/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var Zp=Object.create;var Qi=Object.defineProperty;var jp=Object.getOwnPropertyDescriptor;var ef=Object.getOwnPropertyNames;var tf=Object.getPrototypeOf,Af=Object.prototype.hasOwnProperty;var rf=(B,e,t)=>e in B?Qi(B,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):B[e]=t;var We=(B,e)=>()=>(B&&(e=B(B=0)),e);var sf=(B,e)=>()=>(e||B((e={exports:{}}).exports,e),e.exports),rA=(B,e)=>{for(var t in e)Qi(B,t,{get:e[t],enumerable:!0})},Wl=(B,e,t,A)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ef(e))!Af.call(B,i)&&i!==t&&Qi(B,i,{get:()=>e[i],enumerable:!(A=jp(e,i))||A.enumerable});return B};var Xl=(B,e,t)=>(t=B!=null?Zp(tf(B)):{},Wl(e||!B||!B.__esModule?Qi(t,"default",{value:B,enumerable:!0}):t,B)),nf=B=>Wl(Qi({},"__esModule",{value:!0}),B);var ye=(B,e,t)=>rf(B,typeof e!="symbol"?e+"":e,t);var Jl,Yl=We(()=>{Jl={"Ollama (Local)":"Ollama (local)",Model:"Model",Save:"Save",Cancel:"Cancel",Edit:"Edit",Delete:"Delete","Custom Model":"Custom model","Checking...":"Checking...","Cloze card":"Cloze card","Cloze card content":"Cloze card content","Cloze card answer":"Cloze card answer","Select the AI service provider":"Select the AI service provider.","API Key":"API key","Please enter your API Key.":"Please enter your API key.","API Key is valid!":"API Key is valid!","API Key and model available.":"API Key and model available.","Invalid API Key or server error. Please verify your API Key.":"Invalid API Key or server error. Please verify your API Key.","Select a model or enter a custom one.":"Select a model or enter a custom one.","Provider URL":"Provider URL","Leave it blank, unless you are using a proxy.":"Leave it blank, unless you are using a proxy.","Please enter an API Key first":"Please enter an API Key first.","Custom model unavailable. Please check the model ID and your access permissions.":"Custom model unavailable. Please check the model ID and your access permissions.","OpenAI service":"OpenAI service","No models available. Please check your API Key.":"No models available. Please check your API Key.","Anthropic service":"Anthropic service","Model ID can only contain letters, numbers, underscores, dots and hyphens.":"Model ID can only contain letters, numbers, underscores, dots and hyphens.","Unable to create model selection dropdown menu.":"Unable to create model selection dropdown menu.","Gemini service":"Gemini service","Deepseek service":"Deepseek service","Custom AI Service":"Custom AI Service","Configure your own AI service provider. Supports OpenAI, Anthropic, and Gemini compatible APIs.":"Configure your own AI service provider. Supports OpenAI, Anthropic, and Gemini compatible APIs.","The API type will be automatically detected based on your URL.":"The API type will be automatically detected based on your URL.","Service Name":"Service Name","Give your custom AI service a name":"Give your custom AI service a name","e.g., My AI Service":"e.g., My AI Service","API Endpoint URL":"API Endpoint URL","The base URL of your AI service API":"The base URL of your AI service API","Your API key for authentication":"Your API key for authentication","Test Connection":"Test Connection","Testing...":"Testing...","Please fill in all required fields first":"Please fill in all required fields first","Connection successful! Detected API type: ":"Connection successful! Detected API type: ","Connection successful!":"Connection successful!","Connection failed. Please check your settings.":"Connection failed. Please check your settings.","Connection failed: ":"Connection failed: ","The model identifier to use":"The model identifier to use","gpt-4, claude-3-opus, gemini-pro, etc.":"gpt-4, claude-3-opus, gemini-pro, etc.","Detected API Type: ":"Detected API Type: ","Advanced Options":"Advanced Options","Optional custom headers (JSON format)":"Optional custom headers (JSON format)",'Example: {"X-Custom-Header": "value"}':'Example: {"X-Custom-Header": "value"}',"Invalid JSON format. Headers must be an object.":"Invalid JSON format. Headers must be an object.","Invalid JSON format":"Invalid JSON format",Expand:"Expand",Collapse:"Collapse","Ollama service":"Ollama service","Ollama server URL (default: http://localhost:11434)":"Ollama server URL (default: http://localhost:11434)",Check:"Check","Server URL":"Server URL","Successfully connected to Ollama service":"Successfully connected to Ollama service.","No models found. Please download models using ollama":"No models found. Please download models using ollama.","Could not connect to Ollama service":"Could not connect to Ollama service","Failed to connect to Ollama service. Please check the server URL.":"Failed to connect to Ollama service. Please check the server URL.","Currently selected model (Test connection to see all available models)":"Currently selected model (Test connection to see all available models)","Select a Ollama model.":"Select a Ollama model.","No models available. Please load an available model first.":"No models available. Please load an available model first.","No models available":"No models available","Prompt settings":"Custom prompt","Add Prompt":"Add prompt","Input Prompt Name":"Input prompt name","Input Prompt Content\nAvailable parameters:\n{{highlight}} - Current highlighted text\n{{comment}} - Existing comment":`Input prompt content
Available parameters:
{{highlight}} - Current highlighted text
{{comment}} - Existing comment`,"Prompt added":"Prompt added","Prompt updated":"Prompt updated","Shift + Enter Wrap, Enter Save":"Shift + Enter Wrap, Enter Save","Tab AI, Shift + Enter Wrap, Enter Save":"Tab AI, Shift + Enter Wrap, Enter Save","Please enter AI instruction":"Please enter AI instruction","AI response generated":"AI response generated","AI generation failed":"AI generation failed","Delete comment":"Delete","Add Comment":"Add comment","Export as Image":"Export as image","Select Prompt":"Select prompt","Please add Prompt in the settings first":"Please add prompt in the settings first","AI comments have been added":"AI comments have been added","AI comments failed:":"AI comments failed:",Chat:"Chat","Failed to process dropped highlight:":"Failed to process dropped highlight:","highlighted notes":" highlighted notes","Input message...":"Input message...","Unable to access the Ollama model, please check the service.":"Unable to access the Ollama model, please check the service.","Unable to get Gemini model list, please check API Key and network connection.":"Unable to get Gemini model list, please check API key and network connection.",Download:"Download","Export successful!":"Export successful!","Export failed, please try again.":"Export failed, please try again.","Loading...":"Loading...","Search...":"Search...","No matching content found.":"No matching content found.","The current document has no highlighted content.":"The current document has no highlighted content.","No corresponding file found.":"No corresponding file found.","Export failed: Failed to load necessary components.":"Export failed: Failed to load necessary components.","All Highlight":"All highlight","Export as notes":"Export as notes","Add File Comment":"Add file comment","File Comment":"File comment","Successfully exported highlights to: ":"Successfully exported highlights to: ","Failed to export highlights: ":"Failed to export highlights: ","Default Template":"Default template","Modern minimalist knowledge card style":"Modern minimalist knowledge card style","Academic Template":"Academic template","Formal style suitable for academic citations":"Formal style suitable for academic citations","Social Template":"Social template","Modern style suitable for social media sharing":"Modern style suitable for social media sharing","Open AI chat window":"Open AI chat window","Open HiNote window":"Open HiNote window",General:"Highlight","Export Path":"Export path","Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.":"Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.",Exclusions:"Exclusions","Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md":"Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md","Custom text extraction":"Custom text extraction","Use Custom Pattern":"Use custom pattern","Enable to use a custom regular expression for extracting text.":"Enable to use a custom regular expression for extracting text.","Custom Pattern":"Custom pattern","Enter a custom regular expression for extracting text. Use capture groups () to specify the text to extract. The first non-empty capture group will be used as the extracted text.":"Enter a custom regular expression for extracting text. Use capture groups () to specify the text to extract. The first non-empty capture group will be used as the extracted text.","Default Color":"Default color","Set the default color for decorators when no color is specified. Leave empty to use system default.":"Set the default color for decorators when no color is specified. Leave empty to use system default.","Show Comment Widget":"Show comment widget","Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.":"Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.","Export template":"Export template","Clean orphaned data":"Clean orphaned data","Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.":"Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.","Flashcard learning":"Flashcard learning","New cards per day":"New cards per day","Maximum number of new cards to learn each day":"Maximum number of new cards to learn each day.","Reviews per day":"Reviews per day","Maximum number of cards to review each day":"Maximum number of cards to review each day.","Target retention":"Target retention","Target memory retention rate (0.8 = 80%)":"Target memory retention rate (0.8 = 80%).","Maximum interval":"Maximum interval","Maximum interval in days between reviews":"Maximum interval in days between reviews.","Reset daily stats":"Reset daily stats","Reset today's learning statistics":"Reset today's learning statistics.",Reset:"Reset","Daily statistics have been reset":"Daily statistics have been reset","No statistics to reset for today":"No statistics to reset for today",Advanced:"Advanced","These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm.":"These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm.","Reset algorithm parameters":"Reset algorithm parameters","Reset the FSRS algorithm parameters to default values":"Reset the FSRS algorithm parameters to default values.","Reset to Default":"Reset to default","FSRS parameters have been reset to default values":"FSRS parameters have been reset to default values.",days:"days","Activate HiCard":"Activate HiCard","Enter your license key to activate HiCard feature.":"Enter your license key to activate HiCard feature.","Get your license key from":"Get your license key from","HiNote official website":"HiNote official website","Enter license key":"Enter license key",Activate:"Activate","Please enter a license key":"Please enter a license key","HiCard activated successfully!":"HiCard activated successfully!","Invalid license key":"Invalid license key","Use global settings":"Use global settings","New cards per day:":"New cards per day:","Reviews per day:":"Reviews per day:","Create Group":"Create group",Create:"Create",Again:"Again",Hard:"Hard",Good:"Good",Easy:"Easy",Card:"Card",of:"of",Settings:"Settings","Are you sure you want to delete this group?":"Are you sure you want to delete this group?",Yes:"Yes",No:"No","You've completed All cards for today!":"You've completed All cards for today!","No cards available.":"No cards available.","Return to First Card":"Return to First Card","Edit Group":"Edit group","Create New Group":"Create new group","Please fill in all fields":"Please fill in all fields","Saving...":"Saving...","Creating...":"Creating...","Group updated successfully":"Group updated successfully","Failed to update group":"Failed to update group","Group created successfully":"Group created successfully","Failed to create or update group":"Failed to create or update group",Retention:"Retention","Limits:":"Limits:","Learning completed!":"Learning completed!","Group deleted":"Group deleted","search-prefix-all":"match all file highlights","search-prefix-hicard":"match flashcards only","search-prefix-comment":"match with comments only","search-prefix-path":"match path of the file","Open (DoubleClick)":"Open (double-click)",Testing:"Testing",connection:"connection","connection successful!":"connection successful!","connection failed. Please check your configuration.":"connection failed. Please check your configuration.","test failed":"test failed","Please enter your":"Please enter your","API Key first.":"API Key first.","host address first.":"host address first.","Invalid API Key":"Invalid API Key","Access denied":"Access denied","Rate limit exceeded":"Rate limit exceeded","Connection timeout":"Connection timeout","Service unavailable":"Service unavailable","Service not found":"Service not found","Server error":"Server error","Detected API type":"Detected API type"}});var $l,zl=We(()=>{$l={"Ollama (Local)":"Ollama (\u672C\u5730)",Model:"\u6A21\u578B",Save:"\u4FDD\u5B58",Cancel:"\u53D6\u6D88",Edit:"\u7F16\u8F91",Delete:"\u5220\u9664","Custom Model":"\u81EA\u5B9A\u4E49\u6A21\u578B","Checking...":"\u68C0\u67E5\u4E2D...","Cloze card":"\u6316\u7A7A\u5361\u7247","Cloze card content":"\u6316\u7A7A\u5361\u7247\u5185\u5BB9","Cloze card answer":"\u6316\u7A7A\u5361\u7247\u7B54\u6848","Select the AI service provider":"\u9009\u62E9 AI \u670D\u52A1\u63D0\u4F9B\u5546\u3002","API Key":"API \u5BC6\u94A5","Please enter your API Key.":"\u8BF7\u8F93\u5165\u60A8\u7684 API \u5BC6\u94A5\u3002","API Key is valid!":"API \u5BC6\u94A5\u6709\u6548\uFF01","API Key and model available.":"API \u5BC6\u94A5\u548C\u6A21\u578B\u53EF\u7528\uFF01","Invalid API Key or server error. Please verify your API Key.":"API\u5BC6\u94A5\u65E0\u6548\u6216\u670D\u52A1\u5668\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u5BC6\u94A5\u3002","Select a model or enter a custom one.":"\u9009\u62E9\u6A21\u578B\u6216\u8F93\u5165\u81EA\u5B9A\u4E49\u6A21\u578B\u3002","Provider URL":"\u670D\u52A1\u5730\u5740","Leave it blank, unless you are using a proxy.":"\u7559\u7A7A\uFF0C\u9664\u975E\u60A8\u4F7F\u7528\u4EE3\u7406\u3002","Please enter an API Key first":"\u8BF7\u5148\u8F93\u5165 API \u5BC6\u94A5\u3002","Custom model unavailable. Please check the model ID and your access permissions.":"\u81EA\u5B9A\u4E49\u6A21\u578B\u4E0D\u53EF\u7528\u3002\u8BF7\u68C0\u67E5\u6A21\u578B ID \u548C\u60A8\u7684\u8BBF\u95EE\u6743\u9650\u3002","OpenAI service":"OpenAI \u670D\u52A1","No models available. Please check your API Key.":"\u6CA1\u6709\u53EF\u7528\u7684\u6A21\u578B\u3002\u8BF7\u68C0\u67E5\u60A8\u7684 API \u5BC6\u94A5\u3002","Anthropic service":"Anthropic \u670D\u52A1","Model ID can only contain letters, numbers, underscores, dots and hyphens.":"\u6A21\u578B ID \u53EA\u80FD\u5305\u542B\u5B57\u6BCD\u3001\u6570\u5B57\u3001\u4E0B\u5212\u7EBF\u3001\u70B9\u548C\u8FDE\u5B57\u7B26","Unable to create model selection dropdown menu.":"\u65E0\u6CD5\u521B\u5EFA\u6A21\u578B\u9009\u62E9\u4E0B\u62C9\u83DC\u5355\u3002","Gemini service":"Gemini \u670D\u52A1","Deepseek service":"Deepseek \u670D\u52A1","Custom AI Service":"\u81EA\u5B9A\u4E49 AI \u670D\u52A1","Configure your own AI service provider. Supports OpenAI, Anthropic, and Gemini compatible APIs.":"\u914D\u7F6E\u60A8\u81EA\u5DF1\u7684 AI \u670D\u52A1\u5546\u3002\u652F\u6301 OpenAI\u3001Anthropic \u548C Gemini \u517C\u5BB9\u7684 API\u3002","The API type will be automatically detected based on your URL.":"API \u7C7B\u578B\u5C06\u6839\u636E\u60A8\u7684 URL \u81EA\u52A8\u68C0\u6D4B\u3002","Service Name":"\u670D\u52A1\u540D\u79F0","Give your custom AI service a name":"\u4E3A\u60A8\u7684\u81EA\u5B9A\u4E49 AI \u670D\u52A1\u547D\u540D","e.g., My AI Service":"\u4F8B\u5982\uFF1A\u6211\u7684 AI \u670D\u52A1","API Endpoint URL":"API \u7AEF\u70B9 URL","The base URL of your AI service API":"\u60A8\u7684 AI \u670D\u52A1 API \u7684\u57FA\u7840 URL","Your API key for authentication":"\u7528\u4E8E\u8EAB\u4EFD\u9A8C\u8BC1\u7684 API \u5BC6\u94A5","Test Connection":"\u6D4B\u8BD5\u8FDE\u63A5","Testing...":"\u6D4B\u8BD5\u4E2D...","Please fill in all required fields first":"\u8BF7\u5148\u586B\u5199\u6240\u6709\u5FC5\u586B\u5B57\u6BB5","Connection successful! Detected API type: ":"\u8FDE\u63A5\u6210\u529F\uFF01\u68C0\u6D4B\u5230\u7684 API \u7C7B\u578B\uFF1A","Connection successful!":"\u8FDE\u63A5\u6210\u529F\uFF01","Connection failed. Please check your settings.":"\u8FDE\u63A5\u5931\u8D25\u3002\u8BF7\u68C0\u67E5\u60A8\u7684\u8BBE\u7F6E\u3002","Connection failed: ":"\u8FDE\u63A5\u5931\u8D25\uFF1A","The model identifier to use":"\u8981\u4F7F\u7528\u7684\u6A21\u578B\u6807\u8BC6\u7B26","gpt-4, claude-3-opus, gemini-pro, etc.":"gpt-4\u3001claude-3-opus\u3001gemini-pro \u7B49","Detected API Type: ":"\u68C0\u6D4B\u5230\u7684 API \u7C7B\u578B\uFF1A","Advanced Options":"\u9AD8\u7EA7\u9009\u9879","Optional custom headers (JSON format)":"\u53EF\u9009\u7684\u81EA\u5B9A\u4E49\u8BF7\u6C42\u5934\uFF08JSON \u683C\u5F0F\uFF09",'Example: {"X-Custom-Header": "value"}':'\u793A\u4F8B\uFF1A{"X-Custom-Header": "value"}',"Invalid JSON format. Headers must be an object.":"\u65E0\u6548\u7684 JSON \u683C\u5F0F\u3002\u8BF7\u6C42\u5934\u5FC5\u987B\u662F\u4E00\u4E2A\u5BF9\u8C61\u3002","Invalid JSON format":"\u65E0\u6548\u7684 JSON \u683C\u5F0F",Expand:"\u5C55\u5F00",Collapse:"\u6536\u8D77","Ollama service":"Ollama \u670D\u52A1","Ollama server URL (default: http://localhost:11434)":"Ollama server URL\uFF08\u9ED8\u8BA4\uFF1Ahttp://localhost:11434\uFF09",Check:"\u9A8C\u8BC1","Server URL":"\u670D\u52A1\u5668 URL","Successfully connected to Ollama service":"\u6210\u529F\u8FDE\u63A5\u5230 Ollama \u670D\u52A1","No models found. Please download models using ollama":"\u672A\u627E\u5230\u6A21\u578B\u3002\u8BF7\u4F7F\u7528 ollama \u4E0B\u8F7D\u6A21\u578B","Could not connect to Ollama service":"\u65E0\u6CD5\u8FDE\u63A5\u5230 Ollama \u670D\u52A1","Failed to connect to Ollama service. Please check the server URL.":"\u65E0\u6CD5\u8FDE\u63A5\u5230 Ollama \u670D\u52A1\uFF0C\u8BF7\u68C0\u67E5 server URL\u3002","Currently selected model (Test connection to see all available models)":"\u5F53\u524D\u9009\u62E9\u7684\u6A21\u578B\uFF08\u6D4B\u8BD5\u8FDE\u63A5\u4EE5\u67E5\u770B\u53EF\u7528\u6A21\u578B\uFF09","Select a Ollama model.":"\u9009\u62E9\u4E00\u4E2A Ollama \u6A21\u578B","No models available. Please load an available model first.":"\u65E0\u53EF\u7528\u6A21\u578B\uFF0C\u8BF7\u5148\u52A0\u8F7D\u53EF\u7528\u6A21\u578B\u3002","No models available":"\u65E0\u53EF\u7528\u6A21\u578B","Prompt settings":"\u81EA\u5B9A\u4E49 Prompt","Add Prompt":"\u6DFB\u52A0 Prompt","Input Prompt Name":"\u8F93\u5165 Prompt \u540D\u79F0","Input Prompt Content\nAvailable parameters:\n{{highlight}} - Current highlighted text\n{{comment}} - Existing comment":`\u8F93\u5165 Prompt \u5185\u5BB9
\u53EF\u7528\u53C2\u6570:
{{highlight}} - \u5F53\u524D\u9AD8\u4EAE\u6587\u672C
{{comment}} - \u5DF2\u5B58\u5728\u7684\u6CE8\u91CA`,"Prompt added":"Prompt \u5DF2\u6DFB\u52A0","Prompt updated":"Prompt \u5DF2\u66F4\u65B0","Shift + Enter Wrap, Enter Save":"Shift + Enter \u6362\u884C\uFF0CEnter \u4FDD\u5B58","Tab AI, Shift + Enter Wrap, Enter Save":"Tab AI\uFF0CShift + Enter \u6362\u884C\uFF0CEnter \u4FDD\u5B58","Please enter AI instruction":"\u8BF7\u8F93\u5165AI\u6307\u4EE4","AI response generated":"AI\u54CD\u5E94\u5DF2\u751F\u6210","AI generation failed":"AI\u751F\u6210\u5931\u8D25","Delete comment":"\u5220\u9664\u8BC4\u8BBA","Add Comment":"\u6DFB\u52A0\u8BC4\u8BBA","Export as Image":"\u5BFC\u51FA\u4E3A\u56FE\u7247","Select Prompt":"\u9009\u62E9 Prompt","Please add Prompt in the settings first":"\u8BF7\u5148\u5728\u8BBE\u7F6E\u4E2D\u6DFB\u52A0 Prompt","AI comments added ":"AI \u8BC4\u8BBA\u5DF2\u6DFB\u52A0","AI comments failed:":"AI \u8BC4\u8BBA\u5931\u8D25\uFF1A",Chat:"\u5BF9\u8BDD","Failed to process dropped highlight:":"\u65E0\u6CD5\u5904\u7406\u5220\u9664\u7684\u9AD8\u4EAE\uFF1A","highlighted notes":" \u6761\u9AD8\u4EAE\u7B14\u8BB0","Input message...":"\u8F93\u5165\u6D88\u606F...","Unable to access the Ollama model, please check the service.":"\u65E0\u6CD5\u8BBF\u95EE Ollama \u6A21\u578B\uFF0C\u8BF7\u68C0\u67E5\u670D\u52A1\u662F\u5426\u6B63\u5E38\u8FD0\u884C","Unable to get Gemini model list, please check API Key and network connection.":"\u65E0\u6CD5\u83B7\u53D6 Gemini \u6A21\u578B\u5217\u8868\uFF0C\u8BF7\u68C0\u67E5 API Key \u548C\u7F51\u7EDC\u8FDE\u63A5",Download:"\u4E0B\u8F7D","Export successful!":"\u5BFC\u51FA\u6210\u529F\uFF01","Export failed, please try again.":"\u5BFC\u51FA\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5","Loading...":"\u52A0\u8F7D\u4E2D...","Search...":"\u641C\u7D22\u9AD8\u4EAE\u6216\u8BC4\u8BBA...","No matching content found.":"\u672A\u627E\u5230\u5339\u914D\u7684\u5185\u5BB9\u3002","The current document has no highlighted content.":"\u5F53\u524D\u6587\u6863\u6CA1\u6709\u9AD8\u4EAE\u5185\u5BB9\u3002","No corresponding file found.":"\u672A\u627E\u5230\u76F8\u5E94\u7684\u6587\u4EF6\u3002","Export failed: Failed to load necessary components.":"\u5BFC\u51FA\u5931\u8D25\uFF1A\u52A0\u8F7D\u5FC5\u8981\u7EC4\u4EF6\u5931\u8D25\u3002","All Highlight":"\u5168\u90E8\u9AD8\u4EAE","Export as notes":"\u5BFC\u51FA\u4E3A\u7B14\u8BB0","Add File Comment":"\u6DFB\u52A0\u6587\u4EF6\u8BC4\u8BBA","File Comment":"\u6587\u4EF6\u8BC4\u8BBA","Successfully exported highlights to: ":"\u6210\u529F\u5BFC\u51FA\u9AD8\u4EAE\u5230\uFF1A","Failed to export highlights: ":"\u65E0\u6CD5\u5BFC\u51FA\u9AD8\u4EAE\uFF1A","Default Template":"\u9ED8\u8BA4\u6A21\u677F","Modern minimalist knowledge card style":"\u73B0\u4EE3\u6781\u7B80\u77E5\u8BC6\u5361\u7247\u98CE\u683C","Academic Template":"\u5B66\u672F\u6A21\u677F","Formal style suitable for academic citations":"\u9002\u7528\u4E8E\u5B66\u672F\u5F15\u7528\u7684\u6B63\u5F0F\u98CE\u683C","Social Template":"\u793E\u4EA4\u6A21\u677F","Modern style suitable for social media sharing":"\u9002\u7528\u4E8E\u793E\u4EA4\u5A92\u4F53\u5206\u4EAB\u7684\u73B0\u4EE3\u98CE\u683C","Open AI chat window":"\u6253\u5F00 AI \u5BF9\u8BDD\u7A97\u53E3","Open HiNote window":"\u6253\u5F00 HiNote \u7A97\u53E3","General Settings":"\u901A\u7528\u8BBE\u7F6E","Export Path":"\u5BFC\u51FA\u8DEF\u5F84","Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.":"\u8BBE\u7F6E\u9AD8\u4EAE\u7B14\u8BB0\u7684\u5BFC\u51FA\u8DEF\u5F84\u3002\u7559\u7A7A\u5219\u4F7F\u7528 vault \u6839\u76EE\u5F55\u3002\u8DEF\u5F84\u5E94\u76F8\u5BF9\u4E8E vault \u6839\u76EE\u5F55\u3002",Exclusions:"\u6392\u9664","Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md":"\u9017\u53F7\u5206\u9694\u7684\u8DEF\u5F84\uFF0C\u6807\u7B7E\uFF0C\u7B14\u8BB0\u6807\u9898\u6216\u6587\u4EF6\u6269\u5C55\u540D\uFF0C\u5C06\u4ECE\u9AD8\u4EAE\u4E2D\u6392\u9664\u3002\u4F8B\u5982\uFF1Afolder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md","Custom text extraction":"\u81EA\u5B9A\u4E49\u6587\u672C\u63D0\u53D6","Use Custom Pattern":"\u4F7F\u7528\u81EA\u5B9A\u4E49\u6A21\u5F0F","Enable to use a custom regular expression for extracting text.":"\u542F\u7528\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u4EE5\u63D0\u53D6\u6587\u672C\u3002","Custom Pattern":"\u81EA\u5B9A\u4E49\u6A21\u5F0F","Enter a custom regular expression for extracting text. Use capture groups () to specify the text to extract. The first non-empty capture group will be used as the extracted text.":"\u8F93\u5165\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u4EE5\u63D0\u53D6\u6587\u672C\u3002\u4F7F\u7528\u6355\u83B7\u7EC4 () \u6307\u5B9A\u8981\u63D0\u53D6\u7684\u6587\u672C\u3002\u7B2C\u4E00\u4E2A\u975E\u7A7A\u6355\u83B7\u7EC4\u5C06\u7528\u4F5C\u63D0\u53D6\u7684\u6587\u672C\u3002","Default Color":"\u9ED8\u8BA4\u989C\u8272","Set the default color for decorators when no color is specified. Leave empty to use system default.":"\u8BBE\u7F6E\u5F53\u672A\u6307\u5B9A\u989C\u8272\u65F6\u7684\u88C5\u9970\u5668\u7684\u9ED8\u8BA4\u989C\u8272\u3002\u7559\u7A7A\u4EE5\u4F7F\u7528\u7CFB\u7EDF\u9ED8\u8BA4\u989C\u8272\u3002","Show Comment Widget":"\u663E\u793A\u8BC4\u8BBA\u5C0F\u7EC4\u4EF6","Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.":"\u663E\u793A\u6216\u9690\u85CF\u9AD8\u4EAE\u65C1\u8FB9\u7684\u8BC4\u8BBA\u5C0F\u7EC4\u4EF6\u3002\u7981\u7528\u6B64\u9009\u9879\u53EF\u4EE5\u51CF\u5C11\u9605\u8BFB\u65F6\u7684\u89C6\u89C9\u5E72\u6270\u3002","Export template":"\u5BFC\u51FA\u6A21\u677F","Clean orphaned data":"\u6E05\u7406\u5B64\u7ACB\u6570\u636E","Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.":"\u5220\u9664\u4E0D\u518D\u5B58\u5728\u4E8E\u60A8\u7684\u6587\u6863\u4E2D\u7684\u9AD8\u4EAE\u548C\u6CE8\u91CA\u3002\u8FD9\u5728\u60A8\u5220\u9664\u9AD8\u4EAE\u4F46\u6CE8\u91CA\u4ECD\u7136\u5B58\u50A8\u5728\u6570\u636E\u6587\u4EF6\u4E2D\u65F6\u5F88\u6709\u7528\u3002","Flashcard learning":"\u95EA\u5361\u5B66\u4E60\u8BBE\u7F6E","New cards per day":"\u6BCF\u65E5\u65B0\u5361\u7247\u6570\u91CF","Maximum number of new cards to learn each day":"\u6BCF\u5929\u5B66\u4E60\u7684\u65B0\u5361\u7247\u6700\u5927\u6570\u91CF","Reviews per day":"\u6BCF\u65E5\u590D\u4E60\u6570\u91CF","Maximum number of cards to review each day":"\u6BCF\u5929\u590D\u4E60\u7684\u5361\u7247\u6700\u5927\u6570\u91CF","Target retention":"\u76EE\u6807\u8BB0\u5FC6\u4FDD\u6301\u7387","Target memory retention rate (0.8 = 80%)":"\u76EE\u6807\u8BB0\u5FC6\u4FDD\u6301\u7387\uFF080.8 = 80%\uFF09","Maximum interval":"\u6700\u5927\u95F4\u9694","Maximum interval in days between reviews":"\u590D\u4E60\u4E4B\u95F4\u7684\u6700\u5927\u95F4\u9694\u5929\u6570","Reset daily stats":"\u91CD\u7F6E\u4ECA\u65E5\u7EDF\u8BA1","Reset today's learning statistics":"\u91CD\u7F6E\u4ECA\u5929\u7684\u5B66\u4E60\u7EDF\u8BA1\u6570\u636E",Reset:"\u91CD\u7F6E","Daily statistics have been reset":"\u4ECA\u65E5\u7EDF\u8BA1\u5DF2\u91CD\u7F6E","No statistics to reset for today":"\u4ECA\u5929\u6CA1\u6709\u53EF\u91CD\u7F6E\u7684\u7EDF\u8BA1\u6570\u636E",Advanced:"\u9AD8\u7EA7\u8BBE\u7F6E","These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm.":"\u8FD9\u4E9B\u8BBE\u7F6E\u63A7\u5236FSRS\u7B97\u6CD5\u53C2\u6570\u3002\u4EC5\u5728\u7406\u89E3\u7B97\u6CD5\u7684\u60C5\u51B5\u4E0B\u66F4\u6539\u5B83\u4EEC\u3002","Reset algorithm parameters":"\u91CD\u7F6E\u7B97\u6CD5\u53C2\u6570","Reset the FSRS algorithm parameters to default values":"\u5C06FSRS\u7B97\u6CD5\u53C2\u6570\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C","Reset to default":"\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C","FSRS parameters have been reset to default values":"FSRS\u53C2\u6570\u5DF2\u91CD\u7F6E\u4E3A\u9ED8\u8BA4\u503C",days:"\u5929","FSRS weight parameter. The default value is obtained from a smaller sample; if adjustment is needed, please use the FSRS optimizer for calculation.":"\u7B97\u6CD5\u6743\u91CD\u53C2\u6570\u3002\u9ED8\u8BA4\u503C\u4E3A\u8F83\u5C0F\u6837\u672C\u83B7\u5F97\uFF0C\u5982\u679C\u9700\u8981\u8C03\u6574\u8BF7\u4F7F\u7528 FSRS \u4F18\u5316\u5668\u8BA1\u7B97","FSRS parameters":"FSRS \u53C2\u6570","Edit the 17 FSRS algorithm weights. Format: JSON array of numbers.":"\u7F16\u8F91 17 \u4E2A FSRS \u7B97\u6CD5\u6743\u91CD\u3002\u683C\u5F0F\uFF1A\u6570\u5B57\u6570\u7EC4\u7684 JSON \u683C\u5F0F\u3002","FSRS parameters updated successfully":"FSRS \u53C2\u6570\u66F4\u65B0\u6210\u529F","Activate HiCard":"\u6FC0\u6D3B HiCard","Enter your license key to activate HiCard feature.":"\u8F93\u5165\u60A8\u7684\u8BB8\u53EF\u8BC1\u5BC6\u94A5\u4EE5\u6FC0\u6D3B HiCard \u529F\u80FD\u3002","Get your license key from":"\u4ECE\u4EE5\u4E0B\u7F51\u7AD9\u83B7\u53D6\u8BB8\u53EF\u8BC1\u5BC6\u94A5\uFF1A","HiNote official website":"HiNote \u5B98\u65B9\u7F51\u7AD9","Enter license key":"\u8F93\u5165\u8BB8\u53EF\u8BC1\u5BC6\u94A5",Activate:"\u6FC0\u6D3B","Please enter a license key":"\u8BF7\u8F93\u5165\u8BB8\u53EF\u8BC1\u5BC6\u94A5","HiCard activated successfully!":"HiCard \u6FC0\u6D3B\u6210\u529F\uFF01","Invalid license key":"\u65E0\u6548\u7684\u8BB8\u53EF\u8BC1\u5BC6\u94A5","Use global settings":"\u4F7F\u7528\u5168\u5C40\u8BBE\u7F6E","New cards per day:":"\u6BCF\u65E5\u65B0\u5361\u6570\u91CF:","Reviews per day:":"\u6BCF\u65E5\u590D\u4E60\u6570\u91CF:","Create group":"\u521B\u5EFA\u5206\u7EC4",Create:"\u521B\u5EFA",Again:"\u91CD\u6765",Hard:"\u56F0\u96BE",Good:"\u826F\u597D",Easy:"\u7B80\u5355",Card:"\u5361\u7247",of:"\u5171",Settings:"\u8BBE\u7F6E","Are you sure you want to delete this group?":"\u786E\u5B9A\u8981\u5220\u9664\u6B64\u5206\u7EC4\u5417\uFF1F",Yes:"\u662F",No:"\u5426","You've completed All cards for today!":"\u60A8\u4ECA\u5929\u5DF2\u5B8C\u6210\u6240\u6709\u5361\u7247\uFF01","No cards available.":"\u6CA1\u6709\u53EF\u7528\u7684\u5361\u7247\u3002","Return to First Card":"\u8FD4\u56DE\u7B2C\u4E00\u5F20\u5361\u7247","Edit Group":"\u7F16\u8F91\u5206\u7EC4","Create New Group":"\u521B\u5EFA\u65B0\u5206\u7EC4","Please fill in all fields":"\u8BF7\u586B\u5199\u6240\u6709\u5B57\u6BB5","Saving...":"\u4FDD\u5B58\u4E2D...","Creating...":"\u521B\u5EFA\u4E2D...","Group updated successfully":"\u5206\u7EC4\u66F4\u65B0\u6210\u529F","Failed to update group":"\u5206\u7EC4\u66F4\u65B0\u5931\u8D25","Group created successfully":"\u5206\u7EC4\u521B\u5EFA\u6210\u529F","Failed to create or update group":"\u521B\u5EFA\u6216\u66F4\u65B0\u5206\u7EC4\u5931\u8D25",Retention:"\u4FDD\u7559\u7387","Limits:":"\u9650\u5236\uFF1A","Learning completed!":"\u5B66\u4E60\u5B8C\u6210\uFF01","Group deleted":"\u5206\u7EC4\u5DF2\u5220\u9664","search-prefix-all":"\u8DE8\u6587\u4EF6\u641C\u7D22\u6240\u6709\u9AD8\u4EAE","search-prefix-hicard":"\u53EA\u641C\u7D22\u95EA\u5361\u9AD8\u4EAE","search-prefix-comment":"\u53EA\u641C\u7D22\u5E26\u6279\u6CE8\u7684\u9AD8\u4EAE","search-prefix-path":"\u6309\u6587\u4EF6\u8DEF\u5F84\u641C\u7D22\u9AD8\u4EAE","Open (double-click)":"\u53CC\u51FB\u6253\u5F00",Testing:"\u6B63\u5728\u6D4B\u8BD5",connection:"\u8FDE\u63A5","connection successful!":"\u8FDE\u63A5\u6210\u529F\uFF01","connection failed. Please check your configuration.":"\u8FDE\u63A5\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u914D\u7F6E\u3002","test failed":"\u6D4B\u8BD5\u5931\u8D25","Please enter your":"\u8BF7\u5148\u8F93\u5165","API Key first.":"API Key\u3002","host address first.":"\u670D\u52A1\u5730\u5740\u3002","Invalid API Key":"\u65E0\u6548\u7684 API Key","Access denied":"\u8BBF\u95EE\u88AB\u62D2\u7EDD","Rate limit exceeded":"\u8D85\u51FA\u901F\u7387\u9650\u5236","Connection timeout":"\u8FDE\u63A5\u8D85\u65F6","Service unavailable":"\u670D\u52A1\u4E0D\u53EF\u7528","Service not found":"\u670D\u52A1\u672A\u627E\u5230","Server error":"\u670D\u52A1\u5668\u9519\u8BEF","Detected API type":"\u68C0\u6D4B\u5230\u7684 API \u7C7B\u578B"}});function p(B){let A=(Zl.moment.locale().startsWith("zh")?ql.zh:ql.en)[B];return A||B}var Zl,ql,W=We(()=>{Zl=require("obsidian");Yl();zl();ql={en:Jl,zh:$l}});var Ha,Rt,ts=We(()=>{Ha=require("obsidian"),Rt=class{async request(e){try{let t={url:e.url,method:e.method,headers:e.headers||{},body:e.body,throw:!1},A=await(0,Ha.requestUrl)(t);if(A.status<200||A.status>=300)throw this.createHTTPError(A);return A.json}catch(t){throw this.handleError(t)}}async testConnection(e){try{let t=await(0,Ha.requestUrl)({url:e.url,method:e.method,headers:e.headers||{},body:e.body,throw:!1});return t.status>=200&&t.status<300}catch(t){return!1}}createHTTPError(e){let t=`HTTP ${e.status}`;try{let A=e.json;A!=null&&A.error?typeof A.error=="string"?t=A.error:A.error.message&&(t=A.error.message):e.text&&(t=e.text)}catch(A){e.text&&(t=e.text)}return new Error(t)}handleError(e){return e instanceof Error?e:typeof e=="string"?new Error(e):new Error("Unknown error occurred")}static buildJSONHeaders(e){return{"Content-Type":"application/json",...e}}static buildAuthHeaders(e,t="Bearer"){return t==="Bearer"?{"Content-Type":"application/json",Authorization:`Bearer ${e}`}:{"Content-Type":"application/json","x-api-key":e}}}});var Me,Ac=We(()=>{Me=class B extends Error{constructor(t,A,i,n){super(t);this.provider=A;this.code=i;this.originalError=n;this.name="AIServiceError",Error.captureStackTrace&&Error.captureStackTrace(this,B)}static notConfigured(t,A){let i=A?`${t} service not configured: ${A}`:`${t} service not configured`;return new B(i,t,"NOT_CONFIGURED")}static connectionFailed(t,A){return new B(`Failed to connect to ${t} service`,t,"CONNECTION_FAILED",A)}static invalidResponse(t,A){let i=A?`Invalid response from ${t}: ${A}`:`Invalid response from ${t}`;return new B(i,t,"INVALID_RESPONSE")}static apiError(t,A,i){return new B(A,t,"API_ERROR",i)}}});var nt,dt=We(()=>{ts();Ac();nt=class{constructor(e){var t,A;this.httpClient=new Rt,this.apiKey=e.apiKey,this.model=e.model,this.baseUrl=e.baseUrl||this.getDefaultBaseUrl(),this.temperature=(t=e.temperature)!=null?t:.7,this.maxTokens=(A=e.maxTokens)!=null?A:2048}buildHeaders(){return Rt.buildAuthHeaders(this.apiKey)}updateModel(e){this.model=e}isConfigured(){return!!(this.apiKey&&this.model)}async generateResponse(e){let t=[{role:"user",content:e}];return await this.chat(t)}async chat(e){try{let t=this.buildUrl(),A=this.formatRequestBody(e),i=await this.httpClient.request({url:t,method:"POST",headers:this.buildHeaders(),body:JSON.stringify(A)});return this.parseResponse(i)}catch(t){throw this.handleError(t)}}async testConnection(){try{let e=this.buildUrl(),t=[{role:"user",content:"test"}],A=this.formatRequestBody(t);return await this.httpClient.testConnection({url:e,method:"POST",headers:this.buildHeaders(),body:JSON.stringify(A)})}catch(e){return!1}}buildUrl(){return`${this.baseUrl}${this.getEndpoint()}`}handleError(e){if(e instanceof Me)return e;let t="API_ERROR",A=e.message||"Unknown error";return A.includes("connect")||A.includes("ECONNREFUSED")?t="CONNECTION_FAILED":A.includes("rate limit")||A.includes("429")?t="RATE_LIMIT":A.includes("401")||A.includes("403")||A.includes("API key")?t="INVALID_API_KEY":(A.includes("404")||A.includes("model"))&&(t="MODEL_NOT_FOUND"),new Me(A,this.getProviderType(),t,e instanceof Error?e:void 0)}validateResponse(e,t){let A=e;for(let i of t){if(!A||typeof A!="object"||!(i in A))return!1;A=A[i]}return!0}}});var ic={};rA(ic,{AnthropicService:()=>kA});var kA,As=We(()=>{dt();kA=class extends nt{constructor(e,t,A){let i={apiKey:e,model:A||"claude-opus-4-1-20250805",baseUrl:t,temperature:.7,maxTokens:4096};super(i),this.apiAddress=t||"https://api.anthropic.com"}getDefaultBaseUrl(){return"https://api.anthropic.com"}getEndpoint(){return"/v1/messages"}buildHeaders(){return{"x-api-key":this.apiKey,"anthropic-version":"2023-06-01","content-type":"application/json"}}formatRequestBody(e){return{model:this.model,max_tokens:this.maxTokens,messages:e}}parseResponse(e){var t,A;if(!((A=(t=e.content)==null?void 0:t[0])!=null&&A.text))throw new Error("Invalid response format from Anthropic API");return e.content[0].text}getProviderType(){return"anthropic"}async listModels(){return[{id:"claude-opus-4-1-20250805",name:"Claude Opus 4.1"},{id:"claude-opus-4-20250514",name:"Claude Opus 4"},{id:"claude-sonnet-4-20250514",name:"Claude Sonnet 4"},{id:"claude-3-7-sonnet-20250219",name:"Claude 3.7 Sonnet"},{id:"claude-3-5-haiku-20241022",name:"Claude 3.5 Haiku"},{id:"claude-3-haiku-20240307",name:"Claude 3 Haiku"}]}}});var rc={};rA(rc,{GeminiService:()=>NA});var NA,is=We(()=>{dt();NA=class extends nt{constructor(e,t="gemini-2.5-flash",A){let i={apiKey:e,model:t,baseUrl:A,temperature:.7,maxTokens:2048};super(i)}getDefaultBaseUrl(){return"https://generativelanguage.googleapis.com"}getEndpoint(){return`/v1/models/${this.model}:generateContent?key=${this.apiKey}`}buildHeaders(){return{"Content-Type":"application/json"}}formatRequestBody(e){var A,i,n,l;return{contents:e.map(c=>({role:c.role==="assistant"?"model":"user",parts:[{text:c.content}]})),generationConfig:{maxOutputTokens:((A=this.generationConfig)==null?void 0:A.maxOutputTokens)||this.maxTokens,temperature:((i=this.generationConfig)==null?void 0:i.temperature)||this.temperature,...((n=this.generationConfig)==null?void 0:n.responseMimeType)&&{responseMimeType:this.generationConfig.responseMimeType},...((l=this.generationConfig)==null?void 0:l.responseSchema)&&{responseSchema:this.generationConfig.responseSchema}}}}parseResponse(e){var t,A,i,n,l;if(!((l=(n=(i=(A=(t=e.candidates)==null?void 0:t[0])==null?void 0:A.content)==null?void 0:i.parts)==null?void 0:n[0])!=null&&l.text))throw new Error("Invalid response format from Gemini API");return e.candidates[0].content.parts[0].text}getProviderType(){return"gemini"}async listModels(){return[{id:"gemini-2.5-flash",name:"Gemini 2.5 Flash"},{id:"gemini-2.5-pro",name:"Gemini 2.5 Pro"},{id:"gemini-2.5-flash-lite",name:"Gemini 2.5 Flash Lite"},{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash (Legacy)"},{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro (Legacy)"},{id:"gemini-2.0-flash",name:"Gemini 2.0 Flash (Legacy)"}]}setGenerationConfig(e){this.generationConfig=e}async generateResponse(e,t){return t&&this.setGenerationConfig(t),super.generateResponse(e)}async chat(e,t){return t&&this.setGenerationConfig(t),super.chat(e)}async generateJSONResponse(e,t){return this.generateResponse(e,{responseMimeType:"application/json",responseSchema:t})}async chatJSON(e,t){return this.chat(e,{responseMimeType:"application/json",responseSchema:t})}async testConnection(){let e=`${this.baseUrl}/v1/models/${this.model}?key=${this.apiKey}`;return await this.httpClient.testConnection({url:e,method:"GET",headers:this.buildHeaders()})}}});var sc={};rA(sc,{DeepseekService:()=>GA});var GA,rs=We(()=>{dt();GA=class extends nt{constructor(e,t="deepseek-chat",A){let i={apiKey:e,model:t,baseUrl:A,temperature:.7,maxTokens:4096};super(i)}getDefaultBaseUrl(){return"https://api.deepseek.com/v1"}getEndpoint(){return"/chat/completions"}formatRequestBody(e){return{model:this.model,messages:e,temperature:this.temperature,max_tokens:this.maxTokens,frequency_penalty:0,presence_penalty:0}}parseResponse(e){var t,A,i;if(!((i=(A=(t=e.choices)==null?void 0:t[0])==null?void 0:A.message)!=null&&i.content))throw new Error("Invalid response format from Deepseek API");return e.choices[0].message.content}getProviderType(){return"deepseek"}async listModels(){return[{id:"deepseek-chat",name:"Deepseek Chat"},{id:"deepseek-reasoner",name:"Deepseek Reasoner"}]}}});var nc={};rA(nc,{SiliconFlowService:()=>VA});var VA,ss=We(()=>{dt();VA=class extends nt{constructor(e){var A;if(!((A=e.siliconflow)!=null&&A.apiKey))throw new Error("SiliconFlow API key is required");let t={apiKey:e.siliconflow.apiKey,model:e.siliconflow.model||"deepseek-ai/DeepSeek-V3",baseUrl:e.siliconflow.baseUrl,temperature:.7,maxTokens:2048};super(t)}getDefaultBaseUrl(){return"https://api.siliconflow.cn/v1"}getEndpoint(){return"/chat/completions"}formatRequestBody(e){return{model:this.model,messages:e,stream:!1}}parseResponse(e){var t,A,i;if(!((i=(A=(t=e.choices)==null?void 0:t[0])==null?void 0:A.message)!=null&&i.content))throw new Error("Unexpected API response format from SiliconFlow");return e.choices[0].message.content}getProviderType(){return"siliconflow"}async listModels(){try{return(await this.httpClient.request({url:`${this.baseUrl}/models`,method:"GET",headers:this.buildHeaders()})).data.map(t=>({id:t.id,name:t.id.split("/").pop()||t.id,isCustom:!1}))}catch(e){throw this.handleError(e)}}}});var ac={};rA(ac,{CustomAIService:()=>WA});var WA,ns=We(()=>{ts();dt();WA=class{constructor(e,t,A,i,n){this.apiKey=e;this.detectedApiType=null;this.baseUrl=t.replace(/\/$/,""),this.model=A,this.customHeaders=i,this.httpClient=new Rt,this.detectedApiType=n||null}async detectAPIType(){if(this.detectedApiType)return this.detectedApiType;let e=this.baseUrl.toLowerCase();if(e.includes("openai")||e.includes("/v1/chat/completions")||e.includes("/chat/completions"))return this.detectedApiType="openai","openai";if(e.includes("anthropic")||e.includes("claude"))return this.detectedApiType="anthropic","anthropic";if(e.includes("gemini")||e.includes("generativelanguage.googleapis.com"))return this.detectedApiType="gemini","gemini";try{return await this.testOpenAIFormat(),this.detectedApiType="openai","openai"}catch(t){}try{return await this.testAnthropicFormat(),this.detectedApiType="anthropic","anthropic"}catch(t){}try{return await this.testGeminiFormat(),this.detectedApiType="gemini","gemini"}catch(t){}return this.detectedApiType="openai","openai"}async testOpenAIFormat(){var A,i,n;let e=this.baseUrl.includes("/chat/completions")?this.baseUrl:`${this.baseUrl}/chat/completions`;return!!((n=(i=(A=(await this.httpClient.request({url:e,method:"POST",headers:this.buildHeaders(),body:JSON.stringify({model:this.model,messages:[{role:"user",content:"test"}],max_tokens:5})})).choices)==null?void 0:A[0])==null?void 0:i.message)!=null&&n.content)}async testAnthropicFormat(){var A,i;let e=this.baseUrl.includes("/messages")?this.baseUrl:`${this.baseUrl}/messages`;return!!((i=(A=(await this.httpClient.request({url:e,method:"POST",headers:{...this.buildHeaders("ApiKey"),"anthropic-version":"2023-06-01"},body:JSON.stringify({model:this.model,messages:[{role:"user",content:"test"}],max_tokens:5})})).content)==null?void 0:A[0])!=null&&i.text)}async testGeminiFormat(){var A,i,n,l,c;let e=`${this.baseUrl}/${this.model}:generateContent`;return!!((c=(l=(n=(i=(A=(await this.httpClient.request({url:`${e}?key=${this.apiKey}`,method:"POST",headers:{"Content-Type":"application/json",...this.customHeaders},body:JSON.stringify({contents:[{parts:[{text:"test"}]}]})})).candidates)==null?void 0:A[0])==null?void 0:i.content)==null?void 0:n.parts)==null?void 0:l[0])!=null&&c.text)}async generateResponse(e){return await this.chat([{role:"user",content:e}])}async chat(e){switch(await this.detectAPIType()){case"openai":return await this.chatOpenAICompatible(e);case"anthropic":return await this.chatAnthropicCompatible(e);case"gemini":return await this.chatGeminiCompatible(e);default:throw new Error("Unsupported API type")}}async chatOpenAICompatible(e){var A,i,n;let t=this.baseUrl.includes("/chat/completions")?this.baseUrl:`${this.baseUrl}/chat/completions`;try{let l=await this.httpClient.request({url:t,method:"POST",headers:this.buildHeaders(),body:JSON.stringify({model:this.model,messages:e,temperature:.7})});if(!((n=(i=(A=l.choices)==null?void 0:A[0])==null?void 0:i.message)!=null&&n.content))throw new Error("Invalid response format from custom AI API");return l.choices[0].message.content}catch(l){throw l instanceof Error?l:new Error("Failed to generate response from custom AI API")}}async chatAnthropicCompatible(e){var A,i;let t=this.baseUrl.includes("/messages")?this.baseUrl:`${this.baseUrl}/messages`;try{let n=await this.httpClient.request({url:t,method:"POST",headers:{...this.buildHeaders("ApiKey"),"anthropic-version":"2023-06-01"},body:JSON.stringify({model:this.model,messages:e,max_tokens:4096})});if(!((i=(A=n.content)==null?void 0:A[0])!=null&&i.text))throw new Error("Invalid response format from custom AI API");return n.content[0].text}catch(n){throw n instanceof Error?n:new Error("Failed to generate response from custom AI API")}}async chatGeminiCompatible(e){var A,i,n,l,c;let t=`${this.baseUrl}/${this.model}:generateContent`;try{let g=e.map(m=>({role:m.role==="assistant"?"model":"user",parts:[{text:m.content}]})),d=await this.httpClient.request({url:`${t}?key=${this.apiKey}`,method:"POST",headers:{"Content-Type":"application/json",...this.customHeaders},body:JSON.stringify({contents:g})});if(!((c=(l=(n=(i=(A=d.candidates)==null?void 0:A[0])==null?void 0:i.content)==null?void 0:n.parts)==null?void 0:l[0])!=null&&c.text))throw new Error("Invalid response format from custom AI API");return d.candidates[0].content.parts[0].text}catch(g){throw g instanceof Error?g:new Error("Failed to generate response from custom AI API")}}updateModel(e){this.model=e}getDetectedAPIType(){return this.detectedApiType}getProviderType(){return"custom"}async listModels(){return[{id:this.model,name:this.model,isCustom:!0}]}isConfigured(){return!!(this.apiKey&&this.baseUrl&&this.model)}async testConnection(){try{switch(await this.detectAPIType()){case"openai":return await this.testOpenAIFormat(),!0;case"anthropic":return await this.testAnthropicFormat(),!0;case"gemini":return await this.testGeminiFormat(),!0;default:return!1}}catch(e){return!1}}buildHeaders(e="Bearer"){let t=Rt.buildAuthHeaders(this.apiKey,e);return this.customHeaders?{...t,...this.customHeaders}:t}}});var oc={};rA(oc,{IdGenerator:()=>tt});var tt,CA=We(()=>{tt=class{static generateHighlightId(e,t,A){let i=`${e}:${t}:${A}`,n=this.hashCode(i);return`highlight-${Math.abs(n)}-${t}`}static generateCommentId(){let e=Date.now(),t=Math.random().toString(36).substr(2,9);return`comment-${e}-${t}`}static generateCardId(){let e=Date.now(),t=Math.random().toString(36).substr(2,9);return`card-${e}-${t}`}static generateGroupId(){let e=Date.now(),t=Math.random().toString(36).substr(2,7);return`group-${e}-${t}`}static hashCode(e){let t=0;if(e.length===0)return t;for(let A=0;A<e.length;A++){let i=e.charCodeAt(A);t=(t<<5)-t+i,t=t&t}return t}static isValidHighlightId(e){return/^highlight-\d+-\d+$/.test(e)}static isValidCommentId(e){return/^comment-\d+-[a-z0-9]+$/.test(e)}static isValidCardId(e){return/^card-\d+-[a-z0-9]+$/.test(e)}static extractPositionFromHighlightId(e){let t=e.match(/^highlight-\d+-(\d+)$/);return t?parseInt(t[1],10):null}}});var xa=sf((ba,Ma)=>{(function(B,e){typeof ba=="object"&&typeof Ma!="undefined"?Ma.exports=e():typeof define=="function"&&define.amd?define(e):(B=typeof globalThis!="undefined"?globalThis:B||self,B.html2canvas=e())})(ba,function(){"use strict";var B=function(s,r){return B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,a){o.__proto__=a}||function(o,a){for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(o[h]=a[h])},B(s,r)};function e(s,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");B(s,r);function o(){this.constructor=s}s.prototype=r===null?Object.create(r):(o.prototype=r.prototype,new o)}var t=function(){return t=Object.assign||function(r){for(var o,a=1,h=arguments.length;a<h;a++){o=arguments[a];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(r[u]=o[u])}return r},t.apply(this,arguments)};function A(s,r,o,a){function h(u){return u instanceof o?u:new o(function(f){f(u)})}return new(o||(o=Promise))(function(u,f){function v(I){try{E(a.next(I))}catch(H){f(H)}}function w(I){try{E(a.throw(I))}catch(H){f(H)}}function E(I){I.done?u(I.value):h(I.value).then(v,w)}E((a=a.apply(s,r||[])).next())})}function i(s,r){var o={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},a,h,u,f;return f={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function v(E){return function(I){return w([E,I])}}function w(E){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,h&&(u=E[0]&2?h.return:E[0]?h.throw||((u=h.return)&&u.call(h),0):h.next)&&!(u=u.call(h,E[1])).done)return u;switch(h=0,u&&(E=[E[0]&2,u.value]),E[0]){case 0:case 1:u=E;break;case 4:return o.label++,{value:E[1],done:!1};case 5:o.label++,h=E[1],E=[0];continue;case 7:E=o.ops.pop(),o.trys.pop();continue;default:if(u=o.trys,!(u=u.length>0&&u[u.length-1])&&(E[0]===6||E[0]===2)){o=0;continue}if(E[0]===3&&(!u||E[1]>u[0]&&E[1]<u[3])){o.label=E[1];break}if(E[0]===6&&o.label<u[1]){o.label=u[1],u=E;break}if(u&&o.label<u[2]){o.label=u[2],o.ops.push(E);break}u[2]&&o.ops.pop(),o.trys.pop();continue}E=r.call(s,o)}catch(I){E=[6,I],h=0}finally{a=u=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function n(s,r,o){if(o||arguments.length===2)for(var a=0,h=r.length,u;a<h;a++)(u||!(a in r))&&(u||(u=Array.prototype.slice.call(r,0,a)),u[a]=r[a]);return s.concat(u||r)}for(var l=function(){function s(r,o,a,h){this.left=r,this.top=o,this.width=a,this.height=h}return s.prototype.add=function(r,o,a,h){return new s(this.left+r,this.top+o,this.width+a,this.height+h)},s.fromClientRect=function(r,o){return new s(o.left+r.windowBounds.left,o.top+r.windowBounds.top,o.width,o.height)},s.fromDOMRectList=function(r,o){var a=Array.from(o).find(function(h){return h.width!==0});return a?new s(a.left+r.windowBounds.left,a.top+r.windowBounds.top,a.width,a.height):s.EMPTY},s.EMPTY=new s(0,0,0,0),s}(),c=function(s,r){return l.fromClientRect(s,r.getBoundingClientRect())},g=function(s){var r=s.body,o=s.documentElement;if(!r||!o)throw new Error("Unable to get document size");var a=Math.max(Math.max(r.scrollWidth,o.scrollWidth),Math.max(r.offsetWidth,o.offsetWidth),Math.max(r.clientWidth,o.clientWidth)),h=Math.max(Math.max(r.scrollHeight,o.scrollHeight),Math.max(r.offsetHeight,o.offsetHeight),Math.max(r.clientHeight,o.clientHeight));return new l(0,0,a,h)},d=function(s){for(var r=[],o=0,a=s.length;o<a;){var h=s.charCodeAt(o++);if(h>=55296&&h<=56319&&o<a){var u=s.charCodeAt(o++);(u&64512)===56320?r.push(((h&1023)<<10)+(u&1023)+65536):(r.push(h),o--)}else r.push(h)}return r},m=function(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];if(String.fromCodePoint)return String.fromCodePoint.apply(String,s);var o=s.length;if(!o)return"";for(var a=[],h=-1,u="";++h<o;){var f=s[h];f<=65535?a.push(f):(f-=65536,a.push((f>>10)+55296,f%1024+56320)),(h+1===o||a.length>16384)&&(u+=String.fromCharCode.apply(String,a),a.length=0)}return u},C="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",F=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),y=0;y<C.length;y++)F[C.charCodeAt(y)]=y;for(var Q="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",U=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),b=0;b<Q.length;b++)U[Q.charCodeAt(b)]=b;for(var P=function(s){var r=s.length*.75,o=s.length,a,h=0,u,f,v,w;s[s.length-1]==="="&&(r--,s[s.length-2]==="="&&r--);var E=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined"&&typeof Uint8Array.prototype.slice!="undefined"?new ArrayBuffer(r):new Array(r),I=Array.isArray(E)?E:new Uint8Array(E);for(a=0;a<o;a+=4)u=U[s.charCodeAt(a)],f=U[s.charCodeAt(a+1)],v=U[s.charCodeAt(a+2)],w=U[s.charCodeAt(a+3)],I[h++]=u<<2|f>>4,I[h++]=(f&15)<<4|v>>2,I[h++]=(v&3)<<6|w&63;return E},q=function(s){for(var r=s.length,o=[],a=0;a<r;a+=2)o.push(s[a+1]<<8|s[a]);return o},k=function(s){for(var r=s.length,o=[],a=0;a<r;a+=4)o.push(s[a+3]<<24|s[a+2]<<16|s[a+1]<<8|s[a]);return o},N=5,G=11,Z=2,ae=G-N,Oe=65536>>N,xe=1<<N,Ye=xe-1,re=1024>>N,Ae=Oe+re,ke=Ae,me=32,Ve=ke+me,$e=65536>>G,_e=1<<ae,Mt=_e-1,_t=function(s,r,o){return s.slice?s.slice(r,o):new Uint16Array(Array.prototype.slice.call(s,r,o))},Ie=function(s,r,o){return s.slice?s.slice(r,o):new Uint32Array(Array.prototype.slice.call(s,r,o))},Wt=function(s,r){var o=P(s),a=Array.isArray(o)?k(o):new Uint32Array(o),h=Array.isArray(o)?q(o):new Uint16Array(o),u=24,f=_t(h,u/2,a[4]/2),v=a[5]===2?_t(h,(u+a[4])/2):Ie(a,Math.ceil((u+a[4])/4));return new Xt(a[0],a[1],a[2],a[3],f,v)},Xt=function(){function s(r,o,a,h,u,f){this.initialValue=r,this.errorValue=o,this.highStart=a,this.highValueIndex=h,this.index=u,this.data=f}return s.prototype.get=function(r){var o;if(r>=0){if(r<55296||r>56319&&r<=65535)return o=this.index[r>>N],o=(o<<Z)+(r&Ye),this.data[o];if(r<=65535)return o=this.index[Oe+(r-55296>>N)],o=(o<<Z)+(r&Ye),this.data[o];if(r<this.highStart)return o=Ve-$e+(r>>G),o=this.index[o],o+=r>>N&Mt,o=this.index[o],o=(o<<Z)+(r&Ye),this.data[o];if(r<=1114111)return this.data[this.highValueIndex]}return this.errorValue},s}(),He="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",it=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),he=0;he<He.length;he++)it[He.charCodeAt(he)]=he;var Le="KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA==",Ue=50,ze=1,Ce=2,Te=3,si=4,Be=5,ft=7,Qe=8,Za=9,Jt=10,Ln=11,ja=12,Tn=13,zc=14,ni=15,Pn=16,nr=17,ai=18,qc=19,eo=20,Dn=21,oi=22,Rn=23,HA=24,rt=25,li=26,ci=27,QA=28,Zc=29,lA=30,jc=31,ar=32,or=33,Kn=34,On=35,kn=36,hi=37,Nn=38,lr=39,cr=40,Gn=41,to=42,eh=43,th=[9001,65288],Ao="!",j="\xD7",hr="\xF7",Vn=Wt(Le),xt=[lA,kn],_n=[ze,Ce,Te,Be],io=[Jt,Qe],ro=[ci,li],Ah=_n.concat(io),so=[Nn,lr,cr,Kn,On],ih=[ni,Tn],rh=function(s,r){r===void 0&&(r="strict");var o=[],a=[],h=[];return s.forEach(function(u,f){var v=Vn.get(u);if(v>Ue?(h.push(!0),v-=Ue):h.push(!1),["normal","auto","loose"].indexOf(r)!==-1&&[8208,8211,12316,12448].indexOf(u)!==-1)return a.push(f),o.push(Pn);if(v===si||v===Ln){if(f===0)return a.push(f),o.push(lA);var w=o[f-1];return Ah.indexOf(w)===-1?(a.push(a[f-1]),o.push(w)):(a.push(f),o.push(lA))}if(a.push(f),v===jc)return o.push(r==="strict"?Dn:hi);if(v===to||v===Zc)return o.push(lA);if(v===eh)return u>=131072&&u<=196605||u>=196608&&u<=262141?o.push(hi):o.push(lA);o.push(v)}),[a,o,h]},Wn=function(s,r,o,a){var h=a[o];if(Array.isArray(s)?s.indexOf(h)!==-1:s===h)for(var u=o;u<=a.length;){u++;var f=a[u];if(f===r)return!0;if(f!==Jt)break}if(h===Jt)for(var u=o;u>0;){u--;var v=a[u];if(Array.isArray(s)?s.indexOf(v)!==-1:s===v)for(var w=o;w<=a.length;){w++;var f=a[w];if(f===r)return!0;if(f!==Jt)break}if(v!==Jt)break}return!1},no=function(s,r){for(var o=s;o>=0;){var a=r[o];if(a===Jt)o--;else return a}return 0},sh=function(s,r,o,a,h){if(o[a]===0)return j;var u=a-1;if(Array.isArray(h)&&h[u]===!0)return j;var f=u-1,v=u+1,w=r[u],E=f>=0?r[f]:0,I=r[v];if(w===Ce&&I===Te)return j;if(_n.indexOf(w)!==-1)return Ao;if(_n.indexOf(I)!==-1||io.indexOf(I)!==-1)return j;if(no(u,r)===Qe)return hr;if(Vn.get(s[u])===Ln||(w===ar||w===or)&&Vn.get(s[v])===Ln||w===ft||I===ft||w===Za||[Jt,Tn,ni].indexOf(w)===-1&&I===Za||[nr,ai,qc,HA,QA].indexOf(I)!==-1||no(u,r)===oi||Wn(Rn,oi,u,r)||Wn([nr,ai],Dn,u,r)||Wn(ja,ja,u,r))return j;if(w===Jt)return hr;if(w===Rn||I===Rn)return j;if(I===Pn||w===Pn)return hr;if([Tn,ni,Dn].indexOf(I)!==-1||w===zc||E===kn&&ih.indexOf(w)!==-1||w===QA&&I===kn||I===eo||xt.indexOf(I)!==-1&&w===rt||xt.indexOf(w)!==-1&&I===rt||w===ci&&[hi,ar,or].indexOf(I)!==-1||[hi,ar,or].indexOf(w)!==-1&&I===li||xt.indexOf(w)!==-1&&ro.indexOf(I)!==-1||ro.indexOf(w)!==-1&&xt.indexOf(I)!==-1||[ci,li].indexOf(w)!==-1&&(I===rt||[oi,ni].indexOf(I)!==-1&&r[v+1]===rt)||[oi,ni].indexOf(w)!==-1&&I===rt||w===rt&&[rt,QA,HA].indexOf(I)!==-1)return j;if([rt,QA,HA,nr,ai].indexOf(I)!==-1)for(var H=u;H>=0;){var S=r[H];if(S===rt)return j;if([QA,HA].indexOf(S)!==-1)H--;else break}if([ci,li].indexOf(I)!==-1)for(var H=[nr,ai].indexOf(w)!==-1?f:u;H>=0;){var S=r[H];if(S===rt)return j;if([QA,HA].indexOf(S)!==-1)H--;else break}if(Nn===w&&[Nn,lr,Kn,On].indexOf(I)!==-1||[lr,Kn].indexOf(w)!==-1&&[lr,cr].indexOf(I)!==-1||[cr,On].indexOf(w)!==-1&&I===cr||so.indexOf(w)!==-1&&[eo,li].indexOf(I)!==-1||so.indexOf(I)!==-1&&w===ci||xt.indexOf(w)!==-1&&xt.indexOf(I)!==-1||w===HA&&xt.indexOf(I)!==-1||xt.concat(rt).indexOf(w)!==-1&&I===oi&&th.indexOf(s[v])===-1||xt.concat(rt).indexOf(I)!==-1&&w===ai)return j;if(w===Gn&&I===Gn){for(var R=o[u],M=1;R>0&&(R--,r[R]===Gn);)M++;if(M%2!==0)return j}return w===ar&&I===or?j:hr},nh=function(s,r){r||(r={lineBreak:"normal",wordBreak:"normal"});var o=rh(s,r.lineBreak),a=o[0],h=o[1],u=o[2];(r.wordBreak==="break-all"||r.wordBreak==="break-word")&&(h=h.map(function(v){return[rt,lA,to].indexOf(v)!==-1?hi:v}));var f=r.wordBreak==="keep-all"?u.map(function(v,w){return v&&s[w]>=19968&&s[w]<=40959}):void 0;return[a,h,f]},ah=function(){function s(r,o,a,h){this.codePoints=r,this.required=o===Ao,this.start=a,this.end=h}return s.prototype.slice=function(){return m.apply(void 0,this.codePoints.slice(this.start,this.end))},s}(),oh=function(s,r){var o=d(s),a=nh(o,r),h=a[0],u=a[1],f=a[2],v=o.length,w=0,E=0;return{next:function(){if(E>=v)return{done:!0,value:null};for(var I=j;E<v&&(I=sh(o,u,h,++E,f))===j;);if(I!==j||E===v){var H=new ah(o,I,w,E);return w=E,{value:H,done:!1}}return{done:!0,value:null}}}},lh=1,ch=2,gi=4,ao=8,gr=10,oo=47,di=92,hh=9,gh=32,dr=34,ui=61,dh=35,uh=36,ph=37,ur=39,pr=40,pi=41,fh=95,qe=45,mh=33,Bh=60,Ch=62,wh=64,vh=91,Fh=93,yh=61,Eh=123,fr=63,Ih=125,lo=124,Hh=126,Qh=128,co=65533,Xn=42,cA=43,Sh=44,Uh=58,bh=59,fi=46,Mh=0,xh=8,Lh=11,Th=14,Ph=31,Dh=127,Ft=-1,ho=48,go=97,uo=101,Rh=102,Kh=117,Oh=122,po=65,fo=69,mo=70,kh=85,Nh=90,Ne=function(s){return s>=ho&&s<=57},Gh=function(s){return s>=55296&&s<=57343},SA=function(s){return Ne(s)||s>=po&&s<=mo||s>=go&&s<=Rh},Vh=function(s){return s>=go&&s<=Oh},_h=function(s){return s>=po&&s<=Nh},Wh=function(s){return Vh(s)||_h(s)},Xh=function(s){return s>=Qh},mr=function(s){return s===gr||s===hh||s===gh},Br=function(s){return Wh(s)||Xh(s)||s===fh},Bo=function(s){return Br(s)||Ne(s)||s===qe},Jh=function(s){return s>=Mh&&s<=xh||s===Lh||s>=Th&&s<=Ph||s===Dh},Yt=function(s,r){return s!==di?!1:r!==gr},Cr=function(s,r,o){return s===qe?Br(r)||Yt(r,o):Br(s)?!0:!!(s===di&&Yt(s,r))},Jn=function(s,r,o){return s===cA||s===qe?Ne(r)?!0:r===fi&&Ne(o):Ne(s===fi?r:s)},Yh=function(s){var r=0,o=1;(s[r]===cA||s[r]===qe)&&(s[r]===qe&&(o=-1),r++);for(var a=[];Ne(s[r]);)a.push(s[r++]);var h=a.length?parseInt(m.apply(void 0,a),10):0;s[r]===fi&&r++;for(var u=[];Ne(s[r]);)u.push(s[r++]);var f=u.length,v=f?parseInt(m.apply(void 0,u),10):0;(s[r]===fo||s[r]===uo)&&r++;var w=1;(s[r]===cA||s[r]===qe)&&(s[r]===qe&&(w=-1),r++);for(var E=[];Ne(s[r]);)E.push(s[r++]);var I=E.length?parseInt(m.apply(void 0,E),10):0;return o*(h+v*Math.pow(10,-f))*Math.pow(10,w*I)},$h={type:2},zh={type:3},qh={type:4},Zh={type:13},jh={type:8},eg={type:21},tg={type:9},Ag={type:10},ig={type:11},rg={type:12},sg={type:14},wr={type:23},ng={type:1},ag={type:25},og={type:24},lg={type:26},cg={type:27},hg={type:28},gg={type:29},dg={type:31},Yn={type:32},Co=function(){function s(){this._value=[]}return s.prototype.write=function(r){this._value=this._value.concat(d(r))},s.prototype.read=function(){for(var r=[],o=this.consumeToken();o!==Yn;)r.push(o),o=this.consumeToken();return r},s.prototype.consumeToken=function(){var r=this.consumeCodePoint();switch(r){case dr:return this.consumeStringToken(dr);case dh:var o=this.peekCodePoint(0),a=this.peekCodePoint(1),h=this.peekCodePoint(2);if(Bo(o)||Yt(a,h)){var u=Cr(o,a,h)?ch:lh,f=this.consumeName();return{type:5,value:f,flags:u}}break;case uh:if(this.peekCodePoint(0)===ui)return this.consumeCodePoint(),Zh;break;case ur:return this.consumeStringToken(ur);case pr:return $h;case pi:return zh;case Xn:if(this.peekCodePoint(0)===ui)return this.consumeCodePoint(),sg;break;case cA:if(Jn(r,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(r),this.consumeNumericToken();break;case Sh:return qh;case qe:var v=r,w=this.peekCodePoint(0),E=this.peekCodePoint(1);if(Jn(v,w,E))return this.reconsumeCodePoint(r),this.consumeNumericToken();if(Cr(v,w,E))return this.reconsumeCodePoint(r),this.consumeIdentLikeToken();if(w===qe&&E===Ch)return this.consumeCodePoint(),this.consumeCodePoint(),og;break;case fi:if(Jn(r,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(r),this.consumeNumericToken();break;case oo:if(this.peekCodePoint(0)===Xn)for(this.consumeCodePoint();;){var I=this.consumeCodePoint();if(I===Xn&&(I=this.consumeCodePoint(),I===oo))return this.consumeToken();if(I===Ft)return this.consumeToken()}break;case Uh:return lg;case bh:return cg;case Bh:if(this.peekCodePoint(0)===mh&&this.peekCodePoint(1)===qe&&this.peekCodePoint(2)===qe)return this.consumeCodePoint(),this.consumeCodePoint(),ag;break;case wh:var H=this.peekCodePoint(0),S=this.peekCodePoint(1),R=this.peekCodePoint(2);if(Cr(H,S,R)){var f=this.consumeName();return{type:7,value:f}}break;case vh:return hg;case di:if(Yt(r,this.peekCodePoint(0)))return this.reconsumeCodePoint(r),this.consumeIdentLikeToken();break;case Fh:return gg;case yh:if(this.peekCodePoint(0)===ui)return this.consumeCodePoint(),jh;break;case Eh:return ig;case Ih:return rg;case Kh:case kh:var M=this.peekCodePoint(0),L=this.peekCodePoint(1);return M===cA&&(SA(L)||L===fr)&&(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(r),this.consumeIdentLikeToken();case lo:if(this.peekCodePoint(0)===ui)return this.consumeCodePoint(),tg;if(this.peekCodePoint(0)===lo)return this.consumeCodePoint(),eg;break;case Hh:if(this.peekCodePoint(0)===ui)return this.consumeCodePoint(),Ag;break;case Ft:return Yn}return mr(r)?(this.consumeWhiteSpace(),dg):Ne(r)?(this.reconsumeCodePoint(r),this.consumeNumericToken()):Br(r)?(this.reconsumeCodePoint(r),this.consumeIdentLikeToken()):{type:6,value:m(r)}},s.prototype.consumeCodePoint=function(){var r=this._value.shift();return typeof r=="undefined"?-1:r},s.prototype.reconsumeCodePoint=function(r){this._value.unshift(r)},s.prototype.peekCodePoint=function(r){return r>=this._value.length?-1:this._value[r]},s.prototype.consumeUnicodeRangeToken=function(){for(var r=[],o=this.consumeCodePoint();SA(o)&&r.length<6;)r.push(o),o=this.consumeCodePoint();for(var a=!1;o===fr&&r.length<6;)r.push(o),o=this.consumeCodePoint(),a=!0;if(a){var h=parseInt(m.apply(void 0,r.map(function(w){return w===fr?ho:w})),16),u=parseInt(m.apply(void 0,r.map(function(w){return w===fr?mo:w})),16);return{type:30,start:h,end:u}}var f=parseInt(m.apply(void 0,r),16);if(this.peekCodePoint(0)===qe&&SA(this.peekCodePoint(1))){this.consumeCodePoint(),o=this.consumeCodePoint();for(var v=[];SA(o)&&v.length<6;)v.push(o),o=this.consumeCodePoint();var u=parseInt(m.apply(void 0,v),16);return{type:30,start:f,end:u}}else return{type:30,start:f,end:f}},s.prototype.consumeIdentLikeToken=function(){var r=this.consumeName();return r.toLowerCase()==="url"&&this.peekCodePoint(0)===pr?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===pr?(this.consumeCodePoint(),{type:19,value:r}):{type:20,value:r}},s.prototype.consumeUrlToken=function(){var r=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Ft)return{type:22,value:""};var o=this.peekCodePoint(0);if(o===ur||o===dr){var a=this.consumeStringToken(this.consumeCodePoint());return a.type===0&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Ft||this.peekCodePoint(0)===pi)?(this.consumeCodePoint(),{type:22,value:a.value}):(this.consumeBadUrlRemnants(),wr)}for(;;){var h=this.consumeCodePoint();if(h===Ft||h===pi)return{type:22,value:m.apply(void 0,r)};if(mr(h))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Ft||this.peekCodePoint(0)===pi?(this.consumeCodePoint(),{type:22,value:m.apply(void 0,r)}):(this.consumeBadUrlRemnants(),wr);if(h===dr||h===ur||h===pr||Jh(h))return this.consumeBadUrlRemnants(),wr;if(h===di)if(Yt(h,this.peekCodePoint(0)))r.push(this.consumeEscapedCodePoint());else return this.consumeBadUrlRemnants(),wr;else r.push(h)}},s.prototype.consumeWhiteSpace=function(){for(;mr(this.peekCodePoint(0));)this.consumeCodePoint()},s.prototype.consumeBadUrlRemnants=function(){for(;;){var r=this.consumeCodePoint();if(r===pi||r===Ft)return;Yt(r,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},s.prototype.consumeStringSlice=function(r){for(var o=5e4,a="";r>0;){var h=Math.min(o,r);a+=m.apply(void 0,this._value.splice(0,h)),r-=h}return this._value.shift(),a},s.prototype.consumeStringToken=function(r){var o="",a=0;do{var h=this._value[a];if(h===Ft||h===void 0||h===r)return o+=this.consumeStringSlice(a),{type:0,value:o};if(h===gr)return this._value.splice(0,a),ng;if(h===di){var u=this._value[a+1];u!==Ft&&u!==void 0&&(u===gr?(o+=this.consumeStringSlice(a),a=-1,this._value.shift()):Yt(h,u)&&(o+=this.consumeStringSlice(a),o+=m(this.consumeEscapedCodePoint()),a=-1))}a++}while(!0)},s.prototype.consumeNumber=function(){var r=[],o=gi,a=this.peekCodePoint(0);for((a===cA||a===qe)&&r.push(this.consumeCodePoint());Ne(this.peekCodePoint(0));)r.push(this.consumeCodePoint());a=this.peekCodePoint(0);var h=this.peekCodePoint(1);if(a===fi&&Ne(h))for(r.push(this.consumeCodePoint(),this.consumeCodePoint()),o=ao;Ne(this.peekCodePoint(0));)r.push(this.consumeCodePoint());a=this.peekCodePoint(0),h=this.peekCodePoint(1);var u=this.peekCodePoint(2);if((a===fo||a===uo)&&((h===cA||h===qe)&&Ne(u)||Ne(h)))for(r.push(this.consumeCodePoint(),this.consumeCodePoint()),o=ao;Ne(this.peekCodePoint(0));)r.push(this.consumeCodePoint());return[Yh(r),o]},s.prototype.consumeNumericToken=function(){var r=this.consumeNumber(),o=r[0],a=r[1],h=this.peekCodePoint(0),u=this.peekCodePoint(1),f=this.peekCodePoint(2);if(Cr(h,u,f)){var v=this.consumeName();return{type:15,number:o,flags:a,unit:v}}return h===ph?(this.consumeCodePoint(),{type:16,number:o,flags:a}):{type:17,number:o,flags:a}},s.prototype.consumeEscapedCodePoint=function(){var r=this.consumeCodePoint();if(SA(r)){for(var o=m(r);SA(this.peekCodePoint(0))&&o.length<6;)o+=m(this.consumeCodePoint());mr(this.peekCodePoint(0))&&this.consumeCodePoint();var a=parseInt(o,16);return a===0||Gh(a)||a>1114111?co:a}return r===Ft?co:r},s.prototype.consumeName=function(){for(var r="";;){var o=this.consumeCodePoint();if(Bo(o))r+=m(o);else if(Yt(o,this.peekCodePoint(0)))r+=m(this.consumeEscapedCodePoint());else return this.reconsumeCodePoint(o),r}},s}(),wo=function(){function s(r){this._tokens=r}return s.create=function(r){var o=new Co;return o.write(r),new s(o.read())},s.parseValue=function(r){return s.create(r).parseComponentValue()},s.parseValues=function(r){return s.create(r).parseComponentValues()},s.prototype.parseComponentValue=function(){for(var r=this.consumeToken();r.type===31;)r=this.consumeToken();if(r.type===32)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(r);var o=this.consumeComponentValue();do r=this.consumeToken();while(r.type===31);if(r.type===32)return o;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},s.prototype.parseComponentValues=function(){for(var r=[];;){var o=this.consumeComponentValue();if(o.type===32)return r;r.push(o),r.push()}},s.prototype.consumeComponentValue=function(){var r=this.consumeToken();switch(r.type){case 11:case 28:case 2:return this.consumeSimpleBlock(r.type);case 19:return this.consumeFunction(r)}return r},s.prototype.consumeSimpleBlock=function(r){for(var o={type:r,values:[]},a=this.consumeToken();;){if(a.type===32||pg(a,r))return o;this.reconsumeToken(a),o.values.push(this.consumeComponentValue()),a=this.consumeToken()}},s.prototype.consumeFunction=function(r){for(var o={name:r.value,values:[],type:18};;){var a=this.consumeToken();if(a.type===32||a.type===3)return o;this.reconsumeToken(a),o.values.push(this.consumeComponentValue())}},s.prototype.consumeToken=function(){var r=this._tokens.shift();return typeof r=="undefined"?Yn:r},s.prototype.reconsumeToken=function(r){this._tokens.unshift(r)},s}(),mi=function(s){return s.type===15},UA=function(s){return s.type===17},le=function(s){return s.type===20},ug=function(s){return s.type===0},$n=function(s,r){return le(s)&&s.value===r},vo=function(s){return s.type!==31},bA=function(s){return s.type!==31&&s.type!==4},yt=function(s){var r=[],o=[];return s.forEach(function(a){if(a.type===4){if(o.length===0)throw new Error("Error parsing function args, zero tokens for arg");r.push(o),o=[];return}a.type!==31&&o.push(a)}),o.length&&r.push(o),r},pg=function(s,r){return r===11&&s.type===12||r===28&&s.type===29?!0:r===2&&s.type===3},$t=function(s){return s.type===17||s.type===15},ve=function(s){return s.type===16||$t(s)},Fo=function(s){return s.length>1?[s[0],s[1]]:[s[0]]},Pe={type:17,number:0,flags:gi},zn={type:16,number:50,flags:gi},zt={type:16,number:100,flags:gi},Bi=function(s,r,o){var a=s[0],h=s[1];return[ge(a,r),ge(typeof h!="undefined"?h:a,o)]},ge=function(s,r){if(s.type===16)return s.number/100*r;if(mi(s))switch(s.unit){case"rem":case"em":return 16*s.number;case"px":default:return s.number}return s.number},yo="deg",Eo="grad",Io="rad",Ho="turn",vr={name:"angle",parse:function(s,r){if(r.type===15)switch(r.unit){case yo:return Math.PI*r.number/180;case Eo:return Math.PI/200*r.number;case Io:return r.number;case Ho:return Math.PI*2*r.number}throw new Error("Unsupported angle type")}},Qo=function(s){return s.type===15&&(s.unit===yo||s.unit===Eo||s.unit===Io||s.unit===Ho)},So=function(s){var r=s.filter(le).map(function(o){return o.value}).join(" ");switch(r){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Pe,Pe];case"to top":case"bottom":return lt(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Pe,zt];case"to right":case"left":return lt(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[zt,zt];case"to bottom":case"top":return lt(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[zt,Pe];case"to left":case"right":return lt(270)}return 0},lt=function(s){return Math.PI*s/180},qt={name:"color",parse:function(s,r){if(r.type===18){var o=fg[r.name];if(typeof o=="undefined")throw new Error('Attempting to parse an unsupported color function "'+r.name+'"');return o(s,r.values)}if(r.type===5){if(r.value.length===3){var a=r.value.substring(0,1),h=r.value.substring(1,2),u=r.value.substring(2,3);return jt(parseInt(a+a,16),parseInt(h+h,16),parseInt(u+u,16),1)}if(r.value.length===4){var a=r.value.substring(0,1),h=r.value.substring(1,2),u=r.value.substring(2,3),f=r.value.substring(3,4);return jt(parseInt(a+a,16),parseInt(h+h,16),parseInt(u+u,16),parseInt(f+f,16)/255)}if(r.value.length===6){var a=r.value.substring(0,2),h=r.value.substring(2,4),u=r.value.substring(4,6);return jt(parseInt(a,16),parseInt(h,16),parseInt(u,16),1)}if(r.value.length===8){var a=r.value.substring(0,2),h=r.value.substring(2,4),u=r.value.substring(4,6),f=r.value.substring(6,8);return jt(parseInt(a,16),parseInt(h,16),parseInt(u,16),parseInt(f,16)/255)}}if(r.type===20){var v=Lt[r.value.toUpperCase()];if(typeof v!="undefined")return v}return Lt.TRANSPARENT}},Zt=function(s){return(255&s)===0},be=function(s){var r=255&s,o=255&s>>8,a=255&s>>16,h=255&s>>24;return r<255?"rgba("+h+","+a+","+o+","+r/255+")":"rgb("+h+","+a+","+o+")"},jt=function(s,r,o,a){return(s<<24|r<<16|o<<8|Math.round(a*255)<<0)>>>0},Uo=function(s,r){if(s.type===17)return s.number;if(s.type===16){var o=r===3?1:255;return r===3?s.number/100*o:Math.round(s.number/100*o)}return 0},bo=function(s,r){var o=r.filter(bA);if(o.length===3){var a=o.map(Uo),h=a[0],u=a[1],f=a[2];return jt(h,u,f,1)}if(o.length===4){var v=o.map(Uo),h=v[0],u=v[1],f=v[2],w=v[3];return jt(h,u,f,w)}return 0};function qn(s,r,o){return o<0&&(o+=1),o>=1&&(o-=1),o<1/6?(r-s)*o*6+s:o<1/2?r:o<2/3?(r-s)*6*(2/3-o)+s:s}var Mo=function(s,r){var o=r.filter(bA),a=o[0],h=o[1],u=o[2],f=o[3],v=(a.type===17?lt(a.number):vr.parse(s,a))/(Math.PI*2),w=ve(h)?h.number/100:0,E=ve(u)?u.number/100:0,I=typeof f!="undefined"&&ve(f)?ge(f,1):1;if(w===0)return jt(E*255,E*255,E*255,1);var H=E<=.5?E*(w+1):E+w-E*w,S=E*2-H,R=qn(S,H,v+1/3),M=qn(S,H,v),L=qn(S,H,v-1/3);return jt(R*255,M*255,L*255,I)},fg={hsl:Mo,hsla:Mo,rgb:bo,rgba:bo},Ci=function(s,r){return qt.parse(s,wo.create(r).parseComponentValue())},Lt={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},mg={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(s,r){return r.map(function(o){if(le(o))switch(o.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Bg={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Fr=function(s,r){var o=qt.parse(s,r[0]),a=r[1];return a&&ve(a)?{color:o,stop:a}:{color:o,stop:null}},xo=function(s,r){var o=s[0],a=s[s.length-1];o.stop===null&&(o.stop=Pe),a.stop===null&&(a.stop=zt);for(var h=[],u=0,f=0;f<s.length;f++){var v=s[f].stop;if(v!==null){var w=ge(v,r);w>u?h.push(w):h.push(u),u=w}else h.push(null)}for(var E=null,f=0;f<h.length;f++){var I=h[f];if(I===null)E===null&&(E=f);else if(E!==null){for(var H=f-E,S=h[E-1],R=(I-S)/(H+1),M=1;M<=H;M++)h[E+M-1]=R*M;E=null}}return s.map(function(L,J){var V=L.color;return{color:V,stop:Math.max(Math.min(1,h[J]/r),0)}})},Cg=function(s,r,o){var a=r/2,h=o/2,u=ge(s[0],r)-a,f=h-ge(s[1],o);return(Math.atan2(f,u)+Math.PI*2)%(Math.PI*2)},wg=function(s,r,o){var a=typeof s=="number"?s:Cg(s,r,o),h=Math.abs(r*Math.sin(a))+Math.abs(o*Math.cos(a)),u=r/2,f=o/2,v=h/2,w=Math.sin(a-Math.PI/2)*v,E=Math.cos(a-Math.PI/2)*v;return[h,u-E,u+E,f-w,f+w]},mt=function(s,r){return Math.sqrt(s*s+r*r)},Lo=function(s,r,o,a,h){var u=[[0,0],[0,r],[s,0],[s,r]];return u.reduce(function(f,v){var w=v[0],E=v[1],I=mt(o-w,a-E);return(h?I<f.optimumDistance:I>f.optimumDistance)?{optimumCorner:v,optimumDistance:I}:f},{optimumDistance:h?1/0:-1/0,optimumCorner:null}).optimumCorner},vg=function(s,r,o,a,h){var u=0,f=0;switch(s.size){case 0:s.shape===0?u=f=Math.min(Math.abs(r),Math.abs(r-a),Math.abs(o),Math.abs(o-h)):s.shape===1&&(u=Math.min(Math.abs(r),Math.abs(r-a)),f=Math.min(Math.abs(o),Math.abs(o-h)));break;case 2:if(s.shape===0)u=f=Math.min(mt(r,o),mt(r,o-h),mt(r-a,o),mt(r-a,o-h));else if(s.shape===1){var v=Math.min(Math.abs(o),Math.abs(o-h))/Math.min(Math.abs(r),Math.abs(r-a)),w=Lo(a,h,r,o,!0),E=w[0],I=w[1];u=mt(E-r,(I-o)/v),f=v*u}break;case 1:s.shape===0?u=f=Math.max(Math.abs(r),Math.abs(r-a),Math.abs(o),Math.abs(o-h)):s.shape===1&&(u=Math.max(Math.abs(r),Math.abs(r-a)),f=Math.max(Math.abs(o),Math.abs(o-h)));break;case 3:if(s.shape===0)u=f=Math.max(mt(r,o),mt(r,o-h),mt(r-a,o),mt(r-a,o-h));else if(s.shape===1){var v=Math.max(Math.abs(o),Math.abs(o-h))/Math.max(Math.abs(r),Math.abs(r-a)),H=Lo(a,h,r,o,!1),E=H[0],I=H[1];u=mt(E-r,(I-o)/v),f=v*u}break}return Array.isArray(s.size)&&(u=ge(s.size[0],a),f=s.size.length===2?ge(s.size[1],h):u),[u,f]},Fg=function(s,r){var o=lt(180),a=[];return yt(r).forEach(function(h,u){if(u===0){var f=h[0];if(f.type===20&&f.value==="to"){o=So(h);return}else if(Qo(f)){o=vr.parse(s,f);return}}var v=Fr(s,h);a.push(v)}),{angle:o,stops:a,type:1}},yr=function(s,r){var o=lt(180),a=[];return yt(r).forEach(function(h,u){if(u===0){var f=h[0];if(f.type===20&&["top","left","right","bottom"].indexOf(f.value)!==-1){o=So(h);return}else if(Qo(f)){o=(vr.parse(s,f)+lt(270))%lt(360);return}}var v=Fr(s,h);a.push(v)}),{angle:o,stops:a,type:1}},yg=function(s,r){var o=lt(180),a=[],h=1,u=0,f=3,v=[];return yt(r).forEach(function(w,E){var I=w[0];if(E===0){if(le(I)&&I.value==="linear"){h=1;return}else if(le(I)&&I.value==="radial"){h=2;return}}if(I.type===18){if(I.name==="from"){var H=qt.parse(s,I.values[0]);a.push({stop:Pe,color:H})}else if(I.name==="to"){var H=qt.parse(s,I.values[0]);a.push({stop:zt,color:H})}else if(I.name==="color-stop"){var S=I.values.filter(bA);if(S.length===2){var H=qt.parse(s,S[1]),R=S[0];UA(R)&&a.push({stop:{type:16,number:R.number*100,flags:R.flags},color:H})}}}}),h===1?{angle:(o+lt(180))%lt(360),stops:a,type:h}:{size:f,shape:u,stops:a,position:v,type:h}},To="closest-side",Po="farthest-side",Do="closest-corner",Ro="farthest-corner",Ko="circle",Oo="ellipse",ko="cover",No="contain",Eg=function(s,r){var o=0,a=3,h=[],u=[];return yt(r).forEach(function(f,v){var w=!0;if(v===0){var E=!1;w=f.reduce(function(H,S){if(E)if(le(S))switch(S.value){case"center":return u.push(zn),H;case"top":case"left":return u.push(Pe),H;case"right":case"bottom":return u.push(zt),H}else(ve(S)||$t(S))&&u.push(S);else if(le(S))switch(S.value){case Ko:return o=0,!1;case Oo:return o=1,!1;case"at":return E=!0,!1;case To:return a=0,!1;case ko:case Po:return a=1,!1;case No:case Do:return a=2,!1;case Ro:return a=3,!1}else if($t(S)||ve(S))return Array.isArray(a)||(a=[]),a.push(S),!1;return H},w)}if(w){var I=Fr(s,f);h.push(I)}}),{size:a,shape:o,stops:h,position:u,type:2}},Er=function(s,r){var o=0,a=3,h=[],u=[];return yt(r).forEach(function(f,v){var w=!0;if(v===0?w=f.reduce(function(I,H){if(le(H))switch(H.value){case"center":return u.push(zn),!1;case"top":case"left":return u.push(Pe),!1;case"right":case"bottom":return u.push(zt),!1}else if(ve(H)||$t(H))return u.push(H),!1;return I},w):v===1&&(w=f.reduce(function(I,H){if(le(H))switch(H.value){case Ko:return o=0,!1;case Oo:return o=1,!1;case No:case To:return a=0,!1;case Po:return a=1,!1;case Do:return a=2,!1;case ko:case Ro:return a=3,!1}else if($t(H)||ve(H))return Array.isArray(a)||(a=[]),a.push(H),!1;return I},w)),w){var E=Fr(s,f);h.push(E)}}),{size:a,shape:o,stops:h,position:u,type:2}},Ig=function(s){return s.type===1},Hg=function(s){return s.type===2},Zn={name:"image",parse:function(s,r){if(r.type===22){var o={url:r.value,type:0};return s.cache.addImage(r.value),o}if(r.type===18){var a=Go[r.name];if(typeof a=="undefined")throw new Error('Attempting to parse an unsupported image function "'+r.name+'"');return a(s,r.values)}throw new Error("Unsupported image type "+r.type)}};function Qg(s){return!(s.type===20&&s.value==="none")&&(s.type!==18||!!Go[s.name])}var Go={"linear-gradient":Fg,"-moz-linear-gradient":yr,"-ms-linear-gradient":yr,"-o-linear-gradient":yr,"-webkit-linear-gradient":yr,"radial-gradient":Eg,"-moz-radial-gradient":Er,"-ms-radial-gradient":Er,"-o-radial-gradient":Er,"-webkit-radial-gradient":Er,"-webkit-gradient":yg},Sg={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(s,r){if(r.length===0)return[];var o=r[0];return o.type===20&&o.value==="none"?[]:r.filter(function(a){return bA(a)&&Qg(a)}).map(function(a){return Zn.parse(s,a)})}},Ug={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(s,r){return r.map(function(o){if(le(o))switch(o.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},bg={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(s,r){return yt(r).map(function(o){return o.filter(ve)}).map(Fo)}},Mg={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(s,r){return yt(r).map(function(o){return o.filter(le).map(function(a){return a.value}).join(" ")}).map(xg)}},xg=function(s){switch(s){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;case"repeat":default:return 0}},MA;(function(s){s.AUTO="auto",s.CONTAIN="contain",s.COVER="cover"})(MA||(MA={}));var Lg={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(s,r){return yt(r).map(function(o){return o.filter(Tg)})}},Tg=function(s){return le(s)||ve(s)},Ir=function(s){return{name:"border-"+s+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Pg=Ir("top"),Dg=Ir("right"),Rg=Ir("bottom"),Kg=Ir("left"),Hr=function(s){return{name:"border-radius-"+s,initialValue:"0 0",prefix:!1,type:1,parse:function(r,o){return Fo(o.filter(ve))}}},Og=Hr("top-left"),kg=Hr("top-right"),Ng=Hr("bottom-right"),Gg=Hr("bottom-left"),Qr=function(s){return{name:"border-"+s+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(r,o){switch(o){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},Vg=Qr("top"),_g=Qr("right"),Wg=Qr("bottom"),Xg=Qr("left"),Sr=function(s){return{name:"border-"+s+"-width",initialValue:"0",type:0,prefix:!1,parse:function(r,o){return mi(o)?o.number:0}}},Jg=Sr("top"),Yg=Sr("right"),$g=Sr("bottom"),zg=Sr("left"),qg={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Zg={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(s,r){switch(r){case"rtl":return 1;case"ltr":default:return 0}}},jg={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(s,r){return r.filter(le).reduce(function(o,a){return o|ed(a.value)},0)}},ed=function(s){switch(s){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},td={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(s,r){switch(r){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},Ad={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(s,r){return r.type===20&&r.value==="normal"?0:r.type===17||r.type===15?r.number:0}},Ur;(function(s){s.NORMAL="normal",s.STRICT="strict"})(Ur||(Ur={}));var id={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(s,r){switch(r){case"strict":return Ur.STRICT;case"normal":default:return Ur.NORMAL}}},rd={name:"line-height",initialValue:"normal",prefix:!1,type:4},Vo=function(s,r){return le(s)&&s.value==="normal"?1.2*r:s.type===17?r*s.number:ve(s)?ge(s,r):r},sd={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(s,r){return r.type===20&&r.value==="none"?null:Zn.parse(s,r)}},nd={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(s,r){switch(r){case"inside":return 0;case"outside":default:return 1}}},jn={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(s,r){switch(r){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":return 22;case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;case"none":default:return-1}}},br=function(s){return{name:"margin-"+s,initialValue:"0",prefix:!1,type:4}},ad=br("top"),od=br("right"),ld=br("bottom"),cd=br("left"),hd={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(s,r){return r.filter(le).map(function(o){switch(o.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;case"visible":default:return 0}})}},gd={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(s,r){switch(r){case"break-word":return"break-word";case"normal":default:return"normal"}}},Mr=function(s){return{name:"padding-"+s,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},dd=Mr("top"),ud=Mr("right"),pd=Mr("bottom"),fd=Mr("left"),md={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(s,r){switch(r){case"right":return 2;case"center":case"justify":return 1;case"left":default:return 0}}},Bd={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(s,r){switch(r){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Cd={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(s,r){return r.length===1&&$n(r[0],"none")?[]:yt(r).map(function(o){for(var a={color:Lt.TRANSPARENT,offsetX:Pe,offsetY:Pe,blur:Pe},h=0,u=0;u<o.length;u++){var f=o[u];$t(f)?(h===0?a.offsetX=f:h===1?a.offsetY=f:a.blur=f,h++):a.color=qt.parse(s,f)}return a})}},wd={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(s,r){switch(r){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},vd={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(s,r){if(r.type===20&&r.value==="none")return null;if(r.type===18){var o=Ed[r.name];if(typeof o=="undefined")throw new Error('Attempting to parse an unsupported transform function "'+r.name+'"');return o(r.values)}return null}},Fd=function(s){var r=s.filter(function(o){return o.type===17}).map(function(o){return o.number});return r.length===6?r:null},yd=function(s){var r=s.filter(function(w){return w.type===17}).map(function(w){return w.number}),o=r[0],a=r[1];r[2],r[3];var h=r[4],u=r[5];r[6],r[7],r[8],r[9],r[10],r[11];var f=r[12],v=r[13];return r[14],r[15],r.length===16?[o,a,h,u,f,v]:null},Ed={matrix:Fd,matrix3d:yd},_o={type:16,number:50,flags:gi},Id=[_o,_o],Hd={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(s,r){var o=r.filter(ve);return o.length!==2?Id:[o[0],o[1]]}},Qd={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(s,r){switch(r){case"hidden":return 1;case"collapse":return 2;case"visible":default:return 0}}},wi;(function(s){s.NORMAL="normal",s.BREAK_ALL="break-all",s.KEEP_ALL="keep-all"})(wi||(wi={}));for(var Sd={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(s,r){switch(r){case"break-all":return wi.BREAK_ALL;case"keep-all":return wi.KEEP_ALL;case"normal":default:return wi.NORMAL}}},Ud={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(s,r){if(r.type===20)return{auto:!0,order:0};if(UA(r))return{auto:!1,order:r.number};throw new Error("Invalid z-index number parsed")}},Wo={name:"time",parse:function(s,r){if(r.type===15)switch(r.unit.toLowerCase()){case"s":return 1e3*r.number;case"ms":return r.number}throw new Error("Unsupported time type")}},bd={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(s,r){return UA(r)?r.number:1}},Md={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},xd={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(s,r){return r.filter(le).map(function(o){switch(o.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(o){return o!==0})}},Ld={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(s,r){var o=[],a=[];return r.forEach(function(h){switch(h.type){case 20:case 0:o.push(h.value);break;case 17:o.push(h.number.toString());break;case 4:a.push(o.join(" ")),o.length=0;break}}),o.length&&a.push(o.join(" ")),a.map(function(h){return h.indexOf(" ")===-1?h:"'"+h+"'"})}},Td={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},Pd={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(s,r){if(UA(r))return r.number;if(le(r))switch(r.value){case"bold":return 700;case"normal":default:return 400}return 400}},Dd={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(s,r){return r.filter(le).map(function(o){return o.value})}},Rd={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(s,r){switch(r){case"oblique":return"oblique";case"italic":return"italic";case"normal":default:return"normal"}}},Se=function(s,r){return(s&r)!==0},Kd={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(s,r){if(r.length===0)return[];var o=r[0];return o.type===20&&o.value==="none"?[]:r}},Od={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(s,r){if(r.length===0)return null;var o=r[0];if(o.type===20&&o.value==="none")return null;for(var a=[],h=r.filter(vo),u=0;u<h.length;u++){var f=h[u],v=h[u+1];if(f.type===20){var w=v&&UA(v)?v.number:1;a.push({counter:f.value,increment:w})}}return a}},kd={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(s,r){if(r.length===0)return[];for(var o=[],a=r.filter(vo),h=0;h<a.length;h++){var u=a[h],f=a[h+1];if(le(u)&&u.value!=="none"){var v=f&&UA(f)?f.number:0;o.push({counter:u.value,reset:v})}}return o}},Nd={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(s,r){return r.filter(mi).map(function(o){return Wo.parse(s,o)})}},Gd={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(s,r){if(r.length===0)return null;var o=r[0];if(o.type===20&&o.value==="none")return null;var a=[],h=r.filter(ug);if(h.length%2!==0)return null;for(var u=0;u<h.length;u+=2){var f=h[u].value,v=h[u+1].value;a.push({open:f,close:v})}return a}},Xo=function(s,r,o){if(!s)return"";var a=s[Math.min(r,s.length-1)];return a?o?a.open:a.close:""},Vd={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(s,r){return r.length===1&&$n(r[0],"none")?[]:yt(r).map(function(o){for(var a={color:255,offsetX:Pe,offsetY:Pe,blur:Pe,spread:Pe,inset:!1},h=0,u=0;u<o.length;u++){var f=o[u];$n(f,"inset")?a.inset=!0:$t(f)?(h===0?a.offsetX=f:h===1?a.offsetY=f:h===2?a.blur=f:a.spread=f,h++):a.color=qt.parse(s,f)}return a})}},_d={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(s,r){var o=[0,1,2],a=[];return r.filter(le).forEach(function(h){switch(h.value){case"stroke":a.push(1);break;case"fill":a.push(0);break;case"markers":a.push(2);break}}),o.forEach(function(h){a.indexOf(h)===-1&&a.push(h)}),a}},Wd={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},Xd={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(s,r){return mi(r)?r.number:0}},Jd=function(){function s(r,o){var a,h;this.animationDuration=K(r,Nd,o.animationDuration),this.backgroundClip=K(r,mg,o.backgroundClip),this.backgroundColor=K(r,Bg,o.backgroundColor),this.backgroundImage=K(r,Sg,o.backgroundImage),this.backgroundOrigin=K(r,Ug,o.backgroundOrigin),this.backgroundPosition=K(r,bg,o.backgroundPosition),this.backgroundRepeat=K(r,Mg,o.backgroundRepeat),this.backgroundSize=K(r,Lg,o.backgroundSize),this.borderTopColor=K(r,Pg,o.borderTopColor),this.borderRightColor=K(r,Dg,o.borderRightColor),this.borderBottomColor=K(r,Rg,o.borderBottomColor),this.borderLeftColor=K(r,Kg,o.borderLeftColor),this.borderTopLeftRadius=K(r,Og,o.borderTopLeftRadius),this.borderTopRightRadius=K(r,kg,o.borderTopRightRadius),this.borderBottomRightRadius=K(r,Ng,o.borderBottomRightRadius),this.borderBottomLeftRadius=K(r,Gg,o.borderBottomLeftRadius),this.borderTopStyle=K(r,Vg,o.borderTopStyle),this.borderRightStyle=K(r,_g,o.borderRightStyle),this.borderBottomStyle=K(r,Wg,o.borderBottomStyle),this.borderLeftStyle=K(r,Xg,o.borderLeftStyle),this.borderTopWidth=K(r,Jg,o.borderTopWidth),this.borderRightWidth=K(r,Yg,o.borderRightWidth),this.borderBottomWidth=K(r,$g,o.borderBottomWidth),this.borderLeftWidth=K(r,zg,o.borderLeftWidth),this.boxShadow=K(r,Vd,o.boxShadow),this.color=K(r,qg,o.color),this.direction=K(r,Zg,o.direction),this.display=K(r,jg,o.display),this.float=K(r,td,o.cssFloat),this.fontFamily=K(r,Ld,o.fontFamily),this.fontSize=K(r,Td,o.fontSize),this.fontStyle=K(r,Rd,o.fontStyle),this.fontVariant=K(r,Dd,o.fontVariant),this.fontWeight=K(r,Pd,o.fontWeight),this.letterSpacing=K(r,Ad,o.letterSpacing),this.lineBreak=K(r,id,o.lineBreak),this.lineHeight=K(r,rd,o.lineHeight),this.listStyleImage=K(r,sd,o.listStyleImage),this.listStylePosition=K(r,nd,o.listStylePosition),this.listStyleType=K(r,jn,o.listStyleType),this.marginTop=K(r,ad,o.marginTop),this.marginRight=K(r,od,o.marginRight),this.marginBottom=K(r,ld,o.marginBottom),this.marginLeft=K(r,cd,o.marginLeft),this.opacity=K(r,bd,o.opacity);var u=K(r,hd,o.overflow);this.overflowX=u[0],this.overflowY=u[u.length>1?1:0],this.overflowWrap=K(r,gd,o.overflowWrap),this.paddingTop=K(r,dd,o.paddingTop),this.paddingRight=K(r,ud,o.paddingRight),this.paddingBottom=K(r,pd,o.paddingBottom),this.paddingLeft=K(r,fd,o.paddingLeft),this.paintOrder=K(r,_d,o.paintOrder),this.position=K(r,Bd,o.position),this.textAlign=K(r,md,o.textAlign),this.textDecorationColor=K(r,Md,(a=o.textDecorationColor)!==null&&a!==void 0?a:o.color),this.textDecorationLine=K(r,xd,(h=o.textDecorationLine)!==null&&h!==void 0?h:o.textDecoration),this.textShadow=K(r,Cd,o.textShadow),this.textTransform=K(r,wd,o.textTransform),this.transform=K(r,vd,o.transform),this.transformOrigin=K(r,Hd,o.transformOrigin),this.visibility=K(r,Qd,o.visibility),this.webkitTextStrokeColor=K(r,Wd,o.webkitTextStrokeColor),this.webkitTextStrokeWidth=K(r,Xd,o.webkitTextStrokeWidth),this.wordBreak=K(r,Sd,o.wordBreak),this.zIndex=K(r,Ud,o.zIndex)}return s.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&this.visibility===0},s.prototype.isTransparent=function(){return Zt(this.backgroundColor)},s.prototype.isTransformed=function(){return this.transform!==null},s.prototype.isPositioned=function(){return this.position!==0},s.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},s.prototype.isFloating=function(){return this.float!==0},s.prototype.isInlineLevel=function(){return Se(this.display,4)||Se(this.display,33554432)||Se(this.display,268435456)||Se(this.display,536870912)||Se(this.display,67108864)||Se(this.display,134217728)},s}(),Yd=function(){function s(r,o){this.content=K(r,Kd,o.content),this.quotes=K(r,Gd,o.quotes)}return s}(),Jo=function(){function s(r,o){this.counterIncrement=K(r,Od,o.counterIncrement),this.counterReset=K(r,kd,o.counterReset)}return s}(),K=function(s,r,o){var a=new Co,h=o!==null&&typeof o!="undefined"?o.toString():r.initialValue;a.write(h);var u=new wo(a.read());switch(r.type){case 2:var f=u.parseComponentValue();return r.parse(s,le(f)?f.value:r.initialValue);case 0:return r.parse(s,u.parseComponentValue());case 1:return r.parse(s,u.parseComponentValues());case 4:return u.parseComponentValue();case 3:switch(r.format){case"angle":return vr.parse(s,u.parseComponentValue());case"color":return qt.parse(s,u.parseComponentValue());case"image":return Zn.parse(s,u.parseComponentValue());case"length":var v=u.parseComponentValue();return $t(v)?v:Pe;case"length-percentage":var w=u.parseComponentValue();return ve(w)?w:Pe;case"time":return Wo.parse(s,u.parseComponentValue())}break}},$d="data-html2canvas-debug",zd=function(s){var r=s.getAttribute($d);switch(r){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},ea=function(s,r){var o=zd(s);return o===1||r===o},Et=function(){function s(r,o){if(this.context=r,this.textNodes=[],this.elements=[],this.flags=0,ea(o,3))debugger;this.styles=new Jd(r,window.getComputedStyle(o,null)),ua(o)&&(this.styles.animationDuration.some(function(a){return a>0})&&(o.style.animationDuration="0s"),this.styles.transform!==null&&(o.style.transform="none")),this.bounds=c(this.context,o),ea(o,4)&&(this.flags|=16)}return s}(),qd="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",Yo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vi=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),xr=0;xr<Yo.length;xr++)vi[Yo.charCodeAt(xr)]=xr;for(var Zd=function(s){var r=s.length*.75,o=s.length,a,h=0,u,f,v,w;s[s.length-1]==="="&&(r--,s[s.length-2]==="="&&r--);var E=typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined"&&typeof Uint8Array.prototype.slice!="undefined"?new ArrayBuffer(r):new Array(r),I=Array.isArray(E)?E:new Uint8Array(E);for(a=0;a<o;a+=4)u=vi[s.charCodeAt(a)],f=vi[s.charCodeAt(a+1)],v=vi[s.charCodeAt(a+2)],w=vi[s.charCodeAt(a+3)],I[h++]=u<<2|f>>4,I[h++]=(f&15)<<4|v>>2,I[h++]=(v&3)<<6|w&63;return E},jd=function(s){for(var r=s.length,o=[],a=0;a<r;a+=2)o.push(s[a+1]<<8|s[a]);return o},eu=function(s){for(var r=s.length,o=[],a=0;a<r;a+=4)o.push(s[a+3]<<24|s[a+2]<<16|s[a+1]<<8|s[a]);return o},hA=5,ta=11,Aa=2,tu=ta-hA,$o=65536>>hA,Au=1<<hA,ia=Au-1,iu=1024>>hA,ru=$o+iu,su=ru,nu=32,au=su+nu,ou=65536>>ta,lu=1<<tu,cu=lu-1,zo=function(s,r,o){return s.slice?s.slice(r,o):new Uint16Array(Array.prototype.slice.call(s,r,o))},hu=function(s,r,o){return s.slice?s.slice(r,o):new Uint32Array(Array.prototype.slice.call(s,r,o))},gu=function(s,r){var o=Zd(s),a=Array.isArray(o)?eu(o):new Uint32Array(o),h=Array.isArray(o)?jd(o):new Uint16Array(o),u=24,f=zo(h,u/2,a[4]/2),v=a[5]===2?zo(h,(u+a[4])/2):hu(a,Math.ceil((u+a[4])/4));return new du(a[0],a[1],a[2],a[3],f,v)},du=function(){function s(r,o,a,h,u,f){this.initialValue=r,this.errorValue=o,this.highStart=a,this.highValueIndex=h,this.index=u,this.data=f}return s.prototype.get=function(r){var o;if(r>=0){if(r<55296||r>56319&&r<=65535)return o=this.index[r>>hA],o=(o<<Aa)+(r&ia),this.data[o];if(r<=65535)return o=this.index[$o+(r-55296>>hA)],o=(o<<Aa)+(r&ia),this.data[o];if(r<this.highStart)return o=au-ou+(r>>ta),o=this.index[o],o+=r>>hA&cu,o=this.index[o],o=(o<<Aa)+(r&ia),this.data[o];if(r<=1114111)return this.data[this.highValueIndex]}return this.errorValue},s}(),qo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",uu=typeof Uint8Array=="undefined"?[]:new Uint8Array(256),Lr=0;Lr<qo.length;Lr++)uu[qo.charCodeAt(Lr)]=Lr;var pu=1,ra=2,sa=3,Zo=4,jo=5,fu=7,el=8,na=9,aa=10,tl=11,Al=12,il=13,rl=14,oa=15,mu=function(s){for(var r=[],o=0,a=s.length;o<a;){var h=s.charCodeAt(o++);if(h>=55296&&h<=56319&&o<a){var u=s.charCodeAt(o++);(u&64512)===56320?r.push(((h&1023)<<10)+(u&1023)+65536):(r.push(h),o--)}else r.push(h)}return r},Bu=function(){for(var s=[],r=0;r<arguments.length;r++)s[r]=arguments[r];if(String.fromCodePoint)return String.fromCodePoint.apply(String,s);var o=s.length;if(!o)return"";for(var a=[],h=-1,u="";++h<o;){var f=s[h];f<=65535?a.push(f):(f-=65536,a.push((f>>10)+55296,f%1024+56320)),(h+1===o||a.length>16384)&&(u+=String.fromCharCode.apply(String,a),a.length=0)}return u},Cu=gu(qd),ct="\xD7",la="\xF7",wu=function(s){return Cu.get(s)},vu=function(s,r,o){var a=o-2,h=r[a],u=r[o-1],f=r[o];if(u===ra&&f===sa)return ct;if(u===ra||u===sa||u===Zo||f===ra||f===sa||f===Zo)return la;if(u===el&&[el,na,tl,Al].indexOf(f)!==-1||(u===tl||u===na)&&(f===na||f===aa)||(u===Al||u===aa)&&f===aa||f===il||f===jo||f===fu||u===pu)return ct;if(u===il&&f===rl){for(;h===jo;)h=r[--a];if(h===rl)return ct}if(u===oa&&f===oa){for(var v=0;h===oa;)v++,h=r[--a];if(v%2===0)return ct}return la},Fu=function(s){var r=mu(s),o=r.length,a=0,h=0,u=r.map(wu);return{next:function(){if(a>=o)return{done:!0,value:null};for(var f=ct;a<o&&(f=vu(r,u,++a))===ct;);if(f!==ct||a===o){var v=Bu.apply(null,r.slice(h,a));return h=a,{value:v,done:!1}}return{done:!0,value:null}}}},yu=function(s){for(var r=Fu(s),o=[],a;!(a=r.next()).done;)a.value&&o.push(a.value.slice());return o},Eu=function(s){var r=123;if(s.createRange){var o=s.createRange();if(o.getBoundingClientRect){var a=s.createElement("boundtest");a.style.height=r+"px",a.style.display="block",s.body.appendChild(a),o.selectNode(a);var h=o.getBoundingClientRect(),u=Math.round(h.height);if(s.body.removeChild(a),u===r)return!0}}return!1},Iu=function(s){var r=s.createElement("boundtest");r.style.width="50px",r.style.display="block",r.style.fontSize="12px",r.style.letterSpacing="0px",r.style.wordSpacing="0px",s.body.appendChild(r);var o=s.createRange();r.innerHTML=typeof"".repeat=="function"?"&#128104;".repeat(10):"";var a=r.firstChild,h=d(a.data).map(function(w){return m(w)}),u=0,f={},v=h.every(function(w,E){o.setStart(a,u),o.setEnd(a,u+w.length);var I=o.getBoundingClientRect();u+=w.length;var H=I.x>f.x||I.y>f.y;return f=I,E===0?!0:H});return s.body.removeChild(r),v},Hu=function(){return typeof new Image().crossOrigin!="undefined"},Qu=function(){return typeof new XMLHttpRequest().responseType=="string"},Su=function(s){var r=new Image,o=s.createElement("canvas"),a=o.getContext("2d");if(!a)return!1;r.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{a.drawImage(r,0,0),o.toDataURL()}catch(h){return!1}return!0},sl=function(s){return s[0]===0&&s[1]===255&&s[2]===0&&s[3]===255},Uu=function(s){var r=s.createElement("canvas"),o=100;r.width=o,r.height=o;var a=r.getContext("2d");if(!a)return Promise.reject(!1);a.fillStyle="rgb(0, 255, 0)",a.fillRect(0,0,o,o);var h=new Image,u=r.toDataURL();h.src=u;var f=ca(o,o,0,0,h);return a.fillStyle="red",a.fillRect(0,0,o,o),nl(f).then(function(v){a.drawImage(v,0,0);var w=a.getImageData(0,0,o,o).data;a.fillStyle="red",a.fillRect(0,0,o,o);var E=s.createElement("div");return E.style.backgroundImage="url("+u+")",E.style.height=o+"px",sl(w)?nl(ca(o,o,0,0,E)):Promise.reject(!1)}).then(function(v){return a.drawImage(v,0,0),sl(a.getImageData(0,0,o,o).data)}).catch(function(){return!1})},ca=function(s,r,o,a,h){var u="http://www.w3.org/2000/svg",f=document.createElementNS(u,"svg"),v=document.createElementNS(u,"foreignObject");return f.setAttributeNS(null,"width",s.toString()),f.setAttributeNS(null,"height",r.toString()),v.setAttributeNS(null,"width","100%"),v.setAttributeNS(null,"height","100%"),v.setAttributeNS(null,"x",o.toString()),v.setAttributeNS(null,"y",a.toString()),v.setAttributeNS(null,"externalResourcesRequired","true"),f.appendChild(v),v.appendChild(h),f},nl=function(s){return new Promise(function(r,o){var a=new Image;a.onload=function(){return r(a)},a.onerror=o,a.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(s))})},De={get SUPPORT_RANGE_BOUNDS(){var s=Eu(document);return Object.defineProperty(De,"SUPPORT_RANGE_BOUNDS",{value:s}),s},get SUPPORT_WORD_BREAKING(){var s=De.SUPPORT_RANGE_BOUNDS&&Iu(document);return Object.defineProperty(De,"SUPPORT_WORD_BREAKING",{value:s}),s},get SUPPORT_SVG_DRAWING(){var s=Su(document);return Object.defineProperty(De,"SUPPORT_SVG_DRAWING",{value:s}),s},get SUPPORT_FOREIGNOBJECT_DRAWING(){var s=typeof Array.from=="function"&&typeof window.fetch=="function"?Uu(document):Promise.resolve(!1);return Object.defineProperty(De,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:s}),s},get SUPPORT_CORS_IMAGES(){var s=Hu();return Object.defineProperty(De,"SUPPORT_CORS_IMAGES",{value:s}),s},get SUPPORT_RESPONSE_TYPE(){var s=Qu();return Object.defineProperty(De,"SUPPORT_RESPONSE_TYPE",{value:s}),s},get SUPPORT_CORS_XHR(){var s="withCredentials"in new XMLHttpRequest;return Object.defineProperty(De,"SUPPORT_CORS_XHR",{value:s}),s},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var s=!!(typeof Intl!="undefined"&&Intl.Segmenter);return Object.defineProperty(De,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:s}),s}},Fi=function(){function s(r,o){this.text=r,this.bounds=o}return s}(),bu=function(s,r,o,a){var h=Lu(r,o),u=[],f=0;return h.forEach(function(v){if(o.textDecorationLine.length||v.trim().length>0)if(De.SUPPORT_RANGE_BOUNDS){var w=al(a,f,v.length).getClientRects();if(w.length>1){var E=ha(v),I=0;E.forEach(function(S){u.push(new Fi(S,l.fromDOMRectList(s,al(a,I+f,S.length).getClientRects()))),I+=S.length})}else u.push(new Fi(v,l.fromDOMRectList(s,w)))}else{var H=a.splitText(v.length);u.push(new Fi(v,Mu(s,a))),a=H}else De.SUPPORT_RANGE_BOUNDS||(a=a.splitText(v.length));f+=v.length}),u},Mu=function(s,r){var o=r.ownerDocument;if(o){var a=o.createElement("html2canvaswrapper");a.appendChild(r.cloneNode(!0));var h=r.parentNode;if(h){h.replaceChild(a,r);var u=c(s,a);return a.firstChild&&h.replaceChild(a.firstChild,a),u}}return l.EMPTY},al=function(s,r,o){var a=s.ownerDocument;if(!a)throw new Error("Node has no owner document");var h=a.createRange();return h.setStart(s,r),h.setEnd(s,r+o),h},ha=function(s){if(De.SUPPORT_NATIVE_TEXT_SEGMENTATION){var r=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(r.segment(s)).map(function(o){return o.segment})}return yu(s)},xu=function(s,r){if(De.SUPPORT_NATIVE_TEXT_SEGMENTATION){var o=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(o.segment(s)).map(function(a){return a.segment})}return Pu(s,r)},Lu=function(s,r){return r.letterSpacing!==0?ha(s):xu(s,r)},Tu=[32,160,4961,65792,65793,4153,4241],Pu=function(s,r){for(var o=oh(s,{lineBreak:r.lineBreak,wordBreak:r.overflowWrap==="break-word"?"break-word":r.wordBreak}),a=[],h,u=function(){if(h.value){var f=h.value.slice(),v=d(f),w="";v.forEach(function(E){Tu.indexOf(E)===-1?w+=m(E):(w.length&&a.push(w),a.push(m(E)),w="")}),w.length&&a.push(w)}};!(h=o.next()).done;)u();return a},Du=function(){function s(r,o,a){this.text=Ru(o.data,a.textTransform),this.textBounds=bu(r,this.text,a,o)}return s}(),Ru=function(s,r){switch(r){case 1:return s.toLowerCase();case 3:return s.replace(Ku,Ou);case 2:return s.toUpperCase();default:return s}},Ku=/(^|\s|:|-|\(|\))([a-z])/g,Ou=function(s,r,o){return s.length>0?r+o.toUpperCase():s},ol=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h.src=a.currentSrc||a.src,h.intrinsicWidth=a.naturalWidth,h.intrinsicHeight=a.naturalHeight,h.context.cache.addImage(h.src),h}return r}(Et),ll=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h.canvas=a,h.intrinsicWidth=a.width,h.intrinsicHeight=a.height,h}return r}(Et),cl=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this,u=new XMLSerializer,f=c(o,a);return a.setAttribute("width",f.width+"px"),a.setAttribute("height",f.height+"px"),h.svg="data:image/svg+xml,"+encodeURIComponent(u.serializeToString(a)),h.intrinsicWidth=a.width.baseVal.value,h.intrinsicHeight=a.height.baseVal.value,h.context.cache.addImage(h.svg),h}return r}(Et),hl=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h.value=a.value,h}return r}(Et),ga=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h.start=a.start,h.reversed=typeof a.reversed=="boolean"&&a.reversed===!0,h}return r}(Et),ku=[{type:15,flags:0,unit:"px",number:3}],Nu=[{type:16,flags:0,number:50}],Gu=function(s){return s.width>s.height?new l(s.left+(s.width-s.height)/2,s.top,s.height,s.height):s.width<s.height?new l(s.left,s.top+(s.height-s.width)/2,s.width,s.width):s},Vu=function(s){var r=s.type===_u?new Array(s.value.length+1).join("\u2022"):s.value;return r.length===0?s.placeholder||"":r},Tr="checkbox",Pr="radio",_u="password",gl=707406591,da=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;switch(h.type=a.type.toLowerCase(),h.checked=a.checked,h.value=Vu(a),(h.type===Tr||h.type===Pr)&&(h.styles.backgroundColor=3739148031,h.styles.borderTopColor=h.styles.borderRightColor=h.styles.borderBottomColor=h.styles.borderLeftColor=2779096575,h.styles.borderTopWidth=h.styles.borderRightWidth=h.styles.borderBottomWidth=h.styles.borderLeftWidth=1,h.styles.borderTopStyle=h.styles.borderRightStyle=h.styles.borderBottomStyle=h.styles.borderLeftStyle=1,h.styles.backgroundClip=[0],h.styles.backgroundOrigin=[0],h.bounds=Gu(h.bounds)),h.type){case Tr:h.styles.borderTopRightRadius=h.styles.borderTopLeftRadius=h.styles.borderBottomRightRadius=h.styles.borderBottomLeftRadius=ku;break;case Pr:h.styles.borderTopRightRadius=h.styles.borderTopLeftRadius=h.styles.borderBottomRightRadius=h.styles.borderBottomLeftRadius=Nu;break}return h}return r}(Et),dl=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this,u=a.options[a.selectedIndex||0];return h.value=u&&u.text||"",h}return r}(Et),ul=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h.value=a.value,h}return r}(Et),pl=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;h.src=a.src,h.width=parseInt(a.width,10)||0,h.height=parseInt(a.height,10)||0,h.backgroundColor=h.styles.backgroundColor;try{if(a.contentWindow&&a.contentWindow.document&&a.contentWindow.document.documentElement){h.tree=ml(o,a.contentWindow.document.documentElement);var u=a.contentWindow.document.documentElement?Ci(o,getComputedStyle(a.contentWindow.document.documentElement).backgroundColor):Lt.TRANSPARENT,f=a.contentWindow.document.body?Ci(o,getComputedStyle(a.contentWindow.document.body).backgroundColor):Lt.TRANSPARENT;h.backgroundColor=Zt(u)?Zt(f)?h.styles.backgroundColor:f:u}}catch(v){}return h}return r}(Et),Wu=["OL","UL","MENU"],Dr=function(s,r,o,a){for(var h=r.firstChild,u=void 0;h;h=u)if(u=h.nextSibling,Bl(h)&&h.data.trim().length>0)o.textNodes.push(new Du(s,h,o.styles));else if(xA(h))if(El(h)&&h.assignedNodes)h.assignedNodes().forEach(function(v){return Dr(s,v,o,a)});else{var f=fl(s,h);f.styles.isVisible()&&(Xu(h,f,a)?f.flags|=4:Ju(f.styles)&&(f.flags|=2),Wu.indexOf(h.tagName)!==-1&&(f.flags|=8),o.elements.push(f),h.slot,h.shadowRoot?Dr(s,h.shadowRoot,f,a):!Kr(h)&&!Cl(h)&&!Or(h)&&Dr(s,h,f,a))}},fl=function(s,r){return fa(r)?new ol(s,r):wl(r)?new ll(s,r):Cl(r)?new cl(s,r):Yu(r)?new hl(s,r):$u(r)?new ga(s,r):zu(r)?new da(s,r):Or(r)?new dl(s,r):Kr(r)?new ul(s,r):Fl(r)?new pl(s,r):new Et(s,r)},ml=function(s,r){var o=fl(s,r);return o.flags|=4,Dr(s,r,o,o),o},Xu=function(s,r,o){return r.styles.isPositionedWithZIndex()||r.styles.opacity<1||r.styles.isTransformed()||pa(s)&&o.styles.isTransparent()},Ju=function(s){return s.isPositioned()||s.isFloating()},Bl=function(s){return s.nodeType===Node.TEXT_NODE},xA=function(s){return s.nodeType===Node.ELEMENT_NODE},ua=function(s){return xA(s)&&typeof s.style!="undefined"&&!Rr(s)},Rr=function(s){return typeof s.className=="object"},Yu=function(s){return s.tagName==="LI"},$u=function(s){return s.tagName==="OL"},zu=function(s){return s.tagName==="INPUT"},qu=function(s){return s.tagName==="HTML"},Cl=function(s){return s.tagName==="svg"},pa=function(s){return s.tagName==="BODY"},wl=function(s){return s.tagName==="CANVAS"},vl=function(s){return s.tagName==="VIDEO"},fa=function(s){return s.tagName==="IMG"},Fl=function(s){return s.tagName==="IFRAME"},yl=function(s){return s.tagName==="STYLE"},Zu=function(s){return s.tagName==="SCRIPT"},Kr=function(s){return s.tagName==="TEXTAREA"},Or=function(s){return s.tagName==="SELECT"},El=function(s){return s.tagName==="SLOT"},Il=function(s){return s.tagName.indexOf("-")>0},ju=function(){function s(){this.counters={}}return s.prototype.getCounterValue=function(r){var o=this.counters[r];return o&&o.length?o[o.length-1]:1},s.prototype.getCounterValues=function(r){var o=this.counters[r];return o||[]},s.prototype.pop=function(r){var o=this;r.forEach(function(a){return o.counters[a].pop()})},s.prototype.parse=function(r){var o=this,a=r.counterIncrement,h=r.counterReset,u=!0;a!==null&&a.forEach(function(v){var w=o.counters[v.counter];w&&v.increment!==0&&(u=!1,w.length||w.push(1),w[Math.max(0,w.length-1)]+=v.increment)});var f=[];return u&&h.forEach(function(v){var w=o.counters[v.counter];f.push(v.counter),w||(w=o.counters[v.counter]=[]),w.push(v.reset)}),f},s}(),Hl={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Ql={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u0554","\u0553","\u0552","\u0551","\u0550","\u054F","\u054E","\u054D","\u054C","\u054B","\u054A","\u0549","\u0548","\u0547","\u0546","\u0545","\u0544","\u0543","\u0542","\u0541","\u0540","\u053F","\u053E","\u053D","\u053C","\u053B","\u053A","\u0539","\u0538","\u0537","\u0536","\u0535","\u0534","\u0533","\u0532","\u0531"]},ep={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["\u05D9\u05F3","\u05D8\u05F3","\u05D7\u05F3","\u05D6\u05F3","\u05D5\u05F3","\u05D4\u05F3","\u05D3\u05F3","\u05D2\u05F3","\u05D1\u05F3","\u05D0\u05F3","\u05EA","\u05E9","\u05E8","\u05E7","\u05E6","\u05E4","\u05E2","\u05E1","\u05E0","\u05DE","\u05DC","\u05DB","\u05D9\u05D8","\u05D9\u05D7","\u05D9\u05D6","\u05D8\u05D6","\u05D8\u05D5","\u05D9","\u05D8","\u05D7","\u05D6","\u05D5","\u05D4","\u05D3","\u05D2","\u05D1","\u05D0"]},tp={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u10F5","\u10F0","\u10EF","\u10F4","\u10EE","\u10ED","\u10EC","\u10EB","\u10EA","\u10E9","\u10E8","\u10E7","\u10E6","\u10E5","\u10E4","\u10F3","\u10E2","\u10E1","\u10E0","\u10DF","\u10DE","\u10DD","\u10F2","\u10DC","\u10DB","\u10DA","\u10D9","\u10D8","\u10D7","\u10F1","\u10D6","\u10D5","\u10D4","\u10D3","\u10D2","\u10D1","\u10D0"]},LA=function(s,r,o,a,h,u){return s<r||s>o?Ei(s,h,u.length>0):a.integers.reduce(function(f,v,w){for(;s>=v;)s-=v,f+=a.values[w];return f},"")+u},Sl=function(s,r,o,a){var h="";do o||s--,h=a(s)+h,s/=r;while(s*r>=r);return h},we=function(s,r,o,a,h){var u=o-r+1;return(s<0?"-":"")+(Sl(Math.abs(s),u,a,function(f){return m(Math.floor(f%u)+r)})+h)},gA=function(s,r,o){o===void 0&&(o=". ");var a=r.length;return Sl(Math.abs(s),a,!1,function(h){return r[Math.floor(h%a)]})+o},TA=1,eA=2,tA=4,yi=8,Tt=function(s,r,o,a,h,u){if(s<-9999||s>9999)return Ei(s,4,h.length>0);var f=Math.abs(s),v=h;if(f===0)return r[0]+v;for(var w=0;f>0&&w<=4;w++){var E=f%10;E===0&&Se(u,TA)&&v!==""?v=r[E]+v:E>1||E===1&&w===0||E===1&&w===1&&Se(u,eA)||E===1&&w===1&&Se(u,tA)&&s>100||E===1&&w>1&&Se(u,yi)?v=r[E]+(w>0?o[w-1]:"")+v:E===1&&w>0&&(v=o[w-1]+v),f=Math.floor(f/10)}return(s<0?a:"")+v},Ul="\u5341\u767E\u5343\u842C",bl="\u62FE\u4F70\u4EDF\u842C",Ml="\u30DE\u30A4\u30CA\u30B9",ma="\uB9C8\uC774\uB108\uC2A4",Ei=function(s,r,o){var a=o?". ":"",h=o?"\u3001":"",u=o?", ":"",f=o?" ":"";switch(r){case 0:return"\u2022"+f;case 1:return"\u25E6"+f;case 2:return"\u25FE"+f;case 5:var v=we(s,48,57,!0,a);return v.length<4?"0"+v:v;case 4:return gA(s,"\u3007\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",h);case 6:return LA(s,1,3999,Hl,3,a).toLowerCase();case 7:return LA(s,1,3999,Hl,3,a);case 8:return we(s,945,969,!1,a);case 9:return we(s,97,122,!1,a);case 10:return we(s,65,90,!1,a);case 11:return we(s,1632,1641,!0,a);case 12:case 49:return LA(s,1,9999,Ql,3,a);case 35:return LA(s,1,9999,Ql,3,a).toLowerCase();case 13:return we(s,2534,2543,!0,a);case 14:case 30:return we(s,6112,6121,!0,a);case 15:return gA(s,"\u5B50\u4E11\u5BC5\u536F\u8FB0\u5DF3\u5348\u672A\u7533\u9149\u620C\u4EA5",h);case 16:return gA(s,"\u7532\u4E59\u4E19\u4E01\u620A\u5DF1\u5E9A\u8F9B\u58EC\u7678",h);case 17:case 48:return Tt(s,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",Ul,"\u8CA0",h,eA|tA|yi);case 47:return Tt(s,"\u96F6\u58F9\u8CB3\u53C3\u8086\u4F0D\u9678\u67D2\u634C\u7396",bl,"\u8CA0",h,TA|eA|tA|yi);case 42:return Tt(s,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",Ul,"\u8D1F",h,eA|tA|yi);case 41:return Tt(s,"\u96F6\u58F9\u8D30\u53C1\u8086\u4F0D\u9646\u67D2\u634C\u7396",bl,"\u8D1F",h,TA|eA|tA|yi);case 26:return Tt(s,"\u3007\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u5341\u767E\u5343\u4E07",Ml,h,0);case 25:return Tt(s,"\u96F6\u58F1\u5F10\u53C2\u56DB\u4F0D\u516D\u4E03\u516B\u4E5D","\u62FE\u767E\u5343\u4E07",Ml,h,TA|eA|tA);case 31:return Tt(s,"\uC601\uC77C\uC774\uC0BC\uC0AC\uC624\uC721\uCE60\uD314\uAD6C","\uC2ED\uBC31\uCC9C\uB9CC",ma,u,TA|eA|tA);case 33:return Tt(s,"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u5341\u767E\u5343\u842C",ma,u,0);case 32:return Tt(s,"\u96F6\u58F9\u8CB3\u53C3\u56DB\u4E94\u516D\u4E03\u516B\u4E5D","\u62FE\u767E\u5343",ma,u,TA|eA|tA);case 18:return we(s,2406,2415,!0,a);case 20:return LA(s,1,19999,tp,3,a);case 21:return we(s,2790,2799,!0,a);case 22:return we(s,2662,2671,!0,a);case 22:return LA(s,1,10999,ep,3,a);case 23:return gA(s,"\u3042\u3044\u3046\u3048\u304A\u304B\u304D\u304F\u3051\u3053\u3055\u3057\u3059\u305B\u305D\u305F\u3061\u3064\u3066\u3068\u306A\u306B\u306C\u306D\u306E\u306F\u3072\u3075\u3078\u307B\u307E\u307F\u3080\u3081\u3082\u3084\u3086\u3088\u3089\u308A\u308B\u308C\u308D\u308F\u3090\u3091\u3092\u3093");case 24:return gA(s,"\u3044\u308D\u306F\u306B\u307B\u3078\u3068\u3061\u308A\u306C\u308B\u3092\u308F\u304B\u3088\u305F\u308C\u305D\u3064\u306D\u306A\u3089\u3080\u3046\u3090\u306E\u304A\u304F\u3084\u307E\u3051\u3075\u3053\u3048\u3066\u3042\u3055\u304D\u3086\u3081\u307F\u3057\u3091\u3072\u3082\u305B\u3059");case 27:return we(s,3302,3311,!0,a);case 28:return gA(s,"\u30A2\u30A4\u30A6\u30A8\u30AA\u30AB\u30AD\u30AF\u30B1\u30B3\u30B5\u30B7\u30B9\u30BB\u30BD\u30BF\u30C1\u30C4\u30C6\u30C8\u30CA\u30CB\u30CC\u30CD\u30CE\u30CF\u30D2\u30D5\u30D8\u30DB\u30DE\u30DF\u30E0\u30E1\u30E2\u30E4\u30E6\u30E8\u30E9\u30EA\u30EB\u30EC\u30ED\u30EF\u30F0\u30F1\u30F2\u30F3",h);case 29:return gA(s,"\u30A4\u30ED\u30CF\u30CB\u30DB\u30D8\u30C8\u30C1\u30EA\u30CC\u30EB\u30F2\u30EF\u30AB\u30E8\u30BF\u30EC\u30BD\u30C4\u30CD\u30CA\u30E9\u30E0\u30A6\u30F0\u30CE\u30AA\u30AF\u30E4\u30DE\u30B1\u30D5\u30B3\u30A8\u30C6\u30A2\u30B5\u30AD\u30E6\u30E1\u30DF\u30B7\u30F1\u30D2\u30E2\u30BB\u30B9",h);case 34:return we(s,3792,3801,!0,a);case 37:return we(s,6160,6169,!0,a);case 38:return we(s,4160,4169,!0,a);case 39:return we(s,2918,2927,!0,a);case 40:return we(s,1776,1785,!0,a);case 43:return we(s,3046,3055,!0,a);case 44:return we(s,3174,3183,!0,a);case 45:return we(s,3664,3673,!0,a);case 46:return we(s,3872,3881,!0,a);case 3:default:return we(s,48,57,!0,a)}},xl="data-html2canvas-ignore",Ll=function(){function s(r,o,a){if(this.context=r,this.options=a,this.scrolledElements=[],this.referenceElement=o,this.counters=new ju,this.quoteDepth=0,!o.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(o.ownerDocument.documentElement,!1)}return s.prototype.toIFrame=function(r,o){var a=this,h=Ap(r,o);if(!h.contentWindow)return Promise.reject("Unable to find iframe window");var u=r.defaultView.pageXOffset,f=r.defaultView.pageYOffset,v=h.contentWindow,w=v.document,E=sp(h).then(function(){return A(a,void 0,void 0,function(){var I,H;return i(this,function(S){switch(S.label){case 0:return this.scrolledElements.forEach(lp),v&&(v.scrollTo(o.left,o.top),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(v.scrollY!==o.top||v.scrollX!==o.left)&&(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(v.scrollX-o.left,v.scrollY-o.top,0,0))),I=this.options.onclone,H=this.clonedReferenceElement,typeof H=="undefined"?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:w.fonts&&w.fonts.ready?[4,w.fonts.ready]:[3,2];case 1:S.sent(),S.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,rp(w)]:[3,4];case 3:S.sent(),S.label=4;case 4:return typeof I=="function"?[2,Promise.resolve().then(function(){return I(w,H)}).then(function(){return h})]:[2,h]}})})});return w.open(),w.write(ap(document.doctype)+"<html></html>"),op(this.referenceElement.ownerDocument,u,f),w.replaceChild(w.adoptNode(this.documentElement),w.documentElement),w.close(),E},s.prototype.createElementClone=function(r){if(ea(r,2))debugger;if(wl(r))return this.createCanvasClone(r);if(vl(r))return this.createVideoClone(r);if(yl(r))return this.createStyleClone(r);var o=r.cloneNode(!1);return fa(o)&&(fa(r)&&r.currentSrc&&r.currentSrc!==r.src&&(o.src=r.currentSrc,o.srcset=""),o.loading==="lazy"&&(o.loading="eager")),Il(o)?this.createCustomElementClone(o):o},s.prototype.createCustomElementClone=function(r){var o=document.createElement("html2canvascustomelement");return Ba(r.style,o),o},s.prototype.createStyleClone=function(r){try{var o=r.sheet;if(o&&o.cssRules){var a=[].slice.call(o.cssRules,0).reduce(function(u,f){return f&&typeof f.cssText=="string"?u+f.cssText:u},""),h=r.cloneNode(!1);return h.textContent=a,h}}catch(u){if(this.context.logger.error("Unable to access cssRules property",u),u.name!=="SecurityError")throw u}return r.cloneNode(!1)},s.prototype.createCanvasClone=function(r){var o;if(this.options.inlineImages&&r.ownerDocument){var a=r.ownerDocument.createElement("img");try{return a.src=r.toDataURL(),a}catch(E){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",r)}}var h=r.cloneNode(!1);try{h.width=r.width,h.height=r.height;var u=r.getContext("2d"),f=h.getContext("2d");if(f)if(!this.options.allowTaint&&u)f.putImageData(u.getImageData(0,0,r.width,r.height),0,0);else{var v=(o=r.getContext("webgl2"))!==null&&o!==void 0?o:r.getContext("webgl");if(v){var w=v.getContextAttributes();(w==null?void 0:w.preserveDrawingBuffer)===!1&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",r)}f.drawImage(r,0,0)}return h}catch(E){this.context.logger.info("Unable to clone canvas as it is tainted",r)}return h},s.prototype.createVideoClone=function(r){var o=r.ownerDocument.createElement("canvas");o.width=r.offsetWidth,o.height=r.offsetHeight;var a=o.getContext("2d");try{return a&&(a.drawImage(r,0,0,o.width,o.height),this.options.allowTaint||a.getImageData(0,0,o.width,o.height)),o}catch(u){this.context.logger.info("Unable to clone video as it is tainted",r)}var h=r.ownerDocument.createElement("canvas");return h.width=r.offsetWidth,h.height=r.offsetHeight,h},s.prototype.appendChildNode=function(r,o,a){(!xA(o)||!Zu(o)&&!o.hasAttribute(xl)&&(typeof this.options.ignoreElements!="function"||!this.options.ignoreElements(o)))&&(!this.options.copyStyles||!xA(o)||!yl(o))&&r.appendChild(this.cloneNode(o,a))},s.prototype.cloneChildNodes=function(r,o,a){for(var h=this,u=r.shadowRoot?r.shadowRoot.firstChild:r.firstChild;u;u=u.nextSibling)if(xA(u)&&El(u)&&typeof u.assignedNodes=="function"){var f=u.assignedNodes();f.length&&f.forEach(function(v){return h.appendChildNode(o,v,a)})}else this.appendChildNode(o,u,a)},s.prototype.cloneNode=function(r,o){if(Bl(r))return document.createTextNode(r.data);if(!r.ownerDocument)return r.cloneNode(!1);var a=r.ownerDocument.defaultView;if(a&&xA(r)&&(ua(r)||Rr(r))){var h=this.createElementClone(r);h.style.transitionProperty="none";var u=a.getComputedStyle(r),f=a.getComputedStyle(r,":before"),v=a.getComputedStyle(r,":after");this.referenceElement===r&&ua(h)&&(this.clonedReferenceElement=h),pa(h)&&gp(h);var w=this.counters.parse(new Jo(this.context,u)),E=this.resolvePseudoContent(r,h,f,Ii.BEFORE);Il(r)&&(o=!0),vl(r)||this.cloneChildNodes(r,h,o),E&&h.insertBefore(E,h.firstChild);var I=this.resolvePseudoContent(r,h,v,Ii.AFTER);return I&&h.appendChild(I),this.counters.pop(w),(u&&(this.options.copyStyles||Rr(r))&&!Fl(r)||o)&&Ba(u,h),(r.scrollTop!==0||r.scrollLeft!==0)&&this.scrolledElements.push([h,r.scrollLeft,r.scrollTop]),(Kr(r)||Or(r))&&(Kr(h)||Or(h))&&(h.value=r.value),h}return r.cloneNode(!1)},s.prototype.resolvePseudoContent=function(r,o,a,h){var u=this;if(a){var f=a.content,v=o.ownerDocument;if(!(!v||!f||f==="none"||f==="-moz-alt-content"||a.display==="none")){this.counters.parse(new Jo(this.context,a));var w=new Yd(this.context,a),E=v.createElement("html2canvaspseudoelement");Ba(a,E),w.content.forEach(function(H){if(H.type===0)E.appendChild(v.createTextNode(H.value));else if(H.type===22){var S=v.createElement("img");S.src=H.value,S.style.opacity="1",E.appendChild(S)}else if(H.type===18){if(H.name==="attr"){var R=H.values.filter(le);R.length&&E.appendChild(v.createTextNode(r.getAttribute(R[0].value)||""))}else if(H.name==="counter"){var M=H.values.filter(bA),L=M[0],J=M[1];if(L&&le(L)){var V=u.counters.getCounterValue(L.value),O=J&&le(J)?jn.parse(u.context,J.value):3;E.appendChild(v.createTextNode(Ei(V,O,!1)))}}else if(H.name==="counters"){var ie=H.values.filter(bA),L=ie[0],Y=ie[1],J=ie[2];if(L&&le(L)){var _=u.counters.getCounterValues(L.value),D=J&&le(J)?jn.parse(u.context,J.value):3,ee=Y&&Y.type===0?Y.value:"",te=_.map(function(Ze){return Ei(Ze,D,!1)}).join(ee);E.appendChild(v.createTextNode(te))}}}else if(H.type===20)switch(H.value){case"open-quote":E.appendChild(v.createTextNode(Xo(w.quotes,u.quoteDepth++,!0)));break;case"close-quote":E.appendChild(v.createTextNode(Xo(w.quotes,--u.quoteDepth,!1)));break;default:E.appendChild(v.createTextNode(H.value))}}),E.className=Ca+" "+wa;var I=h===Ii.BEFORE?" "+Ca:" "+wa;return Rr(o)?o.className.baseValue+=I:o.className+=I,E}}},s.destroy=function(r){return r.parentNode?(r.parentNode.removeChild(r),!0):!1},s}(),Ii;(function(s){s[s.BEFORE=0]="BEFORE",s[s.AFTER=1]="AFTER"})(Ii||(Ii={}));var Ap=function(s,r){var o=s.createElement("iframe");return o.className="html2canvas-container",o.style.visibility="hidden",o.style.position="fixed",o.style.left="-10000px",o.style.top="0px",o.style.border="0",o.width=r.width.toString(),o.height=r.height.toString(),o.scrolling="no",o.setAttribute(xl,"true"),s.body.appendChild(o),o},ip=function(s){return new Promise(function(r){if(s.complete){r();return}if(!s.src){r();return}s.onload=r,s.onerror=r})},rp=function(s){return Promise.all([].slice.call(s.images,0).map(ip))},sp=function(s){return new Promise(function(r,o){var a=s.contentWindow;if(!a)return o("No window assigned for iframe");var h=a.document;a.onload=s.onload=function(){a.onload=s.onload=null;var u=setInterval(function(){h.body.childNodes.length>0&&h.readyState==="complete"&&(clearInterval(u),r(s))},50)}})},np=["all","d","content"],Ba=function(s,r){for(var o=s.length-1;o>=0;o--){var a=s.item(o);np.indexOf(a)===-1&&r.style.setProperty(a,s.getPropertyValue(a))}return r},ap=function(s){var r="";return s&&(r+="<!DOCTYPE ",s.name&&(r+=s.name),s.internalSubset&&(r+=s.internalSubset),s.publicId&&(r+='"'+s.publicId+'"'),s.systemId&&(r+='"'+s.systemId+'"'),r+=">"),r},op=function(s,r,o){s&&s.defaultView&&(r!==s.defaultView.pageXOffset||o!==s.defaultView.pageYOffset)&&s.defaultView.scrollTo(r,o)},lp=function(s){var r=s[0],o=s[1],a=s[2];r.scrollLeft=o,r.scrollTop=a},cp=":before",hp=":after",Ca="___html2canvas___pseudoelement_before",wa="___html2canvas___pseudoelement_after",Tl=`{
    content: "" !important;
    display: none !important;
}`,gp=function(s){dp(s,"."+Ca+cp+Tl+`
         .`+wa+hp+Tl)},dp=function(s,r){var o=s.ownerDocument;if(o){var a=o.createElement("style");a.textContent=r,s.appendChild(a)}},Pl=function(){function s(){}return s.getOrigin=function(r){var o=s._link;return o?(o.href=r,o.href=o.href,o.protocol+o.hostname+o.port):"about:blank"},s.isSameOrigin=function(r){return s.getOrigin(r)===s._origin},s.setContext=function(r){s._link=r.document.createElement("a"),s._origin=s.getOrigin(r.location.href)},s._origin="about:blank",s}(),up=function(){function s(r,o){this.context=r,this._options=o,this._cache={}}return s.prototype.addImage=function(r){var o=Promise.resolve();return this.has(r)||(Fa(r)||Bp(r))&&(this._cache[r]=this.loadImage(r)).catch(function(){}),o},s.prototype.match=function(r){return this._cache[r]},s.prototype.loadImage=function(r){return A(this,void 0,void 0,function(){var o,a,h,u,f=this;return i(this,function(v){switch(v.label){case 0:return o=Pl.isSameOrigin(r),a=!va(r)&&this._options.useCORS===!0&&De.SUPPORT_CORS_IMAGES&&!o,h=!va(r)&&!o&&!Fa(r)&&typeof this._options.proxy=="string"&&De.SUPPORT_CORS_XHR&&!a,!o&&this._options.allowTaint===!1&&!va(r)&&!Fa(r)&&!h&&!a?[2]:(u=r,h?[4,this.proxy(u)]:[3,2]);case 1:u=v.sent(),v.label=2;case 2:return this.context.logger.debug("Added image "+r.substring(0,256)),[4,new Promise(function(w,E){var I=new Image;I.onload=function(){return w(I)},I.onerror=E,(Cp(u)||a)&&(I.crossOrigin="anonymous"),I.src=u,I.complete===!0&&setTimeout(function(){return w(I)},500),f._options.imageTimeout>0&&setTimeout(function(){return E("Timed out ("+f._options.imageTimeout+"ms) loading image")},f._options.imageTimeout)})];case 3:return[2,v.sent()]}})})},s.prototype.has=function(r){return typeof this._cache[r]!="undefined"},s.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},s.prototype.proxy=function(r){var o=this,a=this._options.proxy;if(!a)throw new Error("No proxy defined");var h=r.substring(0,256);return new Promise(function(u,f){var v=De.SUPPORT_RESPONSE_TYPE?"blob":"text",w=new XMLHttpRequest;w.onload=function(){if(w.status===200)if(v==="text")u(w.response);else{var H=new FileReader;H.addEventListener("load",function(){return u(H.result)},!1),H.addEventListener("error",function(S){return f(S)},!1),H.readAsDataURL(w.response)}else f("Failed to proxy resource "+h+" with status code "+w.status)},w.onerror=f;var E=a.indexOf("?")>-1?"&":"?";if(w.open("GET",""+a+E+"url="+encodeURIComponent(r)+"&responseType="+v),v!=="text"&&w instanceof XMLHttpRequest&&(w.responseType=v),o._options.imageTimeout){var I=o._options.imageTimeout;w.timeout=I,w.ontimeout=function(){return f("Timed out ("+I+"ms) proxying "+h)}}w.send()})},s}(),pp=/^data:image\/svg\+xml/i,fp=/^data:image\/.*;base64,/i,mp=/^data:image\/.*/i,Bp=function(s){return De.SUPPORT_SVG_DRAWING||!wp(s)},va=function(s){return mp.test(s)},Cp=function(s){return fp.test(s)},Fa=function(s){return s.substr(0,4)==="blob"},wp=function(s){return s.substr(-3).toLowerCase()==="svg"||pp.test(s)},T=function(){function s(r,o){this.type=0,this.x=r,this.y=o}return s.prototype.add=function(r,o){return new s(this.x+r,this.y+o)},s}(),PA=function(s,r,o){return new T(s.x+(r.x-s.x)*o,s.y+(r.y-s.y)*o)},kr=function(){function s(r,o,a,h){this.type=1,this.start=r,this.startControl=o,this.endControl=a,this.end=h}return s.prototype.subdivide=function(r,o){var a=PA(this.start,this.startControl,r),h=PA(this.startControl,this.endControl,r),u=PA(this.endControl,this.end,r),f=PA(a,h,r),v=PA(h,u,r),w=PA(f,v,r);return o?new s(this.start,a,f,w):new s(w,v,u,this.end)},s.prototype.add=function(r,o){return new s(this.start.add(r,o),this.startControl.add(r,o),this.endControl.add(r,o),this.end.add(r,o))},s.prototype.reverse=function(){return new s(this.end,this.endControl,this.startControl,this.start)},s}(),ht=function(s){return s.type===1},vp=function(){function s(r){var o=r.styles,a=r.bounds,h=Bi(o.borderTopLeftRadius,a.width,a.height),u=h[0],f=h[1],v=Bi(o.borderTopRightRadius,a.width,a.height),w=v[0],E=v[1],I=Bi(o.borderBottomRightRadius,a.width,a.height),H=I[0],S=I[1],R=Bi(o.borderBottomLeftRadius,a.width,a.height),M=R[0],L=R[1],J=[];J.push((u+w)/a.width),J.push((M+H)/a.width),J.push((f+L)/a.height),J.push((E+S)/a.height);var V=Math.max.apply(Math,J);V>1&&(u/=V,f/=V,w/=V,E/=V,H/=V,S/=V,M/=V,L/=V);var O=a.width-w,ie=a.height-S,Y=a.width-H,_=a.height-L,D=o.borderTopWidth,ee=o.borderRightWidth,te=o.borderBottomWidth,X=o.borderLeftWidth,Fe=ge(o.paddingTop,r.bounds.width),Ze=ge(o.paddingRight,r.bounds.width),st=ge(o.paddingBottom,r.bounds.width),ce=ge(o.paddingLeft,r.bounds.width);this.topLeftBorderDoubleOuterBox=u>0||f>0?pe(a.left+X/3,a.top+D/3,u-X/3,f-D/3,se.TOP_LEFT):new T(a.left+X/3,a.top+D/3),this.topRightBorderDoubleOuterBox=u>0||f>0?pe(a.left+O,a.top+D/3,w-ee/3,E-D/3,se.TOP_RIGHT):new T(a.left+a.width-ee/3,a.top+D/3),this.bottomRightBorderDoubleOuterBox=H>0||S>0?pe(a.left+Y,a.top+ie,H-ee/3,S-te/3,se.BOTTOM_RIGHT):new T(a.left+a.width-ee/3,a.top+a.height-te/3),this.bottomLeftBorderDoubleOuterBox=M>0||L>0?pe(a.left+X/3,a.top+_,M-X/3,L-te/3,se.BOTTOM_LEFT):new T(a.left+X/3,a.top+a.height-te/3),this.topLeftBorderDoubleInnerBox=u>0||f>0?pe(a.left+X*2/3,a.top+D*2/3,u-X*2/3,f-D*2/3,se.TOP_LEFT):new T(a.left+X*2/3,a.top+D*2/3),this.topRightBorderDoubleInnerBox=u>0||f>0?pe(a.left+O,a.top+D*2/3,w-ee*2/3,E-D*2/3,se.TOP_RIGHT):new T(a.left+a.width-ee*2/3,a.top+D*2/3),this.bottomRightBorderDoubleInnerBox=H>0||S>0?pe(a.left+Y,a.top+ie,H-ee*2/3,S-te*2/3,se.BOTTOM_RIGHT):new T(a.left+a.width-ee*2/3,a.top+a.height-te*2/3),this.bottomLeftBorderDoubleInnerBox=M>0||L>0?pe(a.left+X*2/3,a.top+_,M-X*2/3,L-te*2/3,se.BOTTOM_LEFT):new T(a.left+X*2/3,a.top+a.height-te*2/3),this.topLeftBorderStroke=u>0||f>0?pe(a.left+X/2,a.top+D/2,u-X/2,f-D/2,se.TOP_LEFT):new T(a.left+X/2,a.top+D/2),this.topRightBorderStroke=u>0||f>0?pe(a.left+O,a.top+D/2,w-ee/2,E-D/2,se.TOP_RIGHT):new T(a.left+a.width-ee/2,a.top+D/2),this.bottomRightBorderStroke=H>0||S>0?pe(a.left+Y,a.top+ie,H-ee/2,S-te/2,se.BOTTOM_RIGHT):new T(a.left+a.width-ee/2,a.top+a.height-te/2),this.bottomLeftBorderStroke=M>0||L>0?pe(a.left+X/2,a.top+_,M-X/2,L-te/2,se.BOTTOM_LEFT):new T(a.left+X/2,a.top+a.height-te/2),this.topLeftBorderBox=u>0||f>0?pe(a.left,a.top,u,f,se.TOP_LEFT):new T(a.left,a.top),this.topRightBorderBox=w>0||E>0?pe(a.left+O,a.top,w,E,se.TOP_RIGHT):new T(a.left+a.width,a.top),this.bottomRightBorderBox=H>0||S>0?pe(a.left+Y,a.top+ie,H,S,se.BOTTOM_RIGHT):new T(a.left+a.width,a.top+a.height),this.bottomLeftBorderBox=M>0||L>0?pe(a.left,a.top+_,M,L,se.BOTTOM_LEFT):new T(a.left,a.top+a.height),this.topLeftPaddingBox=u>0||f>0?pe(a.left+X,a.top+D,Math.max(0,u-X),Math.max(0,f-D),se.TOP_LEFT):new T(a.left+X,a.top+D),this.topRightPaddingBox=w>0||E>0?pe(a.left+Math.min(O,a.width-ee),a.top+D,O>a.width+ee?0:Math.max(0,w-ee),Math.max(0,E-D),se.TOP_RIGHT):new T(a.left+a.width-ee,a.top+D),this.bottomRightPaddingBox=H>0||S>0?pe(a.left+Math.min(Y,a.width-X),a.top+Math.min(ie,a.height-te),Math.max(0,H-ee),Math.max(0,S-te),se.BOTTOM_RIGHT):new T(a.left+a.width-ee,a.top+a.height-te),this.bottomLeftPaddingBox=M>0||L>0?pe(a.left+X,a.top+Math.min(_,a.height-te),Math.max(0,M-X),Math.max(0,L-te),se.BOTTOM_LEFT):new T(a.left+X,a.top+a.height-te),this.topLeftContentBox=u>0||f>0?pe(a.left+X+ce,a.top+D+Fe,Math.max(0,u-(X+ce)),Math.max(0,f-(D+Fe)),se.TOP_LEFT):new T(a.left+X+ce,a.top+D+Fe),this.topRightContentBox=w>0||E>0?pe(a.left+Math.min(O,a.width+X+ce),a.top+D+Fe,O>a.width+X+ce?0:w-X+ce,E-(D+Fe),se.TOP_RIGHT):new T(a.left+a.width-(ee+Ze),a.top+D+Fe),this.bottomRightContentBox=H>0||S>0?pe(a.left+Math.min(Y,a.width-(X+ce)),a.top+Math.min(ie,a.height+D+Fe),Math.max(0,H-(ee+Ze)),S-(te+st),se.BOTTOM_RIGHT):new T(a.left+a.width-(ee+Ze),a.top+a.height-(te+st)),this.bottomLeftContentBox=M>0||L>0?pe(a.left+X+ce,a.top+_,Math.max(0,M-(X+ce)),L-(te+st),se.BOTTOM_LEFT):new T(a.left+X+ce,a.top+a.height-(te+st))}return s}(),se;(function(s){s[s.TOP_LEFT=0]="TOP_LEFT",s[s.TOP_RIGHT=1]="TOP_RIGHT",s[s.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",s[s.BOTTOM_LEFT=3]="BOTTOM_LEFT"})(se||(se={}));var pe=function(s,r,o,a,h){var u=4*((Math.sqrt(2)-1)/3),f=o*u,v=a*u,w=s+o,E=r+a;switch(h){case se.TOP_LEFT:return new kr(new T(s,E),new T(s,E-v),new T(w-f,r),new T(w,r));case se.TOP_RIGHT:return new kr(new T(s,r),new T(s+f,r),new T(w,E-v),new T(w,E));case se.BOTTOM_RIGHT:return new kr(new T(w,r),new T(w,r+v),new T(s+f,E),new T(s,E));case se.BOTTOM_LEFT:default:return new kr(new T(w,E),new T(w-f,E),new T(s,r+v),new T(s,r))}},Nr=function(s){return[s.topLeftBorderBox,s.topRightBorderBox,s.bottomRightBorderBox,s.bottomLeftBorderBox]},Fp=function(s){return[s.topLeftContentBox,s.topRightContentBox,s.bottomRightContentBox,s.bottomLeftContentBox]},Gr=function(s){return[s.topLeftPaddingBox,s.topRightPaddingBox,s.bottomRightPaddingBox,s.bottomLeftPaddingBox]},yp=function(){function s(r,o,a){this.offsetX=r,this.offsetY=o,this.matrix=a,this.type=0,this.target=6}return s}(),Vr=function(){function s(r,o){this.path=r,this.target=o,this.type=1}return s}(),Ep=function(){function s(r){this.opacity=r,this.type=2,this.target=6}return s}(),Ip=function(s){return s.type===0},Dl=function(s){return s.type===1},Hp=function(s){return s.type===2},Rl=function(s,r){return s.length===r.length?s.some(function(o,a){return o===r[a]}):!1},Qp=function(s,r,o,a,h){return s.map(function(u,f){switch(f){case 0:return u.add(r,o);case 1:return u.add(r+a,o);case 2:return u.add(r+a,o+h);case 3:return u.add(r,o+h)}return u})},Kl=function(){function s(r){this.element=r,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return s}(),Ol=function(){function s(r,o){if(this.container=r,this.parent=o,this.effects=[],this.curves=new vp(this.container),this.container.styles.opacity<1&&this.effects.push(new Ep(this.container.styles.opacity)),this.container.styles.transform!==null){var a=this.container.bounds.left+this.container.styles.transformOrigin[0].number,h=this.container.bounds.top+this.container.styles.transformOrigin[1].number,u=this.container.styles.transform;this.effects.push(new yp(a,h,u))}if(this.container.styles.overflowX!==0){var f=Nr(this.curves),v=Gr(this.curves);Rl(f,v)?this.effects.push(new Vr(f,6)):(this.effects.push(new Vr(f,2)),this.effects.push(new Vr(v,4)))}}return s.prototype.getEffects=function(r){for(var o=[2,3].indexOf(this.container.styles.position)===-1,a=this.parent,h=this.effects.slice(0);a;){var u=a.effects.filter(function(w){return!Dl(w)});if(o||a.container.styles.position!==0||!a.parent){if(h.unshift.apply(h,u),o=[2,3].indexOf(a.container.styles.position)===-1,a.container.styles.overflowX!==0){var f=Nr(a.curves),v=Gr(a.curves);Rl(f,v)||h.unshift(new Vr(v,6))}}else h.unshift.apply(h,u);a=a.parent}return h.filter(function(w){return Se(w.target,r)})},s}(),ya=function(s,r,o,a){s.container.elements.forEach(function(h){var u=Se(h.flags,4),f=Se(h.flags,2),v=new Ol(h,s);Se(h.styles.display,2048)&&a.push(v);var w=Se(h.flags,8)?[]:a;if(u||f){var E=u||h.styles.isPositioned()?o:r,I=new Kl(v);if(h.styles.isPositioned()||h.styles.opacity<1||h.styles.isTransformed()){var H=h.styles.zIndex.order;if(H<0){var S=0;E.negativeZIndex.some(function(M,L){return H>M.element.container.styles.zIndex.order?(S=L,!1):S>0}),E.negativeZIndex.splice(S,0,I)}else if(H>0){var R=0;E.positiveZIndex.some(function(M,L){return H>=M.element.container.styles.zIndex.order?(R=L+1,!1):R>0}),E.positiveZIndex.splice(R,0,I)}else E.zeroOrAutoZIndexOrTransformedOrOpacity.push(I)}else h.styles.isFloating()?E.nonPositionedFloats.push(I):E.nonPositionedInlineLevel.push(I);ya(v,I,u?I:o,w)}else h.styles.isInlineLevel()?r.inlineLevel.push(v):r.nonInlineLevel.push(v),ya(v,r,o,w);Se(h.flags,8)&&kl(h,w)})},kl=function(s,r){for(var o=s instanceof ga?s.start:1,a=s instanceof ga?s.reversed:!1,h=0;h<r.length;h++){var u=r[h];u.container instanceof hl&&typeof u.container.value=="number"&&u.container.value!==0&&(o=u.container.value),u.listValue=Ei(o,u.container.styles.listStyleType,!0),o+=a?-1:1}},Sp=function(s){var r=new Ol(s,null),o=new Kl(r),a=[];return ya(r,o,o,a),kl(r.container,a),o},Nl=function(s,r){switch(r){case 0:return gt(s.topLeftBorderBox,s.topLeftPaddingBox,s.topRightBorderBox,s.topRightPaddingBox);case 1:return gt(s.topRightBorderBox,s.topRightPaddingBox,s.bottomRightBorderBox,s.bottomRightPaddingBox);case 2:return gt(s.bottomRightBorderBox,s.bottomRightPaddingBox,s.bottomLeftBorderBox,s.bottomLeftPaddingBox);case 3:default:return gt(s.bottomLeftBorderBox,s.bottomLeftPaddingBox,s.topLeftBorderBox,s.topLeftPaddingBox)}},Up=function(s,r){switch(r){case 0:return gt(s.topLeftBorderBox,s.topLeftBorderDoubleOuterBox,s.topRightBorderBox,s.topRightBorderDoubleOuterBox);case 1:return gt(s.topRightBorderBox,s.topRightBorderDoubleOuterBox,s.bottomRightBorderBox,s.bottomRightBorderDoubleOuterBox);case 2:return gt(s.bottomRightBorderBox,s.bottomRightBorderDoubleOuterBox,s.bottomLeftBorderBox,s.bottomLeftBorderDoubleOuterBox);case 3:default:return gt(s.bottomLeftBorderBox,s.bottomLeftBorderDoubleOuterBox,s.topLeftBorderBox,s.topLeftBorderDoubleOuterBox)}},bp=function(s,r){switch(r){case 0:return gt(s.topLeftBorderDoubleInnerBox,s.topLeftPaddingBox,s.topRightBorderDoubleInnerBox,s.topRightPaddingBox);case 1:return gt(s.topRightBorderDoubleInnerBox,s.topRightPaddingBox,s.bottomRightBorderDoubleInnerBox,s.bottomRightPaddingBox);case 2:return gt(s.bottomRightBorderDoubleInnerBox,s.bottomRightPaddingBox,s.bottomLeftBorderDoubleInnerBox,s.bottomLeftPaddingBox);case 3:default:return gt(s.bottomLeftBorderDoubleInnerBox,s.bottomLeftPaddingBox,s.topLeftBorderDoubleInnerBox,s.topLeftPaddingBox)}},Mp=function(s,r){switch(r){case 0:return _r(s.topLeftBorderStroke,s.topRightBorderStroke);case 1:return _r(s.topRightBorderStroke,s.bottomRightBorderStroke);case 2:return _r(s.bottomRightBorderStroke,s.bottomLeftBorderStroke);case 3:default:return _r(s.bottomLeftBorderStroke,s.topLeftBorderStroke)}},_r=function(s,r){var o=[];return ht(s)?o.push(s.subdivide(.5,!1)):o.push(s),ht(r)?o.push(r.subdivide(.5,!0)):o.push(r),o},gt=function(s,r,o,a){var h=[];return ht(s)?h.push(s.subdivide(.5,!1)):h.push(s),ht(o)?h.push(o.subdivide(.5,!0)):h.push(o),ht(a)?h.push(a.subdivide(.5,!0).reverse()):h.push(a),ht(r)?h.push(r.subdivide(.5,!1).reverse()):h.push(r),h},Gl=function(s){var r=s.bounds,o=s.styles;return r.add(o.borderLeftWidth,o.borderTopWidth,-(o.borderRightWidth+o.borderLeftWidth),-(o.borderTopWidth+o.borderBottomWidth))},Wr=function(s){var r=s.styles,o=s.bounds,a=ge(r.paddingLeft,o.width),h=ge(r.paddingRight,o.width),u=ge(r.paddingTop,o.width),f=ge(r.paddingBottom,o.width);return o.add(a+r.borderLeftWidth,u+r.borderTopWidth,-(r.borderRightWidth+r.borderLeftWidth+a+h),-(r.borderTopWidth+r.borderBottomWidth+u+f))},xp=function(s,r){return s===0?r.bounds:s===2?Wr(r):Gl(r)},Lp=function(s,r){return s===0?r.bounds:s===2?Wr(r):Gl(r)},Ea=function(s,r,o){var a=xp(RA(s.styles.backgroundOrigin,r),s),h=Lp(RA(s.styles.backgroundClip,r),s),u=Tp(RA(s.styles.backgroundSize,r),o,a),f=u[0],v=u[1],w=Bi(RA(s.styles.backgroundPosition,r),a.width-f,a.height-v),E=Pp(RA(s.styles.backgroundRepeat,r),w,u,a,h),I=Math.round(a.left+w[0]),H=Math.round(a.top+w[1]);return[E,I,H,f,v]},DA=function(s){return le(s)&&s.value===MA.AUTO},Xr=function(s){return typeof s=="number"},Tp=function(s,r,o){var a=r[0],h=r[1],u=r[2],f=s[0],v=s[1];if(!f)return[0,0];if(ve(f)&&v&&ve(v))return[ge(f,o.width),ge(v,o.height)];var w=Xr(u);if(le(f)&&(f.value===MA.CONTAIN||f.value===MA.COVER)){if(Xr(u)){var E=o.width/o.height;return E<u!=(f.value===MA.COVER)?[o.width,o.width/u]:[o.height*u,o.height]}return[o.width,o.height]}var I=Xr(a),H=Xr(h),S=I||H;if(DA(f)&&(!v||DA(v))){if(I&&H)return[a,h];if(!w&&!S)return[o.width,o.height];if(S&&w){var R=I?a:h*u,M=H?h:a/u;return[R,M]}var L=I?a:o.width,J=H?h:o.height;return[L,J]}if(w){var V=0,O=0;return ve(f)?V=ge(f,o.width):ve(v)&&(O=ge(v,o.height)),DA(f)?V=O*u:(!v||DA(v))&&(O=V/u),[V,O]}var ie=null,Y=null;if(ve(f)?ie=ge(f,o.width):v&&ve(v)&&(Y=ge(v,o.height)),ie!==null&&(!v||DA(v))&&(Y=I&&H?ie/a*h:o.height),Y!==null&&DA(f)&&(ie=I&&H?Y/h*a:o.width),ie!==null&&Y!==null)return[ie,Y];throw new Error("Unable to calculate background-size for element")},RA=function(s,r){var o=s[r];return typeof o=="undefined"?s[0]:o},Pp=function(s,r,o,a,h){var u=r[0],f=r[1],v=o[0],w=o[1];switch(s){case 2:return[new T(Math.round(a.left),Math.round(a.top+f)),new T(Math.round(a.left+a.width),Math.round(a.top+f)),new T(Math.round(a.left+a.width),Math.round(w+a.top+f)),new T(Math.round(a.left),Math.round(w+a.top+f))];case 3:return[new T(Math.round(a.left+u),Math.round(a.top)),new T(Math.round(a.left+u+v),Math.round(a.top)),new T(Math.round(a.left+u+v),Math.round(a.height+a.top)),new T(Math.round(a.left+u),Math.round(a.height+a.top))];case 1:return[new T(Math.round(a.left+u),Math.round(a.top+f)),new T(Math.round(a.left+u+v),Math.round(a.top+f)),new T(Math.round(a.left+u+v),Math.round(a.top+f+w)),new T(Math.round(a.left+u),Math.round(a.top+f+w))];default:return[new T(Math.round(h.left),Math.round(h.top)),new T(Math.round(h.left+h.width),Math.round(h.top)),new T(Math.round(h.left+h.width),Math.round(h.height+h.top)),new T(Math.round(h.left),Math.round(h.height+h.top))]}},Dp="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",Vl="Hidden Text",Rp=function(){function s(r){this._data={},this._document=r}return s.prototype.parseMetrics=function(r,o){var a=this._document.createElement("div"),h=this._document.createElement("img"),u=this._document.createElement("span"),f=this._document.body;a.style.visibility="hidden",a.style.fontFamily=r,a.style.fontSize=o,a.style.margin="0",a.style.padding="0",a.style.whiteSpace="nowrap",f.appendChild(a),h.src=Dp,h.width=1,h.height=1,h.style.margin="0",h.style.padding="0",h.style.verticalAlign="baseline",u.style.fontFamily=r,u.style.fontSize=o,u.style.margin="0",u.style.padding="0",u.appendChild(this._document.createTextNode(Vl)),a.appendChild(u),a.appendChild(h);var v=h.offsetTop-u.offsetTop+2;a.removeChild(u),a.appendChild(this._document.createTextNode(Vl)),a.style.lineHeight="normal",h.style.verticalAlign="super";var w=h.offsetTop-a.offsetTop+2;return f.removeChild(a),{baseline:v,middle:w}},s.prototype.getMetrics=function(r,o){var a=r+" "+o;return typeof this._data[a]=="undefined"&&(this._data[a]=this.parseMetrics(r,o)),this._data[a]},s}(),_l=function(){function s(r,o){this.context=r,this.options=o}return s}(),Kp=1e4,Op=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h._activeEffects=[],h.canvas=a.canvas?a.canvas:document.createElement("canvas"),h.ctx=h.canvas.getContext("2d"),a.canvas||(h.canvas.width=Math.floor(a.width*a.scale),h.canvas.height=Math.floor(a.height*a.scale),h.canvas.style.width=a.width+"px",h.canvas.style.height=a.height+"px"),h.fontMetrics=new Rp(document),h.ctx.scale(h.options.scale,h.options.scale),h.ctx.translate(-a.x,-a.y),h.ctx.textBaseline="bottom",h._activeEffects=[],h.context.logger.debug("Canvas renderer initialized ("+a.width+"x"+a.height+") with scale "+a.scale),h}return r.prototype.applyEffects=function(o){for(var a=this;this._activeEffects.length;)this.popEffect();o.forEach(function(h){return a.applyEffect(h)})},r.prototype.applyEffect=function(o){this.ctx.save(),Hp(o)&&(this.ctx.globalAlpha=o.opacity),Ip(o)&&(this.ctx.translate(o.offsetX,o.offsetY),this.ctx.transform(o.matrix[0],o.matrix[1],o.matrix[2],o.matrix[3],o.matrix[4],o.matrix[5]),this.ctx.translate(-o.offsetX,-o.offsetY)),Dl(o)&&(this.path(o.path),this.ctx.clip()),this._activeEffects.push(o)},r.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},r.prototype.renderStack=function(o){return A(this,void 0,void 0,function(){var a;return i(this,function(h){switch(h.label){case 0:return a=o.element.container.styles,a.isVisible()?[4,this.renderStackContent(o)]:[3,2];case 1:h.sent(),h.label=2;case 2:return[2]}})})},r.prototype.renderNode=function(o){return A(this,void 0,void 0,function(){return i(this,function(a){switch(a.label){case 0:if(Se(o.container.flags,16))debugger;return o.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(o)]:[3,3];case 1:return a.sent(),[4,this.renderNodeContent(o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})},r.prototype.renderTextWithLetterSpacing=function(o,a,h){var u=this;if(a===0)this.ctx.fillText(o.text,o.bounds.left,o.bounds.top+h);else{var f=ha(o.text);f.reduce(function(v,w){return u.ctx.fillText(w,v,o.bounds.top+h),v+u.ctx.measureText(w).width},o.bounds.left)}},r.prototype.createFontStyle=function(o){var a=o.fontVariant.filter(function(f){return f==="normal"||f==="small-caps"}).join(""),h=_p(o.fontFamily).join(", "),u=mi(o.fontSize)?""+o.fontSize.number+o.fontSize.unit:o.fontSize.number+"px";return[[o.fontStyle,a,o.fontWeight,u,h].join(" "),h,u]},r.prototype.renderTextNode=function(o,a){return A(this,void 0,void 0,function(){var h,u,f,v,w,E,I,H,S=this;return i(this,function(R){return h=this.createFontStyle(a),u=h[0],f=h[1],v=h[2],this.ctx.font=u,this.ctx.direction=a.direction===1?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",w=this.fontMetrics.getMetrics(f,v),E=w.baseline,I=w.middle,H=a.paintOrder,o.textBounds.forEach(function(M){H.forEach(function(L){switch(L){case 0:S.ctx.fillStyle=be(a.color),S.renderTextWithLetterSpacing(M,a.letterSpacing,E);var J=a.textShadow;J.length&&M.text.trim().length&&(J.slice(0).reverse().forEach(function(V){S.ctx.shadowColor=be(V.color),S.ctx.shadowOffsetX=V.offsetX.number*S.options.scale,S.ctx.shadowOffsetY=V.offsetY.number*S.options.scale,S.ctx.shadowBlur=V.blur.number,S.renderTextWithLetterSpacing(M,a.letterSpacing,E)}),S.ctx.shadowColor="",S.ctx.shadowOffsetX=0,S.ctx.shadowOffsetY=0,S.ctx.shadowBlur=0),a.textDecorationLine.length&&(S.ctx.fillStyle=be(a.textDecorationColor||a.color),a.textDecorationLine.forEach(function(V){switch(V){case 1:S.ctx.fillRect(M.bounds.left,Math.round(M.bounds.top+E),M.bounds.width,1);break;case 2:S.ctx.fillRect(M.bounds.left,Math.round(M.bounds.top),M.bounds.width,1);break;case 3:S.ctx.fillRect(M.bounds.left,Math.ceil(M.bounds.top+I),M.bounds.width,1);break}}));break;case 1:a.webkitTextStrokeWidth&&M.text.trim().length&&(S.ctx.strokeStyle=be(a.webkitTextStrokeColor),S.ctx.lineWidth=a.webkitTextStrokeWidth,S.ctx.lineJoin=window.chrome?"miter":"round",S.ctx.strokeText(M.text,M.bounds.left,M.bounds.top+E)),S.ctx.strokeStyle="",S.ctx.lineWidth=0,S.ctx.lineJoin="miter";break}})}),[2]})})},r.prototype.renderReplacedElement=function(o,a,h){if(h&&o.intrinsicWidth>0&&o.intrinsicHeight>0){var u=Wr(o),f=Gr(a);this.path(f),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(h,0,0,o.intrinsicWidth,o.intrinsicHeight,u.left,u.top,u.width,u.height),this.ctx.restore()}},r.prototype.renderNodeContent=function(o){return A(this,void 0,void 0,function(){var a,h,u,f,v,w,O,O,E,I,H,S,Y,R,M,_,L,J,V,O,ie,Y,_;return i(this,function(D){switch(D.label){case 0:this.applyEffects(o.getEffects(4)),a=o.container,h=o.curves,u=a.styles,f=0,v=a.textNodes,D.label=1;case 1:return f<v.length?(w=v[f],[4,this.renderTextNode(w,u)]):[3,4];case 2:D.sent(),D.label=3;case 3:return f++,[3,1];case 4:if(!(a instanceof ol))return[3,8];D.label=5;case 5:return D.trys.push([5,7,,8]),[4,this.context.cache.match(a.src)];case 6:return O=D.sent(),this.renderReplacedElement(a,h,O),[3,8];case 7:return D.sent(),this.context.logger.error("Error loading image "+a.src),[3,8];case 8:if(a instanceof ll&&this.renderReplacedElement(a,h,a.canvas),!(a instanceof cl))return[3,12];D.label=9;case 9:return D.trys.push([9,11,,12]),[4,this.context.cache.match(a.svg)];case 10:return O=D.sent(),this.renderReplacedElement(a,h,O),[3,12];case 11:return D.sent(),this.context.logger.error("Error loading svg "+a.svg.substring(0,255)),[3,12];case 12:return a instanceof pl&&a.tree?(E=new r(this.context,{scale:this.options.scale,backgroundColor:a.backgroundColor,x:0,y:0,width:a.width,height:a.height}),[4,E.render(a.tree)]):[3,14];case 13:I=D.sent(),a.width&&a.height&&this.ctx.drawImage(I,0,0,a.width,a.height,a.bounds.left,a.bounds.top,a.bounds.width,a.bounds.height),D.label=14;case 14:if(a instanceof da&&(H=Math.min(a.bounds.width,a.bounds.height),a.type===Tr?a.checked&&(this.ctx.save(),this.path([new T(a.bounds.left+H*.39363,a.bounds.top+H*.79),new T(a.bounds.left+H*.16,a.bounds.top+H*.5549),new T(a.bounds.left+H*.27347,a.bounds.top+H*.44071),new T(a.bounds.left+H*.39694,a.bounds.top+H*.5649),new T(a.bounds.left+H*.72983,a.bounds.top+H*.23),new T(a.bounds.left+H*.84,a.bounds.top+H*.34085),new T(a.bounds.left+H*.39363,a.bounds.top+H*.79)]),this.ctx.fillStyle=be(gl),this.ctx.fill(),this.ctx.restore()):a.type===Pr&&a.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(a.bounds.left+H/2,a.bounds.top+H/2,H/4,0,Math.PI*2,!0),this.ctx.fillStyle=be(gl),this.ctx.fill(),this.ctx.restore())),kp(a)&&a.value.length){switch(S=this.createFontStyle(u),Y=S[0],R=S[1],M=this.fontMetrics.getMetrics(Y,R).baseline,this.ctx.font=Y,this.ctx.fillStyle=be(u.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=Gp(a.styles.textAlign),_=Wr(a),L=0,a.styles.textAlign){case 1:L+=_.width/2;break;case 2:L+=_.width;break}J=_.add(L,0,0,-_.height/2+1),this.ctx.save(),this.path([new T(_.left,_.top),new T(_.left+_.width,_.top),new T(_.left+_.width,_.top+_.height),new T(_.left,_.top+_.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Fi(a.value,J),u.letterSpacing,M),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Se(a.styles.display,2048))return[3,20];if(a.styles.listStyleImage===null)return[3,19];if(V=a.styles.listStyleImage,V.type!==0)return[3,18];O=void 0,ie=V.url,D.label=15;case 15:return D.trys.push([15,17,,18]),[4,this.context.cache.match(ie)];case 16:return O=D.sent(),this.ctx.drawImage(O,a.bounds.left-(O.width+10),a.bounds.top),[3,18];case 17:return D.sent(),this.context.logger.error("Error loading list-style-image "+ie),[3,18];case 18:return[3,20];case 19:o.listValue&&a.styles.listStyleType!==-1&&(Y=this.createFontStyle(u)[0],this.ctx.font=Y,this.ctx.fillStyle=be(u.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",_=new l(a.bounds.left,a.bounds.top+ge(a.styles.paddingTop,a.bounds.width),a.bounds.width,Vo(u.lineHeight,u.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Fi(o.listValue,_),u.letterSpacing,Vo(u.lineHeight,u.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),D.label=20;case 20:return[2]}})})},r.prototype.renderStackContent=function(o){return A(this,void 0,void 0,function(){var a,h,V,u,f,V,v,w,V,E,I,V,H,S,V,R,M,V,L,J,V;return i(this,function(O){switch(O.label){case 0:if(Se(o.element.container.flags,16))debugger;return[4,this.renderNodeBackgroundAndBorders(o.element)];case 1:O.sent(),a=0,h=o.negativeZIndex,O.label=2;case 2:return a<h.length?(V=h[a],[4,this.renderStack(V)]):[3,5];case 3:O.sent(),O.label=4;case 4:return a++,[3,2];case 5:return[4,this.renderNodeContent(o.element)];case 6:O.sent(),u=0,f=o.nonInlineLevel,O.label=7;case 7:return u<f.length?(V=f[u],[4,this.renderNode(V)]):[3,10];case 8:O.sent(),O.label=9;case 9:return u++,[3,7];case 10:v=0,w=o.nonPositionedFloats,O.label=11;case 11:return v<w.length?(V=w[v],[4,this.renderStack(V)]):[3,14];case 12:O.sent(),O.label=13;case 13:return v++,[3,11];case 14:E=0,I=o.nonPositionedInlineLevel,O.label=15;case 15:return E<I.length?(V=I[E],[4,this.renderStack(V)]):[3,18];case 16:O.sent(),O.label=17;case 17:return E++,[3,15];case 18:H=0,S=o.inlineLevel,O.label=19;case 19:return H<S.length?(V=S[H],[4,this.renderNode(V)]):[3,22];case 20:O.sent(),O.label=21;case 21:return H++,[3,19];case 22:R=0,M=o.zeroOrAutoZIndexOrTransformedOrOpacity,O.label=23;case 23:return R<M.length?(V=M[R],[4,this.renderStack(V)]):[3,26];case 24:O.sent(),O.label=25;case 25:return R++,[3,23];case 26:L=0,J=o.positiveZIndex,O.label=27;case 27:return L<J.length?(V=J[L],[4,this.renderStack(V)]):[3,30];case 28:O.sent(),O.label=29;case 29:return L++,[3,27];case 30:return[2]}})})},r.prototype.mask=function(o){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(o.slice(0).reverse()),this.ctx.closePath()},r.prototype.path=function(o){this.ctx.beginPath(),this.formatPath(o),this.ctx.closePath()},r.prototype.formatPath=function(o){var a=this;o.forEach(function(h,u){var f=ht(h)?h.start:h;u===0?a.ctx.moveTo(f.x,f.y):a.ctx.lineTo(f.x,f.y),ht(h)&&a.ctx.bezierCurveTo(h.startControl.x,h.startControl.y,h.endControl.x,h.endControl.y,h.end.x,h.end.y)})},r.prototype.renderRepeat=function(o,a,h,u){this.path(o),this.ctx.fillStyle=a,this.ctx.translate(h,u),this.ctx.fill(),this.ctx.translate(-h,-u)},r.prototype.resizeImage=function(o,a,h){var u;if(o.width===a&&o.height===h)return o;var f=(u=this.canvas.ownerDocument)!==null&&u!==void 0?u:document,v=f.createElement("canvas");v.width=Math.max(1,a),v.height=Math.max(1,h);var w=v.getContext("2d");return w.drawImage(o,0,0,o.width,o.height,0,0,a,h),v},r.prototype.renderBackgroundImage=function(o){return A(this,void 0,void 0,function(){var a,h,u,f,v,w;return i(this,function(E){switch(E.label){case 0:a=o.styles.backgroundImage.length-1,h=function(I){var H,S,R,Fe,je,et,ce,Re,te,M,Fe,je,et,ce,Re,L,J,V,O,ie,Y,_,D,ee,te,X,Fe,Ze,st,ce,Re,AA,je,et,dA,It,iA,uA,pA,Pt,fA,Dt;return i(this,function(KA){switch(KA.label){case 0:if(I.type!==0)return[3,5];H=void 0,S=I.url,KA.label=1;case 1:return KA.trys.push([1,3,,4]),[4,u.context.cache.match(S)];case 2:return H=KA.sent(),[3,4];case 3:return KA.sent(),u.context.logger.error("Error loading background-image "+S),[3,4];case 4:return H&&(R=Ea(o,a,[H.width,H.height,H.width/H.height]),Fe=R[0],je=R[1],et=R[2],ce=R[3],Re=R[4],te=u.ctx.createPattern(u.resizeImage(H,ce,Re),"repeat"),u.renderRepeat(Fe,te,je,et)),[3,6];case 5:Ig(I)?(M=Ea(o,a,[null,null,null]),Fe=M[0],je=M[1],et=M[2],ce=M[3],Re=M[4],L=wg(I.angle,ce,Re),J=L[0],V=L[1],O=L[2],ie=L[3],Y=L[4],_=document.createElement("canvas"),_.width=ce,_.height=Re,D=_.getContext("2d"),ee=D.createLinearGradient(V,ie,O,Y),xo(I.stops,J).forEach(function(Hi){return ee.addColorStop(Hi.stop,be(Hi.color))}),D.fillStyle=ee,D.fillRect(0,0,ce,Re),ce>0&&Re>0&&(te=u.ctx.createPattern(_,"repeat"),u.renderRepeat(Fe,te,je,et))):Hg(I)&&(X=Ea(o,a,[null,null,null]),Fe=X[0],Ze=X[1],st=X[2],ce=X[3],Re=X[4],AA=I.position.length===0?[zn]:I.position,je=ge(AA[0],ce),et=ge(AA[AA.length-1],Re),dA=vg(I,je,et,ce,Re),It=dA[0],iA=dA[1],It>0&&iA>0&&(uA=u.ctx.createRadialGradient(Ze+je,st+et,0,Ze+je,st+et,It),xo(I.stops,It*2).forEach(function(Hi){return uA.addColorStop(Hi.stop,be(Hi.color))}),u.path(Fe),u.ctx.fillStyle=uA,It!==iA?(pA=o.bounds.left+.5*o.bounds.width,Pt=o.bounds.top+.5*o.bounds.height,fA=iA/It,Dt=1/fA,u.ctx.save(),u.ctx.translate(pA,Pt),u.ctx.transform(1,0,0,fA,0,0),u.ctx.translate(-pA,-Pt),u.ctx.fillRect(Ze,Dt*(st-Pt)+Pt,ce,Re*Dt),u.ctx.restore()):u.ctx.fill())),KA.label=6;case 6:return a--,[2]}})},u=this,f=0,v=o.styles.backgroundImage.slice(0).reverse(),E.label=1;case 1:return f<v.length?(w=v[f],[5,h(w)]):[3,4];case 2:E.sent(),E.label=3;case 3:return f++,[3,1];case 4:return[2]}})})},r.prototype.renderSolidBorder=function(o,a,h){return A(this,void 0,void 0,function(){return i(this,function(u){return this.path(Nl(h,a)),this.ctx.fillStyle=be(o),this.ctx.fill(),[2]})})},r.prototype.renderDoubleBorder=function(o,a,h,u){return A(this,void 0,void 0,function(){var f,v;return i(this,function(w){switch(w.label){case 0:return a<3?[4,this.renderSolidBorder(o,h,u)]:[3,2];case 1:return w.sent(),[2];case 2:return f=Up(u,h),this.path(f),this.ctx.fillStyle=be(o),this.ctx.fill(),v=bp(u,h),this.path(v),this.ctx.fill(),[2]}})})},r.prototype.renderNodeBackgroundAndBorders=function(o){return A(this,void 0,void 0,function(){var a,h,u,f,v,w,E,I,H=this;return i(this,function(S){switch(S.label){case 0:return this.applyEffects(o.getEffects(2)),a=o.container.styles,h=!Zt(a.backgroundColor)||a.backgroundImage.length,u=[{style:a.borderTopStyle,color:a.borderTopColor,width:a.borderTopWidth},{style:a.borderRightStyle,color:a.borderRightColor,width:a.borderRightWidth},{style:a.borderBottomStyle,color:a.borderBottomColor,width:a.borderBottomWidth},{style:a.borderLeftStyle,color:a.borderLeftColor,width:a.borderLeftWidth}],f=Np(RA(a.backgroundClip,0),o.curves),h||a.boxShadow.length?(this.ctx.save(),this.path(f),this.ctx.clip(),Zt(a.backgroundColor)||(this.ctx.fillStyle=be(a.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(o.container)]):[3,2];case 1:S.sent(),this.ctx.restore(),a.boxShadow.slice(0).reverse().forEach(function(R){H.ctx.save();var M=Nr(o.curves),L=R.inset?0:Kp,J=Qp(M,-L+(R.inset?1:-1)*R.spread.number,(R.inset?1:-1)*R.spread.number,R.spread.number*(R.inset?-2:2),R.spread.number*(R.inset?-2:2));R.inset?(H.path(M),H.ctx.clip(),H.mask(J)):(H.mask(M),H.ctx.clip(),H.path(J)),H.ctx.shadowOffsetX=R.offsetX.number+L,H.ctx.shadowOffsetY=R.offsetY.number,H.ctx.shadowColor=be(R.color),H.ctx.shadowBlur=R.blur.number,H.ctx.fillStyle=R.inset?be(R.color):"rgba(0,0,0,1)",H.ctx.fill(),H.ctx.restore()}),S.label=2;case 2:v=0,w=0,E=u,S.label=3;case 3:return w<E.length?(I=E[w],I.style!==0&&!Zt(I.color)&&I.width>0?I.style!==2?[3,5]:[4,this.renderDashedDottedBorder(I.color,I.width,v,o.curves,2)]:[3,11]):[3,13];case 4:return S.sent(),[3,11];case 5:return I.style!==3?[3,7]:[4,this.renderDashedDottedBorder(I.color,I.width,v,o.curves,3)];case 6:return S.sent(),[3,11];case 7:return I.style!==4?[3,9]:[4,this.renderDoubleBorder(I.color,I.width,v,o.curves)];case 8:return S.sent(),[3,11];case 9:return[4,this.renderSolidBorder(I.color,v,o.curves)];case 10:S.sent(),S.label=11;case 11:v++,S.label=12;case 12:return w++,[3,3];case 13:return[2]}})})},r.prototype.renderDashedDottedBorder=function(o,a,h,u,f){return A(this,void 0,void 0,function(){var v,w,E,I,H,S,R,M,L,J,V,O,ie,Y,_,D,_,D;return i(this,function(ee){return this.ctx.save(),v=Mp(u,h),w=Nl(u,h),f===2&&(this.path(w),this.ctx.clip()),ht(w[0])?(E=w[0].start.x,I=w[0].start.y):(E=w[0].x,I=w[0].y),ht(w[1])?(H=w[1].end.x,S=w[1].end.y):(H=w[1].x,S=w[1].y),h===0||h===2?R=Math.abs(E-H):R=Math.abs(I-S),this.ctx.beginPath(),f===3?this.formatPath(v):this.formatPath(w.slice(0,2)),M=a<3?a*3:a*2,L=a<3?a*2:a,f===3&&(M=a,L=a),J=!0,R<=M*2?J=!1:R<=M*2+L?(V=R/(2*M+L),M*=V,L*=V):(O=Math.floor((R+L)/(M+L)),ie=(R-O*M)/(O-1),Y=(R-(O+1)*M)/O,L=Y<=0||Math.abs(L-ie)<Math.abs(L-Y)?ie:Y),J&&(f===3?this.ctx.setLineDash([0,M+L]):this.ctx.setLineDash([M,L])),f===3?(this.ctx.lineCap="round",this.ctx.lineWidth=a):this.ctx.lineWidth=a*2+1.1,this.ctx.strokeStyle=be(o),this.ctx.stroke(),this.ctx.setLineDash([]),f===2&&(ht(w[0])&&(_=w[3],D=w[0],this.ctx.beginPath(),this.formatPath([new T(_.end.x,_.end.y),new T(D.start.x,D.start.y)]),this.ctx.stroke()),ht(w[1])&&(_=w[1],D=w[2],this.ctx.beginPath(),this.formatPath([new T(_.end.x,_.end.y),new T(D.start.x,D.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},r.prototype.render=function(o){return A(this,void 0,void 0,function(){var a;return i(this,function(h){switch(h.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=be(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),a=Sp(o),[4,this.renderStack(a)];case 1:return h.sent(),this.applyEffects([]),[2,this.canvas]}})})},r}(_l),kp=function(s){return s instanceof ul||s instanceof dl?!0:s instanceof da&&s.type!==Pr&&s.type!==Tr},Np=function(s,r){switch(s){case 0:return Nr(r);case 2:return Fp(r);case 1:default:return Gr(r)}},Gp=function(s){switch(s){case 1:return"center";case 2:return"right";case 0:default:return"left"}},Vp=["-apple-system","system-ui"],_p=function(s){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?s.filter(function(r){return Vp.indexOf(r)===-1}):s},Wp=function(s){e(r,s);function r(o,a){var h=s.call(this,o,a)||this;return h.canvas=a.canvas?a.canvas:document.createElement("canvas"),h.ctx=h.canvas.getContext("2d"),h.options=a,h.canvas.width=Math.floor(a.width*a.scale),h.canvas.height=Math.floor(a.height*a.scale),h.canvas.style.width=a.width+"px",h.canvas.style.height=a.height+"px",h.ctx.scale(h.options.scale,h.options.scale),h.ctx.translate(-a.x,-a.y),h.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+a.width+"x"+a.height+" at "+a.x+","+a.y+") with scale "+a.scale),h}return r.prototype.render=function(o){return A(this,void 0,void 0,function(){var a,h;return i(this,function(u){switch(u.label){case 0:return a=ca(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,o),[4,Xp(a)];case 1:return h=u.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=be(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(h,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},r}(_l),Xp=function(s){return new Promise(function(r,o){var a=new Image;a.onload=function(){r(a)},a.onerror=o,a.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(new XMLSerializer().serializeToString(s))})},Jp=function(){function s(r){var o=r.id,a=r.enabled;this.id=o,this.enabled=a,this.start=Date.now()}return s.prototype.debug=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];this.enabled&&(typeof window!="undefined"&&window.console&&typeof console.debug=="function"?console.debug.apply(console,n([this.id,this.getTime()+"ms"],r)):this.info.apply(this,r))},s.prototype.getTime=function(){return Date.now()-this.start},s.prototype.info=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];this.enabled&&typeof window!="undefined"&&window.console&&typeof console.info=="function"&&console.info.apply(console,n([this.id,this.getTime()+"ms"],r))},s.prototype.warn=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];this.enabled&&(typeof window!="undefined"&&window.console&&typeof console.warn=="function"?console.warn.apply(console,n([this.id,this.getTime()+"ms"],r)):this.info.apply(this,r))},s.prototype.error=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];this.enabled&&(typeof window!="undefined"&&window.console&&typeof console.error=="function"?console.error.apply(console,n([this.id,this.getTime()+"ms"],r)):this.info.apply(this,r))},s.instances={},s}(),Yp=function(){function s(r,o){var a;this.windowBounds=o,this.instanceName="#"+s.instanceCount++,this.logger=new Jp({id:this.instanceName,enabled:r.logging}),this.cache=(a=r.cache)!==null&&a!==void 0?a:new up(this,r)}return s.instanceCount=1,s}(),$p=function(s,r){return r===void 0&&(r={}),zp(s,r)};typeof window!="undefined"&&Pl.setContext(window);var zp=function(s,r){return A(void 0,void 0,void 0,function(){var o,a,h,u,f,v,w,E,I,H,S,R,M,L,J,V,O,ie,Y,_,ee,D,ee,te,X,Fe,Ze,st,ce,Re,AA,je,et,dA,It,iA,uA,pA,Pt,fA;return i(this,function(Dt){switch(Dt.label){case 0:if(!s||typeof s!="object")return[2,Promise.reject("Invalid element provided as first argument")];if(o=s.ownerDocument,!o)throw new Error("Element is not attached to a Document");if(a=o.defaultView,!a)throw new Error("Document is not attached to a Window");return h={allowTaint:(te=r.allowTaint)!==null&&te!==void 0?te:!1,imageTimeout:(X=r.imageTimeout)!==null&&X!==void 0?X:15e3,proxy:r.proxy,useCORS:(Fe=r.useCORS)!==null&&Fe!==void 0?Fe:!1},u=t({logging:(Ze=r.logging)!==null&&Ze!==void 0?Ze:!0,cache:r.cache},h),f={windowWidth:(st=r.windowWidth)!==null&&st!==void 0?st:a.innerWidth,windowHeight:(ce=r.windowHeight)!==null&&ce!==void 0?ce:a.innerHeight,scrollX:(Re=r.scrollX)!==null&&Re!==void 0?Re:a.pageXOffset,scrollY:(AA=r.scrollY)!==null&&AA!==void 0?AA:a.pageYOffset},v=new l(f.scrollX,f.scrollY,f.windowWidth,f.windowHeight),w=new Yp(u,v),E=(je=r.foreignObjectRendering)!==null&&je!==void 0?je:!1,I={allowTaint:(et=r.allowTaint)!==null&&et!==void 0?et:!1,onclone:r.onclone,ignoreElements:r.ignoreElements,inlineImages:E,copyStyles:E},w.logger.debug("Starting document clone with size "+v.width+"x"+v.height+" scrolled to "+-v.left+","+-v.top),H=new Ll(w,s,I),S=H.clonedReferenceElement,S?[4,H.toIFrame(o,v)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return R=Dt.sent(),M=pa(S)||qu(S)?g(S.ownerDocument):c(w,S),L=M.width,J=M.height,V=M.left,O=M.top,ie=qp(w,S,r.backgroundColor),Y={canvas:r.canvas,backgroundColor:ie,scale:(It=(dA=r.scale)!==null&&dA!==void 0?dA:a.devicePixelRatio)!==null&&It!==void 0?It:1,x:((iA=r.x)!==null&&iA!==void 0?iA:0)+V,y:((uA=r.y)!==null&&uA!==void 0?uA:0)+O,width:(pA=r.width)!==null&&pA!==void 0?pA:Math.ceil(L),height:(Pt=r.height)!==null&&Pt!==void 0?Pt:Math.ceil(J)},E?(w.logger.debug("Document cloned, using foreign object rendering"),ee=new Wp(w,Y),[4,ee.render(S)]):[3,3];case 2:return _=Dt.sent(),[3,5];case 3:return w.logger.debug("Document cloned, element located at "+V+","+O+" with size "+L+"x"+J+" using computed rendering"),w.logger.debug("Starting DOM parsing"),D=ml(w,S),ie===D.styles.backgroundColor&&(D.styles.backgroundColor=Lt.TRANSPARENT),w.logger.debug("Starting renderer for element at "+Y.x+","+Y.y+" with size "+Y.width+"x"+Y.height),ee=new Op(w,Y),[4,ee.render(D)];case 4:_=Dt.sent(),Dt.label=5;case 5:return(!((fA=r.removeContainer)!==null&&fA!==void 0)||fA)&&(Ll.destroy(R)||w.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),w.logger.debug("Finished rendering"),[2,_]}})})},qp=function(s,r,o){var a=r.ownerDocument,h=a.documentElement?Ci(s,getComputedStyle(a.documentElement).backgroundColor):Lt.TRANSPARENT,u=a.body?Ci(s,getComputedStyle(a.body).backgroundColor):Lt.TRANSPARENT,f=typeof o=="string"?Ci(s,o):o===null?Lt.TRANSPARENT:4294967295;return r===a.documentElement?Zt(h)?Zt(u)?f:u:h:f};return $p})});function Ta(B){return La.find(e=>e.id===B)||dc}var dc,of,lf,La,uc=We(()=>{W();dc={id:"default",name:p("Default Template"),description:p("Modern minimalist knowledge card style"),render:B=>{var y;let e=document.createElement("div");e.className="highlight-export-card highlight-export-card-modern";let t=document.createElement("div");t.className="highlight-export-quote-section";let A=document.createElement("div");A.className="highlight-export-quote-decoration";let i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("viewBox","0 0 24 24"),i.setAttribute("width","48"),i.setAttribute("height","48"),i.setAttribute("fill","none"),i.setAttribute("stroke","currentColor"),i.setAttribute("stroke-width","1");let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V20c0 1 0 1 1 1z");let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"),i.appendChild(n),i.appendChild(l),A.appendChild(i),t.appendChild(A);let c=document.createElement("div");c.className="highlight-export-quote",c.textContent=B.text,t.appendChild(c),e.appendChild(t);let g=document.createElement("div");g.className="highlight-export-footer";let d=document.createElement("div");d.className="highlight-export-source",d.textContent=B.fileName||((y=B.filePath)==null?void 0:y.split("/").pop())||"Untitled",g.appendChild(d);let m=document.createElement("div");m.className="highlight-export-date";let C=new Date,F={year:"numeric",month:"long",day:"numeric"};return m.textContent=C.toLocaleDateString(void 0,F),g.appendChild(m),e.appendChild(g),e}},of={id:"academic",name:p("Academic Template"),description:p("Formal style suitable for academic citations"),render:B=>{var l;let e=document.createElement("div");e.className="highlight-export-card highlight-export-card-academic";let t=document.createElement("div");t.className="highlight-export-quote",t.textContent=`"${B.text}"`,e.appendChild(t);let A=document.createElement("div");A.className="highlight-export-footer";let i=document.createElement("div");i.className="highlight-export-source",i.textContent=B.fileName||((l=B.filePath)==null?void 0:l.split("/").pop())||"Untitled",A.appendChild(i);let n=document.createElement("div");return n.className="highlight-export-date",n.textContent=`Retrieved: ${new Date().toLocaleDateString()}`,A.appendChild(n),e.appendChild(A),e}},lf={id:"social",name:p("Social Template"),description:p("Modern style suitable for social media sharing"),render:B=>{var C;let e=document.createElement("div");e.className="highlight-export-card highlight-export-card-social";let t=document.createElement("div");t.className="highlight-export-header";let A=document.createElement("div");A.className="highlight-export-logo";let i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("xmlns","http://www.w3.org/2000/svg"),i.setAttribute("width","24"),i.setAttribute("height","24"),i.setAttribute("viewBox","0 0 100 100"),i.setAttribute("fill","currentColor"),i.setAttribute("stroke","none");let n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d","M50,9.4L14.8,37.1l12.6,38.8l22.6,14.7l22.6-14.7l12.6-38.8L50,9.4z M50,19.5l25.5,20l-9.4,28.9L50,80.6 L33.9,68.4l-9.4-28.9L50,19.5z");let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d","M50,19.5l-25.5,20l9.4,28.9L50,80.6V19.5z"),l.setAttribute("fill-opacity","0.3"),i.appendChild(n),i.appendChild(l),A.appendChild(i),t.appendChild(A);let c=document.createElement("div");c.className="highlight-export-app-name",c.textContent="HiNote",t.appendChild(c),e.appendChild(t);let g=document.createElement("div");g.className="highlight-export-quote",g.textContent=B.text,e.appendChild(g);let d=document.createElement("div");d.className="highlight-export-footer";let m=document.createElement("div");return m.className="highlight-export-source",m.textContent=B.fileName||((C=B.filePath)==null?void 0:C.split("/").pop())||"Untitled",d.appendChild(m),e.appendChild(d),e}},La=[dc,of,lf]});var pc,fc=We(()=>{pc=`
    /* \u5BFC\u51FA\u5361\u7247\u57FA\u7840\u6837\u5F0F */
    .highlight-export-card {
        transition: all 0.3s ease;
        padding: 20px;
        background-color: #ffffff;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        
        /* \u6DFB\u52A0\u66F4\u4E25\u683C\u7684\u6587\u672C\u63A7\u5236 */
        font-size: 16px;
        line-height: 1.6;
        letter-spacing: normal;
        word-spacing: normal;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    /* \u73B0\u4EE3\u98CE\u683C\u6A21\u677F */
    .highlight-export-card-modern {
        padding: 24px;
        position: relative;
        overflow: hidden;
    }

    .highlight-export-card-modern::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(to bottom right, #5871ef 0%, #4c63e6 100%);
    }

    .highlight-export-card-modern .highlight-export-quote-decoration {
        position: absolute;
        top: 24px;
        right: 24px;
        opacity: 0.06;
        transform: scale(2);
    }

    .highlight-export-card-modern .highlight-export-quote-section {
        position: relative;
        padding: 24px 0;
        /* \u786E\u4FDD\u5F15\u7528\u90E8\u5206\u7684\u6587\u672C\u6837\u5F0F\u4E00\u81F4\u6027 */
        font-size: inherit;
        line-height: inherit;
        letter-spacing: inherit;
        word-spacing: inherit;
    }

    .highlight-export-card-modern .highlight-export-quote {
        font-size: 1em;
        line-height: 1.7;
        color: #333333;
        font-weight: 400;
        margin: 0;
        position: relative;
        z-index: 1;
        /* \u786E\u4FDD\u5F15\u7528\u6587\u672C\u7684\u6837\u5F0F\u4E00\u81F4\u6027 */
        letter-spacing: normal;
        word-spacing: normal;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
    }

    /* \u786E\u4FDD\u6240\u6709\u6587\u672C\u5143\u7D20\u7EE7\u627F\u57FA\u7840\u6837\u5F0F */
    .highlight-export-card * {
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
    }

    /* \u5BFC\u51FA\u9884\u89C8\u5BB9\u5668 */
    .highlight-export-preview {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        padding: 20px;
    }

    /* \u5BFC\u51FA\u5BB9\u5668 */
    .highlight-export-container {
        padding: 20px;
        margin: 0;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        width: 480px;
    }
`});var mc={};rA(mc,{ExportPreviewModal:()=>Pa});var $i,Pa,Bc=We(()=>{$i=require("obsidian");uc();W();fc();Pa=class extends $i.Modal{constructor(t,A,i){super(t);this.selectedTemplateId="default";this.includeComments=!1;this.highlight=A,this.html2canvasInstance=i}async onOpen(){let{contentEl:t}=this;t.empty(),t.addClass("highlight-export-modal");let A=t.createEl("div",{cls:"highlight-export-main-container"}),i=A.createEl("select",{cls:"highlight-template-select"});La.forEach(l=>{let c=i.createEl("option",{text:l.name,value:l.id});this.selectedTemplateId===l.id&&(c.selected=!0)}),i.addEventListener("change",l=>{let c=l.target;this.selectedTemplateId=c.value,this.updatePreview()}),this.previewContainer=A.createEl("div",{cls:"highlight-export-preview-container"}),this.updatePreview();let n=t.createEl("div",{cls:"highlight-export-modal-buttons"});if(this.highlight.comments&&this.highlight.comments.length>0){let l=n.createEl("div",{cls:"highlight-export-checkbox-container"}),c=l.createEl("input",{attr:{type:"checkbox",id:"include-comments-checkbox"},cls:"highlight-export-checkbox"}),g=l.createEl("label",{text:p("Include Comments"),attr:{for:"include-comments-checkbox"},cls:"highlight-export-checkbox-label"});c.addEventListener("change",d=>{this.includeComments=d.target.checked,this.updatePreview()})}n.createEl("button",{cls:"highlight-btn",text:p("Cancel")}).addEventListener("click",()=>this.close()),n.createEl("button",{cls:"highlight-btn highlight-btn-primary",text:p("Download")}).addEventListener("click",async()=>{try{let l=document.createElement("div");l.className="highlight-export-container";let g=Ta(this.selectedTemplateId).render(this.highlight);l.appendChild(g),this.includeComments&&this.highlight.comments&&this.highlight.comments.length>0&&this.addCommentsToContainer(l),document.body.appendChild(l);let m=(await this.html2canvasInstance(l,{backgroundColor:null,scale:window.devicePixelRatio*2,useCORS:!0,allowTaint:!0,logging:!1,imageTimeout:0,removeContainer:!0,onclone:async F=>{let y=F.createElement("style");y.textContent=this.getExportStyles(),F.head.appendChild(y),await new Promise(Q=>setTimeout(Q,100))}})).toDataURL("image/png",1),C=document.createElement("a");C.download=`highlight-${this.selectedTemplateId}-${Date.now()}.png`,C.href=m,C.click(),this.close(),new $i.Notice(p("Export successful!"))}catch(l){new $i.Notice(p("Export failed, please try again"))}})}updatePreview(){this.previewContainer.empty(),this.previewContainer.className="highlight-export-preview";let A=Ta(this.selectedTemplateId).render(this.highlight);this.previewContainer.appendChild(A),this.includeComments&&this.highlight.comments&&this.highlight.comments.length>0&&this.addCommentsToContainer(this.previewContainer)}addCommentsToContainer(t){let A=t.querySelector(".highlight-export-card");if(!A)return;let i=A.querySelector(".highlight-export-footer");if(!i)return;let n=document.createElement("div");n.className="highlight-export-comments-section";let l=document.createElement("div");l.className="highlight-export-comments-list",n.appendChild(l),this.highlight.comments&&this.highlight.comments.forEach(c=>{let g=document.createElement("div");g.className="highlight-export-comment-item";let d=document.createElement("div");if(d.className="highlight-export-comment-content",d.textContent=c.content,g.appendChild(d),c.createdAt){let m=document.createElement("div");m.className="highlight-export-comment-time",m.textContent=new Date(c.createdAt).toLocaleString(),g.appendChild(m)}l.appendChild(g)}),A.insertBefore(n,i)}getExportStyles(){return`
            body {
                margin: 0;
                background: none;
            }
            ${pc}
        `}onClose(){let{contentEl:t}=this;t.empty()}}});var Tf={};rA(Tf,{default:()=>xn});module.exports=nf(Tf);var Yc=require("obsidian");var qi=require("obsidian");var ec=require("obsidian");var oe={AGAIN:1,HARD:2,GOOD:3,EASY:4},Ia={request_retention:.9,maximum_interval:36500,newCardsPerDay:20,reviewsPerDay:100,w:[.4872,1.4003,3.7145,13.8206,5.1618,1.2298,.8975,.031,1.6474,.1367,1.0461,2.1072,.0793,.3246,1.587,.2272,2.8755,0,0,0,0]};W();var de=require("obsidian");W();var Jr=class{constructor(e,t){this.containerEl=e,this.fsrsManager=t}render(){this.containerEl.empty(),this.containerEl.addClass("flashcard-stats-panel"),this.renderStatsArea(),this.renderHeatmap()}renderStatsArea(){let e=this.containerEl.createDiv("flashcard-stats-area"),t=this.fsrsManager.getProgress();this.createStatItem(e,t.newCards.toString(),"New","flashcard-stat-new"),this.createStatItem(e,t.learned.toString(),"Learning","flashcard-stat-learning"),this.createStatItem(e,t.due.toString(),"Review","flashcard-stat-due")}createStatItem(e,t,A,i){let n=e.createDiv(`flashcard-stat-item ${i}`),l=n.createDiv("flashcard-stat-value");l.textContent=t;let c=n.createDiv("flashcard-stat-label");c.textContent=A}renderHeatmap(){var e;this.createHeatmap(this.containerEl,((e=this.fsrsManager.storage)==null?void 0:e.dailyStats)||[])}createHeatmap(e,t){let A=e.createDiv("flashcard-heatmap-grid"),i=new Date;new Date(i).setDate(i.getDate()-83);let l=new Map,c=new Date(i);c.setHours(0,0,0,0);let g=c.getTime(),d=`${c.getFullYear()}-${c.getMonth()+1}-${c.getDate()}`,m=!1;[...t].forEach(N=>{let G=new Date(N.date),Z=G.getFullYear(),ae=G.getMonth()+1,Oe=G.getDate(),xe=`${Z}-${ae}-${Oe}`;xe===d&&(m=!0),l.set(xe,N)}),m||l.set(d,{date:g,newCardsLearned:0,cardsReviewed:0,reviewCount:0,newCount:0,againCount:0,hardCount:0,goodCount:0,easyCount:0});let F=7,y=12;A.style.display="grid",A.style.gridTemplateRows=`repeat(${F}, 1fr)`,A.style.gridTemplateColumns=`repeat(${y}, 1fr)`;let Q=i.getDay(),U=Q===0?6:Q-1,b=new Date(i);b.setDate(i.getDate()-((Q===0?7:Q)-1));let P=new Date(b);P.setDate(P.getDate()-11*7);let q=[],k=[];for(let N=0;N<y;N++){let G=new Date(P);G.setDate(G.getDate()+N*7),k.push(G)}for(let N=0;N<y;N++){let G=[];for(let Z=0;Z<F;Z++){let ae=new Date(k[N]);ae.setDate(ae.getDate()+Z),G.push(ae)}q.push(G)}for(let N=0;N<F;N++)for(let G=0;G<y;G++){let Z=q[G][N],ae=Z.getFullYear(),Oe=Z.getMonth()+1,xe=Z.getDate(),Ye=`${ae}-${Oe}-${xe}`,re=l.get(Ye),Ae=A.createDiv("flashcard-heatmap-cell"),ke=Ye===d;if(re){let me=re.newCardsLearned*1.5+re.cardsReviewed;if(re.reviewCount>0){let _e=(re.againCount*1.5+re.hardCount*1.2+re.goodCount+re.easyCount*.8)/re.reviewCount;me=me*(_e+.5)}me=Math.min(me,20);let Ve=Math.ceil(me/4);Ae.addClass(`flashcard-heatmap-level-${Ve}`);let $e=`${Z.toLocaleDateString()}: Learned ${re.newCardsLearned} new cards, reviewed ${re.cardsReviewed} cards`;re.reviewCount>0&&($e+=`
Rating distribution: Again(${re.againCount}), Hard(${re.hardCount}), Good(${re.goodCount}), Easy(${re.easyCount})`),Ae.setAttribute("title",$e)}else ke||Z>i,Ae.addClass("flashcard-heatmap-level-0")}}addZoomControl(e,t){}};var Yr=class{constructor(e){this.isMobileView=!1;this.isSmallScreen=!1;this.showingSidebar=!0;this.isInFlashcardMode=!1;this.component=e,this.isMobileView=de.Platform.isMobile,this.isSmallScreen=window.innerWidth<768,this.showingSidebar=this.isMobileView,this.isInFlashcardMode=!0}renderActivation(){var C;if(!this.component.getIsActive())return;let e=this.component.getContainer();e.empty(),e.addClass("flashcard-mode");let t=e.createEl("div",{cls:"flashcard-activation-container"}),A=t.createEl("div",{cls:"flashcard-activation-header",text:p("Activate HiCard")}),i=t.createEl("div",{cls:"flashcard-activation-description"});i.createEl("span",{text:p("Enter your license key to activate HiCard feature.")+" "}),i.createEl("br"),i.createEl("span",{text:p("Get your license key from")+" "});let l=(((C=window.moment)==null?void 0:C.locale())||"en").startsWith("zh")?"https://www.hinote.vip/index.html":"https://www.hinote.vip/en.html",c=i.createEl("a",{text:p("HiNote official website"),cls:"external-link",href:l});c.setAttr("target","_blank"),c.setAttr("rel","noopener noreferrer");let g=t.createEl("div",{cls:"flashcard-activation-input-container"}),d=g.createEl("input",{cls:"flashcard-activation-input",type:"text",placeholder:p("Enter license key")});g.createEl("button",{cls:"flashcard-activation-button",text:p("Activate")}).addEventListener("click",async()=>{let F=d.value.trim();if(!F){new de.Notice(p("Please enter a license key"));return}await this.component.getLicenseManager().activateLicense(F)?(new de.Notice(p("HiCard activated successfully!")),this.render()):new de.Notice(p("Invalid license key"))})}toggleSidebar(){this.showingSidebar=!this.showingSidebar,this.render()}isShowingSidebar(){return this.showingSidebar}showSidebar(){this.showingSidebar=!0;let e=this.component.getContainer();this.isMobileView&&this.isSmallScreen&&(e.addClass("show-sidebar"),e.removeClass("show-content")),this.render()}goBack(){this.isMobileView&&this.isSmallScreen&&(this.showingSidebar?this.component&&this.component.commentView&&(this.component.commentView.isFlashcardMode=!1,this.component.commentView.isShowingFileList=!0,this.component.commentView.updateViewLayout()):(this.showingSidebar=!0,this.render()))}render(){if(!this.component.getIsActive())return;let e=this.component.getContainer();if(e.empty(),e.addClass("flashcard-mode"),this.isMobileView&&(e.addClass("is-mobile"),this.isSmallScreen&&e.addClass("is-small-screen"),this.showingSidebar?e.addClass("show-sidebar"):e.addClass("show-content")),!this.isMobileView||this.isMobileView&&!this.showingSidebar){let k=e.createEl("div",{cls:"flashcard-progress-container"});this.component.setProgressContainer(k),this.component.updateProgress()}let t=e.createEl("div",{cls:"flashcard-main-container"}),A=t.createEl("div",{cls:"flashcard-sidebar"}),i=A.createEl("div",{cls:"flashcard-stats-container"});new Jr(i,this.component.getFsrsManager()).render();let l=A.createEl("div",{cls:"flashcard-groups"}),g=l.createEl("div",{cls:"flashcard-groups-header"}).createEl("div",{cls:"flashcard-add-group",attr:{"aria-label":p("Add Group")}});(0,de.setIcon)(g,"plus"),g.addEventListener("click",()=>this.component.getGroupManager().showCreateGroupModal());let d=l.createEl("div",{cls:"flashcard-group-list"});(this.component.getFsrsManager().getCardGroups()||[]).forEach(k=>{let N=d.createEl("div",{cls:`flashcard-group-item ${k.name===this.component.getCurrentGroupName()?"active":""}`}),G=N.createEl("div",{cls:"flashcard-group-item-header"}),Z=G.createEl("div",{cls:"flashcard-group-title"}),ae=Z.createEl("span",{cls:"flashcard-group-icon"});(0,de.setIcon)(ae,k.filter.startsWith("#")?"hash":"gallery-horizontal-end"),Z.createEl("span",{cls:"flashcard-group-name",text:k.name});let Oe=G.createEl("div",{cls:"flashcard-group-actions"}),xe=Oe.createEl("div",{cls:"flashcard-group-action",attr:{"aria-label":p("Edit Group")}});(0,de.setIcon)(xe,"edit"),xe.addEventListener("click",Ae=>{Ae.stopPropagation(),this.component.getGroupManager().showEditGroupModal(k)});let Ye=Oe.createEl("div",{cls:"flashcard-group-action",attr:{"aria-label":p("Delete Group")}});(0,de.setIcon)(Ye,"trash"),Ye.addEventListener("click",async Ae=>{if(Ae.stopPropagation(),confirm(p('Are you sure you want to delete group "')+k.name+p('"?')))try{if(await this.component.getFsrsManager().deleteCardGroup(k.id)){if(this.component.getCurrentGroupName()===k.name){let me=this.component.getFsrsManager().getCardGroups()||[];me.length>0?this.component.setCurrentGroupName(me[0].name):this.component.setCurrentGroupName("")}new de.Notice(p("Group deleted")),this.render()}else new de.Notice(p("Delete group failed"))}catch(ke){console.error("Delete group failed:",ke),new de.Notice(p("Delete group failed"))}});let re=this.component.getFsrsManager().getGroupProgress(k.id);if(re){let Ae=N.createEl("div",{cls:"flashcard-group-stats"}),ke=Ae.createEl("div",{cls:"flashcard-group-stat",attr:{"data-tooltip":p("Due Today")}}),me=ke.createEl("span",{cls:"flashcard-stat-icon"});(0,de.setIcon)(me,"calendar-clock"),ke.createEl("span",{text:re.due.toString()});let Ve=Ae.createEl("div",{cls:"flashcard-group-stat",attr:{"data-tooltip":p("New Cards")}}),$e=Ve.createEl("span",{cls:"flashcard-stat-icon"});(0,de.setIcon)($e,"sparkle"),Ve.createEl("span",{text:re.newCards.toString()});let _e=Ae.createEl("div",{cls:"flashcard-group-stat",attr:{"data-tooltip":p("Learned")}}),Mt=_e.createEl("span",{cls:"flashcard-stat-icon"});(0,de.setIcon)(Mt,"check-small"),_e.createEl("span",{text:re.learned.toString()})}N.addEventListener("click",()=>{this.component.setGroupCompletionMessage(this.component.getCurrentGroupName(),this.component.getCompletionMessage());let Ae={currentIndex:this.component.getCurrentIndex(),isFlipped:this.component.isCardFlipped()};this.component.setCurrentGroupName(k.name),e.querySelectorAll(".flashcard-group-item").forEach(Ve=>Ve.classList.remove("active")),N.classList.add("active"),this.component.setCompletionMessage(this.component.getGroupCompletionMessage(k.name)||null),this.component.refreshCardList();let me=this.component.getGroupProgress(k.name);me&&!this.component.getCompletionMessage()?(this.component.setCurrentIndex(me.currentIndex),this.component.setCardFlipped(me.isFlipped)):(this.component.setCurrentIndex(0),this.component.setCardFlipped(!1)),this.isMobileView&&(this.showingSidebar=!1),this.component.saveState(),this.render()})});let F=t.createEl("div",{cls:"flashcard-content-area"}).createEl("div",{cls:"flashcard-container"}),y=this.component.getCards(),Q=this.component.getCurrentIndex(),U=y.length>0&&Q<y.length?y[Q]:null,b=this.component.getCurrentGroupName(),P=this.component.getGroupCompletionMessage(b),q=this.component.getFsrsManager().getCardGroups().length>0;if(!q||y.length===0){let k=this.component.getFsrsManager().getCardGroups().find(G=>G.name===b),N=k&&k.cardIds.length===0;if(q)if(N){let G=F.createEl("div",{cls:"flashcard-completion-message flashcard-empty-group"}),Z=G.createEl("div",{cls:"completion-icon"});(0,de.setIcon)(Z,"circle-slash-2"),G.createEl("h3",{text:p("No Cards in This Group")}),G.createEl("p",{text:p("This group doesn't contain any flashcards yet. Add some flashcards to this group to start learning.")})}else{let G=F.createEl("div",{cls:"flashcard-completion-message"}),Z=G.createEl("div",{cls:"completion-icon"});(0,de.setIcon)(Z,"check-circle"),G.createEl("h3",{text:p("Learning Completed!")});let ae=P;ae||(k?ae=p("Group completed: ")+k.name+p(". All cards have been reviewed."):ae=p("All flashcards completed for today!"),this.component.setGroupCompletionMessage(b,ae)),G.createEl("p",{text:ae})}else{let G=F.createEl("div",{cls:"flashcard-completion-message flashcard-no-group"}),Z=G.createEl("div",{cls:"completion-icon"});(0,de.setIcon)(Z,"folder-plus"),G.createEl("h3",{text:p("No Flashcard Groups")}),G.createEl("p",{text:p("You haven't created any flashcard groups yet. Create a group to get started with your flashcards.")}),G.createEl("button",{cls:"mod-cta",text:p("Create Flashcard Group")}).addEventListener("click",()=>{this.component&&this.component.groupManager?this.component.groupManager.showCreateGroupModal():console.error("Group manager is not available")})}return}if(U){let k=["flashcard"];this.component.isCardFlipped()&&k.push("is-flipped");let N=F.createEl("div",{cls:k.join(" ")}),ae=this.component.getFsrsManager().getCardGroups().filter(He=>this.component.getFsrsManager().getCardsInGroup(He).some(he=>he.id===(U==null?void 0:U.id))).some(He=>He.isReversed),Oe=ae?U.answer:U.text,xe=ae?U.text:U.answer,re=N.createEl("div",{cls:"flashcard-side flashcard-front"}).createEl("div",{cls:"flashcard-content markdown-rendered"});this.renderMarkdownContent(re,Oe,U.filePath);let ke=N.createEl("div",{cls:"flashcard-side flashcard-back"}).createEl("div",{cls:"flashcard-content markdown-rendered"});this.renderMarkdownContent(ke,xe,U.filePath),N.addEventListener("click",()=>this.component.flipCard());let me=F.createEl("div",{cls:"flashcard-rating"}),Ve=U?this.component.getFsrsManager().getCardPredictions(U.id):null;this.component.getRatingButtons().forEach(He=>{let it=me.createEl("button",{cls:"flashcard-rating-button",attr:{"data-rating":He.ratingText,title:`${He.label} (${He.key})`}});if(it.createSpan({text:He.label}),Ve&&Ve[He.rating]){let he=new Date(Ve[He.rating].nextReview),Le=new Date,Ue=he.getTime()-Le.getTime(),ze=it.createSpan({cls:"prediction-info"}),Ce="";if(Ue<60*60*1e3)Ce=`${Math.max(1,Math.round(Ue/6e4))}m`;else if(Ue<24*60*60*1e3)Ce=`${Math.round(Ue/36e5)}h`;else{let Te=Math.round(Ue/864e5);Te<1?Ce=`${Math.round(Te*24)}h`:Te<30?Ce=`${Math.round(Te)}d`:Te<365?Ce=`${Math.round(Te/30)}mo`:Ce=`${Math.round(Te/365)}y`}ze.createSpan({text:Ce,cls:"days"})}else{let he=0,Le=(U==null?void 0:U.reviews)===0,Ue=(U==null?void 0:U.lapses)>0;switch(He.rating){case oe.AGAIN:he=Le?.25:Ue?.5:1;break;case oe.HARD:he=Le?24:Ue?36:48;break;case oe.GOOD:he=Le?24*3:Ue?24*5:24*7;break;case oe.EASY:he=Le?24*5:Ue?24*9:24*14;break}let ze=he/24,Ce="";he<1?Ce=`${Math.round(he*60)}m`:he<24?Ce=`${Math.round(he)}h`:ze<1?Ce=`${Math.round(ze*24)}h`:ze<30?Ce=`${Math.round(ze)}d`:ze<365?Ce=`${Math.round(ze/30)}mo`:Ce=`${Math.round(ze/365)}y`,it.createSpan({text:Ce,cls:"days"})}it.addEventListener("click",he=>{he.stopPropagation(),this.component.rateCard(He.rating)})}),this.component.isCardFlipped()&&N.classList.add("is-flipped");let $e=this.component.getCurrentGroupId(),_e=y.length,Mt=this.component.getFsrsManager(),Ie=($e?Mt.getCardsForStudy($e):[]).length,Wt=Math.max(Ie,_e),Xt=Wt-_e+1;if(F.createEl("div",{cls:"flashcard-counter",text:`${Xt}/${Wt}`}),U.filePath){let it=F.createEl("div",{cls:"flashcard-source"}).createEl("span",{text:U.filePath.split("/").pop()||""});this.component.getUtils().addPagePreview(it,U.filePath),it.addEventListener("click",he=>{he.stopPropagation();let Le=this.component.getApp().vault.getAbstractFileByPath(U.filePath);Le&&Le instanceof de.TFile&&this.component.getApp().workspace.getLeaf().openFile(Le)})}}else F.createEl("div",{cls:"flashcard-empty-state",text:p("No cards available")})}async renderMarkdownContent(e,t,A){for(;e.firstChild;)e.removeChild(e.firstChild);if(!t){console.warn("renderMarkdownContent: content is empty or undefined"),e.textContent="Add answer";return}let i=e.closest(".flashcard-front")!==null,n=t;i?n=t.replace(/\{\{([^{}]+)\}\}/g,(l,c)=>{let d=c.split("").reduce((C,F)=>{let y=/[\u4e00-\u9fa5]/.test(F);return C+(y?3:1)},0);return c.length>5&&(d=Math.floor(d*1.2)),"_".repeat(Math.max(8,d))}):n=t.replace(/\{\{([^{}]+)\}\}/g,"$1");try{await de.MarkdownRenderer.render(this.component.getApp(),n,e,A||"",new de.Component),e.querySelectorAll("ul, ol").forEach(c=>{c.addClass("flashcard-markdown-list")}),i&&e.querySelectorAll("p").forEach(g=>{g.textContent&&g.textContent.includes("______")&&g.addClass("flashcard-cloze")})}catch(l){console.error("Error rendering markdown in flashcard:",l),e.textContent=n}}};W();var $r=class{constructor(e){this.component=e}flipCard(){let e=!this.component.isCardFlipped();this.component.setCardFlipped(e);let t=document.querySelector(".flashcard");t&&(e?t.classList.add("is-flipped"):t.classList.remove("is-flipped")),this.component.saveState()}nextCard(){let e=this.component.getCards();if(e.length===0)return;let t=this.component.getCurrentIndex()+1;t>=e.length&&(t=0),this.component.setCurrentIndex(t),this.component.setCardFlipped(!1),this.component.saveState(),this.component.getRenderer().render()}rateCard(e){let t=this.component.getCards(),A=this.component.getCurrentIndex();if(t.length===0||A>=t.length)return;let i=t[A];if(i){if(this.component.getFsrsManager().trackStudyProgress(i.id,e),t.splice(A,1),t.length===0){let n=this.component.getCurrentGroupName(),l=p("No cards due for review");if(n){let c=this.component.getFsrsManager().getCardGroups().find(g=>g.name===n);c&&(l=p("Group completed: ")+c.name+p(". Add more cards in Settings, but remember: more cards = more reviews."))}else l=p("All flashcards completed for today!");this.component.setGroupCompletionMessage(n,l),this.component.updateProgress(),this.component.getRenderer().render();return}A>=t.length&&this.component.setCurrentIndex(0),this.component.setCardFlipped(!1),this.component.saveState(),this.component.updateProgress(),this.component.getRenderer().render()}}refreshCardList(){let e=this.component.getCurrentGroupName(),t=this.component.getFsrsManager(),A=this.component.getCards(),i=this.component.getCurrentGroupName();if(A.length>0&&i&&i!==e){let F=this.component.getCards(),y=this.component.getCurrentIndex(),Q=F.length>0&&y<F.length?F[y].id:void 0,U={currentIndex:y,isFlipped:this.component.isCardFlipped(),currentCardId:Q},b=t.getUIState();b.groupProgress||(b.groupProgress={}),b.groupProgress[i]=U,t.updateUIState(b)}let n=t.getCardGroups().find(F=>F.name===e);if(!n){console.error(`\u672A\u627E\u5230\u540D\u79F0\u4E3A ${e} \u7684\u5206\u7EC4`);return}let l=t.getCardsByGroupId(n.id),c=t.fsrsService,g=l.filter(F=>!!(F.reviews===0&&F.lastReview===0||c.isDue(F)));if(g.length===0){let F=p("No cards due for review");e?F=p("Group completed: ")+n.name+p(". Add more cards in Settings, but remember: more cards = more reviews."):F=p("All flashcards completed for today!"),this.component.setGroupCompletionMessage(e,F),this.component.setCards([]),this.component.updateProgress();let y=t.getUIState();y.groupProgress||(y.groupProgress={}),y.groupProgress[e]={currentIndex:0,isFlipped:!1,currentCardId:null,completionMessage:F},t.updateUIState(y),this.component.getRenderer().render(),this.component.saveState();return}let d=g,m=this.component.getGroupProgress(e),C=t.getUIState();if(C.groupProgress||(C.groupProgress={}),C.groupProgress[e]?C.groupProgress[e].completionMessage=void 0:C.groupProgress[e]={currentIndex:0,isFlipped:!1,currentCardId:void 0,completionMessage:void 0},t.updateUIState(C),this.component.setCards(d),d.length>0)if(m){let F=0;if(m.currentCardId){let y=d.findIndex(Q=>Q.id===m.currentCardId);y!==-1?F=y:F=Math.min(m.currentIndex,d.length-1)}else F=Math.min(m.currentIndex,d.length-1);this.component.setCurrentIndex(F),this.component.setCardFlipped(m.isFlipped)}else this.component.setCurrentIndex(0),this.component.setCardFlipped(!1);else{let F=p("No cards due for review");if(e){let y=t.getCardGroups().find(Q=>Q.name===e);y&&(F=p("Group completed: ")+y.name+p(". Add more cards in Settings, but remember: more cards = more reviews."))}else F=p("All flashcards completed for today!");this.component.setGroupCompletionMessage(e,F)}this.component.saveState()}};var Si=require("obsidian");W();var zr=class{constructor(e){this.component=e}showCreateGroupModal(){this.showEditGroupModal()}showEditGroupModal(e){var Ce,Te,si;let{app:t}=this.component.getApp(),A=document.createElement("div");A.className="flashcard-modal-overlay",document.body.appendChild(A);let i=document.createElement("div");i.className="flashcard-modal-container",A.appendChild(i);let n=document.createElement("div");n.className="flashcard-modal-content",i.appendChild(n);let l=document.createElement("div");l.className="flashcard-modal-header",n.appendChild(l);let c=document.createElement("h3");c.textContent=e?p("Edit group"):p("Create group"),l.appendChild(c);let g=document.createElement("div");g.className="flashcard-group-form",n.appendChild(g);let d=e?e.name:"",m=document.createElement("input");m.type="text",m.className="flashcard-modal-input",m.placeholder=p("Enter name"),m.value=d,g.appendChild(m),m.addEventListener("input",Be=>{d=Be.target.value});let C=e?e.filter:"",F=document.createElement("textarea");F.className="flashcard-modal-input",F.placeholder=p(`Support format: 
Folder: folder1, folder1/folder2
Note: [[note1]], [[note2]]`),F.value=C,g.appendChild(F),F.addEventListener("input",Be=>{C=Be.target.value});let y=e&&e.isReversed||!1,Q=document.createElement("div");Q.className="flashcard-modal-option",g.appendChild(Q);let U=document.createElement("input");U.type="checkbox",U.className="flashcard-modal-checkbox",U.checked=y,Q.appendChild(U);let b=document.createElement("label");b.textContent=p("Reverse cards (use comments as questions)"),b.className="flashcard-modal-label",Q.appendChild(b),U.addEventListener("change",Be=>{y=Be.target.checked});let P=document.createElement("div");P.className="flashcard-modal-settings",g.appendChild(P);let q=document.createElement("div");q.className="flashcard-modal-settings-header",P.appendChild(q);let k=document.createElement("h4");k.textContent=p("Learning settings"),k.className="settings-title",q.appendChild(k);let N=e?((Ce=e.settings)==null?void 0:Ce.useGlobalSettings)!==!1:!0,G=document.createElement("div");G.className="flashcard-modal-option use-global-option",q.appendChild(G);let Z=document.createElement("input");Z.type="checkbox",Z.className="flashcard-modal-checkbox",Z.id="use-global-settings",Z.checked=N,G.appendChild(Z);let ae=document.createElement("label");ae.textContent=p("Use global settings"),ae.className="flashcard-modal-label",ae.htmlFor="use-global-settings",G.appendChild(ae),Z.addEventListener("change",Be=>{N=Be.target.checked,it()});let Oe=e&&((Te=e.settings)==null?void 0:Te.newCardsPerDay)||20,xe=document.createElement("div");xe.className="flashcard-modal-option slider-option",P.appendChild(xe);let Ye=document.createElement("label");Ye.textContent=p("New cards per day: "),Ye.className="flashcard-modal-label",xe.appendChild(Ye);let re=document.createElement("div");re.className="slider-with-value",xe.appendChild(re);let Ae=document.createElement("input");Ae.className="flashcard-modal-slider",Ae.type="range",Ae.min="5",Ae.max="100",Ae.step="5",Ae.value=String(Oe);let ke=parseInt(Ae.value);ke<5?Ae.value="5":ke%5!==0&&(Ae.value=(Math.round(ke/5)*5).toString()),re.appendChild(Ae);let me=document.createElement("span");me.className="slider-value",me.textContent=Ae.value,re.appendChild(me),Ae.addEventListener("input",()=>{Oe=parseInt(Ae.value),me.textContent=Ae.value});let Ve={setDisabled:Be=>{Ae.disabled=Be,xe.classList.toggle("disabled",Be)}},$e=e&&((si=e.settings)==null?void 0:si.reviewsPerDay)||100,_e=document.createElement("div");_e.className="flashcard-modal-option slider-option",P.appendChild(_e);let Mt=document.createElement("label");Mt.textContent=p("Reviews per day: "),Mt.className="flashcard-modal-label",_e.appendChild(Mt);let _t=document.createElement("div");_t.className="slider-with-value",_e.appendChild(_t);let Ie=document.createElement("input");Ie.className="flashcard-modal-slider",Ie.type="range",Ie.min="10",Ie.max="500",Ie.step="10",Ie.value=String($e);let Wt=parseInt(Ie.value);Wt<10?Ie.value="10":Wt%10!==0&&(Ie.value=(Math.round(Wt/10)*10).toString()),_t.appendChild(Ie);let Xt=document.createElement("span");Xt.className="slider-value",Xt.textContent=Ie.value,_t.appendChild(Xt),Ie.addEventListener("input",()=>{$e=parseInt(Ie.value),Xt.textContent=Ie.value});let He={setDisabled:Be=>{Ie.disabled=Be,_e.classList.toggle("disabled",Be)}},it=()=>{N?(Ve.setDisabled(!0),He.setDisabled(!0)):(Ve.setDisabled(!1),He.setDisabled(!1))};it();let he=document.createElement("div");he.className="button-container",n.appendChild(he);let Le=document.createElement("button");Le.className="flashcard-cancel-btn",Le.textContent=p("Cancel"),he.appendChild(Le);let Ue=document.createElement("button");Ue.className="flashcard-save-group-btn",Ue.textContent=e?p("Save"):p("Create"),he.appendChild(Ue),Ue.addEventListener("click",async()=>{if(!d){new Si.Notice(p("Group name cannot be empty"));return}let Be=this.component.getFsrsManager();if(e){let ft=e.name;try{await Be.updateCardGroup(e.id,{name:d,filter:C,isReversed:y,settings:{useGlobalSettings:N,newCardsPerDay:N?void 0:Oe,reviewsPerDay:N?void 0:$e},lastUpdated:Date.now()});let Qe=Be.storage;Qe&&Qe.uiState&&(Qe.uiState.groupCompletionMessages&&Qe.uiState.groupCompletionMessages[ft]!==void 0&&(Qe.uiState.groupCompletionMessages[d]=Qe.uiState.groupCompletionMessages[ft],delete Qe.uiState.groupCompletionMessages[ft]),Qe.uiState.groupProgress&&Qe.uiState.groupProgress[ft]&&(Qe.uiState.groupProgress[d]=Qe.uiState.groupProgress[ft],delete Qe.uiState.groupProgress[ft]),Qe.uiState.currentGroupName===ft&&(Qe.uiState.currentGroupName=d),await Be.saveStoragePublic()),this.component.getCurrentGroupName()===ft&&this.component.setCurrentGroupName(d),this.component.refreshCardList(),this.component.getRenderer().render(),new Si.Notice(p("Group update successful"))}catch(Qe){console.error("Update group failed:",Qe),new Si.Notice(p("Update group failed"))}}else await Be.createCardGroup({name:d,filter:C,isReversed:y,createdTime:Date.now(),sortOrder:Be.getCardGroups().length,settings:{useGlobalSettings:N,newCardsPerDay:N?void 0:Oe,reviewsPerDay:N?void 0:$e}}),new Si.Notice(p("Group created")),this.component.refreshCardList(),this.component.getRenderer().render();document.body.removeChild(A),e&&this.component.getRenderer().render()});let ze=Be=>{Be.key==="Escape"&&(document.body.removeChild(A),document.removeEventListener("keydown",ze))};document.addEventListener("keydown",ze),Le.addEventListener("click",()=>{document.body.removeChild(A),e&&this.component.getRenderer().render()})}};W();var jl=require("obsidian"),qr=class{constructor(e){this.component=e}getGroupProgress(){let e=this.component.getCurrentGroupId(),t=[];e?t=this.component.getFsrsManager().getCardsByGroupId(e):t=(()=>{let g=this.component.getFsrsManager(),d=g.getCardGroups(),m=[],C=new Set;return d.forEach(F=>{g.getCardsByGroupId(F.id).forEach(Q=>{C.has(Q.id)||(C.add(Q.id),m.push(Q))})}),m})();let i=t.filter(g=>this.component.getFsrsManager().fsrsService.isDue(g)).length,n=t.filter(g=>g.reviews===0).length,l=t.filter(g=>g.reviews>0).length,c=this.calculateRetention(t);return{due:i,newCards:n,learned:l,retention:c}}calculateRetention(e){let t=e.filter(i=>i.reviews>0);return t.length===0?1:t.reduce((i,n)=>i+n.retrievability,0)/t.length}updateProgress(){let e=this.component.getProgressContainer();if(!e)return;e.empty();let t=this.getGroupProgress(),A=e.createEl("div",{cls:"flashcard-progress-text"});A.createSpan({text:this.component.getCurrentGroupName()||p("Groups"),cls:"group-name"}),A.createSpan({text:"|",cls:"separator"}),[{label:p("Due"),value:t.due},{label:p("New"),value:t.newCards},{label:p("Learned"),value:t.learned},{label:p("Retention"),value:`${(t.retention*100).toFixed(1)}%`}].forEach((b,P)=>{P>0&&A.createSpan({text:"|",cls:"separator"});let q=A.createEl("div",{cls:"stat"});if(q.createSpan({text:b.label+": "}),q.createSpan({text:b.value.toString(),cls:"stat-value"}),b.label===p("Retention")){let k=q.createSpan({cls:"help-icon"});(0,jl.setIcon)(k,"help-circle"),k.setAttribute("aria-label",p(`Retention = (Total Reviews - Forget Count) / Total Reviews
This metric reflects your learning effectiveness, higher means better memory retention`))}});let l=e.createEl("div",{cls:"flashcard-progress-bar-container"}).createEl("div",{cls:"flashcard-progress-bar"}),c=t.due+t.newCards,g=this.component.getCards().length,d=c>0?Math.round((c-g)/c*100):100;if(l.style.width=`${d}%`,this.component.getCurrentGroupName()){let b=this.component.getFsrsManager().getCardGroups().find(P=>P.id===this.component.getCurrentGroupName());if(b){let P=e.createEl("div",{cls:"flashcard-group-name-container"});P.createEl("div",{cls:"flashcard-group-name",text:b.name}),b.filter&&P.createEl("div",{cls:"flashcard-group-filter",text:p("Filter")+": "+b.filter})}}let m=e.createEl("div",{cls:"flashcard-index-container"}),C=this.component.getCurrentGroupId(),F=this.component.getCards().length,y=this.component.getFsrsManager(),U=(C?y.getCardsForStudy(C):[]).length;if(U>0||F>0){let b=Math.max(U,F),P=b-F+1;F>0?m.textContent=`${P}/${b}`:m.textContent=`${b}/${b}`}else m.textContent="0/0"}saveState(){let e=this.component.getCurrentGroupName(),t=this.component.getFsrsManager().getUIState();t.currentGroupName=e,t.currentIndex=this.component.getCurrentIndex(),t.isFlipped=this.component.isCardFlipped(),t.completionMessage=this.component.getCompletionMessage(),t.groupProgress||(t.groupProgress={}),t.groupProgress[e]={currentIndex:this.component.getCurrentIndex(),isFlipped:this.component.isCardFlipped()},t.groupCompletionMessages||(t.groupCompletionMessages={}),t.groupCompletionMessages[e]=this.component.getGroupCompletionMessage(e),this.component.getFsrsManager().updateUIState(t)}};var Zr=class{constructor(e){this.component=e}addPagePreview(e,t){if(!t)return;let A;e.addEventListener("mouseenter",i=>{A=setTimeout(()=>{let n=i.target;this.component.getApp().workspace.trigger("hover-link",{event:i,source:"hi-note",hoverParent:n,targetEl:n,linktext:t})},300)}),e.addEventListener("mouseleave",()=>{A&&clearTimeout(A)})}};var OA=class extends ec.Component{constructor(t,A){super();this.progressContainer=null;this.currentIndex=0;this.isFlipped=!1;this.cards=[];this.isActive=!1;this.currentCard=null;this.currentGroupName="";this.currentGroupId="";this.completionMessage=null;this.groupProgress={};this.ratingButtons=[{label:p("Again"),rating:oe.AGAIN,key:"1",ratingText:"again"},{label:p("Hard"),rating:oe.HARD,key:"2",ratingText:"hard"},{label:p("Good"),rating:oe.GOOD,key:"3",ratingText:"good"},{label:p("Easy"),rating:oe.EASY,key:"4",ratingText:"easy"}];this.container=t,this.app=A.app,this.fsrsManager=A.fsrsManager,this.renderer=new Yr(this),this.operations=new $r(this),this.groupManager=new zr(this),this.progressManager=new qr(this),this.utils=new Zr(this),this.groupProgress={};let i=this.fsrsManager.getUIState()||{};if(this.currentGroupName=i.currentGroupName||"",this.currentGroupName){let n=this.fsrsManager.getCardGroups().find(l=>l.name===this.currentGroupName);n?this.currentGroupId=n.id:this.currentGroupId=""}else this.currentGroupId="";this.completionMessage=i.completionMessage||null,i.groupProgress&&(this.groupProgress={...i.groupProgress}),this.currentGroupName&&this.groupProgress[this.currentGroupName]?(this.currentIndex=this.groupProgress[this.currentGroupName].currentIndex||0,this.isFlipped=this.groupProgress[this.currentGroupName].isFlipped||!1):(this.currentIndex=0,this.isFlipped=!1),(!i||!i.groupProgress||typeof i.groupProgress!="object")&&(this.groupProgress={}),i&&"groupProgress"in i&&i.groupProgress&&typeof i.groupProgress=="object"?this.groupProgress={...i.groupProgress}:this.groupProgress={}}setLicenseManager(t){this.licenseManager=t}setCards(t){this.cards=t}cleanup(){}async activate(){if(this.isActive=!0,this.licenseManager){let t=await this.licenseManager.isActivated(),A=t?await this.licenseManager.isFeatureEnabled("flashcard"):!1;if(t&&A){this.operations.refreshCardList(),this.renderer.render();return}}this.renderer.renderActivation()}renderActivation(){this.renderer.renderActivation()}deactivate(){this.isActive=!1,this.container.empty(),this.container.removeClass("flashcard-mode")}destroy(){this.container.removeClass("flashcard-mode"),this.container.empty()}getContainer(){return this.container}getIsActive(){return this.isActive}getApp(){return this.app}getFsrsManager(){return this.fsrsManager}getLicenseManager(){return this.licenseManager}getCards(){return this.cards}getCurrentIndex(){return this.currentIndex}setCurrentIndex(t){this.currentIndex=t}isCardFlipped(){return this.isFlipped}setCardFlipped(t){this.isFlipped=t}getCurrentGroupName(){return this.currentGroupName}setCurrentGroupName(t){if(this.currentGroupName=t,t){let A=this.fsrsManager.getCardGroups().find(i=>i.name===t);A?this.currentGroupId=A.id:this.currentGroupId=""}else this.currentGroupId=""}getCurrentGroupId(){return this.currentGroupId}setCurrentGroupId(t){if(this.currentGroupId=t,t){let A=this.fsrsManager.getCardGroups().find(i=>i.id===t);this.currentGroupName=A?A.name:""}else this.currentGroupName=""}getCompletionMessage(){return this.completionMessage}setCompletionMessage(t){this.completionMessage=t}getGroupCompletionMessage(t){return this.groupProgress[t]&&this.groupProgress[t].completionMessage||null}setGroupCompletionMessage(t,A){if(this.groupProgress[t]||(this.groupProgress[t]={currentIndex:0,isFlipped:!1,completionMessage:null}),this.groupProgress[t].completionMessage=A,this.fsrsManager){let i=this.fsrsManager.getUIState();i.groupProgress||(i.groupProgress={}),i.groupProgress[t]||(i.groupProgress[t]={currentIndex:0,isFlipped:!1,currentCardId:void 0,completionMessage:void 0}),i.groupProgress[t].completionMessage=A,A&&(i.groupProgress[t].isFlipped=!1,i.groupProgress[t].currentCardId=void 0),this.fsrsManager.updateUIState(i)}}getGroupProgress(t){let A=t||this.currentGroupName;return this.groupProgress[A]||null}isComponentActive(){return this.isActive}getProgressContainer(){return this.progressContainer}setProgressContainer(t){this.progressContainer=t}getRatingButtons(){return this.ratingButtons}flipCard(){this.operations.flipCard()}nextCard(){this.operations.nextCard()}rateCard(t){this.operations.rateCard(t)}refreshCardList(){this.operations.refreshCardList()}saveState(){let t=this.getCurrentGroupName(),A=this.fsrsManager.getUIState();if(A.currentGroupName=t,A.completionMessage=this.completionMessage,A.groupProgress||(A.groupProgress={}),t){let i=this.cards.length>0&&this.currentIndex<this.cards.length?this.cards[this.currentIndex].id:void 0,n=this.getGroupCompletionMessage(t);A.groupProgress[t]?(A.groupProgress[t].currentIndex=this.currentIndex,A.groupProgress[t].isFlipped=this.isFlipped,A.groupProgress[t].currentCardId=i,A.groupProgress[t].completionMessage=n):A.groupProgress[t]={currentIndex:this.currentIndex,isFlipped:this.isFlipped,currentCardId:i,completionMessage:n}}this.fsrsManager.updateUIState(A)}updateProgress(){this.progressManager.updateProgress()}getRenderer(){return this.renderer}getOperations(){return this.operations}getGroupManager(){return this.groupManager}getProgressManager(){return this.progressManager}getUtils(){return this.utils}};var bi=require("obsidian");W();var Ui=class extends bi.Component{constructor(t,A,i,n=window.app,l=!1){super();this.highlight=A;this.onHighlightClick=i;this.app=n;this.isInMainView=l;this.render(t).catch(c=>{console.error("Error rendering highlight content:",c)})}async render(t){this.container=t.createEl("div",{cls:"highlight-content"}),await this.renderText()}async renderText(){this.textContainer=this.container.createEl("div",{cls:"highlight-text-container"});let t=this.textContainer.createEl("div",{cls:"highlight-text-decorator"});this.highlight.backgroundColor&&(t.style.backgroundColor=this.highlight.backgroundColor);let i=this.textContainer.createEl("div",{cls:"highlight-text"}).createEl("div",{cls:`highlight-text-content ${this.highlight.isVirtual?"virtual-highlight":""} markdown-rendered`}),n=this.highlight.text||"";try{await bi.MarkdownRenderer.render(this.app,n,i,this.highlight.filePath||"",new bi.Component),i.querySelectorAll("ul, ol").forEach(c=>{c.addClass("highlight-markdown-list")}),await this.activateInternalLinks(i,this.highlight.filePath||"")}catch(l){console.error("Error rendering markdown in highlight:",l);let c=n.split(`
`);c.forEach((g,d)=>{let m=i.createEl("p",{text:g,cls:"highlight-text-line"});d<c.length-1&&m.addClass("highlight-text-line-spacing")})}!this.highlight.isGlobalSearch&&!this.isInMainView?(i.setAttribute("aria-label",p("Jump to highlight")),i.addEventListener("mousedown",async l=>{l.target.closest("a")||(l.preventDefault(),l.stopPropagation(),await this.onHighlightClick(this.highlight))})):(i.addClass("global-search-highlight"),i.removeAttribute("aria-label"),i.style.cursor="default")}async activateInternalLinks(t,A){t.querySelectorAll("a.internal-link").forEach(l=>{let c=l.getAttribute("data-href")||l.getAttribute("href");c&&(l.addEventListener("click",g=>{g.preventDefault(),g.stopPropagation(),this.app.metadataCache.getFirstLinkpathDest(c,A)&&this.app.workspace.openLinkText(c,A,!1)}),l.addEventListener("mouseenter",g=>{this.app.workspace.trigger("hover-link",{event:g,source:"hi-note",hoverParent:t,targetEl:l,linktext:c,sourcePath:A})}))}),t.querySelectorAll("a.tag").forEach(l=>{let c=l.getAttribute("href");c&&l.addEventListener("click",g=>{g.preventDefault(),g.stopPropagation(),this.app.workspace.trigger("search:open",c)})})}getContainer(){return this.container}};Ui.dragPreview=null;var jr=require("obsidian");W();var Mi=class extends jr.Component{constructor(t,A,i){super();this.highlight=A;this.onCommentEdit=i;this.app=window.app,this.render(t)}render(t){if((this.highlight.comments||[]).length===0)return;let i=t.createEl("div",{cls:"hi-notes-section"});this.container=i.createEl("div",{cls:"hi-notes-list"}),this.renderComments().catch(n=>{console.error("Error rendering comments:",n)})}async renderComments(){let t=this.highlight.comments||[];for(t.sort((A,i)=>i.updatedAt-A.updatedAt);this.container.firstChild;)this.container.removeChild(this.container.firstChild);for(let A of t){let i=this.container.createEl("div",{cls:"hi-note",attr:{"data-comment-id":A.id}}),n=i.createEl("div",{cls:"hi-note-content-wrapper"}),l=n.createEl("div",{cls:"hi-note-content markdown-rendered"}),c=A.content;try{await jr.MarkdownRenderer.renderMarkdown(c,l,this.highlight.filePath||"",this),l.querySelectorAll("ul, ol").forEach(m=>{m.addClass("comment-markdown-list")}),await this.activateInternalLinks(l,this.highlight.filePath||"")}catch(d){console.error("Error rendering markdown in comment:",d),l.textContent=c}l.addEventListener("dblclick",d=>{d.target.closest("a")||(d.stopPropagation(),d.preventDefault(),this.onCommentEdit(A))}),l.addEventListener("click",d=>{d.target.closest("a")||d.stopPropagation()}),requestAnimationFrame(()=>{this.checkAndAddToggleButton(n,l,A)});let g=i.createEl("div",{cls:"hi-note-footer"});g.createEl("div",{text:new Date(A.updatedAt).toLocaleString(),cls:"hi-note-time"}),g.createEl("span",{text:"Double click to edit",cls:"hi-note-edit-hint"}),g.createEl("div",{cls:"hi-note-actions"})}}checkAndAddToggleButton(t,A,i){if(A.scrollHeight>240){t.addClass("has-collapsible-content"),t.addClass("collapsed");let c=t.createEl("div",{cls:"content-fade-out"}),g=t.createEl("div",{cls:"toggle-content-btn"}),d=g.createEl("span",{text:p("Expand")});g.addEventListener("click",m=>{m.stopPropagation(),t.hasClass("collapsed")?(t.removeClass("collapsed"),t.addClass("expanded"),d.textContent=p("Collapse")):(t.addClass("collapsed"),t.removeClass("expanded"),d.textContent=p("Expand"))})}}async activateInternalLinks(t,A){t.querySelectorAll("a.internal-link").forEach(l=>{let c=l.getAttribute("data-href")||l.getAttribute("href");c&&(l.addEventListener("click",g=>{g.preventDefault(),g.stopPropagation(),this.app.metadataCache.getFirstLinkpathDest(c,A)&&this.app.workspace.openLinkText(c,A,!1)}),l.addEventListener("mouseenter",g=>{this.app.workspace.trigger("hover-link",{event:g,source:"hi-note",hoverParent:t,targetEl:l,linktext:c,sourcePath:A})}))}),t.querySelectorAll("a.tag").forEach(l=>{let c=l.getAttribute("href");c&&l.addEventListener("click",g=>{g.preventDefault(),g.stopPropagation(),this.app.workspace.trigger("search:open",c)})})}};W();var es=class{constructor(e,t,A){this.parent=e;this.highlight=t;this.onClick=A;this.render()}render(){this.container=this.parent.createEl("div",{cls:"unfocused-comment-input"}),this.container.createEl("div",{cls:"unfocused-input-area",attr:{placeholder:p("Add comment...")}}).addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),this.onClick()})}remove(){this.container.remove()}hide(){this.container.style.display="none"}};var fe=require("obsidian");var mA=class mA{static start(e,t,A={}){var g;let{showIcon:i=!0,maxLength:n=30}=A;this.clear(),this.instance=document.createElement("div"),this.instance.className="highlight-dragging";let l=document.createElement("div");l.className="highlight-dragging-content";let c=t.length>n?t.slice(0,n)+"...":t;l.textContent=c,this.instance.appendChild(l),document.body.appendChild(this.instance),this.updatePosition(e.clientX,e.clientY),(g=e.dataTransfer)==null||g.setDragImage(this.dragImage,0,0),document.addEventListener("dragover",this.handleDragOver)}static updatePosition(e,t){this.instance&&this.instance.setAttribute("style",`left: ${e+10}px; top: ${t+10}px;`)}static clear(){this.instance&&(this.instance.remove(),this.instance=null),document.removeEventListener("dragover",this.handleDragOver)}};mA.instance=null,mA.dragImage=new Image,mA.dragImage.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",mA.handleDragOver=e=>{e.preventDefault(),mA.updatePosition(e.clientX,e.clientY)};var xi=mA;W();var tc=require("obsidian"),Li=class{constructor(e,t){this.highlight=e;this.plugin=t}generateSync(){var t,A,i,n;let e=[];if(this.highlight.isVirtual){let l=((A=(t=this.highlight.filePath)==null?void 0:t.split("/").pop())==null?void 0:A.replace(".md",""))||"File";e.push(`> [!note] [[${l}]]`),e.push("> ")}else{e.push("> [!quote] HiNote");let l=!1;if(this.highlight.blockId){let c=this.highlight.filePath;if(!c){let g=this.plugin.app.workspace.getActiveFile();g&&(c=g.path)}if(c){let g=(i=c.split("/").pop())==null?void 0:i.replace(".md","");if(g){let d=`> ![[${g}#^${this.highlight.blockId}]]`;e.push(d),e.push("> "),l=!0}}}else if(this.highlight.filePath&&typeof this.highlight.position=="number"){let c=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(c instanceof tc.TFile){let g=this.plugin.app.metadataCache.getFileCache(c);if(g!=null&&g.sections){let d=this.highlight.position,m=g.sections.find(C=>C.position.start.offset<=d&&C.position.end.offset>=d);if(m!=null&&m.id){let C=(n=this.highlight.filePath.split("/").pop())==null?void 0:n.replace(".md","");if(C){let F=`> ![[${C}#^${m.id}]]`;e.push(F),e.push("> "),l=!0}}}}}!l&&this.highlight.text&&(e.push(`> ${this.highlight.text}`),e.push("> "))}if(this.highlight.comments&&this.highlight.comments.length>0)for(let l of this.highlight.comments)e.push(...this.formatComment(l,!1));return e.join(`
`)}async generate(){return this.generateSync()}formatComment(e,t){let A=[],i=t?">":">>";if(!t){let l=e.updatedAt?window.moment(e.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"";A.push(`>> [!note]+ ${l}`)}let n=e.content.split(`
`).map(l=>(l=l.trim(),l?`${i} ${l}`:i)).join(`
`);return A.push(n),A.push(">"),A}};var Ot=require("obsidian");dt();dt();var Ti=class{constructor(){this.factories=new Map;this.instances=new Map}register(e){let t=e.getProviderType();this.factories.set(t,e)}registerAll(e){e.forEach(t=>this.register(t))}getService(e,t){if(this.instances.has(e)){let n=this.instances.get(e);if(n.isConfigured())return n}let A=this.factories.get(e);if(!A)throw Me.notConfigured(e,`Provider ${e} not registered`);let i=A.create(t);return this.instances.set(e,i),i}isRegistered(e){return this.factories.has(e)}clearCache(e){e?this.instances.delete(e):this.instances.clear()}getRegisteredProviders(){return Array.from(this.factories.keys())}getActiveServices(){return Array.from(this.instances.keys())}};dt();dt();var Pi=class extends nt{constructor(e,t="gpt-4o",A){let i={apiKey:e,model:t,baseUrl:A,temperature:.7,maxTokens:4096};super(i)}getDefaultBaseUrl(){return"https://api.openai.com/v1"}getEndpoint(){return"/chat/completions"}formatRequestBody(e){return{model:this.model,messages:e,temperature:this.temperature,max_tokens:this.maxTokens}}parseResponse(e){var t,A,i;if(!((i=(A=(t=e.choices)==null?void 0:t[0])==null?void 0:A.message)!=null&&i.content))throw new Error("Invalid response format from OpenAI API");return e.choices[0].message.content}getProviderType(){return"openai"}async listModels(){return[{id:"gpt-4o",name:"GPT-4o"},{id:"gpt-4o-mini",name:"GPT-4o Mini"},{id:"gpt-o1",name:"GPT-o1"},{id:"gpt-4",name:"GPT-4"},{id:"gpt-4-turbo",name:"GPT-4 Turbo"},{id:"gpt-3.5-turbo",name:"GPT-3.5 Turbo"}]}};As();is();rs();ss();var _A=require("obsidian"),BA=class{constructor(e="http://localhost:11434"){this.retryAttempts=3;this.retryDelay=1e3;!e.startsWith("http://")&&!e.startsWith("https://")&&(e="http://"+e),this.baseUrl=e.replace(/\/$/,"")}async listModels(){try{await this.ensureConnection();let e=await this.makeRequest({endpoint:"/api/tags",method:"GET"});if(!e||!e.models)throw new Error("Invalid API response format");return e.models.map(t=>t.name)}catch(e){throw this.handleError(e)}}async generateCompletion(e,t){try{await this.ensureConnection();let A=await this.makeRequest({endpoint:"/api/generate",method:"POST",body:JSON.stringify({model:e,prompt:t,stream:!1})});if(!A||!A.response)throw new Error("Invalid API response format");return A.response}catch(A){throw this.handleError(A)}}async pullModel(e){try{new _A.Notice(`Downloading model ${e}...`);let t=await this.makeRequest({endpoint:"/api/pull",method:"POST",body:JSON.stringify({name:e})});if(!t.ok)throw new Error(`Failed to download model: ${t.status}`);new _A.Notice(`Model ${e} downloaded successfully`)}catch(t){throw new Error(`Failed to download model: ${t.message}`)}}async chat(e,t){var A;try{await this.ensureConnection();let i=await this.makeRequest({endpoint:"/api/chat",method:"POST",body:JSON.stringify({model:e,messages:t,stream:!1})});if(!i||!((A=i.message)!=null&&A.content))throw new Error("Invalid API response format");return i.message.content}catch(i){throw this.handleError(i)}}async ensureConnection(){if(!this.baseUrl)throw new Error("Ollama service not configured. Please set the host in settings.");if(!await this.testConnection())throw new Error("Unable to connect to Ollama service. Please ensure the service is running.")}async testConnection(){if(!this.baseUrl)return!1;try{let e=await this.makeRequest({endpoint:"/api/version",method:"GET"});return!!(e!=null&&e.version)}catch(e){return!1}}async makeRequest(e){let t=null;for(let A=1;A<=this.retryAttempts;A++)try{let i=new URL(e.endpoint,this.baseUrl).toString(),n=await(0,_A.requestUrl)({url:i,method:e.method,headers:{"Content-Type":"application/json",Accept:"application/json"},body:e.body,throw:!1});if(n.status===200)try{return n.text?JSON.parse(n.text):{}}catch(c){throw new Error("Invalid JSON response from server")}let l=`HTTP error! status: ${n.status}`;try{let c=JSON.parse(n.text);c.error&&(l=c.error)}catch(c){n.text&&(l=n.text)}throw new Error(l)}catch(i){if(t=i,A<this.retryAttempts){await this.delay(this.retryDelay*A);continue}break}throw t}handleError(e){return e.message.includes("ECONNREFUSED")?(new _A.Notice("Ollama service is not running. Please start the service."),new Error("Unable to connect to Ollama service. Please ensure the service is running.")):e instanceof TypeError&&e.message.includes("Invalid URL")?new Error(`Invalid Ollama service URL: ${this.baseUrl}`):e}delay(e){return new Promise(t=>setTimeout(t,e))}};ns();var Di=class{getProviderType(){return"openai"}supports(e){return e==="openai"}create(e){var t;if(!((t=e.openai)!=null&&t.apiKey))throw Me.notConfigured("openai","API key not configured");return new Pi(e.openai.apiKey,e.openai.model||"gpt-4o",e.openai.baseUrl)}},Ri=class{getProviderType(){return"anthropic"}supports(e){return e==="anthropic"}create(e){var t;if(!((t=e.anthropic)!=null&&t.apiKey))throw Me.notConfigured("anthropic","API key not configured");return new kA(e.anthropic.apiKey,e.anthropic.apiAddress,e.anthropic.model)}},Ki=class{getProviderType(){return"gemini"}supports(e){return e==="gemini"}create(e){var t;if(!((t=e.gemini)!=null&&t.apiKey))throw Me.notConfigured("gemini","API key not configured");return new NA(e.gemini.apiKey,e.gemini.model||"gemini-2.5-flash",e.gemini.baseUrl)}},Oi=class{getProviderType(){return"deepseek"}supports(e){return e==="deepseek"}create(e){var t;if(!((t=e.deepseek)!=null&&t.apiKey))throw Me.notConfigured("deepseek","API key not configured");return new GA(e.deepseek.apiKey,e.deepseek.model||"deepseek-chat",e.deepseek.baseUrl)}},ki=class{getProviderType(){return"siliconflow"}supports(e){return e==="siliconflow"}create(e){var t;if(!((t=e.siliconflow)!=null&&t.apiKey))throw Me.notConfigured("siliconflow","API key not configured");return new VA(e)}},Ni=class{getProviderType(){return"ollama"}supports(e){return e==="ollama"}create(e){var t;if(!((t=e.ollama)!=null&&t.host))throw Me.notConfigured("ollama","Host not configured");return new Qa(e.ollama.host,e.ollama.model||"")}},Gi=class{getProviderType(){return"custom"}supports(e){return e==="custom"}create(e){var t,A,i;if(!((t=e.custom)!=null&&t.apiKey)||!((A=e.custom)!=null&&A.baseUrl)||!((i=e.custom)!=null&&i.model))throw Me.notConfigured("custom","API key, base URL, or model not configured");return new WA(e.custom.apiKey,e.custom.baseUrl,e.custom.model,e.custom.headers,e.custom.detectedApiType)}},Qa=class{constructor(e,t){this.service=new BA(e),this.model=t}async chat(e){if(!this.model)throw Me.notConfigured("ollama","Model not configured");return await this.service.chat(this.model,e)}async generateResponse(e){if(!this.model)throw Me.notConfigured("ollama","Model not configured");return await this.service.generateCompletion(this.model,e)}async testConnection(){return await this.service.testConnection()}updateModel(e){this.model=e}async listModels(){return(await this.service.listModels()).map(t=>({id:t,name:t}))}getProviderType(){return"ollama"}isConfigured(){return!!this.model}};var Kt=class{constructor(e){this.settings=e,this.registry=new Ti,this.currentProvider=this.parseProvider(e.provider),this.registerAllServices()}registerAllServices(){this.registry.register(new Di),this.registry.register(new Ri),this.registry.register(new Ki),this.registry.register(new Oi),this.registry.register(new ki),this.registry.register(new Ni),this.registry.register(new Gi)}getCurrentService(){return this.registry.getService(this.currentProvider,this.settings)}async generateResponse(e,t,A){let i=this.processPrompt(e,t,A);return await this.getCurrentService().generateResponse(i)}async chat(e){return await this.getCurrentService().chat(e)}async testConnection(e){let t=e||this.currentProvider;try{return await this.registry.getService(t,this.settings).testConnection()}catch(A){return!1}}updateModel(e,t){switch(this.registry.clearCache(e),e){case"openai":this.settings.openai&&(this.settings.openai.model=t);break;case"anthropic":this.settings.anthropic&&(this.settings.anthropic.model=t);break;case"gemini":this.settings.gemini&&(this.settings.gemini.model=t);break;case"deepseek":this.settings.deepseek&&(this.settings.deepseek.model=t);break;case"siliconflow":this.settings.siliconflow&&(this.settings.siliconflow.model=t);break;case"ollama":this.settings.ollama&&(this.settings.ollama.model=t);break;case"custom":this.settings.custom&&(this.settings.custom.model=t);break}}async listModels(e){let t=e||this.currentProvider;try{return await this.registry.getService(t,this.settings).listModels()}catch(A){return console.error(`Failed to list models for ${t}:`,A),[]}}switchProvider(e){this.currentProvider=e,this.settings.provider=e}getCurrentProvider(){return this.currentProvider}getRegisteredProviders(){return this.registry.getRegisteredProviders()}processPrompt(e,t,A){let i=e,n=e.includes("{{highlight}}"),l=e.includes("{{comment}}");return n&&(i=i.replace(/\{\{highlight\}\}/g,t)),l&&A&&(i=i.replace(/\{\{comment\}\}/g,A)),!n&&t&&(i=`${i}

${t}`),i}parseProvider(e){return{openai:"openai",anthropic:"anthropic",gemini:"gemini",deepseek:"deepseek",siliconflow:"siliconflow",ollama:"ollama",custom:"custom"}[e]||"openai"}updateSettings(e){this.settings=e,this.currentProvider=this.parseProvider(e.provider),this.registry.clearCache()}};dt();ts();var Qt=require("obsidian");W();var Bt=class{static async testConnection(e,t){let A=new Qt.Notice(`\u23F3 ${p("Testing")} ${t} ${p("connection")}...`,0);try{let i=await e.testConnection();return A.hide(),i?new Qt.Notice(`\u2713 ${t} ${p("connection successful!")}`,3e3):new Qt.Notice(`\u2717 ${t} ${p("connection failed. Please check your configuration.")}`,5e3),i}catch(i){A.hide();let n=this.getErrorMessage(i);return new Qt.Notice(`\u2717 ${t} ${p("test failed")}: ${n}`,5e3),console.error(`${t} connection test error:`,i),!1}}static checkApiKey(e,t){return!e||e.trim()===""?(new Qt.Notice(`\u26A0\uFE0F ${p("Please enter your")} ${t} ${p("API Key first.")}`,4e3),!1):!0}static checkHost(e,t){return!e||e.trim()===""?(new Qt.Notice(`\u26A0\uFE0F ${p("Please enter your")} ${t} ${p("host address first.")}`,4e3),!1):!0}static getErrorMessage(e){let t=(e==null?void 0:e.message)||String(e);return t.includes("401")||t.includes("Unauthorized")?p("Invalid API Key"):t.includes("403")||t.includes("Forbidden")?p("Access denied"):t.includes("429")||t.includes("rate limit")?p("Rate limit exceeded"):t.includes("timeout")||t.includes("ETIMEDOUT")?p("Connection timeout"):t.includes("ECONNREFUSED")||t.includes("ENOTFOUND")?p("Service unavailable"):t.includes("404")||t.includes("Not Found")?p("Service not found"):t.includes("500")||t.includes("Internal Server Error")?p("Server error"):t.length>100?t.substring(0,100)+"...":t}static showSuccess(e){new Qt.Notice(`\u2713 ${e}`,3e3)}static showError(e){new Qt.Notice(`\u2717 ${e}`,5e3)}static showWarning(e){new Qt.Notice(`\u26A0\uFE0F ${e}`,4e3)}};dt();As();is();rs();ss();ns();W();var as=class{constructor(e,t,A,i){var c;this.plugin=A,this.container=e,this.contentProvider=t,this.options={...i},this.initButton();let n=(c=this.plugin.app.workspace.getLeavesOfType("hinote-view")[0])==null?void 0:c.view,l=n instanceof at?n:null;l!=null&&l.registerAIButton&&l.registerAIButton(this)}destroy(){var A;document.removeEventListener("click",this.boundClickHandler);let e=(A=this.plugin.app.workspace.getLeavesOfType("hinote-view")[0])==null?void 0:A.view,t=e instanceof at?e:null;t!=null&&t.unregisterAIButton&&t.unregisterAIButton(this)}initButton(){let e=this.container.createEl("div",{cls:"highlight-ai-container"});this.options.position&&e.addClass(`highlight-ai-container-${this.options.position}`);let t=e.createEl("div",{cls:this.options.buttonClass,attr:{"aria-label":this.options.buttonLabel}});(0,Ot.setIcon)(t,this.options.buttonIcon),t.addEventListener("click",A=>{A.stopPropagation(),this.toggleDropdown()}),this.aiButton=t}toggleDropdown(){let e=new Ot.Menu,t=Object.entries(this.plugin.settings.ai.prompts||{});t.length>0?t.forEach(([i])=>{e.addItem(n=>n.setTitle(i).onClick(async()=>{await this.handleAIAnalysis(i)}))}):e.addItem(i=>i.setTitle(p("Please add Prompt in the settings first")).setDisabled(!0));let A=this.aiButton.getBoundingClientRect();e.showAtPosition({x:A.left-92,y:A.bottom+8})}async handleAIAnalysis(e){try{this.setLoading(!0);let t=new Kt(this.plugin.settings.ai),A=this.plugin.settings.ai.prompts[e];if(!A)throw new Error(p(`Not found named "${e}" Prompt`));let i=this.contentProvider.getText(),n=this.contentProvider.getComments(),l=await t.generateResponse(A,i,n);await this.options.onResponse(l),new Ot.Notice(p("AI comments added"))}catch(t){new Ot.Notice(p(`AI comments failed: ${t.message}`))}finally{this.setLoading(!1)}}setLoading(e){e?(this.aiButton.addClass("loading"),(0,Ot.setIcon)(this.aiButton,"loader")):(this.aiButton.removeClass("loading"),(0,Ot.setIcon)(this.aiButton,this.options.buttonIcon||"bot-message-square"))}getButtonElement(){return this.aiButton}};var Sa=require("obsidian"),sA=class{constructor(e){this.STORAGE_KEY="flashcard-license";this.VAULT_ID_KEY="vault-id";this.API_URL="https://hi-note-license-server-production.up.railway.app";this.FEATURES=["flashcard"];this.VERIFICATION_INTERVAL_DAYS=7;this.licenseToken=null;this.plugin=e}async generateVaultId(){try{let e=await this.plugin.loadData()||{};if(e[this.VAULT_ID_KEY])return e[this.VAULT_ID_KEY];let t=this.plugin.app.vault.adapter,A=this.plugin.app.vault.getName();t&&"basePath"in t&&(A=t.basePath+"/"+A);let i=navigator.platform||"",n=[A,i].join("|"),c=new TextEncoder().encode(n),g=await crypto.subtle.digest("SHA-256",c),m=Array.from(new Uint8Array(g)).map(C=>C.toString(16).padStart(2,"0")).join("");return await this.saveVaultId(m),m}catch(e){let t=this.plugin.app.vault.getName(),i=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",i),c=Array.from(new Uint8Array(n)).map(g=>g.toString(16).padStart(2,"0")).join("");return await this.saveVaultId(c),c}}async saveVaultId(e){let t=await this.plugin.loadData()||{};await this.plugin.saveData({...t,[this.VAULT_ID_KEY]:e})}async activateLicense(e){try{let t=await this.generateVaultId(),A=`${this.API_URL}/api/verify`,l=(await(0,Sa.requestUrl)({url:A,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({licenseKey:e,deviceId:t})})).json;if(l.valid){let c=await this.plugin.loadData()||{};return await this.plugin.saveData({...c,[this.STORAGE_KEY]:{key:e,token:l.token,features:l.features,vaultId:t,lastVerified:Date.now()}}),this.licenseToken=l.token,!0}return!1}catch(t){let A=t instanceof Error?t.message:"Unknown error";return!1}}async isFeatureEnabled(e){var i;let t=await this.plugin.loadData(),A=t==null?void 0:t[this.STORAGE_KEY];return((i=A==null?void 0:A.features)==null?void 0:i.includes(e))||!1}async isActivated(){try{let e=await this.plugin.loadData(),t=e==null?void 0:e[this.STORAGE_KEY];return t!=null&&t.token?this.shouldVerifyLicense(t.lastVerified)?this.verifyWithServer(t):(this.licenseToken||(this.licenseToken=t.token),!0):!1}catch(e){return!1}}shouldVerifyLicense(e){return e?(Date.now()-e)/(1e3*60*60*24)>=this.VERIFICATION_INTERVAL_DAYS:!0}async verifyWithServer(e){try{let t=await this.generateVaultId(),A=e.vaultId,i=A&&A!==t,l=(await(0,Sa.requestUrl)({url:`${this.API_URL}/api/verify`,method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${e.token}`},body:JSON.stringify({licenseKey:e.key,deviceId:t,isDeviceChanged:i})})).json;if(!l)return!!this.licenseToken;if(l.valid){let c=await this.plugin.loadData()||{};return await this.plugin.saveData({...c,[this.STORAGE_KEY]:{...e,token:l.token||e.token,vaultId:t,lastVerified:Date.now()}}),this.licenseToken=l.token||e.token,!0}return!1}catch(t){return!!this.licenseToken}}};W();var Vi=class{constructor(e,t,A){this.selectionManager=null;this.onHighlightClick=null;this.onCommentAdd=null;this.onCommentEdit=null;this.onExport=null;this.onAIResponse=null;this.currentFile=null;this.isDraggedToMainView=!1;this.highlightsWithFlashcards=new Set;this.currentBatch=0;this.container=e,this.plugin=t,this.searchInput=A}setCallbacks(e){e.onHighlightClick&&(this.onHighlightClick=e.onHighlightClick),e.onCommentAdd&&(this.onCommentAdd=e.onCommentAdd),e.onCommentEdit&&(this.onCommentEdit=e.onCommentEdit),e.onExport&&(this.onExport=e.onExport),e.onAIResponse&&(this.onAIResponse=e.onAIResponse)}updateState(e){e.currentFile!==void 0&&(this.currentFile=e.currentFile),e.isDraggedToMainView!==void 0&&(this.isDraggedToMainView=e.isDraggedToMainView),e.highlightsWithFlashcards!==void 0&&(this.highlightsWithFlashcards=e.highlightsWithFlashcards),e.currentBatch!==void 0&&(this.currentBatch=e.currentBatch)}renderHighlights(e,t=!1,A){if(A&&(this.selectionManager=A),t||(typeof Ee.clearAllInstances=="function"&&Ee.clearAllInstances(),this.container.empty(),this.currentBatch=0,this.selectionManager&&this.selectionManager.clearSelection()),e.length===0){this.renderEmptyState();return}this.selectionManager&&!t&&this.selectionManager.initialize();let i=this.container.querySelector(".highlight-list");i||(i=this.container.createEl("div",{cls:"highlight-list"})),e.forEach(n=>{this.renderHighlightCard(i,n)})}renderHighlightCard(e,t){var n;this.currentFile&&!t.filePath&&(t.filePath=this.currentFile.path);let A=new Ee(e,t,this.plugin,{onHighlightClick:async l=>{this.onHighlightClick&&await this.onHighlightClick(l)},onCommentAdd:l=>{this.onCommentAdd&&this.onCommentAdd(A.getElement(),l)},onExport:l=>{this.onExport&&this.onExport(l)},onCommentEdit:(l,c)=>{this.onCommentEdit&&this.onCommentEdit(A.getElement(),l,c)},onAIResponse:async l=>{this.onAIResponse&&await this.onAIResponse(t,l)}},this.isDraggedToMainView,this.currentFile===null?t.fileName:this.currentFile.basename,(n=this.selectionManager)!=null?n:void 0);t.id&&this.highlightsWithFlashcards.has(t.id)&&setTimeout(()=>{t.id&&Ee.updateCardUIByHighlightId(t.id)},0);let i=A.getElement();if(this.isDraggedToMainView){i.classList.add("in-main-view");let l=i.querySelector(".highlight-text-content");l&&l.removeAttribute("title")}else i.classList.remove("in-main-view")}renderEmptyState(){let e=this.searchInput&&this.searchInput.value.trim()!=="";this.container.createEl("div",{cls:"highlight-empty-state",text:e?p("No matching highlights found for your search."):p("The current document has no highlighted content.")})}clear(){typeof Ee.clearAllInstances=="function"&&Ee.clearAllInstances(),this.container.empty()}getCurrentBatch(){return this.currentBatch}setCurrentBatch(e){this.currentBatch=e}};var os=require("obsidian");W();var _i=class{constructor(e){this.highlightManager=e;this.addCommentButton=null}createFileCommentButton(e,t){return this.addCommentButton=e.createEl("div",{cls:"highlight-icon-button"}),(0,os.setIcon)(this.addCommentButton,"message-square-plus"),this.addCommentButton.setAttribute("aria-label",p("Add File Comment")),this.addCommentButton.addEventListener("click",async()=>{await this.handleAddFileComment(t)}),this.addCommentButton}async handleAddFileComment(e){let t=e.getCurrentFile();if(!t){new os.Notice(p("Please open a file first."));return}let A=Date.now(),n={id:`file-comment-${A}`,text:p("File Comment"),filePath:t.path,isVirtual:!0,position:0,paragraphOffset:0,blockId:`virtual-${A}`,createdAt:A,updatedAt:A,comments:[]};await this.highlightManager.addHighlight(t,n),e.onVirtualHighlightCreated(n),setTimeout(()=>{let l=e.getHighlightContainer(),c=l.querySelector(".highlight-card");c&&(e.onShowCommentInput(c,n),l.scrollTo({top:0,behavior:"smooth"}))},100)}async filterVirtualHighlights(e,t){let A=await this.highlightManager.getFileHighlights(e),i=new Set;t.forEach(c=>{c.id&&i.add(c.id)});let l=A.filter(c=>c.isVirtual&&c.comments&&c.comments.length>0&&c.id&&!i.has(c.id)).filter(c=>!t.some(g=>g.text===c.text));return l.forEach(c=>{c.id&&i.add(c.id)}),l}destroy(){this.addCommentButton&&(this.addCommentButton.remove(),this.addCommentButton=null)}};var ut=require("obsidian");W();var Wi=class{constructor(e){this.plugin=e}checkHasFlashcard(e){let t=this.plugin.fsrsManager;if(!t||!e)return!1;let A=t.findCardsBySourceId(e,"highlight");return A&&A.length>0}async createFlashcard(e,t,A=!1){try{let i=this.plugin.fsrsManager;if(!i)return A||new ut.Notice(p("FSRS \u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316")),!1;if(!e.id){console.warn("\u9AD8\u4EAE\u7F3A\u5C11 ID\uFF0C\u6B63\u5728\u751F\u6210...");let d=(await Promise.resolve().then(()=>(CA(),oc))).IdGenerator;e.id=d.generateHighlightId(e.filePath||"",e.position||0,e.text)}if(e.filePath){let d=this.plugin.app.vault.getAbstractFileByPath(e.filePath);if(d instanceof ut.TFile){let m={id:e.id,text:e.text,position:e.position||0,paragraphOffset:e.paragraphOffset,blockId:e.blockId,comments:e.comments||[],createdAt:e.createdAt||Date.now(),updatedAt:e.updatedAt||Date.now(),filePath:e.filePath,fileName:e.fileName,fileIcon:e.fileIcon,backgroundColor:e.backgroundColor,originalLength:e.originalLength,isVirtual:e.isVirtual,isCloze:e.isCloze};await this.plugin.highlightManager.addHighlight(d,m)}}let n=e.text,l="",c=[];if(e.filePath){let d=t||e.filePath.split("/").pop()||e.filePath;c.push(`From: [[${d}]]`)}return e.comments&&e.comments.length>0&&c.push(e.comments.map(d=>d.content||"").join(`
`)),l=c.length>0?c.join(`

`):p("Add answer"),i.addCard(n,l,e.filePath||t,e.id,"highlight")?(this.plugin.eventManager.emitFlashcardChanged(),A||new ut.Notice(p("Flashcard created successfully!")),!0):(A||new ut.Notice(p("Failed to create flashcard, please check highlight content")),!1)}catch(i){return console.error("\u521B\u5EFA\u95EA\u5361\u65F6\u51FA\u9519:",i),A||new ut.Notice(p(`Failed to create flashcard: ${i.message}`)),!1}}async deleteFlashcard(e,t=!1){try{let A=this.plugin.fsrsManager;if(!A)return t||new ut.Notice(p("FSRS \u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316")),{success:!1,shouldDeleteHighlight:!1};if(A.deleteCardsBySourceId(e.id||"","highlight")>0){A.cleanupInvalidCardReferences();let l=!(e.comments&&e.comments.length>0);return t||(l?new ut.Notice(p("Flashcard and highlight deleted")):new ut.Notice(p("Flashcard deleted, highlight and comments preserved"))),t||this.plugin.eventManager.emitFlashcardChanged(),{success:!0,shouldDeleteHighlight:l}}else return t||new ut.Notice(p("Flashcard not found")),{success:!1,shouldDeleteHighlight:!1}}catch(A){return console.error("\u5220\u9664\u95EA\u5361\u65F6\u51FA\u9519:",A),t||new ut.Notice(p(`Failed to delete flashcard: ${A.message}`)),{success:!1,shouldDeleteHighlight:!1}}}};var wA=require("obsidian");var Xi=class{static escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}static removeHighlightFormat(e,t,A){let i=this.escapeRegExp(t),n=e,l=!1,c=new RegExp(`==\\s*(${i})\\s*==`,"g"),g=n.replace(c,t);if(g!==n&&(n=g,l=!0),!l){let d=new RegExp(`<mark[^>]*>(${i})</mark>`,"g"),m=n.replace(d,t);m!==n&&(n=m,l=!0)}if(!l){let d=new RegExp(`<span[^>]*>(${i})</span>`,"g"),m=n.replace(d,t);m!==n&&(n=m,l=!0)}if(!l&&A)try{let d=new RegExp(A,"g"),m=n.replace(d,(C,...F)=>{for(let y of F)if(typeof y=="string"&&y.includes(t))return t;return C});m!==n&&(n=m,l=!0)}catch(d){console.error("\u81EA\u5B9A\u4E49\u6B63\u5219\u8868\u8FBE\u5F0F\u9519\u8BEF:",d)}return n}static removeHighlightFormatInRange(e,t,A,i,n){let l=Math.max(0,A-100),c=Math.min(e.length,i+100),g=e.substring(l,c),d=this.removeHighlightFormat(g,t,n);return d!==g?e.substring(0,l)+d+e.substring(c):e}static getCommonHighlightPatterns(e){let t=this.escapeRegExp(e);return[new RegExp(`==\\s*(${t})\\s*==`,"g"),new RegExp(`<mark[^>]*>(${t})</mark>`,"g"),new RegExp(`<span[^>]*>(${t})</span>`,"g")]}};W();var Ji=class{constructor(e){this.plugin=e}async deleteHighlight(e,t=!1,A=!1){try{if(!t&&!confirm(p("Delete this highlight and all its data, including Comments and HiCards? Can't undo.")))return!1;if(e.filePath){await this.removeHighlightFromFile(e);let i=this.plugin.app.vault.getAbstractFileByPath(e.filePath);i instanceof wA.TFile&&await this.plugin.highlightManager.removeHighlight(i,e),this.plugin.eventManager.emitHighlightDelete(e.filePath,e.text||"",e.id||"")}return A||new wA.Notice(p("Highlight deleted successfully")),!0}catch(i){return console.error("\u5220\u9664\u9AD8\u4EAE\u65F6\u51FA\u9519:",i),A||new wA.Notice(p(`Failed to delete highlight: ${i.message}`)),!1}}async removeHighlightFromFile(e){var n;if(!e.filePath)return;let t=this.plugin.app.vault.getAbstractFileByPath(e.filePath);if(!(t instanceof wA.TFile))return;let A=e.text,i=(n=this.plugin.settings)==null?void 0:n.customHighlightRegex;await this.plugin.app.vault.process(t,l=>{if(typeof e.position=="number"){let c=e.position+(e.originalLength||A.length);return Xi.removeHighlightFormatInRange(l,A,e.position,c,i)}else return Xi.removeHighlightFormat(l,A,i)})}async deleteHighlightCompletely(e){try{if(e.filePath){let t=this.plugin.app.vault.getAbstractFileByPath(e.filePath);t instanceof wA.TFile&&(await this.plugin.highlightManager.removeHighlight(t,e),this.plugin.eventManager.emitHighlightDelete(e.filePath,e.text||"",e.id||""))}}catch(t){throw console.error("\u5B8C\u5168\u5220\u9664\u9AD8\u4EAE\u65F6\u51FA\u9519:",t),t}}};var ls=require("obsidian"),vA=class{static updateCardIcons(e,t){let A=e.querySelectorAll(".highlight-card-icon"),i=t?this.ICONS.FLASHCARD:this.ICONS.FILE;A.forEach(n=>{(0,ls.setIcon)(n,i),t?n.addClass("has-flashcard"):n.removeClass("has-flashcard")})}static setFileIcon(e,t){let A=t?this.ICONS.FLASHCARD:this.ICONS.FILE;(0,ls.setIcon)(e,A),t?e.addClass("has-flashcard"):e.removeClass("has-flashcard")}static setHighlightIcon(e,t){let A=t?this.ICONS.FLASHCARD:this.ICONS.HIGHLIGHT;(0,ls.setIcon)(e,A),t?e.addClass("has-flashcard"):e.removeClass("has-flashcard")}static getIconName(e){switch(e){case"flashcard":return this.ICONS.FLASHCARD;case"file":return this.ICONS.FILE;case"highlight":return this.ICONS.HIGHLIGHT;case"message":return this.ICONS.MESSAGE;default:return this.ICONS.FILE}}};vA.ICONS={FLASHCARD:"book-heart",FILE:"file-text",HIGHLIGHT:"highlighter",MESSAGE:"message-circle"};var ue=class ue{constructor(e,t,A,i,n=!1,l,c){this.container=e;this.highlight=t;this.plugin=A;this.options=i;this.isInMainView=n;this.selectionManager=c;this.isEditing=!1;this.aiButtonInstance=null;this.moreActionsDropdown=null;this.unfocusedInput=null;this.hasFlashcard=!1;this.isShowingRealInput=!1;var g;this.fileName=l,this.highlight=t,this.plugin=A,this.options=i,this.fileName=(g=this.highlight.filePath)==null?void 0:g.split("/").pop(),this.flashcardManager=new Wi(A),this.deletionManager=new Ji(A),ue.cardInstances.add(this),this.setupCommentInputEventListeners(),this.render()}static clearAllInstances(){ue.cardInstances.forEach(e=>{typeof e.destroy=="function"&&e.destroy()}),ue.cardInstances.clear()}static findCardInstanceByHighlightId(e){for(let t of ue.cardInstances)if(t.highlight.id&&t.highlight.id===e)return t;return null}static updateCardUIByHighlightId(e){let t=ue.findCardInstanceByHighlightId(e);t&&t.updateIconsAfterCardCreation()}static clearAllUnfocusedInputs(){ue.cardInstances.forEach(e=>{e.unfocusedInput&&(e.unfocusedInput.remove(),e.unfocusedInput=null)})}setupCommentInputEventListeners(){let e=A=>{var i;((i=A.detail)==null?void 0:i.highlightId)===this.highlight.id&&(this.isShowingRealInput=!0,this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null))},t=A=>{var i;((i=A.detail)==null?void 0:i.highlightId)===this.highlight.id&&(this.isShowingRealInput=!1)};document.addEventListener("comment-input-shown",e),document.addEventListener("comment-input-closed",t),this.plugin.register(()=>{document.removeEventListener("comment-input-shown",e),document.removeEventListener("comment-input-closed",t)})}render(){this.card=this.container.createEl("div",{cls:`highlight-card ${this.highlight.isVirtual?"virtual-highlight-card":""}`,attr:{"data-highlight":JSON.stringify(this.highlight)}}),this.card.addEventListener("click",c=>{if(this.isEditing||this.isShowingRealInput)return;let g=c.target;g.closest(".hi-note-input")||g.closest(".hi-note-actions-hint")||this.selectCard(c)});let e=this.card.createEl("div",{cls:"highlight-card-title-bar"}),t=e.createEl("div",{cls:"highlight-card-title-left"}),A=e.createEl("div",{cls:"highlight-card-title-right"});if((this.isInMainView||this.highlight.isGlobalSearch)&&this.fileName){let c=t.createEl("div",{cls:"highlight-card-icon",attr:{"aria-label":p("Open (DoubleClick)")}});this.checkHasFlashcard()?((0,fe.setIcon)(c,"book-heart"),c.addClass("has-flashcard")):(0,fe.setIcon)(c,"file-text"),c.addEventListener("dblclick",async C=>{C.stopPropagation();let F=this.highlight.filePath||this.fileName;if(!F)return;let y=this.plugin.app.vault.getAbstractFileByPath(F);if(!y||!(y instanceof fe.TFile))return;let Q=this.plugin.app.workspace.getLeavesOfType("markdown"),U=this.plugin.app.workspace.activeLeaf,b=Q.find(P=>P!==U);if(b||(b=this.plugin.app.workspace.getLeaf("split","vertical")),await b.openFile(y),this.highlight.position!==void 0){let P=b.view;if(P.getViewType()==="markdown"){let q=P.getViewType()==="markdown"?P.editor:null;if(q){let k=q.offsetToPos(this.highlight.position);q.setCursor(k),q.scrollIntoView({from:k,to:k},!0)}}}});let d=this.fileName?this.fileName.replace(/\.md$/,""):"",m=t.createEl("span",{text:d,cls:"highlight-card-title-text"});this.setupDragFunctionality(t),this.addPagePreview(m,this.highlight.filePath||this.fileName)}else{let c=t.createEl("div",{cls:"highlight-card-icon"});if(this.checkHasFlashcard()?((0,fe.setIcon)(c,"book-heart"),c.addClass("has-flashcard")):(0,fe.setIcon)(c,"highlighter"),this.highlight.filePath&&typeof this.highlight.position=="number"){let d=this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath);if(d instanceof fe.TFile&&!this.highlight.isGlobalSearch){let m=this.plugin.app.workspace.getLeavesOfType("markdown").find(C=>{let F=C.view;return F instanceof fe.MarkdownView&&F.file&&F.file.path===d.path});if(m){let C=m.view;if(C.editor){let y=C.editor.offsetToPos(this.highlight.position).line+1;t.createEl("div",{cls:"highlight-line-number-badge"}).createEl("span",{text:`L${y}`,cls:"highlight-line-number"})}}}}this.setupDragFunctionality(t)}this.aiButtonInstance=new as(A,{getText:()=>this.highlight.text,getComments:()=>(this.highlight.comments||[]).map(c=>c.content||"").join(`
`)},this.plugin,{onResponse:async c=>{await this.options.onAIResponse(c)},buttonClass:"highlight-title-btn highlight-ai-btn",buttonIcon:"sparkles",buttonLabel:p("AI comment"),position:"titlebar"});let n=A.createEl("div",{cls:"highlight-more-actions-container"}).createEl("div",{cls:"highlight-title-btn highlight-more-btn",attr:{"aria-label":p("More")}});(0,fe.setIcon)(n,"ellipsis-vertical"),n.addEventListener("click",c=>{c.stopPropagation(),this.toggleMoreActionsDropdown(n)}),this.isInMainView&&this.fileName&&this.highlight&&this.highlight.filePath&&typeof this.highlight.position=="number"&&this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath)instanceof fe.TFile&&this.generateDragContent().catch(g=>{console.error("[HighlightCard] Error pre-generating block ID:",g)});let l=this.card.createEl("div",{cls:"highlight-content"});new Ui(l,this.highlight,this.options.onHighlightClick,this.plugin.app,this.isInMainView),new Mi(this.card,this.highlight,c=>{this.isEditing=!0,this.selectCard(),this.options.onCommentEdit(this.highlight,c)})}showUnfocusedCommentInput(){if(this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.isEditing||this.isShowingRealInput)return;let e=this.card.querySelector(".highlight-content");e&&(this.unfocusedInput=new es(e,this.highlight,()=>{this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.options.onCommentAdd(this.highlight)}))}static findCardInstanceByElement(e){for(let t of ue.cardInstances)if(t.card===e||t.card.contains(e))return t;return null}showCommentInput(){ue.clearAllUnfocusedInputs(),this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.options.onCommentAdd(this.highlight)}selectCard(e){if(ue.clearAllUnfocusedInputs(),!this.selectionManager){console.error("[HighlightCard] SelectionManager \u672A\u4F20\u5165\uFF0C\u65E0\u6CD5\u8FDB\u884C\u9009\u62E9\u64CD\u4F5C");return}e&&e.shiftKey?this.selectionManager.isCardSelected(this.card)?this.selectionManager.unselectCard(this.card):this.selectionManager.selectCard(this.card,this.highlight):(this.selectionManager.clearSelection(),this.selectionManager.selectCard(this.card,this.highlight),this.showUnfocusedCommentInput())}getElement(){return this.card}addPagePreview(e,t){if(!t)return;let A=this.plugin.app.vault.getAbstractFileByPath(t);if(!(A instanceof fe.TFile))return;let i;e.addEventListener("mouseenter",n=>{i=setTimeout(async()=>{let l=n.target;this.plugin.app.workspace.trigger("hover-link",{event:n,source:"hi-note",hoverParent:l,targetEl:l,linktext:A.path})},300)}),e.addEventListener("mouseleave",()=>{i&&clearTimeout(i)})}update(e){this.highlight=e,this.isEditing=!1,this.card.empty(),this.render()}generateDragContentSync(){return new Li(this.highlight,this.plugin).generateSync()}async generateDragContent(){return new Li(this.highlight,this.plugin).generate()}setupDragFunctionality(e){e.setAttribute("draggable","true"),this.highlight&&this.highlight.filePath&&typeof this.highlight.position=="number"&&this.plugin.app.vault.getAbstractFileByPath(this.highlight.filePath)instanceof fe.TFile&&this.generateDragContent().catch(A=>{console.error("[HighlightCard] Error pre-generating block ID:",A)}),e.addEventListener("dragstart",async t=>{var A,i;try{if(!this.highlight||!this.highlight.text)throw new Error("Invalid highlight data");let n;try{let c=new Promise((g,d)=>{setTimeout(()=>d(new Error("Block ID generation timeout")),300)});n=await Promise.race([this.generateDragContent(),c])}catch(c){console.debug("[HighlightCard] Using sync fallback for drag content:",c),n=this.generateDragContentSync()}(A=t.dataTransfer)==null||A.setData("text/plain",n);let l=JSON.stringify(this.highlight);(i=t.dataTransfer)==null||i.setData("application/highlight",l),e.addClass("dragging"),xi.start(t,this.highlight.text)}catch(n){console.error("[HighlightCard] Error during drag start:",n),t.preventDefault(),t.stopPropagation()}}),e.addEventListener("dragend",()=>{e.removeClass("dragging"),xi.clear()})}copyHighlightContent(){try{let e=`> [!quote] HiNote
`;if(e+=`> ${this.highlight.text}`,this.highlight.filePath){let t=this.fileName||this.highlight.filePath.split("/").pop()||this.highlight.filePath;e+=`
> 
`,e+=`> From: [[${t}]]`}e+=`

`,navigator.clipboard.writeText(e).then(()=>{new fe.Notice("Copied")}).catch(t=>{console.error("\u590D\u5236\u5185\u5BB9\u5931\u8D25:",t),new fe.Notice("Failed to copy content")})}catch(e){console.error("\u590D\u5236\u9AD8\u4EAE\u5185\u5BB9\u65F6\u51FA\u9519:",e),new fe.Notice("Failed to copy content")}}handleExportAsImage(){this.options.onExport(this.highlight)}toggleMoreActionsDropdown(e){let t=new fe.Menu;this.hasFlashcard=this.checkHasFlashcard(),t.addItem(i=>i.setTitle(this.hasFlashcard?p("Delete HiCard"):p("Create HiCard")).onClick(()=>this.handleCreateHiCard())),t.addItem(i=>i.setTitle(p("Copy Highlight")).onClick(()=>this.copyHighlightContent())),t.addItem(i=>i.setTitle(p("Export as Image")).onClick(()=>this.handleExportAsImage())),t.addItem(i=>i.setTitle(p("Delete")).onClick(()=>this.handleDeleteHighlight()));let A=e.getBoundingClientRect();t.showAtPosition({x:A.left-100,y:A.bottom+8})}hasVisibleMoreDropdown(){return ue.visibleDropdowns.size>0}static addVisibleDropdown(e){ue.isGlobalListenerAdded||(document.addEventListener("click",ue.handleDocumentClick,!0),ue.isGlobalListenerAdded=!0),ue.visibleDropdowns.add(e)}static removeVisibleDropdown(e){ue.visibleDropdowns.delete(e)}checkHasFlashcard(){return this.flashcardManager.checkHasFlashcard(this.highlight.id||"")}async handleCreateHiCard(){try{let e=new sA(this.plugin),t=await e.isActivated(),A=t?await e.isFeatureEnabled("flashcard"):!1;if(!t||!A){new fe.Notice(p("Only HiNote Pro"));return}if(!this.plugin.fsrsManager){new fe.Notice(p("FSRS \u7BA1\u7406\u5668\u672A\u521D\u59CB\u5316"));return}let n=this.checkHasFlashcard();this.hasFlashcard=n,n?await this.handleDeleteHiCard():await this.handleCreateNewHiCard()}catch(e){console.error("\u5904\u7406\u95EA\u5361\u64CD\u4F5C\u65F6\u51FA\u9519:",e),new fe.Notice(p(`\u64CD\u4F5C\u5931\u8D25: ${e.message}`))}}async deleteHiCardForHighlight(e=!1){let t=await this.flashcardManager.deleteFlashcard(this.highlight,e);return t.success&&(this.hasFlashcard=!1,this.updateIconsAfterCardDeletion(),t.shouldDeleteHighlight&&!e&&await this.deletionManager.deleteHighlightCompletely(this.highlight)),t.success}async handleDeleteHiCard(e=!1){await this.deleteHiCardForHighlight(e)}async deleteHighlightCompletely(){await this.deletionManager.deleteHighlightCompletely(this.highlight)}async createHiCardForHighlight(e=!1){let t=await this.flashcardManager.createFlashcard(this.highlight,this.fileName,e);return t&&(this.hasFlashcard=!0,this.updateIconsAfterCardCreation()),t}async handleCreateNewHiCard(e=!1){await this.createHiCardForHighlight(e)}updateIconsAfterCardDeletion(){vA.updateCardIcons(this.card,!1)}updateIconsAfterCardCreation(){vA.updateCardIcons(this.card,!0)}updateCreateHiCardButtonText(){let e=this.card.querySelector(".create-hicard-btn");e&&(e.textContent=this.hasFlashcard?p("Delete HiCard"):p("Create HiCard"))}async handleDeleteHighlight(e=!1,t=!1){try{this.hasFlashcard&&await this.handleDeleteHiCard(!0),await this.deletionManager.deleteHighlight(this.highlight,e,t)&&(this.card.remove(),ue.cardInstances.delete(this))}catch(A){console.error("\u5220\u9664\u9AD8\u4EAE\u65F6\u51FA\u9519:",A),new fe.Notice(p(`\u5220\u9664\u9AD8\u4EAE\u5931\u8D25: ${A.message}`))}}updateComments(e){this.highlight=e,this.isEditing=!1;let t=this.card.querySelector(".hi-notes-section");t&&t.remove(),this.highlight.comments&&this.highlight.comments.length>0&&new Mi(this.card,this.highlight,A=>{this.isEditing=!0,this.selectCard(),this.options.onCommentEdit(this.highlight,A)})}destroy(){this.unfocusedInput&&(this.unfocusedInput.remove(),this.unfocusedInput=null),this.moreActionsDropdown&&(this.moreActionsDropdown.remove(),this.moreActionsDropdown=null),ue.cardInstances.delete(this)}};window.HighlightCard={findCardInstanceByHighlightId:ue.findCardInstanceByHighlightId},ue.cardInstances=new Set,ue.visibleDropdowns=new Set,ue.isGlobalListenerAdded=!1,ue.handleDocumentClick=e=>{for(let t of ue.visibleDropdowns){let A=t.closest(".highlight-card");A&&!A.contains(e.target)&&!t.contains(e.target)&&(t.classList.add("hi-note-hidden"),ue.visibleDropdowns.delete(t))}};var Ee=ue;var cs=require("obsidian"),hs=class{constructor(e){this.app=e}async jumpToHighlight(e,t){let A=await this.openOrActivateFile(t);A&&await this.locateAndHighlightText(A,e.text,e.position)}async openOrActivateFile(e){let A=this.app.workspace.getLeavesOfType("markdown").find(i=>{var l;return((l=i.view.file)==null?void 0:l.path)===e});if(!A)try{let i=this.app.vault.getAbstractFileByPath(e);if(!i)return new cs.Notice("\u672A\u627E\u5230\u6587\u4EF6"),null;A=await this.app.workspace.getLeaf("tab"),await A.openFile(i)}catch(i){return new cs.Notice("\u6253\u5F00\u6587\u4EF6\u5931\u8D25"),null}return await this.app.workspace.setActiveLeaf(A,{focus:!1}),A}async locateAndHighlightText(e,t,A){await new Promise(U=>setTimeout(U,300));let i=e.view,n=i.editor,l=n.getValue(),c=-1,g=[],d=t,m=0,C=-1;for(;(C=l.indexOf(t,m))!==-1;)g.push(C),m=C+1;if(A!==void 0&&A>=0){if(l.substring(A,A+t.length)===t)c=A;else if(g.length>0){let U=g[0],b=Math.abs(A-U);for(let P of g){let q=Math.abs(A-P);q<b&&(b=q,U=P)}c=U}}if(c===-1)if(g.length>0)c=g[0];else{new cs.Notice("\u672A\u627E\u5230\u9AD8\u4EAE\u5185\u5BB9");return}let F=n.offsetToPos(c),y=n.offsetToPos(c+d.length);i.getMode()==="preview"?e.setEphemeralState({line:F.line,startLoc:{line:F.line,col:F.ch},endLoc:{line:y.line,col:y.ch},scroll:F.line}):(n.setSelection(F,y),n.scrollIntoView({from:F,to:y},!0),this.app.workspace.setActiveLeaf(e,{focus:!0}))}};var cc=require("obsidian");W();var gs=class{static shouldExclude(e,t){if(!t||t.trim().length===0)return!1;let A=t.split(",").map(l=>l.trim()).filter(l=>l.length>0),i=e.path,n=e.basename;return A.some(l=>{if(l=l.trim(),!l)return!1;if(l.startsWith("[[")&&l.endsWith("]]")){let d=l.slice(2,-2);return n===d}if(l.startsWith("*.")){let d=l.slice(2);return e.extension===d||i.endsWith(d)}let c=l.replace(/^\/+/,""),g=i.replace(/^\/+/,"");return g.startsWith(c+"/")||g===c})}};var kt=class kt{constructor(e){this.app=e}getOrCreateBlockId(e,t){let A=e.getLine(t),i=A.match(kt.BLOCK_ID_REGEX);if(i)return i[1];let n="";for(let c=0;c<7;c++)n+=kt.BLOCK_ID_CHARS.charAt(Math.floor(Math.random()*kt.BLOCK_ID_CHARS.length));let l=A.trimEnd();return e.setLine(t,`${l} ^${n}`),n}extractBlockId(e){let t=e.match(kt.BLOCK_ID_REGEX);return t?t[1]:void 0}getParagraphBlockId(e,t){let A=this.app.metadataCache.getFileCache(e);if(!(A!=null&&A.sections))return;let i=A.sections.find(n=>n.position.start.offset<=t&&n.position.end.offset>=t);return i!=null&&i.id?`${e.path}#^${i.id}`:void 0}async createParagraphBlockId(e,t,A){let i=this.getParagraphBlockId(e,t);if(i)return i;let n=this.app.workspace.getLeaf();await n.openFile(e,{active:!1});let c=n.view.editor,d=c.offsetToPos(t).line,m=this.app.metadataCache.getFileCache(e);if(m!=null&&m.sections){let F=A||t,y=m.sections.find(Q=>Q.position.start.offset<=F&&Q.position.end.offset>=F);y&&(d=c.offsetToPos(y.position.end.offset).line,console.debug(`[BlockIdService] \u627E\u5230\u5305\u542B\u9AD8\u4EAE\u7684\u6BB5\u843D\uFF0C\u7ED3\u675F\u884C: ${d}`))}let C=this.getOrCreateBlockId(c,d);return await this.app.vault.modify(e,c.getValue()),`${e.path}#^${C}`}hasValidBlockId(e){return kt.BLOCK_ID_REGEX.test(e)}};kt.BLOCK_ID_REGEX=/\^([a-zA-Z0-9-]+)$/,kt.BLOCK_ID_CHARS="abcdefghijklmnopqrstuvwxyz0123456789";var ds=kt;var XA=class XA{constructor(e){this.app=e;this.contentCache=new Map;let t=e.plugins,A=t&&t.plugins?t.plugins["hi-note"]:void 0;this.settings=A==null?void 0:A.settings,this.blockIdService=new ds(e)}shouldProcessFile(e){var t;return e.extension!=="md"?!1:!gs.shouldExclude(e,((t=this.settings)==null?void 0:t.excludePatterns)||"")}extractHighlights(e,t){var i;let A=[];if(this.settings.useCustomPattern&&((i=this.settings.regexRules)==null?void 0:i.length)>0)for(let n of this.settings.regexRules.filter(l=>l.enabled))try{let l=new RegExp(n.pattern,"g");this.processRegexMatches(e,l,A,t,n.color)}catch(l){}else this.processRegexMatches(e,XA.DEFAULT_HIGHLIGHT_PATTERN,A,t,"#ffeb3b");return A.sort((n,l)=>{var c,g;return((c=n.position)!=null?c:0)-((g=l.position)!=null?g:0)})}processRegexMatches(e,t,A,i,n){let l=[];if(i){let d=this.app.metadataCache.getFileCache(i);d!=null&&d.sections&&(l=d.sections.filter(C=>["code","codeblock","fenced_code","pre"].includes(C.type)).map(C=>[C.position.start.offset,C.position.end.offset]))}function c(d,m,C){return C.some(([F,y])=>Math.max(d,F)<Math.min(m,y))}let g;for(;(g=t.exec(e))!==null;){let d=g,m=d[0],C=d.index,F=C+m.length;if(c(C,F,l))continue;if(m.startsWith("==")&&m.endsWith("==")){let b=C>0?e.charAt(C-1):"",P=F<e.length?e.charAt(F):"";if(b==="="||P==="=")continue}let y=d.slice(1).find(b=>b!==void 0);y||(y=m);let Q=null;if(m.includes("style=")&&(Q=this.extractColorFromElement(m)),!A.some(b=>typeof b.position=="number"&&Math.abs(b.position-d.index)<XA.DUPLICATE_POSITION_THRESHOLD&&b.text===y)&&y){let b=/\{\{([^{}]+)\}\}/.test(y),P={text:y,position:d.index,backgroundColor:Q||n,isCloze:b,filePath:i.path,originalLength:m.length};A.push(P)}}}getParagraphOffset(e,t){let A=e.substring(0,t),i=A.split(/\n\s*\n/);return A.length-i[i.length-1].length}async getFilesWithHighlights(){let e=this.app.vault.getMarkdownFiles(),t=[],A=0;for(let i of e){if(!this.shouldProcessFile(i))continue;let n=await this.getCachedFileContent(i),l=this.extractHighlights(n,i);l.length>0&&(t.push(i),A+=l.length)}return t}async getAllHighlights(){let e=this.app.vault.getMarkdownFiles(),t=[];for(let A of e){if(!this.shouldProcessFile(A))continue;let i=await this.getCachedFileContent(A),n=this.extractHighlights(i,A);n.length>0&&t.push({file:A,highlights:n})}return t}async createBlockIdForHighlight(e,t,A){try{let i=this.blockIdService.getParagraphBlockId(e,t);if(i)return i;let n=A?t+A:t;return await this.blockIdService.createParagraphBlockId(e,t,n)}catch(i){throw i}}extractColorFromElement(e){let t=e.match(/style=["']([^"']*)["']/);if(!t)return null;let A=t[1].match(/background(?:-color)?:\s*((?:rgba?\(.*?\)|#[0-9a-fA-F]{3,8}|var\(--[^)]+\)))/);return A?A[1]:null}async getCachedFileContent(e){let t=this.contentCache.get(e.path);if(t&&t.mtime===e.stat.mtime)return t.content;let A=await this.app.vault.read(e);return this.contentCache.set(e.path,{content:A,mtime:e.stat.mtime}),A}invalidateContentCache(e){this.contentCache.delete(e)}clearContentCache(){this.contentCache.clear()}escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}};XA.DUPLICATE_POSITION_THRESHOLD=10,XA.DEFAULT_HIGHLIGHT_PATTERN=/==([^=\n](?:[^=\n]|=[^=\n])*?[^=\n])==|<mark[^>]*>([\s\S]*?)<\/mark>|<span[^>]*>([\s\S]*?)<\/span>/g;var us=XA;var ps=class{constructor(e){this.app=e}findMatchingHighlight(e,t,A){var l,c;let i=A.getCachedHighlights(e.path)||[];if(!i||i.length===0)return null;let n=i.find(g=>g.text!==t.text?!1:typeof g.position=="number"&&typeof t.position=="number"?Math.abs(g.position-t.position)<10:!1);if(n)return n;if(t.text&&t.position!==void 0){let g=i.filter(d=>d.text===t.text&&typeof d.position=="number").sort((d,m)=>{var C,F,y,Q;return Math.abs(((C=d.position)!=null?C:0)-((F=t.position)!=null?F:0))-Math.abs(((y=m.position)!=null?y:0)-((Q=t.position)!=null?Q:0))});if(g.length>0&&Math.abs(((l=g[0].position)!=null?l:0)-((c=t.position)!=null?c:0))<500)return g[0]}if(t.text){let g=i.filter(d=>d.text===t.text);if(g.length===1)return g[0]}return t.position!==void 0&&(n=i.find(g=>typeof g.position=="number"&&Math.abs(g.position-t.position)<50),n)?n:null}mergeHighlightsWithComments(e,t,A){if(t.length===0)return e.map(C=>this.createHighlightInfo(C,A));let i=new Map,n=new Map,l=new Map;for(let C of t)if(C.id&&i.set(C.id,C),C.text&&(n.has(C.text)||n.set(C.text,[]),n.get(C.text).push(C)),C.position!==void 0){let F=Math.floor(C.position/50);l.has(F)||l.set(F,[]),l.get(F).push(C)}let c=new Set,g=[],d=e.map(C=>{var F,y;if(C.id&&i.has(C.id)){let Q=i.get(C.id);if(Q.id&&!c.has(Q.id))return c.add(Q.id),this.trackPositionUpdate(g,Q,C),this.createMergedHighlight(C,Q,A)}if(C.text&&n.has(C.text)){let U=n.get(C.text).filter(b=>b.id&&!c.has(b.id)&&C.position!==void 0&&b.position!==void 0).sort((b,P)=>{var q,k,N,G;return Math.abs(((q=b.position)!=null?q:0)-((k=C.position)!=null?k:0))-Math.abs(((N=P.position)!=null?N:0)-((G=C.position)!=null?G:0))});for(let b of U)if(Math.abs(((F=b.position)!=null?F:0)-((y=C.position)!=null?y:0))<500)return c.add(b.id),this.trackPositionUpdate(g,b,C),this.createMergedHighlight(C,b,A)}if(C.text&&n.has(C.text)){let Q=n.get(C.text).filter(U=>U.id&&!c.has(U.id));if(Q.length===1)return c.add(Q[0].id),this.trackPositionUpdate(g,Q[0],C),this.createMergedHighlight(C,Q[0],A)}if(C.position!==void 0){let Q=Math.floor(C.position/50);for(let U=Q-1;U<=Q+1;U++)if(l.has(U)){let b=l.get(U);for(let P of b)if(P.id&&!c.has(P.id)&&P.position!==void 0&&Math.abs(P.position-C.position)<50)return c.add(P.id),this.trackPositionUpdate(g,P,C),this.createMergedHighlight(C,P,A)}}return this.createHighlightInfo(C,A)}),m=t.filter(C=>C.id&&C.isVirtual&&C.comments&&C.comments.length>0&&!c.has(C.id)).map(C=>this.createHighlightInfo(C,A));return g.length>0&&this.applyPositionUpdates(A.path,t,g),[...m,...d]}trackPositionUpdate(e,t,A){t.id&&A.position!==void 0&&t.position!==void 0&&A.position!==t.position&&e.push({id:t.id,newPosition:A.position})}applyPositionUpdates(e,t,A){setTimeout(async()=>{var i;try{let n=new Map(A.map(c=>[c.id,c.newPosition])),l=!1;for(let c of t)c.id&&n.has(c.id)&&(c.position=n.get(c.id),l=!0);if(l){let c=this.app.plugins,g=(i=c==null?void 0:c.plugins)==null?void 0:i["hi-note"];g!=null&&g.highlightRepository&&await g.highlightRepository.saveFileHighlights(e,t)}}catch(n){}},100)}createMergedHighlight(e,t,A){return{...e,id:t.id,comments:t.comments||[],createdAt:t.createdAt,updatedAt:t.updatedAt,fileName:A.basename,filePath:A.path,fileIcon:"file-text"}}createHighlightInfo(e,t){return{...e,comments:e.comments||[],fileName:t.basename,filePath:t.path,fileIcon:"file-text",position:e.position||0}}};var Yi=require("obsidian"),FA=class FA{constructor(e,t){this.app=e;this.extractor=t;this.fileIndex={wordToFiles:new Map,fileToHighlights:new Map,lastUpdated:0};this.isIndexing=!1}async initialize(){this.registerFileEventHandlers();let t=this.app.isMobile?1e4:3e3;setTimeout(()=>{this.buildFileIndex()},t)}destroy(){this.unregisterFileEventHandlers(),this.fileIndex={wordToFiles:new Map,fileToHighlights:new Map,lastUpdated:0},this.extractor.clearContentCache()}registerFileEventHandlers(){this.fileCreateEventRef=this.app.vault.on("create",e=>{e instanceof Yi.TFile&&e.extension==="md"&&this.updateFileInIndex(e)}),this.fileModifyEventRef=this.app.vault.on("modify",e=>{e instanceof Yi.TFile&&e.extension==="md"&&(this.extractor.invalidateContentCache(e.path),this.updateFileInIndex(e))}),this.fileDeleteEventRef=this.app.vault.on("delete",e=>{e instanceof Yi.TFile&&e.extension==="md"&&(this.extractor.invalidateContentCache(e.path),this.removeFileFromIndex(e.path))}),this.fileRenameEventRef=this.app.vault.on("rename",(e,t)=>{e instanceof Yi.TFile&&e.extension==="md"&&(this.extractor.invalidateContentCache(t),this.removeFileFromIndex(t),this.updateFileInIndex(e))})}unregisterFileEventHandlers(){this.app.vault.offref(this.fileCreateEventRef),this.app.vault.offref(this.fileModifyEventRef),this.app.vault.offref(this.fileDeleteEventRef),this.app.vault.offref(this.fileRenameEventRef)}async buildFileIndex(){if(this.isIndexing)return;this.isIndexing=!0;let e=Date.now();try{let t=await this.extractor.getAllHighlights(),A=new Map,i=new Map;for(let{file:n,highlights:l}of t){let c=l.map(d=>({...d,fileName:n.basename,filePath:n.path}));i.set(n.path,c);let g=this.extractKeywordsFromHighlights(l);this.addKeywordsToIndex(g,n.path,A)}this.fileIndex={wordToFiles:A,fileToHighlights:i,lastUpdated:Date.now()}}catch(t){}finally{this.isIndexing=!1}}tokenizeText(e){return e?e.toLowerCase().split(/\s+/).filter(A=>A.length>=FA.MIN_WORD_LENGTH).map(A=>A.replace(/[.,;:!?()\[\]{}'"`~]/g,"")).filter(A=>A.length>=FA.MIN_WORD_LENGTH):[]}isIndexExpired(){return this.fileIndex.lastUpdated===0||Date.now()-this.fileIndex.lastUpdated>FA.INDEX_EXPIRY_TIME}getAllHighlightsFromCache(){return this.fileIndex.lastUpdated===0&&!this.isIndexing&&this.buildFileIndex(),!this.isIndexExpired()&&this.fileIndex.fileToHighlights.size>0?this.getAllHighlightsFromIndex():null}getAllHighlightsFromIndex(){let e=[];for(let t of this.fileIndex.fileToHighlights.values())e.push(...t);return e}extractKeywordsFromHighlights(e){var A;let t=new Set;for(let i of e)if(this.tokenizeText(i.text).forEach(l=>t.add(l)),(A=i.comments)!=null&&A.length)for(let l of i.comments)this.tokenizeText(l.content).forEach(g=>t.add(g));return t}addKeywordsToIndex(e,t,A){for(let i of e)A.has(i)||A.set(i,new Set),A.get(i).add(t)}removeFileFromIndex(e){if(!this.isIndexExpired())try{if(this.fileIndex.fileToHighlights.has(e)){for(let[t,A]of this.fileIndex.wordToFiles.entries())A.delete(e),A.size===0&&this.fileIndex.wordToFiles.delete(t);this.fileIndex.fileToHighlights.delete(e)}}catch(t){}}async updateFileInIndex(e){if(!this.isIndexing){if(this.fileIndex.lastUpdated===0&&(this.fileIndex={wordToFiles:new Map,fileToHighlights:new Map,lastUpdated:Date.now()}),this.isIndexExpired()){this.buildFileIndex();return}try{if(this.removeFileFromIndex(e.path),this.extractor.shouldProcessFile(e)){let t=await this.app.vault.read(e),A=this.extractor.extractHighlights(t,e);if(A.length>0){let i=A.map(l=>({...l,fileName:e.basename,filePath:e.path}));this.fileIndex.fileToHighlights.set(e.path,i);let n=this.extractKeywordsFromHighlights(A);this.addKeywordsToIndex(n,e.path,this.fileIndex.wordToFiles)}}}catch(t){}}}async searchHighlightsFromIndex(e){var l;if((this.isIndexExpired()||this.fileIndex.fileToHighlights.size===0)&&await this.buildFileIndex(),!e.trim())return this.getAllHighlightsFromIndex();let t=this.tokenizeText(e);if(t.length===0)return this.getAllHighlightsFromIndex();let A=[];for(let c of t){let g=new Set;for(let[d,m]of this.fileIndex.wordToFiles.entries())if(d.includes(c))for(let C of m)g.add(C);A.push(g)}let i;if(A.length>0){i=A[0];for(let c=1;c<A.length;c++)i=new Set([...i].filter(g=>A[c].has(g)))}else i=new Set;let n=[];for(let c of i){let g=this.fileIndex.fileToHighlights.get(c)||[];for(let d of g){let m=d.text.toLowerCase(),C=((l=d.comments)==null?void 0:l.map(y=>y.content.toLowerCase()))||[];t.every(y=>m.includes(y)||C.some(Q=>Q.includes(y)))&&n.push(d)}}return n}};FA.INDEX_EXPIRY_TIME=36e5,FA.MIN_WORD_LENGTH=2;var fs=FA;var lc=require("obsidian"),JA=class JA{constructor(e,t){this.app=e;this.extractor=t}async batchRemoveHighlightMarks(e){let t=0,A=0,i=new Map;for(let n of e)i.has(n.filePath)||i.set(n.filePath,[]),i.get(n.filePath).push(n);for(let[n,l]of i)try{let c=this.app.vault.getAbstractFileByPath(n);if(!c||!(c instanceof lc.TFile)){A+=l.length;continue}let g=[...l].sort((d,m)=>{var y,Q;let C=(y=d.position)!=null?y:1/0;return((Q=m.position)!=null?Q:1/0)-C});await this.app.vault.process(c,d=>{for(let m of g)try{d=this.removeHighlightMarkFromContent(d,m),t++}catch(C){A++}return d})}catch(c){A+=l.length}return{success:t,failed:A}}removeHighlightMarkFromContent(e,t){let A=this.extractor.escapeRegExp(t.text);if(typeof t.position=="number"){let n=t.position,l=t.text,c=[`==${l}==`,`== ${l} ==`,`<mark>${l}</mark>`,`<span class="highlight">${l}</span>`];for(let g of c){let d=Math.max(0,n-JA.POSITION_SEARCH_OFFSET_BEFORE),m=Math.min(e.length,n+l.length+JA.POSITION_SEARCH_OFFSET_AFTER),C=e.substring(d,m);if(C.includes(g)){let F=e.substring(0,d),y=e.substring(m),Q=C.replace(g,l);return F+Q+y}}}let i=[new RegExp(`==\\s*(${A})\\s*==`),new RegExp(`<mark[^>]*>(${A})</mark>`),new RegExp(`<span[^>]*class="highlight"[^>]*>(${A})</span>`)];for(let n of i)if(n.test(e))return e.replace(n,t.text);return e}};JA.POSITION_SEARCH_OFFSET_BEFORE=10,JA.POSITION_SEARCH_OFFSET_AFTER=50;var ms=JA;var YA=class{constructor(e){this.app=e;this.extractor=new us(e),this.matcher=new ps(e),this.indexer=new fs(e,this.extractor),this.batchOps=new ms(e,this.extractor)}async initialize(){return this.indexer.initialize()}destroy(){this.indexer.destroy()}shouldProcessFile(e){return this.extractor.shouldProcessFile(e)}extractHighlights(e,t){return this.extractor.extractHighlights(e,t)}async getFilesWithHighlights(){return this.extractor.getFilesWithHighlights()}async getAllHighlights(){return this.extractor.getAllHighlights()}async createBlockIdForHighlight(e,t,A){return this.extractor.createBlockIdForHighlight(e,t,A)}getAllHighlightsFromCache(){return this.indexer.getAllHighlightsFromCache()}async searchHighlightsFromIndex(e){return this.indexer.searchHighlightsFromIndex(e)}findMatchingHighlight(e,t,A){return this.matcher.findMatchingHighlight(e,t,A)}mergeHighlightsWithComments(e,t,A){return this.matcher.mergeHighlightsWithComments(e,t,A)}async batchRemoveHighlightMarks(e){return this.batchOps.batchRemoveHighlightMarks(e)}};CA();var Bs=class{constructor(e,t){this.app=e;this.highlightRepository=t;this.highlightService=new YA(e)}getPluginInstance(){let e=this.app.plugins;return e&&e.plugins?e.plugins["hi-note"]:void 0}async createExportFile(e,t,A){let i=e;A&&(this.app.vault.getAbstractFileByPath(A)||await this.app.vault.createFolder(A),i=`${A}/${e}`);try{return await this.app.vault.create(`${i}.md`,t)}catch(n){throw n.message&&n.message.includes("already exists")?new Error(p("Export file already exists. Please try again in a moment.")):new Error(p("Failed to create export file: ")+n.message)}}async exportHighlightsAsMarkdown(e){var g,d,m,C;if(!e||e.length===0)throw new Error(p("No highlights to export."));let t=this.getPluginInstance(),A={};for(let F of e)F.filePath&&(A[F.filePath]||(A[F.filePath]=[]),A[F.filePath].push(F));let i=[];for(let F in A){let y=this.app.vault.getAbstractFileByPath(F);if(!(y instanceof cc.TFile))continue;i.push(`## ${y.basename}`),i.push("");let Q=A[F],U=(d=(g=t==null?void 0:t.settings)==null?void 0:g.export)==null?void 0:d.exportTemplate;if(U&&U.trim()!==""){let b=await this.generateContentFromTemplate(y,Q,U);b.trim()!==""&&i.push(b)}else{let b=await this.generateDefaultContent(y,Q);i.push(b)}}let n=i.join(`
`),l=((C=(m=t==null?void 0:t.settings)==null?void 0:m.export)==null?void 0:C.exportPath)||"",c=`Selected Highlights ${window.moment().format("YYYYMMDDHHmmss")}`;return await this.createExportFile(c,n,l)}async exportHighlightsToNote(e){var c,g;let t=await this.getFileHighlights(e);if(!t||t.length===0)throw new Error(p("No highlights found in the current file."));let A=await this.generateExportContent(e,t),i=this.getPluginInstance(),n=((g=(c=i==null?void 0:i.settings)==null?void 0:c.export)==null?void 0:g.exportPath)||"",l=`${e.basename} - HiNote ${window.moment().format("YYYYMMDDHHmmss")}`;return await this.createExportFile(l,A,n)}async getFileHighlights(e){let t=await this.app.vault.read(e),A=this.highlightService.extractHighlights(t,e),i=this.highlightRepository.getCachedHighlights(e.path)||[],n=i.filter(g=>g.isVirtual&&g.comments&&g.comments.length>0),l=i.filter(g=>!g.isVirtual),c=A.map(g=>{var m,C,F,y;let d=l.find(Q=>{let U=Q.text===g.text;return U&&typeof Q.position=="number"&&typeof g.position=="number"?Math.abs(Q.position-g.position)<1e3:U});return d?{...d,position:(m=g.position)!=null?m:0,paragraphOffset:(C=g.paragraphOffset)!=null?C:0}:{...g,id:g.id||tt.generateHighlightId(e.path,g.position||0,g.text),position:(F=g.position)!=null?F:0,paragraphOffset:(y=g.paragraphOffset)!=null?y:0,comments:[],createdAt:Date.now(),updatedAt:Date.now()}});return[...n,...c]}async generateExportContent(e,t){var n,l;let A=this.getPluginInstance(),i=(l=(n=A==null?void 0:A.settings)==null?void 0:n.export)==null?void 0:l.exportTemplate;return i&&i.trim()!==""?this.generateContentFromTemplate(e,t,i):this.generateDefaultContent(e,t)}async generateContentFromTemplate(e,t,A){let i=[];for(let n of t){let l=await this.generateStructuredContent(n,e,A);i.push(...l),i.push("")}return i.join(`
`)}replaceVariables(e,t){let A=e;for(let[i,n]of Object.entries(t))A=A.replace(new RegExp(`{{${i}}}`,"g"),n||"");return A}formatComment(e,t=!1){let A=[],i=t?">":">>";if(!t){let l=e.updatedAt?window.moment(e.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"";A.push(`>> [!note]+ ${l}`)}let n=e.content.split(`
`).map(l=>(l=l.trim(),l?`${i} ${l}`:i)).join(`
`);return A.push(n),A.push(">"),A}async generateStructuredContent(e,t,A){let i=[];if(e.isVirtual)i.push(`> [!note] [[${t.basename}]]`),i.push("> ");else if(A&&(A.includes("{{highlightText}}")||A.includes("{{highlightBlockRef}}"))){let n=this.extractHighlightTemplate(A),l="";if(typeof e.position=="number"&&A.includes("{{highlightBlockRef}}"))try{let g=e.originalLength||e.text.length;l=await this.highlightService.createBlockIdForHighlight(t,e.position,g)||""}catch(g){console.error("[ExportService] Error creating block ID:",g)}let c=this.replaceVariables(n,{sourceFile:t.basename,highlightText:e.text||"",highlightBlockRef:l,highlightType:"HiNote",commentContent:"",commentDate:""});i.push(...c.split(`
`))}else i.push("> [!quote] HiNote"),i.push(`> ${e.text||""}`),i.push("> ");if(e.comments&&e.comments.length>0)for(let n of e.comments)i.push(...this.formatComment(n,e.isVirtual));return i}extractHighlightTemplate(e){let t=e,A=/\n>>\s*\[!note\]\+[\s\S]*?(?=\n>\s*$|\n\s*$|$)/g;return t=t.replace(A,""),t=t.replace(/\{\{commentContent\}\}/g,""),t=t.replace(/\{\{commentDate\}\}/g,""),t=t.replace(/\n{3,}/g,`

`),t=t.replace(/\n>\s*\n\s*$/g,`
`),t.trim()}async generateDefaultContent(e,t){return this.generateContentFromTemplate(e,t,`> [!quote] HiNote
> {{highlightText}}
> 
>> [!note]+ {{commentDate}}
>> {{commentContent}}`)}};W();W();var Cs=class{constructor(e,t){this.searchHintsEventHandlers=null;this.searchInput=e,this.searchContainer=t}showSearchPrefixHints(){let e=document.querySelector(".search-prefix-hints");e&&e.remove();let t=document.body.createDiv({cls:"search-prefix-hints show"});[{prefix:"all:",description:p("search-prefix-all")},{prefix:"path:",description:p("search-prefix-path")},{prefix:"hicard:",description:p("search-prefix-hicard")},{prefix:"comment:",description:p("search-prefix-comment")}].forEach(({prefix:c,description:g})=>{let d=t.createDiv({cls:"search-prefix-hint-item"});d.createSpan({cls:"search-prefix-tag",text:c}),d.createSpan({cls:"search-prefix-description",text:g}),d.addEventListener("click",()=>{this.searchInput.value=c+" ",this.searchInput.focus(),t.remove();let m=new Event("input",{bubbles:!0});this.searchInput.dispatchEvent(m)})}),this.positionSearchHints(t);let i=()=>{this.searchInput.value.trim()===""?document.body.contains(t)||(document.body.appendChild(t),this.positionSearchHints(t)):t&&document.body.contains(t)&&t.remove()};this.searchInput.addEventListener("input",i);let n=c=>{t&&!t.contains(c.target)&&c.target!==this.searchInput&&(t.remove(),document.removeEventListener("click",n))},l=()=>{setTimeout(()=>{(!document.activeElement||document.activeElement!==this.searchInput&&!t.contains(document.activeElement))&&t.remove()},200)};this.searchInput.addEventListener("blur",l),setTimeout(()=>{document.addEventListener("click",n)},10),this.searchHintsEventHandlers={input:i,blur:l,click:n}}positionSearchHints(e){let t=this.searchInput.getBoundingClientRect();e.addClass("search-hints-container"),e.style.top=t.bottom+4+"px",e.style.left=t.left+"px",e.style.width=t.width+"px"}destroy(){let e=document.querySelector(".search-prefix-hints");e&&e.remove(),this.searchHintsEventHandlers&&(this.searchInput.removeEventListener("input",this.searchHintsEventHandlers.input),this.searchInput.removeEventListener("blur",this.searchHintsEventHandlers.blur),document.removeEventListener("click",this.searchHintsEventHandlers.click),this.searchHintsEventHandlers=null)}};var ws=class{constructor(e){this.plugin=e}parseSearchInput(e){let t=e.toLowerCase().trim(),A=t.startsWith("all:"),i=t.startsWith("hicard:"),n=t.startsWith("comment:"),l=t.startsWith("path:"),c="",g=t;return A?(c="all",g=t.substring(4).trim()):i?(c="hicard",g=t.substring(7).trim()):n?(c="comment",g=t.substring(8).trim()):l&&(c="path",g=t.substring(5).trim()),{searchTerm:g,searchType:c}}filterHighlights(e,t,A="",i){return A==="path"?this.filterByPath(e,t):A==="hicard"?this.filterByFlashcard(e,t,i):A==="comment"?this.filterByComment(e,t,i):this.filterByGeneral(e,t,i)}filterByPath(e,t){return e.forEach(A=>{if(A.filePath&&!A.fileName){let i=A.filePath.split("/");A.fileName=i[i.length-1]}}),!t||t.trim()===""?e.filter(A=>!!A.filePath):e.filter(A=>A.filePath?A.filePath.toLowerCase().includes(t.toLowerCase()):!1)}filterByFlashcard(e,t,A){let i=this.plugin.fsrsManager;return i?e.filter(n=>(n.id?i.findCardsBySourceId(n.id,"highlight").length>0:!1)?t?this.matchesSearchTerm(n,t,A):!0:!1):[]}filterByComment(e,t,A){return e.filter(i=>i.comments&&i.comments.length>0?t?this.matchesSearchTerm(i,t,A):!0:!1)}filterByGeneral(e,t,A){return e.filter(i=>this.matchesSearchTerm(i,t,A))}matchesSearchTerm(e,t,A){var n,l;let i=t.toLowerCase();return!!(e.text.toLowerCase().includes(i)||(n=e.comments)!=null&&n.some(c=>c.content.toLowerCase().includes(i))||A===null&&((l=e.fileName)!=null&&l.toLowerCase().includes(i)))}};var vs=class{constructor(e,t,A,i){this.searchDebounceTimer=null;this.isSearching=!1;this.localSearchDebounceTime=200;this.globalSearchDebounceTime=500;this.handleSearchInputWithDebounce=e=>{this.searchDebounceTimer!==null&&(window.clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=null);let t=this.searchInput.value.toLowerCase().trim(),A=t.startsWith("all:"),i=A?this.globalSearchDebounceTime:this.localSearchDebounceTime;A&&t.length>4&&this.showSearchLoadingIndicator(),this.searchDebounceTimer=window.setTimeout(async()=>{await this.performSearch(),this.searchDebounceTimer=null},i)};this.plugin=e,this.searchInput=t,this.searchLoadingIndicator=A,this.uiHelper=new Cs(t,i),this.searchService=new ws(e)}setCallbacks(e,t,A){this.onSearchCallback=e,this.getHighlightsCallback=t,this.getCurrentFileCallback=A}initialize(){this.searchInput.addEventListener("focus",()=>{this.uiHelper.showSearchPrefixHints()}),this.searchInput.addEventListener("input",this.handleSearchInputWithDebounce)}destroy(){this.searchDebounceTimer!==null&&(window.clearTimeout(this.searchDebounceTimer),this.searchDebounceTimer=null),this.uiHelper.destroy()}async performSearch(){try{let e=this.searchInput.value.trim(),{searchTerm:t,searchType:A}=this.searchService.parseSearchInput(e);this.onSearchCallback&&await this.onSearchCallback(t,A)}catch(e){console.error("[\u641C\u7D22 UI \u7BA1\u7406\u5668] \u641C\u7D22\u8FC7\u7A0B\u4E2D\u51FA\u9519:",e)}finally{this.hideSearchLoadingIndicator()}}filterHighlightsByTerm(e,t=""){let A=this.getHighlightsCallback(),i=this.getCurrentFileCallback();return this.searchService.filterHighlights(A,e,t,i)}showSearchLoadingIndicator(){this.isSearching||(this.isSearching=!0,this.searchLoadingIndicator.style.display="flex")}hideSearchLoadingIndicator(){this.isSearching&&(this.isSearching=!1,this.searchLoadingIndicator.style.display="none")}getSearchValue(){return this.searchInput.value.trim()}hasSearchTerm(){return this.searchInput.value.trim()!==""}};var Fs=class{constructor(e){this.selectedCards=new Map;this.isSelectionMode=!1;this.selectionBox=null;this.selectionStartX=0;this.selectionStartY=0;this.mouseMoveThreshold=5;this.mouseMoved=!1;this.onSelectionChangeCallback=null;this.handleSelectionStart=e=>{e.target.closest(".highlight-card")||e.target.closest(".flashcard-mode")||e.target.closest(".flashcard-add-group")||e.target.closest(".flashcard-group-action")||(this.selectionStartX=e.clientX,this.selectionStartY=e.clientY,this.mouseMoved=!1,document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp))};this.handleMouseMove=e=>{let t=e.clientX-this.selectionStartX,A=e.clientY-this.selectionStartY;Math.sqrt(t*t+A*A)>=this.mouseMoveThreshold&&(this.mouseMoved=!0,document.removeEventListener("mousemove",this.handleMouseMove),this.startSelection(e))};this.handleMouseUp=e=>{this.cleanupMouseEvents(),this.mouseMoved||this.clearSelection()};this.handleSelectionMove=e=>{if(!this.isSelectionMode||!this.selectionBox)return;let t=e.clientX-this.selectionStartX,A=e.clientY-this.selectionStartY;t<0?(this.selectionBox.style.left=`${e.clientX}px`,this.selectionBox.style.width=`${-t}px`):this.selectionBox.style.width=`${t}px`,A<0?(this.selectionBox.style.top=`${e.clientY}px`,this.selectionBox.style.height=`${-A}px`):this.selectionBox.style.height=`${A}px`,this.selectCardsInBox()};this.handleSelectionEnd=e=>{this.isSelectionMode&&(this.selectionBox&&(this.selectionBox.remove(),this.selectionBox=null),this.isSelectionMode=!1,this.cleanupSelectionEvents(),this.updateSelectedHighlights())};this.highlightContainer=e}setOnSelectionChange(e){this.onSelectionChangeCallback=e}initialize(){this.setupSelectionBox()}clearSelection(){this.selectedCards.forEach((e,t)=>{t.removeClass("selected")}),this.selectedCards.clear(),this.isSelectionMode=!1,this.notifySelectionChange()}updateSelectedHighlights(){this.selectedCards.clear(),Array.from(this.highlightContainer.querySelectorAll(".highlight-card.selected")).forEach(t=>{let A=t.getAttribute("data-highlight");if(A)try{let i=JSON.parse(A);this.selectedCards.set(t,i)}catch(i){console.error("Error parsing highlight data:",i)}}),this.notifySelectionChange()}getSelectedHighlights(){let e=new Set;return this.selectedCards.forEach(t=>{e.add(t)}),e}getSelectedCount(){return this.selectedCards.size}selectCard(e,t){this.selectedCards.set(e,t),e.addClass("selected"),this.notifySelectionChange()}unselectCard(e){this.selectedCards.has(e)&&(e.removeClass("selected"),this.selectedCards.delete(e),this.notifySelectionChange())}isCardSelected(e){return this.selectedCards.has(e)}isInSelectionMode(){return this.isSelectionMode}setupSelectionBox(){this.highlightContainer.removeEventListener("mousedown",this.handleSelectionStart),this.cleanupMouseEvents(),this.cleanupSelectionEvents(),this.highlightContainer.addEventListener("mousedown",this.handleSelectionStart)}startSelection(e){this.cleanupMouseEvents(),this.selectedCards.size>0&&this.clearSelection(),this.selectionBox=document.createElement("div"),this.selectionBox.className="selection-box",this.selectionBox.style.left=`${this.selectionStartX}px`,this.selectionBox.style.top=`${this.selectionStartY}px`,document.body.appendChild(this.selectionBox),this.isSelectionMode=!0,document.addEventListener("mousemove",this.handleSelectionMove),document.addEventListener("mouseup",this.handleSelectionEnd)}selectCardsInBox(){if(!this.selectionBox)return;let e=this.selectionBox.getBoundingClientRect();this.highlightContainer.querySelectorAll(".highlight-card").forEach(A=>{let i=A.getBoundingClientRect();!(e.right<i.left||e.left>i.right||e.bottom<i.top||e.top>i.bottom)?A.addClass("selected"):document.querySelector(".multi-select-mode")||A.removeClass("selected")})}notifySelectionChange(){this.onSelectionChangeCallback&&this.onSelectionChangeCallback(this.selectedCards.size)}cleanupMouseEvents(){document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp)}cleanupSelectionEvents(){document.removeEventListener("mousemove",this.handleSelectionMove),document.removeEventListener("mouseup",this.handleSelectionEnd)}destroy(){this.selectionBox&&(this.selectionBox.remove(),this.selectionBox=null),this.clearSelection(),this.highlightContainer.removeEventListener("mousedown",this.handleSelectionStart),this.cleanupMouseEvents(),this.cleanupSelectionEvents()}};var ne=require("obsidian");W();var ys=class{constructor(e,t,A,i,n){this.multiSelectActionsContainer=null;this.plugin=e,this.exportService=t,this.licenseManager=A,this.highlightService=i,this.containerEl=n}setCallbacks(e,t,A){this.getSelectedHighlightsCallback=e,this.onClearSelectionCallback=t,this.onRefreshViewCallback=A}async showMultiSelectActions(e){if(e<=1){this.hideMultiSelectActions();return}this.hideMultiSelectActions(),this.multiSelectActionsContainer||(this.multiSelectActionsContainer=this.containerEl.createEl("div",{cls:"multi-select-actions"})),this.multiSelectActionsContainer.show(),this.multiSelectActionsContainer.empty(),this.multiSelectActionsContainer.createEl("div",{cls:"selected-count",text:`selected ${e}`}),this.createExportButton(),await this.createFlashcardButtons(),this.createDeleteButton()}hideMultiSelectActions(){this.multiSelectActionsContainer&&(this.multiSelectActionsContainer.empty(),this.multiSelectActionsContainer.hide())}createExportButton(){if(!this.multiSelectActionsContainer)return;let e=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});e.setAttribute("aria-label",p("Export")),(0,ne.setIcon)(e,"file-input"),e.addEventListener("click",()=>{this.exportSelectedHighlights()})}async createFlashcardButtons(){if(!this.multiSelectActionsContainer)return;let e=this.plugin.fsrsManager;if(!e){this.createDefaultFlashcardButton();return}let t=this.getSelectedHighlightsCallback(),A=0;for(let i of t)if(i.id){let n=e.findCardsBySourceId(i.id,"highlight");n&&n.length>0&&A++}A===0?this.createFlashcardCreateButton():A===t.size?this.createFlashcardDeleteButton():this.createFlashcardManageButton()}createDefaultFlashcardButton(){if(!this.multiSelectActionsContainer)return;let e=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});e.setAttribute("aria-label",p("Create HiCard")),(0,ne.setIcon)(e,"book-plus"),e.addEventListener("click",()=>{new ne.Notice(p("HiCard function is not initialized, please enable FSRS function"))})}createFlashcardCreateButton(){if(!this.multiSelectActionsContainer)return;let e=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});e.setAttribute("aria-label",p("Create HiCard")),(0,ne.setIcon)(e,"book-plus"),this.licenseManager.isActivated().then(t=>{t?this.licenseManager.isFeatureEnabled("flashcard").then(A=>{A||(e.addClass("disabled-button"),e.setAttribute("aria-label",p("Only HiNote Pro")))}):(e.addClass("disabled-button"),e.setAttribute("aria-label",p("Only HiNote Pro")))}),e.addEventListener("click",async()=>{if(e.hasClass("disabled-button")){new ne.Notice(p("Only HiNote Pro"));return}await this.createMissingFlashcards()})}createFlashcardDeleteButton(){if(!this.multiSelectActionsContainer)return;let e=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button delete-flashcard-button"});e.setAttribute("aria-label",p("Delete HiCard")),(0,ne.setIcon)(e,"book-x"),e.addEventListener("click",()=>{this.deleteFlashcardsFromSelected()})}createFlashcardManageButton(){if(!this.multiSelectActionsContainer)return;let e=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});e.setAttribute("aria-label",p("Manage HiCard")),(0,ne.setIcon)(e,"book-heart"),e.addEventListener("click",t=>{this.showFlashcardManageMenu(t)})}createDeleteButton(){if(!this.multiSelectActionsContainer)return;let e=this.multiSelectActionsContainer.createEl("div",{cls:"multi-select-action-button"});e.setAttribute("aria-label",p("Delete")),(0,ne.setIcon)(e,"trash"),e.addEventListener("click",()=>{this.deleteSelectedHighlights()})}async exportSelectedHighlights(){let e=this.getSelectedHighlightsCallback();if(e.size===0){new ne.Notice(p("Please select highlights to export"));return}try{let t=Array.from(e),A=await this.exportService.exportHighlightsAsMarkdown(t);new ne.Notice(p("Successfully exported selected highlights to: ")+A.path),this.onClearSelectionCallback()}catch(t){console.error("Failed to export highlights:",t),new ne.Notice(p("Failed to export highlights: ")+(t instanceof Error?t.message:String(t)))}}async createMissingFlashcards(){let e=await this.licenseManager.isActivated(),t=e?await this.licenseManager.isFeatureEnabled("flashcard"):!1;if(!e||!t){new ne.Notice(p("Only HiNote Pro"));return}let A=this.plugin.fsrsManager;if(!A){new ne.Notice(p("HiCard function is not initialized, please enable FSRS function"));return}let i=this.getSelectedHighlightsCallback(),n=0,l=0;for(let c of i)try{if(c.id){let g=A.findCardsBySourceId(c.id,"highlight");if(g&&g.length>0)continue;let d=Ee.findCardInstanceByHighlightId(c.id),m=!1,C=null;if(d)m=await d.createHiCardForHighlight(!0);else{let F=document.createElement("div");C=new Ee(F,c,this.plugin,{onHighlightClick:async()=>{},onCommentAdd:()=>{},onExport:()=>{},onCommentEdit:()=>{},onAIResponse:async()=>{}},!1);try{m=await C.createHiCardForHighlight(!0)}finally{C.destroy()}}m?n++:l++}}catch(g){l++,console.error("Create HiCard failed:",g)}n>0&&this.plugin.eventManager.emitFlashcardChanged(),this.showResultNotice(n,l,"create"),this.onClearSelectionCallback(),await this.onRefreshViewCallback()}deleteFlashcardsFromSelected(){let e=new ne.Modal(this.plugin.app);e.titleEl.setText(p("Confirm delete HiCard")),e.contentEl.createEl("p",{text:p("Are you sure you want to delete the HiCards of the selected highlights? This action cannot be undone.")});let t=e.contentEl.createEl("div",{cls:"modal-button-container"});t.createEl("button",{text:p("Cancel")}).addEventListener("click",()=>e.close()),t.createEl("button",{cls:"mod-warning",text:p("Delete")}).addEventListener("click",async()=>{e.close(),await this.deleteExistingFlashcards()}),e.open()}async deleteExistingFlashcards(){let e=this.plugin.fsrsManager;if(!e){new ne.Notice(p("HiCard function is not initialized, please enable FSRS function"));return}let t=this.getSelectedHighlightsCallback(),A=0,i=0;for(let n of t)try{if(n.id){let l=e.findCardsBySourceId(n.id,"highlight");if(!l||l.length===0)continue;let c=Ee.findCardInstanceByHighlightId(n.id),g=!1,d=null;if(c)g=await c.deleteHiCardForHighlight(!0);else{let m=document.createElement("div");d=new Ee(m,n,this.plugin,{onHighlightClick:async()=>{},onCommentAdd:()=>{},onExport:()=>{},onCommentEdit:()=>{},onAIResponse:async()=>{}},!1);try{g=await d.deleteHiCardForHighlight(!0)}finally{d.destroy()}}g?A++:i++}}catch(l){i++,console.error("Failed to delete HiCard:",l)}A>0&&this.plugin.eventManager.emitFlashcardChanged(),this.showResultNotice(A,i,"delete"),this.onClearSelectionCallback(),await this.onRefreshViewCallback()}deleteSelectedHighlights(){let e=this.getSelectedHighlightsCallback();if(e.size===0){new ne.Notice(p("No highlights selected"));return}let t=new ne.Modal(this.plugin.app);t.titleEl.setText(p("Confirm delete highlights")),t.contentEl.createEl("p",{text:p(`Are you sure you want to delete ${e.size} highlights and all their data, including Comments and HiCards? This action cannot be undone.`)});let A=t.contentEl.createEl("div",{cls:"modal-button-container"});A.createEl("button",{text:p("Cancel")}).addEventListener("click",()=>t.close()),A.createEl("button",{cls:"mod-warning",text:p("Delete")}).addEventListener("click",async()=>{t.close(),await this.performDeleteSelectedHighlights()}),t.open()}async performDeleteSelectedHighlights(){let e=this.getSelectedHighlightsCallback();if(e.size===0){new ne.Notice(p("No highlights selected"));return}let t=Array.from(e),A=0,i=0,n=0;try{let g=this.plugin.fsrsManager;if(g){for(let C of t)if(C.id)try{g.deleteCardsBySourceId(C.id,"highlight")}catch(F){console.error("[BatchDelete] \u5220\u9664\u95EA\u5361\u5931\u8D25:",C.id,F)}}let d=t.filter(C=>C.filePath&&C.text).map(C=>({text:C.text,position:C.position,filePath:C.filePath,originalLength:C.originalLength}));if(d.length>0){let C=await this.highlightService.batchRemoveHighlightMarks(d);A=C.success,i=C.failed}let m=this.plugin.highlightManager;if(m){let C=new Map;for(let F of t)F.filePath&&F.id&&(C.has(F.filePath)||C.set(F.filePath,[]),C.get(F.filePath).push(F));for(let[F,y]of C)try{let Q=this.plugin.app.vault.getAbstractFileByPath(F);if(Q instanceof ne.TFile)for(let U of y)try{await m.removeHighlight(Q,U)}catch(b){console.error("[BatchDelete] \u4ECE HighlightManager \u5220\u9664\u5931\u8D25:",U.id,b),n++}}catch(Q){console.error("[BatchDelete] \u5904\u7406\u6587\u4EF6\u5931\u8D25:",F,Q),n+=y.length}}for(let C of t)if(C.id)try{let F=Ee.findCardInstanceByHighlightId(C.id);if(F){let y=F.card;y&&y.remove(),F.destroy()}}catch(F){console.error("[BatchDelete] \u6E05\u7406\u5361\u7247\u5B9E\u4F8B\u5931\u8D25:",C.id,F)}if(A>0)for(let C of t)C.filePath&&C.id&&this.plugin.eventManager.emitHighlightDelete(C.filePath,C.text||"",C.id)}catch(g){console.error("[BatchDelete] \u6279\u91CF\u5220\u9664\u8FC7\u7A0B\u51FA\u9519:",g),i=t.length}this.onClearSelectionCallback();let l=A,c=i+n;if(l>0&&c===0)new ne.Notice(p(`\u6210\u529F\u5220\u9664 ${l} \u4E2A\u9AD8\u4EAE`));else if(l>0&&c>0){let g=p(`\u6210\u529F\u5220\u9664 ${l} \u4E2A\u9AD8\u4EAE`);i>0&&(g+=p(`\uFF0C${i} \u4E2A\u6587\u4EF6\u6807\u8BB0\u5220\u9664\u5931\u8D25`)),n>0&&(g+=p(`\uFF0C${n} \u4E2A\u6570\u636E\u5220\u9664\u5931\u8D25`)),new ne.Notice(g)}else c>0&&new ne.Notice(p("\u5220\u9664\u9AD8\u4EAE\u5931\u8D25"))}showFlashcardManageMenu(e){let{Menu:t}=require("obsidian"),A=new t;A.addItem(n=>{n.setTitle(p("Create missing HiCard")).setIcon("plus-circle").onClick(async()=>{await this.createMissingFlashcards()})}),A.addItem(n=>{n.setTitle(p("Delete existing HiCards")).setIcon("trash").onClick(()=>{this.deleteFlashcardsFromSelected()})});let i=e.currentTarget;if(i){let n=i.getBoundingClientRect();A.showAtPosition({x:n.left-85,y:n.top-60})}else A.showAtMouseEvent(e)}showResultNotice(e,t,A){let i=A==="create"?"created":"deleted";e>0&&t===0?new ne.Notice(p(`Successfully ${i} ${e} HiCard`)):e>0&&t>0?new ne.Notice(p(`Successfully ${i} ${e} HiCard, ${t} failed`)):e===0&&t===0?new ne.Notice(p(`No HiCard to ${A}`)):new ne.Notice(p(`Failed to ${A} HiCard! Please check the selected highlight content`))}destroy(){this.hideMultiSelectActions(),this.multiSelectActionsContainer&&(this.multiSelectActionsContainer.remove(),this.multiSelectActionsContainer=null)}};var $A=require("obsidian");W();var Es=class{constructor(e,t,A,i){this.onFileSelect=null;this.onFlashcardModeToggle=null;this.onAllHighlightsSelect=null;this.onRefreshView=null;this.currentFile=null;this.isFlashcardMode=!1;this.isMobileView=!1;this.isSmallScreen=!1;this.isDraggedToMainView=!1;this.cachedFiles=null;this.cachedFileCounts=null;this.cacheTimestamp=0;this.CACHE_EXPIRY=6e4;this.container=e,this.plugin=t,this.highlightService=A,this.licenseManager=i}setCallbacks(e){e.onFileSelect&&(this.onFileSelect=e.onFileSelect),e.onFlashcardModeToggle&&(this.onFlashcardModeToggle=e.onFlashcardModeToggle),e.onAllHighlightsSelect&&(this.onAllHighlightsSelect=e.onAllHighlightsSelect),e.onRefreshView&&(this.onRefreshView=e.onRefreshView)}updateState(e){e.currentFile!==void 0&&(this.currentFile=e.currentFile),e.isFlashcardMode!==void 0&&(this.isFlashcardMode=e.isFlashcardMode),e.isMobileView!==void 0&&(this.isMobileView=e.isMobileView),e.isSmallScreen!==void 0&&(this.isSmallScreen=e.isSmallScreen),e.isDraggedToMainView!==void 0&&(this.isDraggedToMainView=e.isDraggedToMainView)}async updateFileList(e=!1){if(e&&this.invalidateCache(),this.container.children.length>0&&!e){this.updateFileListSelection();return}await this.createFileList()}async createFileList(){this.container.empty();let t=this.container.createEl("div",{cls:"highlight-file-list-header"}).createEl("div",{text:"HiNote",cls:"highlight-file-list-title"});t.style.cursor="pointer",t.addEventListener("click",async()=>{await this.updateFileList(!0),this.onRefreshView&&await this.onRefreshView()});let A=this.container.createEl("div",{cls:"highlight-file-list"});await this.createAllHighlightsItem(A),await this.createFlashcardItem(A),A.createEl("div",{cls:"highlight-file-list-separator"});let i=await this.getFilesWithHighlights();for(let n of i)await this.createFileItem(A,n)}async createAllHighlightsItem(e){let t=e.createEl("div",{cls:`highlight-file-item highlight-file-item-all ${this.currentFile===null&&!this.isFlashcardMode?"is-active":""}`}),A=t.createEl("div",{cls:"highlight-file-item-left"}),i=A.createEl("span",{cls:"highlight-file-item-icon"});(0,$A.setIcon)(i,"square-library"),A.createEl("span",{text:p("All Highlight"),cls:"highlight-file-item-name"});let n=await this.getTotalHighlightsCount();t.createEl("span",{text:`${n}`,cls:"highlight-file-item-count"}),t.addEventListener("click",async()=>{this.onAllHighlightsSelect&&this.onAllHighlightsSelect()})}async createFlashcardItem(e){let t=e.createEl("div",{cls:`highlight-file-item highlight-file-item-flashcard ${this.isFlashcardMode?"is-active":""}`}),A=t.createEl("div",{cls:"highlight-file-item-left"}),i=A.createEl("span",{cls:"highlight-file-item-icon"});(0,$A.setIcon)(i,"book-heart"),A.createEl("span",{text:p("HiCard"),cls:"highlight-file-item-name"});let n=t.createEl("span",{cls:"highlight-file-item-count"}),l=()=>{let c=this.plugin.fsrsManager.getTotalCardsCount();n.textContent=`${c}`};l(),this.plugin.eventManager.on("flashcard:changed",()=>{l()}),t.addEventListener("click",async()=>{this.onFlashcardModeToggle&&this.onFlashcardModeToggle(!0)})}async createFileItem(e,t){var g;let A=e.createEl("div",{cls:`highlight-file-item ${((g=this.currentFile)==null?void 0:g.path)===t.path?"is-active":""}`});A.setAttribute("data-path",t.path);let i=A.createEl("div",{cls:"highlight-file-item-left"}),n=i.createEl("span",{cls:"highlight-file-item-icon",attr:{"aria-label":p("Open (DoubleClick)")}});(0,$A.setIcon)(n,"file-text"),n.addEventListener("dblclick",async d=>{d.stopPropagation(),await this.getPreferredLeaf().openFile(t)});let l=i.createEl("span",{text:t.basename,cls:"highlight-file-item-name"});this.addPagePreview(l,t);let c=await this.getFileHighlightsCount(t);A.createEl("span",{text:`${c}`,cls:"highlight-file-item-count"}),A.addEventListener("click",async()=>{this.onFileSelect&&this.onFileSelect(t)})}updateFileListSelection(){let e=this.container.querySelector(".highlight-file-item-all");e&&e.classList.toggle("is-active",this.currentFile===null&&!this.isFlashcardMode);let t=this.container.querySelector(".highlight-file-item-flashcard");t&&t.classList.toggle("is-active",this.isFlashcardMode),this.container.querySelectorAll(".highlight-file-item:not(.highlight-file-item-all):not(.highlight-file-item-flashcard)").forEach(i=>{var l;let n=((l=this.currentFile)==null?void 0:l.path)===i.getAttribute("data-path");i.classList.toggle("is-active",n)})}invalidateCache(){this.cachedFiles=null,this.cachedFileCounts=null,this.cacheTimestamp=0}async getFilesWithHighlights(){let e=Date.now();if(this.cachedFiles&&e-this.cacheTimestamp<this.CACHE_EXPIRY)return this.cachedFiles;let t=this.highlightService.getAllHighlightsFromCache();if(t&&t.length>0){let i=new Set,n=new Map;for(let c of t)c.filePath&&(i.add(c.filePath),n.set(c.filePath,(n.get(c.filePath)||0)+1));let l=[];for(let c of i){let g=this.plugin.app.vault.getAbstractFileByPath(c);g instanceof $A.TFile&&l.push(g)}return this.cachedFiles=l,this.cachedFileCounts=n,this.cacheTimestamp=e,l}let A=await this.getFilesWithHighlightsLegacy();return this.cachedFiles=A,this.cacheTimestamp=e,A}async getFilesWithHighlightsLegacy(){let t=this.plugin.app.vault.getMarkdownFiles().filter(n=>this.highlightService.shouldProcessFile(n)),A=[],i=new Map;for(let n of t){let l=await this.plugin.app.vault.read(n),c=this.highlightService.extractHighlights(l,n);c.length>0&&(A.push(n),i.set(n.path,c.length))}return this.cachedFileCounts=i,A}async getFileHighlightsCount(e){if(this.cachedFileCounts&&this.cachedFileCounts.has(e.path))return this.cachedFileCounts.get(e.path);let t=await this.plugin.app.vault.read(e),A=this.highlightService.extractHighlights(t,e).length;return this.cachedFileCounts||(this.cachedFileCounts=new Map),this.cachedFileCounts.set(e.path,A),A}getTotalHighlightsCount(){let e=this.highlightService.getAllHighlightsFromCache();if(e)return e.length;if(this.cachedFileCounts){let t=0;for(let A of this.cachedFileCounts.values())t+=A;return t}return 0}addPagePreview(e,t){let A;e.addEventListener("mouseenter",i=>{A=setTimeout(async()=>{let n=i.target;this.plugin.app.workspace.trigger("hover-link",{event:i,source:"hi-note",hoverParent:n,targetEl:n,linktext:t.path})},300)}),e.addEventListener("mouseleave",()=>{A&&clearTimeout(A)})}getPreferredLeaf(){let e=this.plugin.app.workspace.getLeavesOfType("markdown");if(this.isDraggedToMainView){let t=e.find(A=>A!==this.plugin.app.workspace.activeLeaf);if(t)return t}return this.plugin.app.workspace.getLeaf("split","vertical")}destroy(){this.container.empty(),this.onFileSelect=null,this.onFlashcardModeToggle=null,this.onAllHighlightsSelect=null,this.onRefreshView=null}};var Is=class{constructor(e,t,A){this.app=e,this.highlightService=t,this.highlightRepository=A}async loadFileHighlights(e){if(!this.highlightService.shouldProcessFile(e))return[];let t=await this.app.vault.read(e),A=this.highlightService.extractHighlights(t,e),i=await this.highlightRepository.getFileHighlights(e.path);return this.mergeHighlightsWithComments(A,i,e)}async loadAllHighlights(e="",t=""){let A=[];if(t==="path"){let i=await this.highlightService.getAllHighlights();for(let{file:n,highlights:l}of i){if(e&&!n.path.toLowerCase().includes(e.toLowerCase()))continue;let c=await this.highlightRepository.getFileHighlights(n.path),g=this.mergeHighlightsWithComments(l,c,n);A.push(...g)}}else{let i=await this.highlightService.getAllHighlights();for(let{file:n,highlights:l}of i){let c=await this.highlightRepository.getFileHighlights(n.path),g=this.mergeHighlightsWithComments(l,c,n);if(e){let d=g.filter(m=>{var C;return m.text.toLowerCase().includes(e.toLowerCase())||((C=m.comments)==null?void 0:C.some(F=>F.content.toLowerCase().includes(e.toLowerCase())))});A.push(...d)}else A.push(...g)}}return A}mergeHighlightsWithComments(e,t,A){return this.highlightService.mergeHighlightsWithComments(e,t,A)}markAsGlobalSearch(e,t=!0){return e.map(A=>({...A,isGlobalSearch:t}))}markAsCanvasSource(e,t){return e.map(A=>({...A,isFromCanvas:!0,isGlobalSearch:!0,canvasSource:t.path}))}};var Qs=require("obsidian");CA();W();var Hs=class{constructor(e,t,A){this.onRefreshView=null;this.onHighlightsUpdate=null;this.onCardUpdate=null;this.currentFile=null;this.highlights=[];this.app=e,this.plugin=t,this.highlightManager=A}setCallbacks(e){e.onRefreshView&&(this.onRefreshView=e.onRefreshView),e.onHighlightsUpdate&&(this.onHighlightsUpdate=e.onHighlightsUpdate),e.onCardUpdate&&(this.onCardUpdate=e.onCardUpdate)}updateState(e){e.currentFile!==void 0&&(this.currentFile=e.currentFile),e.highlights!==void 0&&(this.highlights=e.highlights)}async addComment(e,t){var n;let A=await this.getFileForHighlight(e);if(!A){new Qs.Notice(p("No corresponding file found."));return}e.id||(e.id=tt.generateHighlightId(((n=this.currentFile)==null?void 0:n.path)||"",e.position||0,e.text)),e.comments||(e.comments=[]);let i={id:tt.generateCommentId(),content:t,createdAt:Date.now(),updatedAt:Date.now()};e.comments.push(i),e.updatedAt=Date.now(),await this.highlightManager.addHighlight(A,e),this.dispatchCommentUpdateEvent(e),this.onCardUpdate?this.onCardUpdate(e):this.onRefreshView&&await this.onRefreshView()}async updateComment(e,t,A){let i=await this.getFileForHighlight(e);if(!i||!e.comments)return;let n=e.comments.find(l=>l.id===t);if(n){let l=n.content;n.content=A,n.updatedAt=Date.now(),e.updatedAt=Date.now(),await this.highlightManager.addHighlight(i,e),this.dispatchCommentUpdateEvent(e),e.id&&this.plugin.eventManager.emitCommentUpdate(i.path,l,A,e.id),this.onCardUpdate?this.onCardUpdate(e):this.onRefreshView&&await this.onRefreshView()}}async deleteComment(e,t){let A=await this.getFileForHighlight(e);if(!(!A||!e.comments)){if(e.comments=e.comments.filter(i=>i.id!==t),e.updatedAt=Date.now(),e.comments.length===0){let i=e.id?this.checkHasFlashcard(e.id):!1;e.isVirtual||!i?(await this.highlightManager.removeHighlight(A,e),this.highlights=this.highlights.filter(n=>n.id&&e.id?n.id!==e.id:!(n.position===e.position&&n.text===e.text)),this.onHighlightsUpdate&&this.onHighlightsUpdate(this.highlights)):await this.highlightManager.addHighlight(A,e)}else await this.highlightManager.addHighlight(A,e);this.dispatchCommentUpdateEvent(e),this.onCardUpdate?this.onCardUpdate(e):this.onRefreshView&&await this.onRefreshView()}}async deleteVirtualHighlight(e){if(!e.isVirtual||e.comments&&e.comments.length>0)return;let t=await this.getFileForHighlight(e);t&&(await this.highlightManager.removeHighlight(t,e),this.highlights=this.highlights.filter(A=>A.id&&e.id?A.id!==e.id:!(A.position===e.position&&A.text===e.text)),this.onHighlightsUpdate&&this.onHighlightsUpdate(this.highlights),this.onRefreshView&&await this.onRefreshView())}async getFileForHighlight(e){if(this.currentFile)return this.currentFile;if(e.filePath){let t=this.app.vault.getAbstractFileByPath(e.filePath);if(t instanceof Qs.TFile)return t}if(e.fileName){let A=this.app.vault.getFiles().find(i=>i.basename===e.fileName||i.name===e.fileName);if(A)return A}return null}checkHasFlashcard(e){let t=this.plugin.fsrsManager;if(!t||!e)return!1;let A=t.findCardsBySourceId(e,"highlight");return A&&A.length>0}dispatchCommentUpdateEvent(e){window.dispatchEvent(new CustomEvent("comment-updated",{detail:{text:e.text,comments:e.comments}}))}};W();var Nt=require("obsidian");var Ss=class{constructor(e,t,A,i,n){this.card=e;this.highlight=t;this.existingComment=A;this.plugin=i;this.options=n;this.cancelEdit=()=>{};this.isProcessing=!1;this.isAIProcessing=!1;this.originalContent="";this.commentEl=null;this.boundHandleOutsideClick=this.handleOutsideClick.bind(this),document.addEventListener("click",this.boundHandleOutsideClick),this.notifyInputShown()}show(){this.existingComment?this.showEditMode():this.showCreateMode()}showEditMode(){var n;let e=this.card.querySelector(`[data-comment-id="${this.existingComment.id}"]`);if(!e)return;this.commentEl=e,e.addClass("editing");let t=e.querySelector(".hi-note-content");if(!t)return;let A=((n=this.existingComment)==null?void 0:n.content)||"";this.textarea=document.createElement("textarea"),this.textarea.value=A,this.textarea.className="hi-note-input",this.textarea.style.minHeight=`${t.offsetHeight}px`,this.textarea.addEventListener("input",()=>{this.autoResizeTextarea()}),this.textarea.addEventListener("click",l=>{l.stopPropagation()}),t.replaceWith(this.textarea);let i=e.querySelector(".hi-note-footer");i&&i.addClass("hi-note-hidden"),this.actionHint=e.createEl("div",{cls:"hi-note-actions-hint"}),this.actionHint.addEventListener("click",l=>{l.stopPropagation()}),this.setupActionHint(),this.options.onDelete&&this.actionHint.createEl("div",{cls:"hi-note-delete-link",text:p("Delete comment")}).addEventListener("click",async c=>{var g,d;if(c.stopPropagation(),!this.isProcessing){this.isProcessing=!0,document.removeEventListener("click",this.boundHandleOutsideClick);try{await((d=(g=this.options).onDelete)==null?void 0:d.call(g)),setTimeout(()=>{this.destroySafe()},0)}catch(m){console.error("\u5220\u9664\u8BC4\u8BBA\u5931\u8D25:",m),document.addEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1}}}),this.setupKeyboardEvents(t,i||void 0),setTimeout(()=>{this.textarea.focus(),this.textarea.setSelectionRange(this.textarea.value.length,this.textarea.value.length)},50)}showCreateMode(){let e=document.createElement("div");e.className="hi-note-input",this.textarea=e.createEl("textarea"),this.textarea.addEventListener("input",()=>{this.autoResizeTextarea()}),e.addEventListener("click",i=>{i.stopPropagation()});let t=this.card.querySelector(".hi-notes-section");t||(t=this.card.createEl("div",{cls:"hi-notes-section"}),t.createEl("div",{cls:"hi-notes-list"}));let A=t.querySelector(".hi-notes-list");A&&A.insertBefore(e,A.firstChild),this.actionHint=e.createEl("div",{cls:"hi-note-actions-hint"}),this.actionHint.addEventListener("click",i=>{i.stopPropagation()}),this.setupActionHint(),this.setupKeyboardEvents(),setTimeout(()=>{this.textarea.focus()},50)}setupKeyboardEvents(e,t){let A=this.existingComment?{contentEl:e,footer:t}:null;this.cancelEdit=()=>{this.cancel(A)},this.textarea.onkeydown=async i=>{if(i.key==="Tab"){i.preventDefault(),await this.handleInlineAI();return}if(i.key==="Enter"){if(Nt.Platform.isMobile)return;if(i.shiftKey||(i.preventDefault(),this.isProcessing))return;let n=this.textarea.value.trim();if(!n)return;this.isProcessing=!0,this.textarea.disabled=!0;try{await this.options.onSave(n),this.destroy()}catch(l){this.textarea.disabled=!1,this.isProcessing=!1}}}}autoResizeTextarea(){this.textarea&&requestAnimationFrame(()=>{if(!this.textarea)return;let e=window.pageYOffset||document.documentElement.scrollTop;this.textarea.style.height="auto";let t=this.textarea.scrollHeight;this.textarea.style.height=`${t}px`,window.scrollTo(0,e)})}handleOutsideClick(e){if(!this.textarea||this.isProcessing)return;let t=e.target;if(!this.textarea.contains(t)&&!t.closest(".hi-note-actions-hint")){e.preventDefault(),e.stopPropagation(),this.isProcessing=!0;let i=this.textarea.value.trim();i?(this.textarea.disabled=!0,this.options.onSave(i).then(()=>{this.destroy()}).catch(()=>{this.textarea.disabled=!1,this.isProcessing=!1})):this.cancel()}}async handleInlineAI(){var t;let e=this.textarea.value.trim();if(!e){new Nt.Notice(p("Please enter AI instruction"));return}if(!this.isAIProcessing){this.originalContent=e;try{this.setAILoading(!0);let A=this.highlight.text||"",n=await new Kt(this.plugin.settings.ai).generateResponse(e,A,((t=this.existingComment)==null?void 0:t.content)||"");this.textarea.value=n,this.autoResizeTextarea(),new Nt.Notice(p("AI response generated"))}catch(A){console.error("AI\u5185\u8054\u751F\u6210\u5931\u8D25:",A),this.textarea.value=this.originalContent,new Nt.Notice(p(`AI generation failed: ${A.message}`))}finally{this.setAILoading(!1)}}}setAILoading(e){if(this.isAIProcessing=e,e){if(this.textarea.disabled=!0,this.textarea.style.opacity="0.6",this.actionHint){let t=this.actionHint.querySelector(".hi-note-delete-link");if(t&&(t.style.visibility="hidden"),!this.actionHint.querySelector(".ai-loading-hint")){let n=this.actionHint.createEl("span",{cls:"ai-loading-hint"}).createEl("span",{cls:"ai-loading-icon"});(0,Nt.setIcon)(n,"loader")}}}else if(this.textarea.disabled=!1,this.textarea.style.opacity="1",this.actionHint){let t=this.actionHint.querySelector(".ai-loading-hint");t&&t.remove();let A=this.actionHint.querySelector(".hi-note-delete-link");A&&(A.style.visibility="")}}cancel(e){var t;if(this.notifyInputClosed(),this.existingComment&&(e!=null&&e.contentEl)&&(e!=null&&e.footer))this.textarea.replaceWith(e.contentEl),this.actionHint.remove(),e.footer.removeClass("hi-note-hidden");else{let A=this.textarea.closest(".hi-note-input");A&&A.remove(),this.card.querySelector(".hi-note")||(t=this.card.querySelector(".hi-notes-section"))==null||t.remove()}document.removeEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1,this.options.onCancel()}destroy(){this.notifyInputClosed(),document.removeEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1,this.textarea&&this.textarea.parentElement&&this.textarea.remove(),this.actionHint&&this.actionHint.parentElement&&this.actionHint.remove(),this.commentEl&&(this.commentEl.removeClass("editing"),this.commentEl=null)}destroySafe(){try{this.notifyInputClosed(),document.removeEventListener("click",this.boundHandleOutsideClick),this.isProcessing=!1,this.textarea&&this.textarea.isConnected&&this.textarea.parentElement&&this.textarea.remove(),this.actionHint&&this.actionHint.isConnected&&this.actionHint.parentElement&&this.actionHint.remove(),this.commentEl&&this.commentEl.isConnected&&(this.commentEl.removeClass("editing"),this.commentEl=null)}catch(e){console.error("[CommentInput] \u5B89\u5168\u9500\u6BC1\u65F6\u51FA\u9519:",e)}}setupActionHint(){Nt.Platform.isMobile?this.actionHint.createEl("button",{cls:"hi-note-save-button",text:p("Submit")}).addEventListener("click",async t=>{t.stopPropagation(),await this.handleSave()}):this.actionHint.createEl("span",{cls:"hi-note-hint",text:p("Tab AI, Shift + Enter Wrap, Enter Save")})}async handleSave(){if(this.isProcessing)return;let e=this.textarea.value.trim();if(e){this.isProcessing=!0,this.textarea.disabled=!0;try{await this.options.onSave(e),this.destroy()}catch(t){this.isProcessing=!1,this.textarea.disabled=!1}}}notifyInputShown(){let e=new CustomEvent("comment-input-shown",{detail:{highlightId:this.highlight.id}});document.dispatchEvent(e)}notifyInputClosed(){let e=new CustomEvent("comment-input-closed",{detail:{highlightId:this.highlight.id}});document.dispatchEvent(e)}};var Us=class{constructor(e){this.onCommentSave=null;this.onCommentDelete=null;this.onCommentCancel=null;this.onViewUpdate=null;this.plugin=e}setCallbacks(e){e.onCommentSave&&(this.onCommentSave=e.onCommentSave),e.onCommentDelete&&(this.onCommentDelete=e.onCommentDelete),e.onCommentCancel&&(this.onCommentCancel=e.onCommentCancel),e.onViewUpdate&&(this.onViewUpdate=e.onViewUpdate)}showCommentInput(e,t,A){this.currentEditingHighlightId=t.id,new Ss(e,t,A,this.plugin,{onSave:async i=>{this.onCommentSave&&await this.onCommentSave(t,i,A),this.onViewUpdate&&await this.onViewUpdate()},onDelete:A?async()=>{this.onCommentDelete&&await this.onCommentDelete(t,A.id)}:void 0,onCancel:async()=>{this.onCommentCancel&&await this.onCommentCancel(t)}}).show()}getCurrentEditingHighlightId(){return this.currentEditingHighlightId}clearEditingState(){this.currentEditingHighlightId=void 0}};var hc=require("obsidian"),bs=class{constructor(e,t,A,i){this.onCreateFloatingButton=null;this.onRemoveFloatingButton=null;this.onUpdateFileList=null;this.isDraggedToMainView=!1;this.isFlashcardMode=!1;this.isShowingFileList=!0;this.isMobileView=!1;this.isSmallScreen=!1;this.containerEl=e,this.fileListContainer=t,this.mainContentContainer=A,this.searchContainer=i}setCallbacks(e){e.onCreateFloatingButton&&(this.onCreateFloatingButton=e.onCreateFloatingButton),e.onRemoveFloatingButton&&(this.onRemoveFloatingButton=e.onRemoveFloatingButton),e.onUpdateFileList&&(this.onUpdateFileList=e.onUpdateFileList)}updateState(e){e.isDraggedToMainView!==void 0&&(this.isDraggedToMainView=e.isDraggedToMainView),e.isFlashcardMode!==void 0&&(this.isFlashcardMode=e.isFlashcardMode),e.isShowingFileList!==void 0&&(this.isShowingFileList=e.isShowingFileList),e.isMobileView!==void 0&&(this.isMobileView=e.isMobileView),e.isSmallScreen!==void 0&&(this.isSmallScreen=e.isSmallScreen)}async updateViewLayout(){this.isMobileView=this.checkIfMobile(),this.isSmallScreen=this.checkIfSmallScreen(),this.fileListContainer.removeClass("highlight-display-block"),this.fileListContainer.removeClass("highlight-display-none"),this.mainContentContainer.removeClass("highlight-display-none");let e=this.containerEl.children[1];this.isDraggedToMainView?e.addClass("is-in-main-view"):e.removeClass("is-in-main-view"),this.isSmallScreen?e.addClass("is-small-screen"):e.removeClass("is-small-screen"),this.isDraggedToMainView?(this.isMobileView&&this.isSmallScreen?this.applySmallScreenLayout():this.applyLargeScreenLayout(),this.onCreateFloatingButton&&this.onCreateFloatingButton(),this.onUpdateFileList&&("requestIdleCallback"in window?requestIdleCallback(async()=>{this.onUpdateFileList&&await this.onUpdateFileList(!0)}):setTimeout(async()=>{this.onUpdateFileList&&await this.onUpdateFileList(!0)},50))):this.applySidebarLayout()}applySmallScreenLayout(){this.isShowingFileList?(this.fileListContainer.addClass("highlight-display-block"),this.mainContentContainer.addClass("highlight-display-none"),this.fileListContainer.addClass("highlight-full-width")):(this.fileListContainer.addClass("highlight-display-none"),this.mainContentContainer.removeClass("highlight-display-none"),this.fileListContainer.removeClass("highlight-full-width"))}applyLargeScreenLayout(){this.fileListContainer.addClass("highlight-display-block"),this.mainContentContainer.removeClass("highlight-display-none"),this.fileListContainer.removeClass("highlight-full-width")}applySidebarLayout(){if(this.fileListContainer.addClass("highlight-display-none"),this.onRemoveFloatingButton&&this.onRemoveFloatingButton(),!this.isFlashcardMode){this.searchContainer.removeClass("highlight-display-none");let e=this.searchContainer.querySelector(".highlight-search-icons");e&&e.removeClass("highlight-display-none")}}checkIfMobile(){return hc.Platform.isMobile}checkIfSmallScreen(){return window.innerWidth<768}getDeviceInfo(){return{isMobile:this.isMobileView,isSmallScreen:this.isSmallScreen,isDraggedToMainView:this.isDraggedToMainView}}};var Ms=class{constructor(e,t){this.onPositionChange=null;this.isDraggedToMainView=!1;this.app=e,this.leaf=t}setCallbacks(e){e.onPositionChange&&(this.onPositionChange=e.onPositionChange)}updateState(e){e.isDraggedToMainView!==void 0&&(this.isDraggedToMainView=e.isDraggedToMainView)}async checkViewPosition(e){let t=this.app.workspace.rootSplit;if(!t)return;let A=this.isViewInMainArea(this.leaf,t);this.isDraggedToMainView!==A&&(this.isDraggedToMainView=A,this.onPositionChange&&await this.onPositionChange(A,e))}isViewInMainArea(e,t){return t&&t.children?t.children.some(A=>A===e?!0:this.isViewInMainArea(e,A)):!1}isDraggedToMain(){return this.isDraggedToMainView}};var gc=require("obsidian"),xs=class{constructor(e,t,A){this.onShowLoading=null;this.onHideLoading=null;this.onShowError=null;this.onShowEmpty=null;this.app=e,this.canvasService=t,this.highlightDataService=A}setCallbacks(e){e.onShowLoading&&(this.onShowLoading=e.onShowLoading),e.onHideLoading&&(this.onHideLoading=e.onHideLoading),e.onShowError&&(this.onShowError=e.onShowError),e.onShowEmpty&&(this.onShowEmpty=e.onShowEmpty)}async processCanvasFile(e){this.onShowLoading&&this.onShowLoading();try{let t=await this.canvasService.parseCanvasFile(e);if(t.length===0)return this.onShowEmpty&&this.onShowEmpty("There are no file nodes in the current Canvas."),[];let A=[];for(let i of t){let n=this.app.vault.getAbstractFileByPath(i);if(n instanceof gc.TFile){let c=(await this.highlightDataService.loadFileHighlights(n)).map(g=>({...g,fileName:n.basename,filePath:n.path,fileIcon:"file-text"}));A.push(...c)}}return this.markAsCanvasHighlights(A,e)}catch(t){return console.error("\u5904\u7406 Canvas \u6587\u4EF6\u5931\u8D25:",t),this.onShowError&&this.onShowError("\u5904\u7406 Canvas \u6587\u4EF6\u65F6\u51FA\u9519"),[]}finally{this.onHideLoading&&this.onHideLoading()}}markAsCanvasHighlights(e,t){return e.map(A=>({...A,isFromCanvas:!0,canvasSource:t.path,isGlobalSearch:!0}))}};var Ua=require("obsidian"),Ls=class{constructor(e,t,A){this.app=e,this.highlightService=t,this.highlightRepository=A}async updateAllHighlights(e="",t=""){return t==="path"?await this.loadHighlightsByPath(e):e?await this.searchHighlightsFromIndex(e):await this.loadAllHighlights()}async loadHighlightsByPath(e){let t=this.highlightService.getAllHighlightsFromCache();if(t)return this.filterCachedHighlightsByPath(t,e);let A=await this.highlightService.getAllHighlights(),i=[];for(let{file:n,highlights:l}of A){if(e&&!n.path.toLowerCase().includes(e.toLowerCase()))continue;let c=await this.highlightRepository.getFileHighlights(n.path),g=this.processFileHighlights(l,c,n);i.push(...g);let d=this.getVirtualHighlights(c,n);i.push(...d)}return this.sortHighlights(i)}async filterCachedHighlightsByPath(e,t){let A=[],i=new Map;for(let n of e){let l=n.filePath||"";t&&!l.toLowerCase().includes(t.toLowerCase())||(i.has(l)||i.set(l,[]),i.get(l).push(n))}for(let[n,l]of i.entries()){let c=this.app.vault.getAbstractFileByPath(n);if(!(c instanceof Ua.TFile))continue;let g=await this.highlightRepository.getFileHighlights(c.path),d=this.processFileHighlights(l,g,c);A.push(...d);let m=this.getVirtualHighlights(g,c);A.push(...m)}return this.sortHighlights(A)}async searchHighlightsFromIndex(e){return(await this.highlightService.searchHighlightsFromIndex(e)).map(A=>({...A,comments:A.comments||[],fileName:A.fileName||this.extractFileNameFromPath(A.filePath),filePath:A.filePath||"",fileIcon:"file-text"}))}async loadAllHighlights(){let e=this.highlightService.getAllHighlightsFromCache();if(e)return this.processCachedHighlights(e);let t=await this.highlightService.getAllHighlights(),A=[];for(let{file:i,highlights:n}of t){let l=await this.highlightRepository.getFileHighlights(i.path),c=this.processFileHighlights(n,l,i);A.push(...c);let g=this.getVirtualHighlights(l,i);A.push(...g)}return this.sortHighlights(A)}async processCachedHighlights(e){let t=[],A=new Map;for(let i of e){let n=i.filePath||"";A.has(n)||A.set(n,[]),A.get(n).push(i)}for(let[i,n]of A.entries()){let l=this.app.vault.getAbstractFileByPath(i);if(!(l instanceof Ua.TFile))continue;let c=await this.highlightRepository.getFileHighlights(l.path),g=this.processFileHighlights(n,c,l);t.push(...g);let d=this.getVirtualHighlights(c,l);t.push(...d)}return this.sortHighlights(t)}processFileHighlights(e,t,A){return this.highlightService.mergeHighlightsWithComments(e,t,A)}getVirtualHighlights(e,t){return[]}extractFileNameFromPath(e){var t;return e&&((t=e.split("/").pop())==null?void 0:t.replace(".md",""))||""}sortHighlights(e){return e.sort((t,A)=>{let i=t.filePath||"",n=A.filePath||"";if(i!==n)return i.localeCompare(n);if(t.isVirtual&&!A.isVirtual)return-1;if(!t.isVirtual&&A.isVirtual)return 1;if(t.position!==void 0&&A.position!==void 0&&t.position!==A.position)return t.position-A.position;if(t.createdAt!==void 0&&A.createdAt!==void 0&&t.createdAt!==A.createdAt)return t.createdAt-A.createdAt;let l=t.id||"",c=A.id||"";return l.localeCompare(c)})}};var yA=require("obsidian");W();var Ts=class{constructor(e,t){this.app=e;this.exportService=t;this.exportButton=null}createExportButton(e,t){return this.exportButton=e.createEl("div",{cls:"highlight-icon-button"}),(0,yA.setIcon)(this.exportButton,"file-symlink"),this.exportButton.setAttribute("aria-label",p("Export as notes")),this.exportButton.addEventListener("click",async()=>{await this.handleExportClick(t())}),this.exportButton}async handleExportClick(e){if(!e){new yA.Notice(p("Please open a file first."));return}try{let t=await this.exportService.exportHighlightsToNote(e);new yA.Notice(p("Successfully exported highlights to: ")+t.path),await this.app.workspace.getLeaf().openFile(t)}catch(t){new yA.Notice(p("Failed to export highlights: ")+t.message)}}async exportHighlightAsImage(e){try{let t=(await Promise.resolve().then(()=>Xl(xa()))).default,{ExportPreviewModal:A}=await Promise.resolve().then(()=>(Bc(),mc));new A(this.app,e,t).open()}catch(t){console.error("[ExportManager] Error exporting as image:",t),new yA.Notice(p("Export failed: Failed to load necessary components."))}}destroy(){this.exportButton&&(this.exportButton.remove(),this.exportButton=null)}};var Cc=require("obsidian"),Ps=class{constructor(e){this.highlightContainer=e;this.currentBatch=0;this.isLoading=!1;this.BATCH_SIZE=20;this.observer=null;this.sentinel=null;this.loadingIndicator=null}setLoadingIndicator(e){this.loadingIndicator=e}reset(){this.currentBatch=0,this.isLoading=!1,this.cleanup()}getCurrentBatch(){return this.currentBatch}setCurrentBatch(e){this.currentBatch=e}async loadMoreHighlights(e,t){if(!this.isLoading){this.isLoading=!0,this.showLoading();try{let A=this.currentBatch*this.BATCH_SIZE,i=e.slice(A,A+this.BATCH_SIZE);if(i.length===0){this.hideLoading(),this.loadingIndicator&&this.loadingIndicator.remove();return}await t(i,!0),this.currentBatch++}catch(A){console.error("[InfiniteScrollManager] Error loading highlights:",A),new Cc.Notice("\u52A0\u8F7D\u9AD8\u4EAE\u5185\u5BB9\u65F6\u51FA\u9519")}finally{this.isLoading=!1,this.hideLoading()}}}async loadUntilScrollable(e,t){let i=0;for(;i<10;){let{scrollHeight:n,clientHeight:l}=this.highlightContainer;if(n>l||this.currentBatch*this.BATCH_SIZE>=e.length)break;await this.loadMoreHighlights(e,t),i++,await new Promise(g=>setTimeout(g,50))}}setupInfiniteScroll(e,t){this.cleanup(),this.sentinel=this.highlightContainer.createEl("div",{cls:"scroll-sentinel"}),this.sentinel.style.height="1px",this.sentinel.style.width="100%",this.observer=new IntersectionObserver(async A=>{A[0].isIntersecting&&!this.isLoading&&await this.loadMoreHighlights(e,t)},{root:this.highlightContainer,rootMargin:"300px",threshold:0}),this.observer.observe(this.sentinel)}showLoading(){this.loadingIndicator&&(this.loadingIndicator.addClass("highlight-display-block"),this.loadingIndicator.removeClass("highlight-display-none"))}hideLoading(){this.loadingIndicator&&(this.loadingIndicator.removeClass("highlight-display-block"),this.loadingIndicator.addClass("highlight-display-none"))}cleanup(){this.observer&&(this.observer.disconnect(),this.observer=null),this.sentinel&&(this.sentinel.remove(),this.sentinel=null)}destroy(){this.cleanup(),this.loadingIndicator=null}};var Ds=class{constructor(e,t){this.app=e;this.plugin=t;this.flashcardComponent=null;this.isFlashcardMode=!1;this.highlightsWithFlashcards=new Set}isInFlashcardMode(){return this.isFlashcardMode}setFlashcardMode(e){this.isFlashcardMode=e}getFlashcardComponent(){return this.flashcardComponent}createFlashcardComponent(e){return this.flashcardComponent&&this.destroyFlashcardComponent(),this.flashcardComponent=new OA(e,this.plugin),this.isFlashcardMode=!0,this.flashcardComponent}destroyFlashcardComponent(){this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.isFlashcardMode=!1}exitFlashcardMode(){this.destroyFlashcardComponent()}updateFlashcardMarkers(e){if(this.highlightsWithFlashcards.clear(),!this.plugin||!this.plugin.fsrsManager)return;let t=this.plugin.fsrsManager;for(let A of e)if(A.id){let i=t.findCardsBySourceId(A.id,"highlight");i&&i.length>0&&this.highlightsWithFlashcards.add(A.id)}}getFlashcardMarkers(){return this.highlightsWithFlashcards}hasFlashcard(e){return this.highlightsWithFlashcards.has(e)}handleBackButton(){if(!this.isFlashcardMode||!this.flashcardComponent)return!1;let e=this.flashcardComponent.getRenderer();return e&&!e.isShowingSidebar()?(e.showSidebar(),!0):!1}destroy(){this.destroyFlashcardComponent(),this.highlightsWithFlashcards.clear()}};var wc=require("obsidian"),Rs=class{constructor(){this.isMobileView=!1;this.isSmallScreen=!1;this.resizeObserver=null;this.onDeviceChangeCallback=null;this.updateDeviceInfo()}setOnDeviceChange(e){this.onDeviceChangeCallback=e}startWatching(e){this.resizeObserver=new ResizeObserver(()=>{let t=this.isMobileView,A=this.isSmallScreen;this.updateDeviceInfo(),(t!==this.isMobileView||A!==this.isSmallScreen)&&this.onDeviceChangeCallback&&this.onDeviceChangeCallback(this.getDeviceInfo())}),this.resizeObserver.observe(e)}stopWatching(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}updateDeviceInfo(){this.isMobileView=this.checkIfMobile(),this.isSmallScreen=this.checkIfSmallScreen()}checkIfMobile(){return wc.Platform.isMobile}checkIfSmallScreen(){return window.innerWidth<768}getDeviceInfo(){return{isMobile:this.isMobileView,isSmallScreen:this.isSmallScreen,isDesktop:!this.isMobileView,isLargeScreen:!this.isSmallScreen}}isMobile(){return this.isMobileView}isSmall(){return this.isSmallScreen}isDesktop(){return!this.isMobileView}isLarge(){return!this.isSmallScreen}destroy(){this.stopWatching(),this.onDeviceChangeCallback=null}};var vc=require("obsidian");W();var Ks=class{initializeUI(e){e.empty(),e.addClass("comment-view-container");let t=e.createEl("div",{cls:"highlight-main-container"}),A=t.createEl("div",{cls:"highlight-file-list-container"}),i=t.createEl("div",{cls:"highlight-content-container"}),n=this.createBackButton(i),l=n.querySelector(".highlight-back-button"),c=i.createEl("div",{cls:"highlight-search-container"}),g=this.createSearchInput(c),d=this.createSearchLoadingIndicator(c),m=c.createEl("div",{cls:"highlight-search-icons"}),C=i.createEl("div",{cls:"highlight-container"}),F=this.createLoadingIndicator();return{mainContainer:t,fileListContainer:A,mainContentContainer:i,backButtonContainer:n,backButton:l,searchContainer:c,searchInput:g,searchLoadingIndicator:d,iconButtonsContainer:m,highlightContainer:C,loadingIndicator:F}}createBackButton(e){let t=e.createEl("div",{cls:"highlight-back-button-container"}),A=t.createEl("div",{cls:"highlight-back-button"});return(0,vc.setIcon)(A,"arrow-left"),A.createEl("span",{text:p("BACK"),cls:"highlight-back-button-text"}),t}createSearchInput(e){let t=e.createEl("input",{cls:"highlight-search-input",attr:{type:"text",placeholder:p("Search...")}});return t.addEventListener("focus",()=>{e.addClass("focused")}),t.addEventListener("blur",()=>{e.removeClass("focused")}),t}createSearchLoadingIndicator(e){let t=e.createEl("div",{cls:"highlight-search-loading"});return t.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="loading-spinner"><circle cx="12" cy="12" r="10"></circle><path d="M12 6v6l4 2"></path></svg>',t.style.display="none",t}createLoadingIndicator(){let e=createEl("div",{cls:"highlight-loading-indicator",text:p("Loading...")});return e.addClass("highlight-display-none"),e}setupMultiSelectListener(e,t){e.addEventListener("highlight-multi-select",A=>{t()})}};var Fc=require("obsidian");var Os=class{constructor(e,t){this.app=e;this.component=t;this.callbacks={};this.eventRefs=[];this.customEventHandlers=new Map}setCallbacks(e){this.callbacks={...this.callbacks,...e}}registerAllEvents(e,t){this.registerFileOpenEvent(e,t),this.registerFileModifyEvent(e,t),this.registerFileCreateEvent(),this.registerFileDeleteEvent(),this.registerLayoutChangeEvent(),this.registerCommentInputEvent()}registerFileOpenEvent(e,t){let A=this.app.workspace.on("file-open",i=>{var n,l,c;if(i&&!t()){let g=this.app.workspace.activeLeaf,d=((l=(n=g==null?void 0:g.getViewState())==null?void 0:n.state)==null?void 0:l.file)!==i.path&&((c=g==null?void 0:g.view)==null?void 0:c.getViewType())==="canvas";this.callbacks.onFileOpen&&this.callbacks.onFileOpen(i,d)}});this.component.registerEvent(A),this.eventRefs.push(A)}registerFileModifyEvent(e,t){let A=this.app.vault.on("modify",i=>{var l,c,g;let n=e();if(i===n&&!t()&&i instanceof Fc.TFile){let d=this.app.workspace.activeLeaf,m=((c=(l=d==null?void 0:d.getViewState())==null?void 0:l.state)==null?void 0:c.file)!==i.path&&((g=d==null?void 0:d.view)==null?void 0:g.getViewType())==="canvas";this.callbacks.onFileModify&&this.callbacks.onFileModify(i,m)}});this.component.registerEvent(A),this.eventRefs.push(A)}registerFileCreateEvent(){let e=this.app.vault.on("create",()=>{this.callbacks.onFileCreate&&this.callbacks.onFileCreate()});this.component.registerEvent(e),this.eventRefs.push(e)}registerFileDeleteEvent(){let e=this.app.vault.on("delete",()=>{this.callbacks.onFileDelete&&this.callbacks.onFileDelete()});this.component.registerEvent(e),this.eventRefs.push(e)}registerLayoutChangeEvent(){let e=this.app.workspace.on("layout-change",()=>{this.callbacks.onLayoutChange&&this.callbacks.onLayoutChange()});this.component.registerEvent(e),this.eventRefs.push(e)}registerCommentInputEvent(){let e=t=>{let{highlightId:A,text:i}=t.detail;this.callbacks.onCommentInput&&this.callbacks.onCommentInput(A,i)};window.addEventListener("open-comment-input",e),this.customEventHandlers.set("open-comment-input",e),this.component.register(()=>{window.removeEventListener("open-comment-input",e)})}registerKeyboardEvents(e){let t=i=>{i.key==="Shift"&&e.addClass("multi-select-mode")},A=i=>{i.key==="Shift"&&e.removeClass("multi-select-mode")};this.component.registerDomEvent(document,"keydown",t),this.component.registerDomEvent(document,"keyup",A)}handleCommentInputDisplay(e,t,A,i){setTimeout(()=>{A.querySelectorAll(".highlight-card").forEach(l=>{l.removeClass("selected")});let n=Ee.findCardInstanceByHighlightId(e);if(!n){let l=Array.from(A.querySelectorAll(".highlight-card")).find(c=>{var d;return((d=c.querySelector(".highlight-text-content"))==null?void 0:d.textContent)===t});l&&(l.addClass("selected"),n=Ee.findCardInstanceByElement(l),l.scrollIntoView({behavior:"smooth"}))}n&&n.showCommentInput()},100)}destroy(){this.customEventHandlers.forEach((e,t)=>{window.removeEventListener(t,e)}),this.customEventHandlers.clear(),this.eventRefs=[],this.callbacks={}}};var ks=class{configureSearchUIManager(e,t){e.setCallbacks(t.onSearch,t.getHighlights,t.getCurrentFile)}configureSelectionManager(e,t){e.setOnSelectionChange(A=>{t&&t.showMultiSelectActions(A)})}configureBatchOperationsHandler(e,t){e.setCallbacks(t.getSelectedHighlights,t.clearSelection,t.refreshView)}configureFileListManager(e,t){}configureHighlightRenderManager(e,t){}configureCommentService(e,t){e.setCallbacks({onRefreshView:t.onRefreshView,onHighlightsUpdate:t.onHighlightsUpdate,onCardUpdate:t.onCardUpdate})}configureCommentInputManager(e,t){e.setCallbacks({onCommentSave:t.onCommentSave,onCommentDelete:t.onCommentDelete,onCommentCancel:t.onCommentCancel,onViewUpdate:t.onViewUpdate})}configureLayoutManager(e,t){e.setCallbacks(t)}configureViewPositionDetector(e,t){e.setCallbacks(t)}configureCanvasProcessor(e,t){e.setCallbacks(t)}};var Ns=class{constructor(){this.currentFile=null;this.highlights=[];this.highlightsWithFlashcards=new Set;this.isFlashcardMode=!1;this.isDraggedToMainView=!1;this.isMobileView=!1;this.isSmallScreen=!1;this.isShowingFileList=!0;this.currentEditingHighlightId=null}isInAllHighlightsView(){return this.currentFile===null}resetHighlights(){this.highlights=[]}};var pt="hinote-view",zi=class zi extends qi.ItemView{constructor(t,A,i){super(t);this.state=new Ns;this.searchUIManager=null;this.selectionManager=null;this.batchOperationsHandler=null;this.fileListManager=null;this.highlightRenderManager=null;this.highlightDataService=null;this.commentService=null;this.commentInputManager=null;this.layoutManager=null;this.viewPositionDetector=null;this.canvasProcessor=null;this.globalHighlightService=null;this.exportManager=null;this.virtualHighlightManager=null;this.infiniteScrollManager=null;this.flashcardViewManager=null;this.deviceManager=null;this.uiInitializer=null;this.eventCoordinator=null;this.callbackConfigurator=null;this.flashcardComponent=null;this.aiButtons=[];this.highlightManager=A,this.highlightRepository=i;let n=this.app.plugins;if(n&&n.plugins&&n.plugins["hi-note"])this.plugin=n.plugins["hi-note"];else throw new Error("Hi-Note plugin not found");this.locationService=new hs(this.app),this.exportService=new Bs(this.app,this.highlightRepository),this.highlightService=this.plugin.highlightService,this.licenseManager=new sA(this.plugin),this.canvasService=this.plugin.canvasService,this.deviceManager=new Rs,this.uiInitializer=new Ks,this.eventCoordinator=new Os(this.app,this),this.callbackConfigurator=new ks,this.exportManager=new Ts(this.app,this.exportService),this.virtualHighlightManager=new _i(this.highlightManager),this.flashcardViewManager=new Ds(this.app,this.plugin),this.eventCoordinator.setCallbacks({onFileOpen:(l,c)=>{this.state.currentFile=l,this.updateHighlights(c)},onFileModify:(l,c)=>{this.fileListManager&&this.fileListManager.invalidateCache(),this.updateHighlights(c)},onFileCreate:()=>{this.fileListManager&&this.fileListManager.invalidateCache()},onFileDelete:()=>{this.fileListManager&&this.fileListManager.invalidateCache()},onLayoutChange:()=>{this.checkViewPosition()},onCommentInput:(l,c)=>{this.eventCoordinator.handleCommentInputDisplay(l,c,this.highlightContainer,(g,d)=>this.showCommentInput(g,d))}}),this.eventCoordinator.registerAllEvents(()=>this.state.currentFile,()=>this.state.isDraggedToMainView)}getViewType(){return pt}getDisplayText(){return"HiNote"}getIcon(){return"highlighter"}async onOpen(){let t=this.containerEl.children[1];t.addEventListener("highlight-multi-select",c=>{this.selectionManager&&this.selectionManager.updateSelectedHighlights()});let A=this.uiInitializer.initializeUI(t);this.fileListContainer=A.fileListContainer,this.mainContentContainer=A.mainContentContainer,this.searchContainer=A.searchContainer,this.searchInput=A.searchInput,this.searchLoadingIndicator=A.searchLoadingIndicator,this.highlightContainer=A.highlightContainer,this.loadingIndicator=A.loadingIndicator,A.backButton.addEventListener("click",()=>{if(this.state.isMobileView&&this.state.isSmallScreen&&this.state.isDraggedToMainView){if(this.state.isFlashcardMode&&this.flashcardComponent){let c=this.flashcardComponent.getRenderer();if(c&&!c.isShowingSidebar()){c.showSidebar();return}}this.state.isShowingFileList=!0,this.updateViewLayout()}}),this.virtualHighlightManager&&this.virtualHighlightManager.createFileCommentButton(A.iconButtonsContainer,{getCurrentFile:()=>this.state.currentFile,getHighlights:()=>this.state.highlights,onVirtualHighlightCreated:c=>{this.state.highlights.unshift(c),this.renderHighlights(this.state.highlights)},onShowCommentInput:(c,g)=>this.showCommentInput(c,g),getHighlightContainer:()=>this.highlightContainer}),this.exportManager&&this.exportManager.createExportButton(A.iconButtonsContainer,()=>this.state.currentFile),this.searchUIManager=new vs(this.plugin,this.searchInput,this.searchLoadingIndicator,this.searchContainer),this.callbackConfigurator&&this.callbackConfigurator.configureSearchUIManager(this.searchUIManager,{onSearch:async(c,g)=>{await this.handleSearch(c,g)},getHighlights:()=>this.state.highlights,getCurrentFile:()=>this.state.currentFile}),this.searchUIManager.initialize(),this.selectionManager=new Fs(this.highlightContainer),this.selectionManager.initialize(),this.registerDomEvent(document,"click",c=>{if(this.selectionManager&&!this.selectionManager.isInSelectionMode()){if(this.selectionManager.getSelectedCount()<=1)return;let d=c.target;!d.closest(".multi-select-actions")&&!d.closest(".highlight-card.selected")&&!d.closest(".highlight-container")&&this.selectionManager.clearSelection()}}),this.batchOperationsHandler=new ys(this.plugin,this.exportService,this.licenseManager,this.highlightService,this.containerEl),this.callbackConfigurator&&(this.callbackConfigurator.configureSelectionManager(this.selectionManager,this.batchOperationsHandler),this.callbackConfigurator.configureBatchOperationsHandler(this.batchOperationsHandler,{getSelectedHighlights:()=>this.selectionManager.getSelectedHighlights(),clearSelection:()=>this.selectionManager.clearSelection(),refreshView:async()=>await this.refreshView()})),this.fileListManager=new Es(this.fileListContainer,this.plugin,this.highlightService,this.licenseManager),this.fileListManager.setCallbacks({onFileSelect:async c=>{this.state.currentFile=c,this.state.isFlashcardMode=!1,this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.highlightContainer.empty(),this.highlightContainer.removeClass("flashcard-mode"),this.fileListManager.updateState({currentFile:this.state.currentFile,isFlashcardMode:this.state.isFlashcardMode}),this.fileListManager.updateFileListSelection(),this.searchContainer.removeClass("highlight-display-none");let g=this.searchContainer.querySelector(".highlight-search-icons");g&&g.removeClass("highlight-display-none"),this.state.isMobileView&&this.state.isSmallScreen&&this.state.isDraggedToMainView&&(this.state.isShowingFileList=!1,this.updateViewLayout()),await this.updateHighlights()},onFlashcardModeToggle:async c=>{this.state.currentFile=null,this.state.isFlashcardMode=c,this.fileListManager.updateState({currentFile:this.state.currentFile,isFlashcardMode:this.state.isFlashcardMode}),this.fileListManager.updateFileListSelection(),this.searchContainer.addClass("highlight-display-none"),this.highlightContainer.empty(),this.flashcardComponent||(this.flashcardComponent=new OA(this.highlightContainer,this.plugin),this.flashcardComponent.setLicenseManager(this.licenseManager)),this.state.isMobileView&&this.state.isSmallScreen&&this.state.isDraggedToMainView&&(this.state.isShowingFileList=!1,this.updateViewLayout()),await this.flashcardComponent.activate()},onAllHighlightsSelect:async()=>{this.state.currentFile=null,this.state.isFlashcardMode=!1,this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.highlightContainer.empty(),this.highlightContainer.removeClass("flashcard-mode"),this.fileListManager.updateState({currentFile:this.state.currentFile,isFlashcardMode:this.state.isFlashcardMode}),this.fileListManager.updateFileListSelection(),this.searchContainer.removeClass("highlight-display-none");let c=this.searchContainer.querySelector(".highlight-search-icons");c&&c.addClass("highlight-display-none"),this.state.isMobileView&&this.state.isSmallScreen&&this.state.isDraggedToMainView&&(this.state.isShowingFileList=!1,this.updateViewLayout()),await this.updateAllHighlights()},onRefreshView:async()=>{this.state.isFlashcardMode?this.flashcardComponent&&await this.flashcardComponent.activate():this.state.currentFile===null?await this.updateAllHighlights():await this.updateHighlights()}}),this.highlightRenderManager=new Vi(this.highlightContainer,this.plugin,this.searchInput),this.highlightRenderManager.setCallbacks({onHighlightClick:async c=>await this.jumpToHighlight(c),onCommentAdd:(c,g)=>this.showCommentInput(c,g),onCommentEdit:(c,g,d)=>this.showCommentInput(c,g,d),onExport:c=>this.exportHighlightAsImage(c),onAIResponse:async(c,g)=>{this.commentService&&(this.commentService.updateState({currentFile:this.state.currentFile,highlights:this.state.highlights}),await this.commentService.addComment(c,g)),await this.updateHighlights()}}),this.highlightDataService=new Is(this.app,this.highlightService,this.highlightRepository),this.commentService=new Hs(this.app,this.plugin,this.highlightManager),this.commentInputManager=new Us(this.plugin),this.callbackConfigurator&&(this.callbackConfigurator.configureCommentService(this.commentService,{onRefreshView:async()=>await this.refreshView(),onHighlightsUpdate:c=>{this.state.highlights=c},onCardUpdate:c=>{let g=this.state.highlights.findIndex(m=>m.id===c.id);g!==-1&&(this.state.highlights[g]=c);let d=Ee.findCardInstanceByHighlightId(c.id||"");d&&d.updateComments(c)}}),this.callbackConfigurator.configureCommentInputManager(this.commentInputManager,{onCommentSave:async(c,g,d)=>{this.commentService&&(this.commentService.updateState({currentFile:this.state.currentFile,highlights:this.state.highlights}),d?await this.commentService.updateComment(c,d.id,g):await this.commentService.addComment(c,g))},onCommentDelete:async(c,g)=>{this.commentService&&(this.commentService.updateState({currentFile:this.state.currentFile,highlights:this.state.highlights}),await this.commentService.deleteComment(c,g))},onCommentCancel:async c=>{c.isVirtual&&(!c.comments||c.comments.length===0)&&this.commentService&&(this.commentService.updateState({currentFile:this.state.currentFile,highlights:this.state.highlights}),await this.commentService.deleteVirtualHighlight(c))},onViewUpdate:async()=>await this.updateHighlights()})),this.layoutManager=new bs(this.containerEl,this.fileListContainer,this.mainContentContainer,this.searchContainer),this.callbackConfigurator&&this.callbackConfigurator.configureLayoutManager(this.layoutManager,{onCreateFloatingButton:()=>{},onRemoveFloatingButton:()=>{},onUpdateFileList:async c=>{this.fileListManager&&(this.fileListManager.updateState({currentFile:this.state.currentFile,isFlashcardMode:this.state.isFlashcardMode,isMobileView:this.state.isMobileView,isSmallScreen:this.state.isSmallScreen,isDraggedToMainView:this.state.isDraggedToMainView}),await this.fileListManager.updateFileList(c))}}),this.viewPositionDetector=new Ms(this.app,this.leaf),this.globalHighlightService=new Ls(this.app,this.highlightService,this.highlightRepository),this.canvasProcessor=new xs(this.app,this.canvasService,this.highlightDataService),this.callbackConfigurator&&this.callbackConfigurator.configureCanvasProcessor(this.canvasProcessor,{onShowLoading:()=>{this.highlightContainer.empty(),this.loadingIndicator&&(this.highlightContainer.appendChild(this.loadingIndicator),this.loadingIndicator.removeClass("highlight-display-none"))},onHideLoading:()=>{this.loadingIndicator&&this.loadingIndicator.addClass("highlight-display-none")},onShowError:c=>{this.highlightContainer.empty(),this.highlightContainer.createDiv({cls:"error-message",text:c})},onShowEmpty:c=>{this.highlightContainer.empty(),this.highlightContainer.createDiv({cls:"no-highlights-message",text:c})}}),this.viewPositionDetector.setCallbacks({onPositionChange:async(c,g)=>{if(this.state.isDraggedToMainView=c,c){let d=this.deviceManager.getDeviceInfo();d.isMobile&&d.isSmallScreen&&(this.state.isShowingFileList=!0);let m=this.app.workspace.getActiveFile();m?(this.state.currentFile=m,await this.updateHighlights()):(this.state.currentFile=null,await this.updateAllHighlights()),this.fileListManager&&(this.fileListManager.updateState({currentFile:this.state.currentFile,isFlashcardMode:this.state.isFlashcardMode}),this.fileListManager.updateFileListSelection())}else{this.state.isFlashcardMode&&(this.state.isFlashcardMode=!1,this.flashcardComponent&&(this.flashcardComponent.deactivate(),this.flashcardComponent=null),this.fileListManager&&(this.fileListManager.updateState({currentFile:this.state.currentFile,isFlashcardMode:this.state.isFlashcardMode}),this.fileListManager.updateFileListSelection()));let d=this.app.workspace.getActiveFile();d?g?(this.state.currentFile=d,this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator),setTimeout(()=>{this.updateHighlights()},zi.CANVAS_UPDATE_DELAY)):(this.state.currentFile=d,this.updateHighlights()):(this.state.highlights=[],this.renderHighlights([]))}if(this.layoutManager&&(this.layoutManager.updateState({isDraggedToMainView:this.state.isDraggedToMainView,isFlashcardMode:this.state.isFlashcardMode,isShowingFileList:this.state.isShowingFileList}),await this.layoutManager.updateViewLayout()),this.searchInput&&this.searchInput.value.trim()!==""){let d=new Event("input",{bubbles:!0});this.searchInput.dispatchEvent(d)}}}),this.eventCoordinator&&this.eventCoordinator.registerKeyboardEvents(this.highlightContainer),this.infiniteScrollManager||(this.infiniteScrollManager=new Ps(this.highlightContainer),this.infiniteScrollManager.setLoadingIndicator(this.loadingIndicator));let i=this.app.workspace.getActiveFile();i&&(this.state.currentFile=i,await this.updateHighlights()),this.updateViewLayout(),this.highlightContainer.empty();let n=this.searchInput.value.toLowerCase().trim(),l=this.state.highlights.filter(c=>{var g,d;return!!(c.text.toLowerCase().includes(n)||(g=c.comments)!=null&&g.some(m=>m.content.toLowerCase().includes(n))||this.state.currentFile===null&&((d=c.fileName)!=null&&d.toLowerCase().includes(n)))});this.renderHighlights(l)}renderHighlights(t,A=!1){var i,n;this.highlightRenderManager&&this.flashcardViewManager&&(this.highlightRenderManager.updateState({currentFile:this.state.currentFile,isDraggedToMainView:this.state.isDraggedToMainView,highlightsWithFlashcards:this.flashcardViewManager.getFlashcardMarkers(),currentBatch:((i=this.infiniteScrollManager)==null?void 0:i.getCurrentBatch())||0}),this.highlightRenderManager.renderHighlights(t,A,(n=this.selectionManager)!=null?n:void 0),this.infiniteScrollManager&&this.infiniteScrollManager.setCurrentBatch(this.highlightRenderManager.getCurrentBatch()))}async jumpToHighlight(t){if(!this.state.isDraggedToMainView&&!t.isGlobalSearch){if(!this.state.currentFile){new qi.Notice(p("No corresponding file found."));return}await this.locationService.jumpToHighlight(t,this.state.currentFile.path)}}async exportHighlightAsImage(t){this.exportManager&&await this.exportManager.exportHighlightAsImage(t)}async showCommentInput(t,A,i){this.commentInputManager&&this.commentInputManager.showCommentInput(t,A,i)}async checkViewPosition(){if(this.viewPositionDetector){let t=this.isInAllHighlightsView();await this.viewPositionDetector.checkViewPosition(t)}}async updateViewLayout(){if(this.layoutManager){this.layoutManager.updateState({isDraggedToMainView:this.state.isDraggedToMainView,isFlashcardMode:this.state.isFlashcardMode,isShowingFileList:this.state.isShowingFileList}),await this.layoutManager.updateViewLayout();let t=this.deviceManager.getDeviceInfo();this.state.isMobileView=t.isMobile,this.state.isSmallScreen=t.isSmallScreen}}async updateAllHighlights(t="",A=""){this.infiniteScrollManager&&this.infiniteScrollManager.reset(),this.state.highlights=[],this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator);try{this.globalHighlightService&&(this.state.highlights=await this.globalHighlightService.updateAllHighlights(t,A)),await this.loadMoreHighlights(),await this.loadUntilScrollable(),this.setupInfiniteScroll()}catch(i){console.error("[CommentView] Error in updateAllHighlights:",i),new qi.Notice(p("Error loading all highlights")),this.highlightContainer.empty(),this.highlightContainer.createEl("div",{cls:"highlight-empty-state",text:p("Error loading highlights. Please try again.")})}finally{this.loadingIndicator.removeClass("highlight-display-block")}}async loadMoreHighlights(){this.infiniteScrollManager&&await this.infiniteScrollManager.loadMoreHighlights(this.state.highlights,async(t,A)=>await this.renderHighlights(t,A))}async loadUntilScrollable(){this.infiniteScrollManager&&await this.infiniteScrollManager.loadUntilScrollable(this.state.highlights,async(t,A)=>await this.renderHighlights(t,A))}setupInfiniteScroll(){this.infiniteScrollManager&&this.infiniteScrollManager.setupInfiniteScroll(this.state.highlights,async(t,A)=>await this.renderHighlights(t,A))}onunload(){var t,A,i,n,l,c;(t=this.searchUIManager)==null||t.destroy(),(A=this.selectionManager)==null||A.destroy(),(i=this.batchOperationsHandler)==null||i.destroy(),(n=this.fileListManager)==null||n.destroy(),(l=this.highlightRenderManager)==null||l.clear(),(c=this.commentInputManager)==null||c.clearEditingState(),this.searchUIManager=null,this.selectionManager=null,this.batchOperationsHandler=null,this.fileListManager=null,this.highlightRenderManager=null,this.highlightDataService=null,this.commentService=null,this.commentInputManager=null,this.layoutManager=null,this.viewPositionDetector=null,this.canvasProcessor=null,this.globalHighlightService=null}updateAIDropdowns(){this.aiButtons.forEach(t=>{}),this.app.workspace.trigger("comment-view:update-ai-dropdowns")}registerAIButton(t){this.aiButtons.push(t)}unregisterAIButton(t){let A=this.aiButtons.indexOf(t);A!==-1&&this.aiButtons.splice(A,1)}isInAllHighlightsView(){return this.state.currentFile===null}async handleSearch(t,A){try{if(this.state.highlights.some(n=>n.isGlobalSearch)&&A!=="all"&&A!=="path"&&this.state.currentFile){this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator),await this.updateHighlights(),this.state.highlights.forEach(l=>{l.isGlobalSearch=!1});let n=this.searchUIManager.filterHighlightsByTerm(t,A);this.renderHighlights(n);return}if((A==="all"||A==="path")&&this.state.currentFile!==null){this.highlightContainer.empty(),this.highlightContainer.appendChild(this.loadingIndicator);let n=this.state.currentFile;try{this.state.currentFile=null,await this.updateAllHighlights(t,A),this.state.highlights.forEach(l=>{l.isGlobalSearch=!0}),this.renderHighlights(this.state.highlights)}finally{this.state.currentFile=n}}else{this.state.highlights.forEach(l=>{l.isGlobalSearch=!1});let n=this.searchUIManager.filterHighlightsByTerm(t,A);this.renderHighlights(n)}}catch(i){console.error("[\u9AD8\u4EAE\u641C\u7D22] \u641C\u7D22\u8FC7\u7A0B\u4E2D\u51FA\u9519:",i)}}async refreshView(){this.isInAllHighlightsView()?await this.updateAllHighlights():await this.updateHighlights()}async updateHighlights(t=!1){if(this.isInAllHighlightsView()){await this.updateAllHighlights();return}if(!this.state.currentFile){this.renderHighlights([]);return}if(this.state.currentFile.extension==="canvas"){await this.handleCanvasFile(this.state.currentFile);return}if(this.state.currentFile.extension==="md"?this.highlightDataService?this.state.highlights=await this.highlightDataService.loadFileHighlights(this.state.currentFile):this.state.highlights=[]:this.state.highlights=[],this.virtualHighlightManager&&this.state.currentFile){let A=await this.virtualHighlightManager.filterVirtualHighlights(this.state.currentFile,this.state.highlights);this.state.highlights.unshift(...A)}if(t&&this.state.currentFile&&this.state.highlights.forEach(A=>{var i;A.isFromCanvas=!0,A.isGlobalSearch=!0,A.fileName=(i=this.state.currentFile)==null?void 0:i.name}),this.flashcardViewManager&&this.flashcardViewManager.updateFlashcardMarkers(this.state.highlights),this.searchInput&&this.searchInput.value.trim()!==""&&this.searchUIManager){let A=this.searchInput.value.toLowerCase().trim(),i=this.searchUIManager.filterHighlightsByTerm(A,"");this.renderHighlights(i)}else this.renderHighlights(this.state.highlights)}async handleCanvasFile(t){this.canvasProcessor&&(this.state.highlights=await this.canvasProcessor.processCanvasFile(t),this.renderHighlights(this.state.highlights))}};zi.CANVAS_UPDATE_DELAY=10,zi.COMMENT_INPUT_DELAY=100;var at=zi;var bc=require("obsidian");var At=require("obsidian");W();var nA=require("obsidian");W();var Gs=class{constructor(e,t){this.containerEl=e,this.plugin=t,this.rules=t.settings.regexRules||[],this.rulesContainer=e.createDiv({cls:"regex-rules-container"}),this.display()}display(){this.rulesContainer.empty();let e=this.rulesContainer.createDiv({cls:"regex-rule-warning"});e.innerHTML=p("Use regex with caution. If there are capture groups (), the first capture group will be used as the highlight text; if there are no capture groups, the entire match will be used."),this.rules.length===0?this.rulesContainer.createDiv().setText(p('No custom regex rules. Click "+" to add a new rule.')):this.rules.forEach((i,n)=>{this.createRuleItem(i,n)});let t=this.rulesContainer.createDiv({cls:"regex-rule-add"});t.createSpan({cls:"regex-rule-add-text"}).setText(p("Add new rule")),t.addEventListener("click",()=>{let i={id:`rule-${Date.now()}`,name:"",pattern:"",color:"#ffeb3b",enabled:!0};this.rules.push(i),this.saveRules(),this.display()})}createRuleItem(e,t){let A=this.rulesContainer.createDiv({cls:"regex-rule-item"}),i=new nA.TextComponent(A);i.setPlaceholder(p("Rule name")),i.setValue(e.name),i.onChange(m=>{e.name=m,this.saveRules()});let n=new nA.TextComponent(A);n.setPlaceholder(p("Regular expression with capture groups")),n.setValue(e.pattern),n.onChange(m=>{e.pattern=m,this.saveRules()});let l=A.createDiv(),c=new nA.TextComponent(l);c.setPlaceholder("#ffeb3b"),c.setValue(e.color),c.inputEl.addClass("color-input"),c.onChange(m=>{let C=m.trim();C&&(C.startsWith("#")||C.startsWith("rgb")||C.startsWith("rgba"))&&(e.color=C,this.saveRules())});let g=A.createDiv({cls:"regex-rule-delete"});(0,nA.setIcon)(g,"trash-2"),g.setAttr("aria-label",p("Delete rule")),g.addEventListener("click",()=>{this.rules.splice(t,1),this.saveRules(),this.display()});let d=new nA.ToggleComponent(A);d.setValue(e.enabled),d.onChange(m=>{e.enabled=m,this.saveRules()}),d.toggleEl.addClass("regex-rule-toggle")}async saveRules(){this.plugin.settings.regexRules=this.rules,await this.plugin.saveSettings()}};var Vs=class{constructor(e,t){this.plugin=e,this.containerEl=t}async updateOrphanedDataCount(e){try{let t=e.querySelector(".orphaned-data-count, .no-orphaned-data");t&&t.remove();let A=await this.plugin.highlightManager.checkOrphanedDataCount(),i=document.createElement("div");A.orphanedHighlights>0?(i.className="orphaned-data-count",i.textContent=`Found ${A.orphanedHighlights} orphaned highlights in ${A.affectedFiles} files.`):(i.className="no-orphaned-data",i.textContent="No orphaned data found."),e.appendChild(i)}catch(t){console.error("[HiNote] Error updating orphaned data count:",t)}}display(){let e=this.containerEl.createEl("div",{cls:"general-settings-container"});new At.Setting(e).setName(p("Export Path")).setDesc(p("Set the path for exported highlight notes. Leave empty to use vault root. The path should be relative to your vault root.")).addText(g=>g.setPlaceholder("Example: folder 1/folder 2").setValue(this.plugin.settings.export.exportPath||"").onChange(async d=>{d=d.replace(/^\/+/,""),d=d.replace(/\/+$/,""),this.plugin.settings.export.exportPath=d,await this.plugin.saveSettings()})),new At.Setting(e).setName(p("Exclusions")).setDesc(p("Comma separated list of paths, tags, note titles or file extensions that will be excluded from highlighting. e.g. folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md")).addTextArea(g=>{g.setPlaceholder("folder1, folder1/folder2, [[note1]], [[note2]], *.excalidraw.md").setValue(this.plugin.settings.excludePatterns||"").onChange(async d=>{let m=d.split(",").map(C=>C.trim()).filter(C=>C.length>0);this.plugin.settings.excludePatterns=d,await this.plugin.saveSettings()}),g.inputEl.rows=4,g.inputEl.cols=40}),new At.Setting(e).setName(p("Export template")).setDesc(p("Customize the format of exported highlights and comments using variables. Available variables: {{highlightText}}, {{highlightBlockRef}}, {{commentContent}}, {{commentDate}}. Leave empty to use default template.")).addTextArea(g=>{g.setPlaceholder(`> [!quote] HiNote
> {{highlightText}}
> 
>> [!note]+ {{commentDate}}
>> {{commentContent}}`).setValue(this.plugin.settings.export.exportTemplate||"").onChange(async m=>{this.plugin.settings.export.exportTemplate=m,await this.plugin.saveSettings()}),g.inputEl.rows=5,g.inputEl.cols=40}),new At.Setting(e).setName(p("Show Comment Widget")).setDesc(p("Show or hide the comment widget next to highlights. Disabling this can reduce visual clutter while reading.")).addToggle(g=>{var d;return g.setValue((d=this.plugin.settings.showCommentWidget)!=null?d:!0).onChange(async m=>{this.plugin.settings.showCommentWidget=m,await this.plugin.saveSettings(),this.plugin.highlightDecorator&&this.plugin.highlightDecorator.refreshDecorations()})}),new At.Setting(e).setName(p("Custom text extraction")).setHeading(),new At.Setting(e).setName(p("Use custom rules")).setDesc(p("Enable to use custom regex rules to extract highlight text.")).addToggle(g=>g.setValue(this.plugin.settings.useCustomPattern).onChange(async d=>{this.plugin.settings.useCustomPattern=d,await this.plugin.saveSettings()}));let t=e.createDiv({cls:"regex-editor-container"});new Gs(t,this.plugin),new At.Setting(e).setName(p("Data management")).setHeading();let A=new At.Setting(e).setName(p("Clean orphaned data")).setDesc(p("Remove highlights and comments that no longer exist in your documents. This is useful if you have deleted highlights but their comments are still stored in the data file.")),i=0,n=0,l=!1,c=A.addButton(g=>{g.setButtonText(p("Check")),g.onClick(async()=>{g.setButtonText(p("Checking...")),g.setDisabled(!0);try{let d=await this.plugin.highlightManager.checkOrphanedDataCount();i=d.orphanedHighlights,n=d.affectedFiles,l=!0;let m=A.descEl,C=m.querySelector(".orphaned-data-count, .no-orphaned-data");C&&C.remove();let F=document.createElement("div");i>0?(F.className="orphaned-data-count",F.textContent=`Found ${i} orphaned highlights in ${n} files.`,g.setButtonText(p("Clean data")),g.setDisabled(!1),g.onClick(async()=>{g.setButtonText(p("Cleaning...")),g.setDisabled(!0);try{let y=await this.plugin.highlightManager.cleanOrphanedData();y.removedHighlights>0?new At.Notice(`Cleaned ${y.removedHighlights} orphaned highlights from ${y.affectedFiles} files.`):new At.Notice("No orphaned data found."),g.setButtonText(p("Check")),l=!1,F&&F.parentElement&&F.parentElement.removeChild(F)}catch(y){console.error("[HiNote] Error cleaning orphaned data:",y),new At.Notice("Error cleaning orphaned data. Check console for details."),g.setButtonText(p("Check"))}finally{g.setDisabled(!1)}})):(F.className="no-orphaned-data",F.textContent="No orphaned data found.",g.setButtonText(p("Check")),g.setDisabled(!1)),m.appendChild(F)}catch(d){console.error("[HiNote] Error checking orphaned data:",d),new At.Notice("Error checking orphaned data. Check console for details."),g.setButtonText(p("Check")),g.setDisabled(!1)}})})}};var Uc=require("obsidian");W();var aA=require("obsidian");var ot=require("obsidian");W();var Ge=class{constructor(e,t){this.plugin=e,this.containerEl=t}createModelDropdown(e,t,A){new ot.Setting(e).setName(p("Model")).setDesc(p("Select the AI model to use")).addDropdown(i=>{let n=Object.fromEntries(t.map(l=>[l.id,l.name]));return i.addOptions(n).setValue(this.plugin.settings.ai.model||A.id).onChange(async l=>{this.plugin.settings.ai.model=l,await this.plugin.saveSettings()})})}getProviderSettings(e){return this.plugin.settings.ai[e.settingsKey]||(this.plugin.settings.ai[e.settingsKey]={...e.defaultSettings}),this.plugin.settings.ai[e.settingsKey]}initializeStandardModelState(e){let t=this.getProviderSettings(e),A;if(t.isCustomModel)A={id:t.model,name:t.model,isCustom:!0};else{let i=e.defaultModels.find(n=>n.id===t.model);A=i||e.defaultModels[0],i||(t.model=A.id)}return{selectedModel:A,apiKey:t.apiKey||""}}async saveStandardModelState(e,t){let A=this.getProviderSettings(e),i=t.selectedModel;A.model=i.id,A.isCustomModel=!!i.isCustom,A.apiKey=t.apiKey||"",i.isCustom&&i.id&&(A.lastCustomModel=i.id),await this.plugin.saveSettings()}renderApiKeySetting(e,t,A,i){new ot.Setting(e).setName(p("API Key")).setDesc(p("Please enter your API Key.")).addText(n=>n.setPlaceholder(t.apiKeyPlaceholder).setValue(A.apiKey).onChange(async l=>{A.apiKey=l,await this.saveStandardModelState(t,A)})).addButton(n=>{n.setButtonText(p("Check")),n.onClick(async()=>{if(!A.apiKey||A.apiKey.trim()===""){this.showButtonStatus(n.buttonEl,"warning");return}this.showButtonStatus(n.buttonEl,"loading");try{let l=await i();this.showButtonStatus(n.buttonEl,l?"success":"error")}catch(l){this.showButtonStatus(n.buttonEl,"error")}})})}showButtonStatus(e,t){let A=e.textContent||p("Check");switch(e.empty(),e.disabled=t==="loading",e.removeClass("check-btn-loading","check-btn-success","check-btn-error","check-btn-warning"),t){case"loading":(0,ot.setIcon)(e,"loader-2"),e.addClass("check-btn-loading");break;case"success":(0,ot.setIcon)(e,"check"),e.addClass("check-btn-success"),this.resetButtonAfterDelay(e,A,2e3);break;case"error":(0,ot.setIcon)(e,"x"),e.addClass("check-btn-error"),this.resetButtonAfterDelay(e,A,2e3);break;case"warning":(0,ot.setIcon)(e,"alert-triangle"),e.addClass("check-btn-warning"),this.resetButtonAfterDelay(e,A,2e3);break}}resetButtonAfterDelay(e,t,A){setTimeout(()=>{e.empty(),e.textContent=t,e.disabled=!1,e.removeClass("check-btn-loading","check-btn-success","check-btn-error","check-btn-warning")},A)}renderModelSelector(e,t,A,i){let n=new ot.Setting(e).setName(p("Model")).setDesc(p("Select a model or enter a custom one.")).addDropdown(m=>{t.defaultModels.forEach(F=>{m.addOption(F.id,F.name)}),m.addOption("custom",p("Custom Model"));let C=A.selectedModel.isCustom?"custom":A.selectedModel.id;return m.setValue(C),i.modelSelectEl=m.selectEl,m.onChange(async F=>{if(F==="custom")await this.showStandardCustomModelInput(t,A,i);else{let y=t.defaultModels.find(Q=>Q.id===F);if(y){if(A.selectedModel.isCustom){let Q=this.getProviderSettings(t);Q.lastCustomModel=A.selectedModel.id,await this.plugin.saveSettings()}A.selectedModel=y,await this.saveStandardModelState(t,A),this.hideStandardCustomModelInput(i)}}}),m});i.customModelContainer=n.settingEl.createDiv("custom-model-container"),i.customModelContainer.addClass("custom-model-container");let l=n.settingEl.querySelector(".setting-item-control");l&&(l.addClass("openai-dropdown-container"),l.insertBefore(i.customModelContainer,l.firstChild));let g=new ot.Setting(i.customModelContainer).addText(m=>m.setPlaceholder("model-id").setValue(A.selectedModel.isCustom?A.selectedModel.id:"").onChange(async C=>{let F=C.trim();if(F){if(!/^[a-zA-Z0-9-_./:]+$/.test(F)){new ot.Notice(p("Model ID can only contain letters, numbers, underscores, dots and hyphens.")),m.setValue(A.selectedModel.id);return}A.selectedModel={id:F,name:F,isCustom:!0},await this.saveStandardModelState(t,A)}})).settingEl;g.addClass("openai-setting-no-border");let d=g.querySelector(".setting-item-control");d&&d.addClass("openai-setting-no-margin"),A.selectedModel.isCustom&&this.showStandardCustomModelInput(t,A,i)}async showStandardCustomModelInput(e,t,A){if(A.customModelContainer&&A.modelSelectEl){A.customModelContainer.addClass("visible"),A.modelSelectEl.value="custom";let i=this.getProviderSettings(e);if(!t.selectedModel.isCustom){let l=i.lastCustomModel||"";t.selectedModel={id:l,name:l,isCustom:!0},i.model=l,i.isCustomModel=!0,await this.plugin.saveSettings();let c=A.customModelContainer.querySelector("input");c&&(c.value=l)}}}hideStandardCustomModelInput(e){e.customModelContainer&&e.customModelContainer.removeClass("visible")}renderProviderUrlSetting(e,t){let A=t.providerUrlKey||"apiAddress";new ot.Setting(e).setName(p("Provider URL")).setDesc(p("Leave it blank, unless you are using a proxy.")).addText(i=>i.setPlaceholder(t.providerUrlPlaceholder).setValue(this.getProviderSettings(t)[A]||"").onChange(async n=>{let l=this.getProviderSettings(t);l[A]=n,await this.plugin.saveSettings()}))}};W();var yc=[{id:"gpt-4o",name:"GPT-4o"},{id:"gpt-4o-mini",name:"GPT-4o Mini"},{id:"gpt-o1",name:"GPT-o1"},{id:"gpt-4",name:"GPT-4"},{id:"gpt-4-turbo",name:"GPT-4 Turbo"}],Zi={settingsKey:"openai",serviceName:"OpenAI",defaultModels:yc,apiKeyPlaceholder:"sk-...",providerUrlPlaceholder:"https://api.openai.com/v1",providerUrlKey:"apiAddress",defaultSettings:{apiKey:"",model:yc[0].id,apiAddress:"",isCustomModel:!1,lastCustomModel:""}},_s=class extends Ge{constructor(t,A){super(t,A);this.refs={modelSelectEl:null,customModelContainer:null};this.modelState=this.initializeStandardModelState(Zi)}display(t){let A=t.createEl("div",{cls:"ai-service-settings"});new aA.Setting(A).setName(p("OpenAI service")).setHeading(),this.renderApiKeySetting(A,Zi,this.modelState,async()=>(await this.fetchAvailableModels(this.modelState.apiKey)).length>0),this.renderModelSelector(A,Zi,this.modelState,this.refs),this.renderProviderUrlSetting(A,Zi)}async validateModel(t,A,i){try{return(await(0,aA.requestUrl)({url:`${i}/models/${A}`,method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).status!==200?(new aA.Notice(p("Custom model unavailable. Please check the model ID and your access permissions.")),!1):(await(0,aA.requestUrl)({url:`${i}/chat/completions`,method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({model:A,messages:[{role:"user",content:"Hello"}],max_tokens:1})})).status===200}catch(n){return!1}}async fetchAvailableModels(t){try{let A=this.getProviderSettings(Zi).apiAddress||"https://api.openai.com/v1";if(this.modelState.selectedModel.isCustom){let n=this.modelState.selectedModel.id;if(!await this.validateModel(t,n,A))throw new Error(`Custom model not available: ${n}`);return[this.modelState.selectedModel]}let i=await(0,aA.requestUrl)({url:`${A}/models`,method:"GET",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});return i.status===200?i.json.data.map(l=>({id:l.id,name:l.id})):[]}catch(A){throw A}}};var Ic=require("obsidian");W();var Ec=[{id:"claude-opus-4-1-20250805",name:"Claude Opus 4.1"},{id:"claude-opus-4-20250514",name:"Claude Opus 4"},{id:"claude-sonnet-4-20250514",name:"Claude Sonnet 4"},{id:"claude-3-7-sonnet-20250219",name:"Claude Sonnet 3.7"},{id:"claude-3-5-haiku-20241022",name:"Claude Haiku 3.5"},{id:"claude-3-haiku-20240307",name:"Claude Haiku 3"}],ji={settingsKey:"anthropic",serviceName:"Anthropic",defaultModels:Ec,apiKeyPlaceholder:"sk-ant-...",providerUrlPlaceholder:"https://api.anthropic.com",providerUrlKey:"apiAddress",defaultSettings:{apiKey:"",model:Ec[0].id,apiAddress:"",isCustomModel:!1,lastCustomModel:""}},Ws=class extends Ge{constructor(t,A){super(t,A);this.refs={modelSelectEl:null,customModelContainer:null};this.modelState=this.initializeStandardModelState(ji)}display(t){let A=t.createEl("div",{cls:"ai-service-settings"});new Ic.Setting(A).setName(p("Anthropic service")).setHeading(),this.renderApiKeySetting(A,ji,this.modelState,async()=>{let i=this.getProviderSettings(ji).apiAddress||"https://api.anthropic.com",n=this.modelState.selectedModel.id,{AnthropicService:l}=await Promise.resolve().then(()=>(As(),ic)),c=new l(this.modelState.apiKey,i,n);return await Bt.testConnection(c,"Anthropic")}),this.renderModelSelector(A,ji,this.modelState,this.refs),this.renderProviderUrlSetting(A,ji)}};var Hc=require("obsidian");W();var Da=[{id:"deepseek-chat",name:"Deepseek Chat"},{id:"deepseek-reasoner",name:"Deepseek Reasoner"}],Ra=[{id:"gemini-2.5-flash",name:"Gemini 2.5 Flash"},{id:"gemini-2.5-pro",name:"Gemini 2.5 Pro"},{id:"gemini-2.5-flash-lite",name:"Gemini 2.5 Flash Lite"},{id:"gemini-1.5-flash",name:"Gemini 1.5 Flash (Legacy)"},{id:"gemini-1.5-pro",name:"Gemini 1.5 Pro (Legacy)"},{id:"gemini-2.0-flash",name:"Gemini 2.0 Flash (Legacy)"}],zA=[{id:"deepseek-ai/DeepSeek-V3",name:"DeepSeek V3",isCustom:!1},{id:"Qwen/Qwen2.5-7B-Instruct",name:"Qwen2.5 7B",isCustom:!1},{id:"Qwen/Qwen2.5-14B-Instruct",name:"Qwen2.5 14B",isCustom:!1},{id:"Pro/Qwen/Qwen2-7B-Instruct",name:"Qwen2 7B",isCustom:!1},{id:"Pro/THUDM/glm-4-9b-chat",name:"GLM-4 9B",isCustom:!1},{id:"google/gemma-2-9b-it",name:"Gemma2 9B",isCustom:!1}],Gt={excludePatterns:"",useCustomPattern:!1,regexRules:[{id:"default-md",name:"Default Highlight",pattern:"==([^=\\n](?:[^=\\n]|=[^=\\n])*?[^=\\n])==",color:"#ffeb3b",enabled:!0},{id:"default-mark",name:"Mark format",pattern:"<mark[^>]*>([\\s\\S]*?)</mark>",color:"#ffeb3b",enabled:!0},{id:"default-span",name:"Span format",pattern:"<span[^>]*>([\\s\\S]*?)</span>",color:"#ffeb3b",enabled:!0}],ai:{provider:"ollama",ollama:{host:"http://localhost:11434",model:""},gemini:{apiKey:"",model:"gemini-pro",baseUrl:"",isCustomModel:!1},openai:{apiKey:"",model:"gpt-4o",baseUrl:""},anthropic:{apiKey:"",model:"claude-2",apiAddress:"",isCustomModel:!1,lastCustomModel:""},deepseek:{apiKey:"",model:"deepseek-chat",baseUrl:""},siliconflow:{apiKey:"",model:zA[0].id,baseUrl:"",isCustomModel:!1,lastCustomModel:""},prompts:{"\u{1F914} Key Insight":"{{highlight}}.Please reinterpret the above content from a fresh perspective and summarize its core idea within 200 characters."}},export:{exportPath:""},contextOptions:{strategy:"smart",includeTitle:!0,maxLength:2e3,surroundingLines:3},showCommentWidget:!0};var er={settingsKey:"deepseek",serviceName:"Deepseek",defaultModels:Da,apiKeyPlaceholder:"dsk-...",providerUrlPlaceholder:"https://api.deepseek.com/v1",providerUrlKey:"apiAddress",defaultSettings:{apiKey:"",model:Da[0].id,apiAddress:"",isCustomModel:!1,lastCustomModel:""}},Xs=class extends Ge{constructor(t,A){super(t,A);this.refs={modelSelectEl:null,customModelContainer:null};this.modelState=this.initializeStandardModelState(er)}display(t){let A=t.createEl("div",{cls:"ai-service-settings"});new Hc.Setting(A).setName(p("Deepseek service")).setHeading(),this.renderApiKeySetting(A,er,this.modelState,async()=>{let i="https://api.deepseek.com",n=this.getProviderSettings(er).apiAddress,l=n&&n.trim()?n:i,c=this.modelState.selectedModel.id,{DeepseekService:g}=await Promise.resolve().then(()=>(rs(),sc)),d=new g(this.modelState.apiKey,c,l);return await Bt.testConnection(d,"Deepseek")}),this.renderModelSelector(A,er,this.modelState,this.refs),this.renderProviderUrlSetting(A,er)}};var Qc=require("obsidian");W();var tr={settingsKey:"gemini",serviceName:"Gemini",defaultModels:Ra,apiKeyPlaceholder:"Enter your API key",providerUrlPlaceholder:"https://generativelanguage.googleapis.com",providerUrlKey:"baseUrl",defaultSettings:{apiKey:"",model:Ra[0].id,baseUrl:"",isCustomModel:!1,lastCustomModel:""}},Js=class extends Ge{constructor(t,A){super(t,A);this.refs={modelSelectEl:null,customModelContainer:null};this.modelState=this.initializeStandardModelState(tr)}display(t){let A=t.createEl("div",{cls:"ai-service-settings"});new Qc.Setting(A).setName(p("Gemini service")).setHeading(),this.renderApiKeySetting(A,tr,this.modelState,async()=>{let i="https://generativelanguage.googleapis.com",n=this.getProviderSettings(tr).baseUrl,l=n&&n.trim()?n:i,c=this.modelState.selectedModel.id,{GeminiService:g}=await Promise.resolve().then(()=>(is(),rc)),d=new g(this.modelState.apiKey,c,l);return await Bt.testConnection(d,"Gemini")}),this.renderModelSelector(A,tr,this.modelState,this.refs),this.renderProviderUrlSetting(A,tr)}};var Ys=require("obsidian");W();var $s=class extends Ge{async display(e){var n,l,c;let t=e.createEl("div",{cls:"ai-service-settings"});new Ys.Setting(t).setName(p("Ollama service")).setHeading();let A="http://localhost:11434";(n=this.plugin.settings.ai.ollama)!=null&&n.host||(this.plugin.settings.ai.ollama||(this.plugin.settings.ai.ollama={}),this.plugin.settings.ai.ollama.host=A,await this.plugin.saveSettings()),new Ys.Setting(t).setName(p("Server URL")).setDesc(p("Ollama server URL (default: http://localhost:11434)")).addText(g=>{var d;return g.setPlaceholder(A).setValue(((d=this.plugin.settings.ai.ollama)==null?void 0:d.host)||A).onChange(async m=>{this.plugin.settings.ai.ollama||(this.plugin.settings.ai.ollama={}),this.plugin.settings.ai.ollama.host=m||A,await this.plugin.saveSettings()}),g}).addButton(g=>{g.setButtonText(p("Check")),g.onClick(async()=>{var m;let d=((m=this.plugin.settings.ai.ollama)==null?void 0:m.host)||A;if(!d||d.trim()===""){this.showButtonStatus(g.buttonEl,"warning");return}this.showButtonStatus(g.buttonEl,"loading");try{let F=await new BA(d).listModels();this.showButtonStatus(g.buttonEl,F&&F.length>0?"success":"error")}catch(C){this.showButtonStatus(g.buttonEl,"error")}})}),(c=(l=this.plugin.settings.ai.ollama)==null?void 0:l.availableModels)!=null&&c.length&&this.displayOllamaModelDropdown(t,this.plugin.settings.ai.ollama.availableModels)}displayOllamaModelDropdown(e,t){let A=e.querySelector(".model-setting");A&&A.remove(),new Ys.Setting(e).setName(p("Model")).setDesc(p("Select a Ollama model.")).addDropdown(n=>{var d;let l=Object.fromEntries(t.map(m=>[m,m])),c=(d=this.plugin.settings.ai.ollama)==null?void 0:d.model,g=t.includes(c)?c:t[0];return n.addOptions(l).setValue(g).onChange(async m=>{this.plugin.settings.ai.ollama||(this.plugin.settings.ai.ollama={}),this.plugin.settings.ai.ollama.model=m,await this.plugin.saveSettings()})}).settingEl.addClass("model-setting")}};var Sc=require("obsidian");W();var zs={settingsKey:"siliconflow",serviceName:"SiliconFlow",defaultModels:zA,apiKeyPlaceholder:"sk-...",providerUrlPlaceholder:"https://api.siliconflow.cn/v1",providerUrlKey:"baseUrl",defaultSettings:{apiKey:"",model:zA[0].id,baseUrl:"",isCustomModel:!1,lastCustomModel:""}},qs=class extends Ge{constructor(t,A){super(t,A);this.refs={modelSelectEl:null,customModelContainer:null};this.modelState=this.initializeStandardModelState(zs)}display(t){let A=t.createEl("div",{cls:"ai-service-settings"});new Sc.Setting(A).setName(p("SiliconFlow service")).setHeading(),this.renderApiKeySetting(A,zs,this.modelState,async()=>{let{SiliconFlowService:i}=await Promise.resolve().then(()=>(ss(),nc)),n=new i(this.plugin.settings.ai);return await Bt.testConnection(n,"SiliconFlow")}),this.renderModelSelector(A,zs,this.modelState,this.refs),this.renderProviderUrlSetting(A,zs)}};var St=require("obsidian");W();var Zs=class extends Ge{constructor(t,A){super(t,A);this.detectedApiType=null}display(t){var l,c;let A=t.createEl("div",{cls:"ai-service-settings"});new St.Setting(A).setName(p("Custom AI Service")).setHeading();let i=A.createEl("div",{cls:"setting-item-description custom-ai-description"});if(i.createEl("p",{text:p("Configure your own AI service provider. Supports OpenAI, Anthropic, and Gemini compatible APIs.")}),i.createEl("p",{text:p("The API type will be automatically detected based on your URL.")}),new St.Setting(A).setName(p("Service Name")).setDesc(p("Give your custom AI service a name")).addText(g=>{var d;return g.setPlaceholder(p("e.g., My AI Service")).setValue(((d=this.plugin.settings.ai.custom)==null?void 0:d.name)||"").onChange(async m=>{this.plugin.settings.ai.custom||(this.plugin.settings.ai.custom={name:"",apiKey:"",baseUrl:"",model:""}),this.plugin.settings.ai.custom.name=m,await this.plugin.saveSettings()})}),new St.Setting(A).setName(p("API Endpoint URL")).setDesc(p("The base URL of your AI service API")).addText(g=>{var d;return g.setPlaceholder("https://api.example.com/v1").setValue(((d=this.plugin.settings.ai.custom)==null?void 0:d.baseUrl)||"").onChange(async m=>{this.plugin.settings.ai.custom||(this.plugin.settings.ai.custom={name:"",apiKey:"",baseUrl:"",model:""}),this.plugin.settings.ai.custom.baseUrl=m,this.plugin.settings.ai.custom.detectedApiType=void 0,this.detectedApiType=null,await this.plugin.saveSettings()})}),new St.Setting(A).setName(p("API Key")).setDesc(p("Your API key for authentication")).addText(g=>{var d;return g.setPlaceholder("sk-...").setValue(((d=this.plugin.settings.ai.custom)==null?void 0:d.apiKey)||"").onChange(async m=>{this.plugin.settings.ai.custom||(this.plugin.settings.ai.custom={name:"",apiKey:"",baseUrl:"",model:""}),this.plugin.settings.ai.custom.apiKey=m,await this.plugin.saveSettings()}),g.inputEl.type="password",g}).addButton(g=>{g.setButtonText(p("Check")),g.onClick(async()=>{var d,m,C,F;if(!((d=this.plugin.settings.ai.custom)!=null&&d.apiKey)||!((m=this.plugin.settings.ai.custom)!=null&&m.baseUrl)||!((C=this.plugin.settings.ai.custom)!=null&&C.model)){this.showButtonStatus(g.buttonEl,"warning");return}this.showButtonStatus(g.buttonEl,"loading");try{let y=await this.testConnection();if(this.showButtonStatus(g.buttonEl,y?"success":"error"),y){let Q=(F=this.plugin.settings.ai.custom)==null?void 0:F.detectedApiType;if(Q){this.detectedApiType=Q;let U={openai:"OpenAI",anthropic:"Anthropic",gemini:"Gemini"},b=A.querySelector(".custom-ai-info");if(!b)b=A.createEl("div",{cls:"setting-item-description custom-ai-info"}),b.createEl("strong",{text:p("Detected API Type: ")}),b.createEl("span",{text:U[Q]||Q});else{let P=b.querySelector("span");P&&(P.textContent=U[Q]||Q)}}}}catch(y){this.showButtonStatus(g.buttonEl,"error")}})}),new St.Setting(A).setName(p("Model")).setDesc(p("The model identifier to use")).addText(g=>{var d;return g.setPlaceholder("gpt-4, claude-3-opus, gemini-pro, etc.").setValue(((d=this.plugin.settings.ai.custom)==null?void 0:d.model)||"").onChange(async m=>{this.plugin.settings.ai.custom||(this.plugin.settings.ai.custom={name:"",apiKey:"",baseUrl:"",model:""}),this.plugin.settings.ai.custom.model=m,await this.plugin.saveSettings()})}),(l=this.plugin.settings.ai.custom)!=null&&l.detectedApiType||this.detectedApiType){let g=((c=this.plugin.settings.ai.custom)==null?void 0:c.detectedApiType)||this.detectedApiType,d={openai:"OpenAI",anthropic:"Anthropic",gemini:"Gemini"},m=A.createEl("div",{cls:"setting-item-description custom-ai-info"});m.createEl("strong",{text:p("Detected API Type: ")}),m.createEl("span",{text:d[g]||g})}let n=new St.Setting(A).setName(p("Advanced Options")).setDesc(p("Optional custom headers (JSON format)"));n.descEl.createEl("br"),n.descEl.createEl("small",{text:p('Example: {"X-Custom-Header": "value"}')}),n.addTextArea(g=>{var d;return g.setPlaceholder("{}").setValue((d=this.plugin.settings.ai.custom)!=null&&d.headers?JSON.stringify(this.plugin.settings.ai.custom.headers,null,2):"").onChange(async m=>{if(!m.trim()){this.plugin.settings.ai.custom&&(this.plugin.settings.ai.custom.headers=void 0,await this.plugin.saveSettings());return}try{let C=JSON.parse(m);if(typeof C!="object"||Array.isArray(C)){new St.Notice(p("Invalid JSON format. Headers must be an object."));return}this.plugin.settings.ai.custom||(this.plugin.settings.ai.custom={name:"",apiKey:"",baseUrl:"",model:""}),this.plugin.settings.ai.custom.headers=C,await this.plugin.saveSettings()}catch(C){new St.Notice(p("Invalid JSON format"))}}),g.inputEl.rows=4,g.inputEl.style.fontFamily="monospace",g})}async testConnection(){try{let{CustomAIService:t}=await Promise.resolve().then(()=>(ns(),ac)),A=this.plugin.settings.ai.custom;if(!A)return!1;let i=new t(A.apiKey,A.baseUrl,A.model,A.headers,A.detectedApiType),n=await i.testConnection();if(n){let l=i.getDetectedAPIType();l&&A&&(A.detectedApiType=l,await this.plugin.saveSettings())}return n}catch(t){return console.error("Test connection error:",t),!1}}};var qA=require("obsidian"),js=require("obsidian");W();var en=class{constructor(e,t){this.plugin=e,this.containerEl=t}display(){let e=this.containerEl.createEl("div",{cls:"prompt-settings-container"}),t=e.createEl("div",{cls:"prompt-settings-header setting-item-heading"});t.createEl("h4",{text:p("Prompt settings"),cls:"prompt-settings-title"});let A=t.createEl("button",{cls:"prompt-add-btn",attr:{"aria-label":p("Add prompt")}});(0,js.setIcon)(A,"plus"),A.onclick=()=>{if(e.querySelector(".new-prompt-section"))return;let i=e.querySelector(".prompt-list");i&&this.createNewPromptForm(e,i)},this.displayPromptList(e)}createNewPromptForm(e,t){var d;let A=e.createEl("div",{cls:"new-prompt-section"});(d=t.parentElement)==null||d.insertBefore(A,t);let i=A.createEl("input",{cls:"prompt-name-input",attr:{placeholder:p("Input Prompt Name"),type:"text"}}),n=new qA.TextAreaComponent(A);n.setPlaceholder(p(`Input Prompt Content
Available parameters:
{{highlight}} - Current highlighted text
{{comment}} - Existing comment`)).setValue(""),n.inputEl.addClass("prompt-textarea");let l=A.createEl("div",{cls:"prompt-buttons"}),c=l.createEl("button",{cls:"prompt-save-btn",text:p("Save")});c.onclick=async()=>{var F;let m=i.value,C=n.getValue();if(m&&C){this.plugin.settings.ai.prompts||(this.plugin.settings.ai.prompts={}),this.plugin.settings.ai.prompts[m]=C,await this.plugin.saveSettings(),A.remove(),this.displayPromptList(e),new qA.Notice(p("Prompt added"));let y=(F=this.plugin.app.workspace.getLeavesOfType("hinote-view")[0])==null?void 0:F.view;y&&y.updateAIDropdowns()}};let g=l.createEl("button",{cls:"prompt-cancel-btn",text:p("Cancel")});g.onclick=()=>{A.remove()}}displayPromptList(e){let t=e.querySelector(".prompt-list");t&&t.remove();let A=e.createEl("div",{cls:"prompt-list"}),i=this.plugin.settings.ai.prompts||{};for(let[n,l]of Object.entries(i)){let c=A.createEl("div",{cls:"prompt-item"}),g=c.createEl("div",{cls:"prompt-display-mode"}),d=g.createEl("div",{cls:"prompt-info"});d.createEl("div",{cls:"prompt-name",text:n});let m=l.replace(/\n/g," ");d.createEl("div",{cls:"prompt-content-preview",text:m});let F=g.createEl("div",{cls:"prompt-buttons"}).createEl("button",{cls:"prompt-edit-btn",attr:{"aria-label":p("Edit")}});(0,js.setIcon)(F,"square-pen");let y=c.createEl("div",{cls:"prompt-edit-mode hi-note-hidden"}),Q=y.createEl("input",{cls:"prompt-name-input",attr:{value:n,type:"text"}}),U=new qA.TextAreaComponent(y);U.setValue(l),U.inputEl.classList.add("prompt-content-input"),U.inputEl.addClass("prompt-textarea");let b=y.createEl("div",{cls:"prompt-edit-buttons"}),P=b.createEl("button",{cls:"prompt-save-btn",text:p("Save")}),q=b.createEl("button",{cls:"prompt-cancel-btn",text:p("Cancel")}),k=b.createEl("button",{cls:"prompt-delete-btn",attr:{"aria-label":p("Delete")}});(0,js.setIcon)(k,"trash-2"),F.onclick=()=>{g.addClass("hi-note-hidden"),y.removeClass("hi-note-hidden")},k.onclick=async()=>{var G;delete this.plugin.settings.ai.prompts[n],await this.plugin.saveSettings(),c.remove();let N=(G=this.plugin.app.workspace.getLeavesOfType("hinote-view")[0])==null?void 0:G.view;N&&N.updateAIDropdowns()},P.onclick=async()=>{var Z;let N=Q.value,G=U.getValue();if(N&&G){N!==n&&delete this.plugin.settings.ai.prompts[n],this.plugin.settings.ai.prompts[N]=G,await this.plugin.saveSettings(),this.displayPromptList(e),new qA.Notice(p("Prompt updated"));let ae=(Z=this.plugin.app.workspace.getLeavesOfType("hinote-view")[0])==null?void 0:Z.view;ae&&ae.updateAIDropdowns()}},q.onclick=()=>{g.removeClass("hi-note-hidden"),y.addClass("hi-note-hidden")}}}};var tn=class{constructor(e,t){this.plugin=e,this.containerEl=t}display(){switch(new Uc.Setting(this.containerEl).setName("AI service").setDesc(p("Select the AI service provider")).addDropdown(e=>{let t={openai:"OpenAI",gemini:"Gemini",anthropic:"Anthropic",deepseek:"Deepseek",siliconflow:"SiliconFlow",ollama:"Ollama (Local)",custom:p("Custom AI Service")};return e.addOptions(t).setValue(this.plugin.settings.ai.provider).onChange(async A=>{this.plugin.settings.ai.provider=A,await this.plugin.saveSettings(),this.containerEl.empty(),this.display()})}),this.plugin.settings.ai.provider){case"openai":new _s(this.plugin,this.containerEl).display(this.containerEl);break;case"gemini":new Js(this.plugin,this.containerEl).display(this.containerEl);break;case"anthropic":new Ws(this.plugin,this.containerEl).display(this.containerEl);break;case"ollama":new $s(this.plugin,this.containerEl).display(this.containerEl);break;case"deepseek":new Xs(this.plugin,this.containerEl).display(this.containerEl);break;case"siliconflow":new qs(this.plugin,this.containerEl).display(this.containerEl);break;case"custom":new Zs(this.plugin,this.containerEl).display(this.containerEl);break}new en(this.plugin,this.containerEl).display()}};var Ke=require("obsidian");W();var Ar=class{constructor(e,t){this.plugin=e,this.containerEl=t,this.fsrsService=e.fsrsManager.fsrsService}display(){let e=this.containerEl.createEl("div",{cls:"flashcard-settings-container"});new Ke.Setting(e).setName(p("Flashcard learning")).setHeading(),new Ke.Setting(e).setName(p("New cards per day")).setDesc(p("Maximum number of new cards to learn each day")).addSlider(n=>{var g;let l=this.fsrsService.getParameters();n.setLimits(1,200,1).setValue(l.newCardsPerDay).setDynamicTooltip().onChange(async d=>{let m=this.fsrsService.getParameters();m.newCardsPerDay=d,this.fsrsService.setParameters(m),await this.plugin.saveSettings()});let c=createEl("span",{cls:"slider-value",text:String(l.newCardsPerDay)});(g=n.sliderEl.parentElement)==null||g.appendChild(c),n.sliderEl.addEventListener("input",()=>{c.textContent=String(n.getValue())})}),new Ke.Setting(e).setName(p("Reviews per day")).setDesc(p("Maximum number of cards to review each day")).addSlider(n=>{var g;let l=this.fsrsService.getParameters();n.setLimits(10,500,10).setValue(l.reviewsPerDay).setDynamicTooltip().onChange(async d=>{let m=this.fsrsService.getParameters();m.reviewsPerDay=d,this.fsrsService.setParameters(m),await this.plugin.saveSettings()});let c=createEl("span",{cls:"slider-value",text:String(l.reviewsPerDay)});(g=n.sliderEl.parentElement)==null||g.appendChild(c),n.sliderEl.addEventListener("input",()=>{c.textContent=String(n.getValue())})}),new Ke.Setting(e).setName(p("Target retention")).setDesc(p("Target memory retention rate (0.8 = 80%)")).addSlider(n=>{var g;let l=this.fsrsService.getParameters();n.setLimits(.7,.95,.01).setValue(l.request_retention).setDynamicTooltip().onChange(async d=>{let m=this.fsrsService.getParameters();m.request_retention=d,this.fsrsService.setParameters(m),await this.plugin.saveSettings()});let c=createEl("span",{cls:"slider-value",text:`${Math.round(l.request_retention*100)}%`});(g=n.sliderEl.parentElement)==null||g.appendChild(c),n.sliderEl.addEventListener("input",()=>{c.textContent=`${Math.round(n.getValue()*100)}%`})}),new Ke.Setting(e).setName(p("Maximum interval")).setDesc(p("Maximum interval in days between reviews")).addText(n=>{let l=this.fsrsService.getParameters();n.setValue(l.maximum_interval.toString()).setPlaceholder("365").onChange(async d=>{let m=parseInt(d);if(!isNaN(m)&&m>0){let C=this.fsrsService.getParameters();C.maximum_interval=m,this.fsrsService.setParameters(C),await this.plugin.saveSettings()}});let c=n.inputEl;c.type="number",c.min="1",c.style.width="80px";let g=createEl("span",{text:` ${p("days")}`,cls:"setting-item-suffix"});c.after(g)}),new Ke.Setting(e).setName(p("Reset daily stats")).setDesc(p("Reset today's learning statistics")).addButton(n=>n.setButtonText(p("Reset")).onClick(async()=>{let l=new Date;l.setHours(0,0,0,0);let c=this.plugin.fsrsManager.storage.dailyStats,g=c.findIndex(d=>d.date===l.getTime());g>=0?(c.splice(g,1),await this.plugin.fsrsManager.saveStorage(),new Ke.Notice(p("Daily statistics have been reset"))):new Ke.Notice(p("No statistics to reset for today"))})),new Ke.Setting(e).setName(p("Advanced")).setHeading(),e.createEl("p",{text:p("These settings control the FSRS algorithm parameters. Only change them if you understand the algorithm."),cls:"setting-item-description"}),new Ke.Setting(e).setName(p("Reset algorithm parameters")).setDesc(p("Reset the FSRS algorithm parameters to default values")).addButton(n=>n.setButtonText(p("Reset to default")).onClick(async()=>{this.fsrsService.resetParameters(),await this.plugin.saveSettings();let l=this.fsrsService.getParameters(),c=this.containerEl.querySelector(".setting-item:nth-child(4) .slider"),g=this.containerEl.querySelector(".setting-item:nth-child(4) .slider-value");c&&g&&(c.value=String(l.request_retention),g.textContent=`${Math.round(l.request_retention*100)}%`);let d=this.containerEl.querySelector('.setting-item:nth-child(5) input[type="number"]');d&&(d.value=String(l.maximum_interval));let m=this.containerEl.querySelector(".setting-item:nth-child(2) .slider"),C=this.containerEl.querySelector(".setting-item:nth-child(2) .slider-value");m&&C&&(m.value=String(l.newCardsPerDay),C.textContent=String(l.newCardsPerDay));let F=this.containerEl.querySelector(".setting-item:nth-child(3) .slider"),y=this.containerEl.querySelector(".setting-item:nth-child(3) .slider-value");F&&y&&(F.value=String(l.reviewsPerDay),y.textContent=String(l.reviewsPerDay));let Q=this.containerEl.querySelector(".fsrs-weights-textarea");Q&&(Q.value=JSON.stringify(l.w)),new Ke.Notice(p("FSRS parameters have been reset to default values"))}));let t=e.createEl("div",{cls:"fsrs-params-container"});t.createEl("p",{text:p("FSRS weight parameter. The default value is obtained from a smaller sample; if adjustment is needed, please use the FSRS optimizer for calculation."),cls:"setting-item-description"});let A=this.fsrsService.getParameters(),i=JSON.stringify(A.w);new Ke.Setting(t).setName(p("FSRS parameters")).setDesc(p("Edit the 21 FSRS algorithm weights. Format: JSON array of numbers.")).addTextArea(n=>{n.setValue(i).setPlaceholder("[0.4872, 1.4003, ...]").onChange(async l=>{try{let c=JSON.parse(l);if(Array.isArray(c)&&c.length===21&&c.every(g=>typeof g=="number")){let g=this.fsrsService.getParameters();g.w=c,this.fsrsService.setParameters(g),await this.plugin.saveSettings(),new Ke.Notice(p("FSRS weights updated successfully"))}else new Ke.Notice(p("Invalid format. Must be an array of 21 numbers."),5e3)}catch(c){new Ke.Notice(p("Invalid JSON format. Please check your input."),5e3)}}),n.inputEl.rows=2,n.inputEl.cols=32,n.inputEl.addClass("fsrs-weights-textarea")})}};W();var An=class extends bc.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t,this.DEFAULT_SETTINGS=t.DEFAULT_SETTINGS,this.licenseManager=new sA(this.plugin)}async display(){let{containerEl:e}=this;e.empty();let t=e.createEl("div",{cls:"setting-tabs"}),A=e.createEl("div",{cls:"setting-tab-content"}),i=t.createEl("div",{text:p("General"),cls:"setting-tab-btn active",attr:{role:"button",tabindex:"0"}}),n=t.createEl("div",{text:p("AI service"),cls:"setting-tab-btn",attr:{role:"button",tabindex:"0"}}),l=null,c=A.createEl("div",{cls:"setting-tab-pane active"}),g=A.createEl("div",{cls:"setting-tab-pane"}),d=null,m=(C,F)=>{t.findAll(".setting-tab-btn").forEach(y=>y.removeClass("active")),A.findAll(".setting-tab-pane").forEach(y=>y.removeClass("active")),C.addClass("active"),F.addClass("active")};i.onclick=()=>m(i,c),n.onclick=()=>m(n,g),new Vs(this.plugin,c).display(),new tn(this.plugin,g).display(),l=t.createEl("div",{text:"HiCard",cls:"setting-tab-btn",attr:{role:"button",tabindex:"0"}}),d=A.createEl("div",{cls:"setting-tab-pane"}),l.onclick=async()=>{var F;if(m(l,d),d.empty(),await this.licenseManager.isActivated())new Ar(this.plugin,d).display();else{let y=d.createEl("div",{cls:"flashcard-activation-container"});y.createEl("div",{cls:"flashcard-activation-header",text:p("Activate HiCard")});let Q=y.createEl("div",{cls:"flashcard-activation-description"});Q.createEl("span",{text:p("Enter your license key to activate HiCard feature.")+" "}),Q.createEl("br"),Q.createEl("span",{text:p("Get your license key from")+" "});let b=(((F=window.moment)==null?void 0:F.locale())||"en").startsWith("zh")?"https://www.hinote.vip/index.html":"https://www.hinote.vip/en.html",P=Q.createEl("a",{text:p("HiNote official website"),cls:"external-link",href:b});P.setAttr("target","_blank"),P.setAttr("rel","noopener noreferrer");let q=y.createEl("div",{cls:"flashcard-activation-input-container"}),k=q.createEl("input",{cls:"flashcard-activation-input",type:"text",placeholder:p("Enter license key")}),N=q.createEl("button",{cls:"flashcard-activation-button",text:p("Activate")}),G=y.createEl("div",{cls:"activation-msg"});N.onclick=async()=>{N.setAttr("disabled","true"),G.textContent=p("Verifying..."),await this.licenseManager.activateLicense(k.value)?(G.textContent=p("Activation successful!"),d.empty(),new Ar(this.plugin,d).display()):(G.textContent=p("Activation failed. Please check your license key."),N.removeAttribute("disabled"))}}}}};var $c=Xl(xa());var Lc=require("obsidian");var Mc=require("obsidian");var rn=class{constructor(e){this.plugin=e;this.aiService=new Kt(this.plugin.settings.ai)}updateModel(e,t){if(this.aiService){let A=e;this.aiService.updateModel(A,t)}}async sendMessage(e,t=[]){try{let A=t.map(n=>({role:n.role,content:n.content}));return A.push({role:"user",content:e}),{content:await this.aiService.chat(A),type:"assistant",timestamp:Date.now()}}catch(A){throw new Mc.Notice("\u83B7\u53D6 AI \u54CD\u5E94\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u670D\u52A1\u914D\u7F6E\u548C\u7F51\u7EDC\u8FDE\u63A5"),A}}async testConnection(){return await this.aiService.testConnection()}};var xc=require("obsidian"),sn=class{constructor(e){this.app=e}async getContextForHighlight(e,t={strategy:"paragraph",includeTitle:!0,maxLength:2e3}){if(!e.filePath)return null;let A=this.app.vault.getAbstractFileByPath(e.filePath);if(!A||!(A instanceof xc.TFile))return null;let i=await this.app.vault.read(A),n=this.app.metadataCache.getFileCache(A);switch(t.strategy){case"paragraph":return this.getParagraphContext(i,e,A,n,t);case"section":return this.getSectionContext(i,e,A,n,t);case"surrounding":return this.getSurroundingContext(i,e,A,t);case"smart":return this.getSmartContext(i,e,A,n,t);default:return this.getParagraphContext(i,e,A,n,t)}}getParagraphContext(e,t,A,i,n){let l=e.split(`
`),c=t.text,g=-1;for(let U=0;U<l.length;U++)if(l[U].includes(c)){g=U;break}if(g===-1)return this.createContextInfo("","",A,e);let d=g,m=g;for(;d>0&&l[d-1].trim()!=="";)d--;for(;m<l.length-1&&l[m+1].trim()!=="";)m++;let C=l.slice(d,g).join(`
`),F=l.slice(g+1,m+1).join(`
`),y=l.slice(d,m+1).join(`
`),Q=this.findSectionTitle(l,g);return this.createContextInfo(C,F,A,y,Q,n.maxLength)}getSectionContext(e,t,A,i,n){if(!(i!=null&&i.sections))return this.getParagraphContext(e,t,A,i,n);let l=e.split(`
`),c=t.text,g=e.indexOf(c);if(g===-1)return this.createContextInfo("","",A,e);let d=i.sections.find(Q=>Q.position.start.offset<=g&&Q.position.end.offset>=g);if(!d)return this.getParagraphContext(e,t,A,i,n);let m=e.substring(d.position.start.offset,d.position.end.offset),C=e.substring(d.position.start.offset,g),F=e.substring(g+c.length,d.position.end.offset),y=this.findSectionTitle(l,this.getLineFromOffset(e,g));return this.createContextInfo(C,F,A,m,y,n.maxLength)}getSurroundingContext(e,t,A,i){let n=e.split(`
`),l=t.text,c=i.surroundingLines||3,g=-1;for(let U=0;U<n.length;U++)if(n[U].includes(l)){g=U;break}if(g===-1)return this.createContextInfo("","",A,e);let d=Math.max(0,g-c),m=Math.min(n.length-1,g+c),C=n.slice(d,g).join(`
`),F=n.slice(g+1,m+1).join(`
`),y=n.slice(d,m+1).join(`
`),Q=this.findSectionTitle(n,g);return this.createContextInfo(C,F,A,y,Q,i.maxLength)}getSmartContext(e,t,A,i,n){let l=this.getSectionContext(e,t,A,i,n);return l.fullContext.length>(n.maxLength||2e3)?this.getParagraphContext(e,t,A,i,n):l}findSectionTitle(e,t){for(let A=t;A>=0;A--){let i=e[A].trim();if(i.startsWith("#"))return i}}getLineFromOffset(e,t){return e.substring(0,t).split(`
`).length-1}createContextInfo(e,t,A,i,n,l){let c=i;if(l&&i.length>l){let g=Math.floor(l/2),d=i.substring(0,g),m=i.substring(i.length-g);c=`${d}

... [\u5185\u5BB9\u5DF2\u622A\u65AD] ...

${m}`}return{beforeContext:e,afterContext:t,sectionTitle:n,filePath:A.path,fileName:A.name,fullContext:c}}async getContextForMultipleHighlights(e,t={strategy:"paragraph"}){let A=[];for(let i of e){let n=await this.getContextForHighlight(i,t);n&&A.push(n)}return A}};var ZA=class ZA{constructor(){this.chatHistory=[];this.draggedContents=[];this.currentPreviewContainer=null;this.chatModelState={provider:"",model:""}}getChatHistory(){return this.chatHistory}setChatHistory(e){this.chatHistory=e}addToHistory(e){this.chatHistory.push(e)}clearHistory(){this.chatHistory=[]}getDraggedContents(){return this.draggedContents}setDraggedContents(e){this.draggedContents=e}addDraggedContent(e){this.draggedContents.push(e)}removeDraggedContent(e){let t=this.draggedContents.indexOf(e);t>-1&&this.draggedContents.splice(t,1)}clearDraggedContents(){this.draggedContents=[]}getCurrentPreviewContainer(){return this.currentPreviewContainer}setCurrentPreviewContainer(e){this.currentPreviewContainer=e}getModelState(){return this.chatModelState}setModelState(e){this.chatModelState=e}saveState(){ZA.savedState={chatHistory:[...this.chatHistory],draggedContents:[...this.draggedContents],currentPreviewContainer:this.currentPreviewContainer!==null}}static getSavedState(){return ZA.savedState}static clearSavedState(){ZA.savedState=null}restoreState(e){this.chatHistory=e.chatHistory,this.draggedContents=e.draggedContents}};ZA.savedState=null;var ir=ZA;var Ka=require("obsidian");W();var nn=class{constructor(e,t,A){this.textarea=null;this.app=e,this.plugin=t,this.stateManager=A,this.containerEl=document.createElement("div")}buildChatWindow(e,t,A,i){this.containerEl.addClass("highlight-chat-window");let n=this.buildHeader(e,t,A,i),l=this.buildChatHistory(),c=this.buildInputArea(),g=this.containerEl.createEl("div",{cls:"highlight-chat-resize-handle"});return this.setupResizeHandle(g),this.setupWindowDrag(n,e,t),this.containerEl}buildHeader(e,t,A,i){let n=this.containerEl.createEl("div",{cls:"highlight-chat-header"}),l=n.createEl("div",{cls:"highlight-chat-title"});l.createEl("span",{text:p("Chat")});let c=l.createEl("div",{cls:"highlight-chat-model",text:i()});c.addEventListener("click",C=>{C.stopPropagation(),A(c,C)});let g=n.createEl("div",{cls:"highlight-chat-buttons"}),d=g.createEl("div",{cls:"highlight-chat-clear"});(0,Ka.setIcon)(d,"eraser"),d.addEventListener("click",e);let m=g.createEl("div",{cls:"highlight-chat-close"});return(0,Ka.setIcon)(m,"x"),m.addEventListener("click",t),n}buildChatHistory(){return this.containerEl.createEl("div",{cls:"highlight-chat-history"})}buildInputArea(){return this.containerEl.createEl("div",{cls:"highlight-chat-input-container"})}setupChatInput(e,t){let A=e.createEl("div",{cls:"highlight-chat-input-wrapper"});this.textarea=A.createEl("textarea",{cls:"highlight-chat-input",attr:{placeholder:p("Input message..."),rows:"1"}});let i=()=>{this.textarea&&(this.textarea.addClass("highlight-chat-input"),this.textarea.style.height=`${Math.min(this.textarea.scrollHeight,150)}px`)};return this.textarea.addEventListener("input",()=>{i()}),this.textarea.addEventListener("keydown",n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),this.textarea&&t(this.textarea))}),this.textarea}setupResizeHandle(e){let t=!1,A=0,i=0,n=0,l=0;e.addEventListener("mousedown",d=>{d.preventDefault(),d.stopPropagation(),t=!0,A=d.clientX,i=d.clientY;let m=this.containerEl.getBoundingClientRect();n=m.width,l=m.height,document.addEventListener("mousemove",c),document.addEventListener("mouseup",g),this.containerEl.addClass("resizing")});let c=d=>{if(!t)return;let m=d.clientX-A,C=d.clientY-i,F=Math.max(300,n+m),y=Math.max(300,l+C),Q=Math.min(F,window.innerWidth*.9),U=Math.min(y,window.innerHeight*.9);this.containerEl.style.width=`${Q}px`,this.containerEl.style.height=`${U}px`},g=()=>{t=!1,document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",g),this.containerEl.removeClass("resizing")}}setupWindowDrag(e,t,A){let i=!1,n,l,c,g;e.addEventListener("mousedown",d=>{d.target.closest(".highlight-chat-clear")||d.target.closest(".highlight-chat-close")||(i=!0,c=d.clientX-this.containerEl.offsetLeft,g=d.clientY-this.containerEl.offsetTop,e.addClass("dragging"))}),document.addEventListener("mousemove",d=>{if(!i)return;d.preventDefault(),n=d.clientX-c,l=d.clientY-g;let m=window.innerWidth-this.containerEl.offsetWidth,C=window.innerHeight-this.containerEl.offsetHeight;n=Math.max(0,Math.min(n,m)),l=Math.max(0,Math.min(l,C)),this.containerEl.addClass("highlight-chat-window"),this.containerEl.style.left=`${n}px`,this.containerEl.style.top=`${l}px`}),document.addEventListener("mouseup",()=>{i=!1,e.removeClass("dragging")})}getContainer(){return this.containerEl}getTextarea(){return this.textarea}getChatHistoryContainer(){return this.containerEl.querySelector(".highlight-chat-history")}};var jA=require("obsidian"),an=class{constructor(e,t,A,i,n){this.isProcessing=!1;var l,c,g,d,m;this.app=e,this.plugin=t,this.chatService=A,this.contextService=i,this.stateManager=n,this.contextOptions={strategy:((l=this.plugin.settings.contextOptions)==null?void 0:l.strategy)||"smart",includeTitle:(g=(c=this.plugin.settings.contextOptions)==null?void 0:c.includeTitle)!=null?g:!0,maxLength:((d=this.plugin.settings.contextOptions)==null?void 0:d.maxLength)||2e3,surroundingLines:((m=this.plugin.settings.contextOptions)==null?void 0:m.surroundingLines)||3}}addMessage(e,t,A,i=!0){let n=e.createEl("div",{cls:"highlight-chat-message"}),l=n.createEl("div",{cls:"highlight-chat-message-content markdown-rendered"});n.addClass(`highlight-chat-message-${A}`),l.addClass(`highlight-chat-message-content-${A}`),A==="assistant"&&i?this.typeWriter(l,t):this.renderMarkdownContent(l,t),e.scrollTop=e.scrollHeight}async typeWriter(e,t,A=30){let i=0;e.textContent="";let n=e.createEl("span",{cls:"highlight-chat-cursor"}),l=()=>{i<t.length?(e.insertBefore(document.createTextNode(t.charAt(i)),n),i++,setTimeout(l,A)):(n.remove(),this.renderMarkdownContent(e,t))};l()}async renderMarkdownContent(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);try{await jA.MarkdownRenderer.render(this.app,t,e,"",new jA.Component),e.querySelectorAll("ul, ol").forEach(i=>{i.addClass("chat-markdown-list")})}catch(A){console.error("Error rendering markdown in chat:",A),e.textContent=t}}async handleSendMessage(e,t,A,i){let n=e.value.trim();if(!(!n||this.isProcessing))try{this.isProcessing=!0;let l=n,c=n,g=this.stateManager.getDraggedContents();if(g.length>0){let m=g.map(Q=>this.contextService.getContextForHighlight(Q,this.contextOptions)),F=(await Promise.all(m)).map((Q,U)=>{let b=g[U];if(!Q)return`**\u9AD8\u4EAE\u5185\u5BB9 ${U+1}:**
${b.text}`;let P=`**Highlight ${U+1}** (from: ${Q.fileName}):
`;return Q.sectionTitle&&(P+=`**Section:** ${Q.sectionTitle}

`),Q.beforeContext.trim()&&(P+=`**Before:**
${Q.beforeContext.trim()}

`),P+=`**Highlight:**
${b.text}

`,Q.afterContext.trim()&&(P+=`**After:**
${Q.afterContext.trim()}`),P}).join(`

---

`);this.stateManager.addToHistory({role:"user",content:`\u4EE5\u4E0B\u662F\u9700\u8981\u5206\u6790\u7684\u5185\u5BB9\uFF08\u5305\u542B\u4E0A\u4E0B\u6587\uFF09\uFF1A

${F}`}),l=n,c=`\u7528\u6237\u63D0\u793A\uFF1A${n}`;let y=A();if(y){let Q=y.closest(".highlight-chat-message-preview");Q&&Q.addClass("sent"),i(null),this.stateManager.clearDraggedContents()}}this.stateManager.addToHistory({role:"user",content:c}),requestAnimationFrame(()=>{e.value="",e.addClass("highlight-chat-input"),e.dispatchEvent(new Event("input"))}),this.addMessage(t,n,"user",!0);let d=await this.chatService.sendMessage(l,this.stateManager.getChatHistory());this.stateManager.addToHistory({role:"assistant",content:d.content}),this.addMessage(t,d.content,"assistant",!0)}catch(l){console.error("\u53D1\u9001\u6D88\u606F\u65F6\u51FA\u9519:",l),new jA.Notice("Failed to send message, please try again")}finally{this.isProcessing=!1}}clearChat(e,t){this.stateManager.clearHistory(),this.stateManager.clearDraggedContents();let A=this.stateManager.getCurrentPreviewContainer();if(A){let i=A.closest(".highlight-chat-message-preview");i&&i.remove(),this.stateManager.setCurrentPreviewContainer(null)}for(;e.firstChild;)e.removeChild(e.firstChild);t&&(t.value="",t.addClass("highlight-chat-input"))}getContextOptions(){return this.contextOptions}setContextOptions(e){this.contextOptions=e}async saveContextOptions(){this.plugin.settings.contextOptions||(this.plugin.settings.contextOptions={}),this.plugin.settings.contextOptions.strategy=this.contextOptions.strategy,this.plugin.settings.contextOptions.includeTitle=this.contextOptions.includeTitle,this.plugin.settings.contextOptions.maxLength=this.contextOptions.maxLength,this.plugin.settings.contextOptions.surroundingLines=this.contextOptions.surroundingLines,await this.plugin.saveSettings()}};var Oa=require("obsidian");W();var on=class{constructor(e,t){this.stateManager=e,this.onPreviewClick=t}setupDragHandlers(e){e.addEventListener("dragenter",t=>{t.preventDefault(),e.addClass("drag-over")}),e.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation(),e.addClass("drag-over");let A=e.getBoundingClientRect(),i=e.scrollTop,n=A.height;e.addClass("highlight-chat-history-drag-guide"),e.style.setProperty("--drag-guide-top",`${i+12}px`),e.style.setProperty("--drag-guide-height",`${n-24}px`);let l=document.querySelector(".highlight-dragging");l&&(l.addClass("highlight-chat-preview"),l.style.left=`${t.clientX+10}px`,l.style.top=`${t.clientY+10}px`)}),e.addEventListener("dragleave",t=>{e.contains(t.relatedTarget)||e.removeClass("drag-over")}),e.addEventListener("drop",async t=>{var i;t.preventDefault(),e.removeClass("drag-over");let A=(i=t.dataTransfer)==null?void 0:i.getData("application/highlight");if(A)try{let n=JSON.parse(A);if(!n.text)return;this.stateManager.getDraggedContents().some(c=>c.text===n.text)||(this.stateManager.addDraggedContent(n),this.showDraggedPreviewsInChat(e))}catch(n){console.error("Error parsing highlight data:",n)}})}showDraggedPreviewsInChat(e){let t=this.stateManager.getCurrentPreviewContainer();if(!t){let g=e.createEl("div",{cls:"highlight-chat-message highlight-chat-message-preview"}).createEl("div",{cls:"highlight-chat-previews"}),d=g.createEl("div",{cls:"highlight-chat-preview-header"}),m=d.createEl("div",{cls:"highlight-chat-preview-header-left"});m.createEl("span",{cls:"highlight-chat-preview-count",text:String(this.stateManager.getDraggedContents().length)}),m.createSpan({text:p("highlighted notes")});let F=d.createEl("div",{cls:"highlight-chat-preview-header-right"}).createEl("div",{cls:"highlight-chat-preview-btn",attr:{title:"Preview"}});(0,Oa.setIcon)(F,"eye"),F.addEventListener("click",()=>{this.onPreviewClick()});let y=g.createEl("div",{cls:"highlight-chat-preview-cards"});t=y,this.stateManager.setCurrentPreviewContainer(y)}let A=this.stateManager.getDraggedContents(),i=t.createEl("div",{cls:"highlight-chat-preview-card"}),n=A[A.length-1];i.createEl("div",{cls:"highlight-chat-preview-content",text:n.text});let l=i.createEl("div",{cls:"highlight-chat-preview-delete"});(0,Oa.setIcon)(l,"x"),l.addEventListener("click",()=>{if(this.stateManager.removeDraggedContent(n),i.remove(),this.stateManager.getDraggedContents().length===0){let c=t==null?void 0:t.closest(".highlight-chat-message-preview");c&&(c.remove(),this.stateManager.setCurrentPreviewContainer(null))}else this.updatePreviewCount()}),this.updatePreviewCount(),e.scrollTop=e.scrollHeight}updatePreviewCount(){let e=this.stateManager.getCurrentPreviewContainer();if(e){let t=e.closest(".highlight-chat-message-preview"),A=t==null?void 0:t.querySelector(".highlight-chat-preview-count");A&&(A.textContent=String(this.stateManager.getDraggedContents().length),this.stateManager.getDraggedContents().length===0&&t&&(t.remove(),this.stateManager.setCurrentPreviewContainer(null)))}}rebuildPreviewCards(e){let t=this.stateManager.getDraggedContents();t.length>0&&t.forEach(()=>{this.showDraggedPreviewsInChat(e)})}};var Ut=require("obsidian"),ln=class{constructor(e,t,A,i,n){this.app=e,this.plugin=t,this.contextService=A,this.stateManager=i,this.messageHandler=n}async showContextPreviewWithSettings(){if(this.stateManager.getDraggedContents().length===0){new Ut.Notice("\u6CA1\u6709\u9AD8\u4EAE\u5185\u5BB9\u53EF\u9884\u89C8");return}let e=this.app.workspace.containerEl.createEl("div",{cls:"highlight-chat-context-modal"}),t=e.createEl("div",{cls:"highlight-chat-context-overlay"}),A=e.createEl("div",{cls:"highlight-chat-context-content"}),i=A.createEl("div",{cls:"highlight-chat-context-header"});i.createEl("h3",{text:"Context Preview & Settings"});let n=i.createEl("div",{cls:"highlight-chat-context-close"});(0,Ut.setIcon)(n,"x");let l=A.createEl("div",{cls:"highlight-chat-context-body"}),c,g=()=>{clearTimeout(c),c=setTimeout(()=>{q()},300)},d=l.createEl("div",{cls:"highlight-chat-context-settings-panel"});this.createSettingsPanel(d,g);let m=l.createEl("div",{cls:"highlight-chat-context-preview-panel"});m.createEl("div",{cls:"highlight-chat-context-preview-panel-header"}).createEl("h4",{text:"Preview Content (Auto-update)"});let F=m.createEl("div",{cls:"highlight-chat-context-preview-content"}),y=A.createEl("div",{cls:"highlight-chat-context-footer"}),Q=y.createEl("div",{cls:"highlight-chat-context-stats"}),U=y.createEl("div",{cls:"highlight-chat-context-buttons"}),b=U.createEl("button",{cls:"highlight-chat-context-cancel",text:"Cancel"}),P=U.createEl("button",{cls:"highlight-chat-context-confirm",text:"Apply"}),q=async()=>{try{F.empty(),F.createEl("div",{cls:"highlight-chat-context-loading",text:"Generating preview..."});let G=await this.generateContextPreview();F.empty(),await this.renderMarkdownContent(F,G.content),Q.textContent=`Characters: ${G.content.length} | Highlights: ${this.stateManager.getDraggedContents().length}`}catch(G){F.empty(),F.createEl("div",{cls:"highlight-chat-context-error",text:"Preview generation failed"})}},k=()=>{e.remove()};n.addEventListener("click",k),b.addEventListener("click",k),t.addEventListener("click",k),P.addEventListener("click",()=>{k(),new Ut.Notice("Context settings applied")});let N=G=>{G.key==="Escape"&&(k(),document.removeEventListener("keydown",N))};document.addEventListener("keydown",N),await q()}createSettingsPanel(e,t){let A=this.messageHandler.getContextOptions(),i=e.createEl("div",{cls:"highlight-chat-settings-section"});i.createEl("h5",{text:"Context Strategy"});let n=i.createEl("select",{cls:"highlight-chat-settings-select"});[{value:"smart",label:"Smart Context - Auto-select best strategy"},{value:"paragraph",label:"Paragraph Context - Get complete paragraphs"},{value:"section",label:"Section Context - Get entire sections"},{value:"surrounding",label:"Surrounding Lines - Specify before/after lines"}].forEach(k=>{let N=n.createEl("option",{value:k.value,text:k.label});k.value===A.strategy&&(N.selected=!0)}),n.addEventListener("change",async()=>{A.strategy=n.value,this.messageHandler.setContextOptions(A),await this.messageHandler.saveContextOptions(),this.updateSurroundingLinesVisibility(e),t()});let c=e.createEl("div",{cls:"highlight-chat-settings-section"});c.createEl("h5",{text:"Context Length"});let g=c.createEl("div",{cls:"highlight-chat-settings-slider-container"}),d=g.createEl("input",{type:"range",cls:"highlight-chat-settings-slider",attr:{min:"500",max:"5000",step:"500",value:String(A.maxLength||2e3)}}),m=g.createEl("span",{cls:"highlight-chat-settings-value",text:`${A.maxLength||2e3} chars`});d.addEventListener("input",async()=>{let k=parseInt(d.value);A.maxLength=k,m.textContent=`${k} chars`,this.messageHandler.setContextOptions(A),await this.messageHandler.saveContextOptions(),t()});let C=e.createEl("div",{cls:"highlight-chat-settings-section highlight-chat-surrounding-section"});C.createEl("h5",{text:"Surrounding Lines"});let F=C.createEl("div",{cls:"highlight-chat-settings-slider-container"}),y=F.createEl("input",{type:"range",cls:"highlight-chat-settings-slider",attr:{min:"1",max:"10",step:"1",value:String(A.surroundingLines||3)}}),Q=F.createEl("span",{cls:"highlight-chat-settings-value",text:`${A.surroundingLines||3} lines`});y.addEventListener("input",async()=>{let k=parseInt(y.value);A.surroundingLines=k,Q.textContent=`${k} lines`,this.messageHandler.setContextOptions(A),await this.messageHandler.saveContextOptions(),t()});let U=e.createEl("div",{cls:"highlight-chat-settings-section"});U.createEl("h5",{text:"Other Options"});let b=U.createEl("label",{cls:"highlight-chat-settings-checkbox"}),P=b.createEl("input",{type:"checkbox"});P.checked=A.includeTitle||!1,b.createSpan({text:" Include section titles"}),P.addEventListener("change",async()=>{A.includeTitle=P.checked,this.messageHandler.setContextOptions(A),await this.messageHandler.saveContextOptions(),t()}),this.updateSurroundingLinesVisibility(e),e.createEl("button",{cls:"highlight-chat-settings-reset",text:"Reset to defaults"}).addEventListener("click",async()=>{let k={strategy:"smart",includeTitle:!0,maxLength:2e3,surroundingLines:3};this.messageHandler.setContextOptions(k),n.value="smart",d.value="2000",m.textContent="2000 chars",y.value="3",Q.textContent="3 lines",P.checked=!0,await this.messageHandler.saveContextOptions(),this.updateSurroundingLinesVisibility(e),new Ut.Notice("Reset to default settings"),t()})}updateSurroundingLinesVisibility(e){let t=e.querySelector(".highlight-chat-surrounding-section"),A=this.messageHandler.getContextOptions();t&&(A.strategy==="surrounding"?t.style.display="block":t.style.display="none")}async generateContextPreview(){let e=this.messageHandler.getContextOptions(),t=this.stateManager.getDraggedContents(),A=t.map(l=>this.contextService.getContextForHighlight(l,e));return{content:(await Promise.all(A)).map((l,c)=>{let g=t[c];if(!l)return`**Highlight ${c+1}:**
${g.text}`;let d=`**Highlight ${c+1}** (from: ${l.fileName}):
`;return l.sectionTitle&&(d+=`**Section:** ${l.sectionTitle}

`),l.beforeContext.trim()&&(d+=`**Before:**
${l.beforeContext.trim()}

`),d+=`**Highlight:**
${g.text}

`,l.afterContext.trim()&&(d+=`**After:**
${l.afterContext.trim()}`),d}).join(`

---

`)}}async renderMarkdownContent(e,t){for(;e.firstChild;)e.removeChild(e.firstChild);try{await Ut.MarkdownRenderer.render(this.app,t,e,"",new Ut.Component),e.querySelectorAll("ul, ol").forEach(i=>{i.addClass("chat-markdown-list")})}catch(A){console.error("Error rendering markdown:",A),e.textContent=t}}};var oA=require("obsidian");W();var cn=class{constructor(e,t,A){this.plugin=e,this.chatService=t,this.stateManager=A}createModelMenuItem(e,t,A,i,n){e.addItem(l=>{l.setTitle(t.name).setChecked(n).onClick(async()=>{this.stateManager.setModelState({provider:A,model:t.id}),this.chatService.updateModel(A,t.id),i.textContent=this.getCurrentModelName()})})}addCustomModelIfExists(e,t,A,i,n){if(n&&i){e.addSeparator();let l=this.stateManager.getModelState();e.addItem(c=>{c.setTitle(i).setChecked(l.model===i).onClick(async()=>{this.stateManager.setModelState({provider:t,model:i}),this.chatService.updateModel(t,i),A.textContent=this.getCurrentModelName()})})}}handleApiError(e){new oA.Notice(p(`Unable to get ${e} model list, please check API Key and network connection.`))}getCurrentModelName(){var i,n,l,c,g,d,m,C,F,y,Q,U;let e=this.plugin.settings.ai,t=this.stateManager.getModelState();switch(t.provider||e.provider){case"openai":return t.model||((i=e.openai)==null?void 0:i.model)||"GPT-4";case"anthropic":return t.model||((n=e.anthropic)==null?void 0:n.model)||"Claude-3";case"ollama":return t.model||((l=e.ollama)==null?void 0:l.model)||"Ollama";case"gemini":return t.model||((c=e.gemini)==null?void 0:c.model)||"Gemini Pro";case"deepseek":return t.model||((g=e.deepseek)==null?void 0:g.model)||"Deepseek Chat";case"siliconflow":return(d=e.siliconflow)!=null&&d.isCustomModel&&((m=e.siliconflow)!=null&&m.model)?e.siliconflow.model:t.model?t.model:((C=e.siliconflow)==null?void 0:C.model)||"SiliconFlow";case"custom":return(F=e.custom)!=null&&F.name&&((y=e.custom)!=null&&y.model)?`${e.custom.name} (${e.custom.model})`:t.model||((Q=e.custom)==null?void 0:Q.model)||((U=e.custom)==null?void 0:U.name)||"Custom AI";default:return"Unknown model"}}async showModelSelector(e,t){let A=new oA.Menu;switch(this.plugin.settings.ai.provider){case"siliconflow":await this.buildSiliconFlowMenu(A,e);break;case"openai":await this.buildOpenAIMenu(A,e);break;case"anthropic":this.buildAnthropicMenu(A,e);break;case"ollama":await this.buildOllamaMenu(A,e);break;case"gemini":await this.buildGeminiMenu(A,e);break;case"deepseek":await this.buildDeepseekMenu(A,e);break;case"custom":this.buildCustomMenu(A,e);break;default:new oA.Notice(p("Unknown AI provider"));break}let n=e.getBoundingClientRect();A.showAtPosition({x:n.left,y:n.bottom})}async buildSiliconFlowMenu(e,t){var A,i;try{let n=this.plugin.settings.ai,l=zA,c=this.stateManager.getModelState();if(l.forEach(g=>{e.addItem(d=>{var C,F;let m=!((C=n.siliconflow)!=null&&C.isCustomModel)&&(c.model===g.id||((F=n.siliconflow)==null?void 0:F.model)===g.id);d.setTitle(g.name).setChecked(m).onClick(async()=>{n.siliconflow?(n.siliconflow.model=g.id,n.siliconflow.isCustomModel=!1):n.siliconflow={model:g.id,isCustomModel:!1},this.stateManager.setModelState({provider:"siliconflow",model:g.id}),this.chatService.updateModel("siliconflow",g.id),await this.plugin.saveSettings(),t.textContent=g.name})})}),(A=n.siliconflow)!=null&&A.isCustomModel&&((i=n.siliconflow)!=null&&i.model)){e.addSeparator();let g=n.siliconflow.model;e.addItem(d=>{var C,F;let m=((C=n.siliconflow)==null?void 0:C.isCustomModel)&&(c.model===g||((F=n.siliconflow)==null?void 0:F.model)===g);d.setTitle(g).setChecked(m).onClick(async()=>{n.siliconflow?(n.siliconflow.model=g,n.siliconflow.isCustomModel=!0):n.siliconflow={model:g,isCustomModel:!0},this.stateManager.setModelState({provider:"siliconflow",model:g}),this.chatService.updateModel("siliconflow",g),await this.plugin.saveSettings(),t.textContent=g})})}}catch(n){new oA.Notice(p("Unable to get SiliconFlow model list, please check API Key and network connection."))}}async buildOpenAIMenu(e,t){try{let A=await this.chatService.aiService.listModels("openai"),i=this.stateManager.getModelState(),n=A.filter(c=>!c.isCustom),l=A.filter(c=>c.isCustom);n.forEach(c=>{this.createModelMenuItem(e,c,"openai",t,i.model===c.id)}),l.length>0&&(e.addSeparator(),l.forEach(c=>{this.createModelMenuItem(e,c,"openai",t,i.model===c.id)}))}catch(A){this.handleApiError("OpenAI")}}buildAnthropicMenu(e,t){let A=this.plugin.settings.ai;["claude-3-opus-20240229","claude-3-sonnet-20240229","claude-3-haiku-20240307"].forEach(n=>{e.addItem(l=>{var c;l.setTitle(n).setChecked(((c=A.anthropic)==null?void 0:c.model)===n).onClick(async()=>{A.anthropic||(A.anthropic={apiKey:"",model:n}),A.anthropic.model=n,await this.plugin.saveSettings(),t.textContent=this.getCurrentModelName()})})})}async buildOllamaMenu(e,t){try{let A=this.plugin.settings.ai;(await this.chatService.aiService.listModels("ollama")).forEach(n=>{var l;this.createModelMenuItem(e,n,"ollama",t,((l=A.ollama)==null?void 0:l.model)===n.id)})}catch(A){new oA.Notice(p("Unable to access the Ollama model, please check the service."))}}async buildGeminiMenu(e,t){var A,i;try{let n=this.plugin.settings.ai;(await this.chatService.aiService.listModels("gemini")).forEach(c=>{var g;this.createModelMenuItem(e,c,"gemini",t,((g=n.gemini)==null?void 0:g.model)===c.id)}),this.addCustomModelIfExists(e,"gemini",t,(A=n.gemini)==null?void 0:A.model,(i=n.gemini)==null?void 0:i.isCustomModel)}catch(n){this.handleApiError("Gemini")}}async buildDeepseekMenu(e,t){var A,i;try{let n=this.plugin.settings.ai;(await this.chatService.aiService.listModels("deepseek")).forEach(c=>{var g;this.createModelMenuItem(e,c,"deepseek",t,((g=n.deepseek)==null?void 0:g.model)===c.id)}),this.addCustomModelIfExists(e,"deepseek",t,(A=n.deepseek)==null?void 0:A.model,(i=n.deepseek)==null?void 0:i.isCustomModel)}catch(n){this.handleApiError("Deepseek")}}buildCustomMenu(e,t){let A=this.plugin.settings.ai,i=this.stateManager.getModelState();if(!A.custom){new oA.Notice(p("Custom AI service not configured"));return}let n=A.custom.name||"Custom AI",l=A.custom.model||"No model configured";e.addItem(c=>{c.setTitle(`${n}: ${l}`).setChecked(!0).onClick(async()=>{t.textContent=this.getCurrentModelName()})}),A.custom.isCustomModel&&A.custom.lastCustomModel&&(e.addSeparator(),e.addItem(c=>{var g;c.setTitle(`Last: ${(g=A.custom)==null?void 0:g.lastCustomModel}`).onClick(async()=>{A.custom&&A.custom.lastCustomModel&&(A.custom.model=A.custom.lastCustomModel,await this.plugin.saveSettings(),t.textContent=this.getCurrentModelName())})})),e.addSeparator(),e.addItem(c=>{c.setTitle(p("Configure in settings")).setDisabled(!0)})}};var bt=class bt extends Lc.Component{constructor(t,A){super();this.textarea=null;if(bt.instance)return bt.instance;this.app=t,this.plugin=A,this.chatService=new rn(this.plugin),this.contextService=new sn(t),this.stateManager=new ir,this.uiBuilder=new nn(t,A,this.stateManager),this.messageHandler=new an(t,A,this.chatService,this.contextService,this.stateManager),this.dragHandler=new on(this.stateManager,()=>this.contextHandler.showContextPreviewWithSettings()),this.contextHandler=new ln(t,A,this.contextService,this.stateManager,this.messageHandler),this.modelSelector=new cn(A,this.chatService,this.stateManager),this.containerEl=this.uiBuilder.buildChatWindow(()=>this.clearChat(),()=>this.close(),(l,c)=>this.modelSelector.showModelSelector(l,c),()=>this.modelSelector.getCurrentModelName());let i=this.containerEl.querySelector(".highlight-chat-input-container");i&&(this.textarea=this.uiBuilder.setupChatInput(i,l=>this.handleSendMessage(l)));let n=this.uiBuilder.getChatHistoryContainer();n&&this.dragHandler.setupDragHandlers(n),this.restoreSavedState(),bt.instance=this}show(){document.body.contains(this.containerEl)?this.containerEl.removeClass("highlight-chat-hidden"):(this.containerEl.addClass("highlight-chat-window"),this.containerEl.addClass("highlight-chat-window-position"),document.body.appendChild(this.containerEl)),document.querySelectorAll(".highlight-floating-button").forEach(t=>{t.style.display="none"}),requestAnimationFrame(()=>{var t;(t=this.textarea)==null||t.focus()})}close(){this.containerEl.addClass("highlight-chat-hidden"),document.querySelectorAll(".highlight-floating-button").forEach(t=>{t.style.display=""})}clearChat(){let t=this.uiBuilder.getChatHistoryContainer();t&&this.textarea&&this.messageHandler.clearChat(t,this.textarea)}async handleSendMessage(t){let A=this.uiBuilder.getChatHistoryContainer();A&&await this.messageHandler.handleSendMessage(t,A,()=>this.stateManager.getCurrentPreviewContainer(),i=>this.stateManager.setCurrentPreviewContainer(i))}restoreSavedState(){let t=ir.getSavedState();if(!t)return;this.stateManager.restoreState(t);let A=this.uiBuilder.getChatHistoryContainer();if(A){for(;A.firstChild;)A.removeChild(A.firstChild);if(this.stateManager.getChatHistory().forEach(i=>{this.messageHandler.addMessage(A,i.content,i.role,!1)}),this.stateManager.getDraggedContents().length>0&&this.dragHandler.rebuildPreviewCards(A),t.currentPreviewContainer){let i=A.querySelector(".highlight-chat-preview-cards");this.stateManager.setCurrentPreviewContainer(i)}}}static getInstance(t,A){return bt.instance||(bt.instance=new bt(t,A)),bt.instance}saveState(){this.stateManager.saveState()}};bt.instance=null;var EA=bt;var hn=class{constructor(e){this.app=e}async openCommentPanelInSidebar(){let{workspace:e}=this.app,t=e.getLeavesOfType(pt);if(t.length){let i=t[0],n=i.view;if(n&&n instanceof at&&n.isDraggedToMainView){e.detachLeavesOfType(pt);let l=e.getRightLeaf(!1);if(l){await l.setViewState({type:pt,active:!0});let c=l.view;c&&c instanceof at&&(c.isDraggedToMainView=!1,c.updateViewLayout(),c.updateHighlights())}}else e.revealLeaf(i);return}let A=e.getRightLeaf(!1);if(A){await A.setViewState({type:pt,active:!0});let i=A.view;i&&i instanceof at&&(i.isDraggedToMainView=!1,i.updateViewLayout())}}async openCommentPanelInMainWindow(){let{workspace:e}=this.app,t=e.getLeavesOfType(pt);if(t.length){let i=t[0];e.setActiveLeaf(i,{focus:!0}),e.detachLeavesOfType(pt);let n=e.getLeaf("tab");await n.setViewState({type:pt,active:!0});let l=n.view;l&&l instanceof at&&this.updateViewToMainMode(l);return}let A=e.getLeaf("tab");A&&(await A.setViewState({type:pt,active:!0}),setTimeout(()=>{let i=A.view;i&&i instanceof at&&this.updateViewToMainMode(i)},100))}updateViewToMainMode(e){e.isDraggedToMainView=!0,e.fileListManager&&e.fileListManager.invalidateCache(),e.updateViewLayout(),e.updateHighlights()}};W();async function cf(B,e,t){await t(),await e.openCommentPanelInSidebar()}function Tc(B,e,t){B.addCommand({id:"open-comment-window",name:p("Open in right sidebar"),callback:()=>cf(B,e,t)})}W();async function hf(B,e,t){await t(),await e.openCommentPanelInMainWindow()}function Pc(B,e,t){B.addCommand({id:"open-comment-main-window",name:p("Open in main window"),callback:()=>hf(B,e,t)})}W();async function gf(B,e){await e(),EA.getInstance(B.app,B).show()}function Dc(B,e){B.addCommand({id:"open-chat-window",name:p("Open AI chat window"),callback:()=>gf(B,e)})}function Rc(B,e,t){Tc(B,e,t),Pc(B,e,t),Dc(B,t)}function Kc(B){return new hn(B.app)}var IA=require("@codemirror/view"),ka=require("obsidian");var Oc=require("@codemirror/view"),ei=require("obsidian"),Vt=class Vt extends Oc.WidgetType{constructor(t,A,i){super();this.plugin=t;this.highlight=A;this.onClick=i;this.resizeListener=null;this.app=this.plugin.app,this.comments=this.highlight.comments||[]}eq(t){var c,g,d,m;if(!(t instanceof Vt))return!1;let A=typeof this.highlight.position=="number"&&typeof t.highlight.position=="number"&&Math.abs(this.highlight.position-t.highlight.position)<Vt.POSITION_MATCH_THRESHOLD,i=this.highlight.text===t.highlight.text,n=((g=(c=this.highlight.comments)==null?void 0:c.length)!=null?g:0)===((m=(d=t.highlight.comments)==null?void 0:d.length)!=null?m:0);return(i||A)&&n}get estimatedHeight(){return 0}get lineBreaks(){return 0}toDOM(){let t=document.createElement("span");return t.addClass("hi-note-widget"),this.highlight.id&&t.setAttribute("data-highlight-id",this.highlight.id),this.createButton(t),t}createButton(t){let A=this.comments.length>0,i=t.createEl("button",{cls:`hi-note-button clickable-icon ${A?"":"hi-note-button-hidden"}`}),n=this.createIconContainer(i),l=this.createTooltip(t);this.setupEventListeners(t,i,l)}createIconContainer(t){let A=t.createEl("span",{cls:"hi-note-icon-container"});return(0,ei.setIcon)(A,"message-circle"),this.comments.length>0&&A.createEl("span",{cls:"hi-note-count",text:this.comments.length.toString()}),A}createTooltip(t){let A=document.createElement("div");A.addClass("hi-note-tooltip","hi-note-tooltip-hidden"),this.highlight.id&&A.setAttribute("data-highlight-id",this.highlight.id);let i=A.createEl("div",{cls:"hi-note-tooltip-list"});return this.renderTooltipContent(i,A),document.body.appendChild(A),{tooltip:A,updateTooltipPosition:()=>{let l=t.getBoundingClientRect();A.style.position="fixed",A.style.top=`${l.bottom+4}px`,A.style.left=`${l.right-A.offsetWidth}px`}}}renderTooltipContent(t,A){this.comments.length!==0&&(this.comments.slice(0,Vt.MAX_TOOLTIP_COMMENTS).forEach(i=>{let n=t.createEl("div",{cls:"hi-note-tooltip-item"}),l=n.createEl("div",{cls:"hi-note-tooltip-content markdown-rendered"});this.renderMarkdownContent(l,i.content),n.createEl("div",{cls:"hi-note-tooltip-time",text:new Date(i.createdAt).toLocaleString()})}),this.comments.length>Vt.MAX_TOOLTIP_COMMENTS&&A.createEl("div",{cls:"hi-note-tooltip-more",text:`\u8FD8\u6709 ${this.comments.length-Vt.MAX_TOOLTIP_COMMENTS} \u6761\u8BC4\u8BBA...`}))}setupEventListeners(t,A,i){let{tooltip:n,updateTooltipPosition:l}=i;this.comments.length>0?(A.removeClass("hi-note-button-hidden"),A.addEventListener("mouseenter",()=>{n.removeClass("hi-note-tooltip-hidden"),l()}),A.addEventListener("mouseleave",()=>{n.addClass("hi-note-tooltip-hidden")})):(A.addClass("hi-note-button-hidden"),t.addEventListener("mouseenter",()=>{A.removeClass("hi-note-button-hidden")}),t.addEventListener("mouseleave",()=>{A.addClass("hi-note-button-hidden")})),A.addEventListener("click",async c=>{c.preventDefault(),c.stopPropagation(),n.addClass("hi-note-tooltip-hidden"),await this.onClick()}),this.resizeListener=l,window.addEventListener("resize",this.resizeListener)}async renderMarkdownContent(t,A){try{await ei.MarkdownRenderer.render(this.app,A,t,"",new ei.Component),t.querySelectorAll("ul, ol").forEach(n=>{n.addClass("tooltip-markdown-list")})}catch(i){console.error("Error rendering markdown in tooltip:",i),t.textContent=A}}destroy(t){if(this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null),this.highlight.id){let A=document.querySelector(`.hi-note-tooltip[data-highlight-id="${this.highlight.id}"]`);A&&A.remove()}t.remove()}updateDOM(t){return!1}ignoreEvent(){return!0}};Vt.POSITION_MATCH_THRESHOLD=30,Vt.MAX_TOOLTIP_COMMENTS=3;var gn=Vt;var ti=class{static findMatch(e,t){if(!t||t.length===0)return null;let A=this.exactMatch(e,t);return A||(A=this.positionMatch(e,t),A)?A:null}static exactMatch(e,t){return t.find(A=>A.text===e.text&&(typeof A.position!="number"||typeof e.position!="number"||Math.abs(A.position-e.position)<10))||null}static positionMatch(e,t){return typeof e.position!="number"?null:t.find(A=>typeof A.position=="number"&&Math.abs(A.position-e.position)<30)||null}static findExactMatch(e,t){return t.find(A=>A.text===e.text&&(typeof A.position!="number"||typeof e.position!="number"||Math.abs(A.position-e.position)<10))||null}};var Nc=require("obsidian");var dn=require("obsidian"),kc=require("obsidian"),Ct=class{static createButton(e,t){let A=e.createEl("button",{cls:`hi-note-button clickable-icon ${t?"":"hi-note-button-hidden"}`}),i=A.createEl("span",{cls:"hi-note-icon-container"});return(0,kc.setIcon)(i,"message-circle"),A}static addCommentCount(e,t){t>0&&e.createEl("span",{cls:"hi-note-count",text:t.toString()})}static createTooltip(e,t){let A=document.createElement("div");A.addClass("hi-note-tooltip","hi-note-tooltip-hidden"),t.id&&A.setAttribute("data-highlight-id",t.id);let i=A.createEl("div",{cls:"hi-note-tooltip-list"});return this.renderTooltipContent(e,i,A,t.comments||[]),document.body.appendChild(A),A}static renderTooltipContent(e,t,A,i){i.length!==0&&(i.slice(0,this.MAX_TOOLTIP_COMMENTS).forEach(n=>{let l=t.createEl("div",{cls:"hi-note-tooltip-item"}),c=l.createEl("div",{cls:"hi-note-tooltip-content markdown-rendered"});this.renderMarkdownContent(e,c,n.content),l.createEl("div",{cls:"hi-note-tooltip-time",text:new Date(n.createdAt).toLocaleString()})}),i.length>this.MAX_TOOLTIP_COMMENTS&&A.createEl("div",{cls:"hi-note-tooltip-more",text:`\u8FD8\u6709 ${i.length-this.MAX_TOOLTIP_COMMENTS} \u6761\u8BC4\u8BBA...`}))}static renderMarkdownContent(e,t,A){dn.MarkdownRenderer.render(e,A,t,"",new dn.Component).catch(i=>{console.error("Error rendering markdown in tooltip:",i),t.textContent=A})}static updateTooltipPosition(e,t){let A=e.getBoundingClientRect();t.style.top=`${A.bottom+4}px`,t.style.left=`${A.right-t.offsetWidth}px`}static setupTooltipEvents(e,t,A){e.addEventListener("mouseenter",()=>{A.removeClass("hi-note-tooltip-hidden"),this.updateTooltipPosition(t,A)}),e.addEventListener("mouseleave",()=>{A.addClass("hi-note-tooltip-hidden")})}static async openCommentPanel(e,t){let A=e.workspace,i=A.getLeavesOfType("hinote-view");if(i.length)A.revealLeaf(i[0]),await new Promise(l=>setTimeout(l,50));else{let l=A.getRightLeaf(!1);l&&(await l.setViewState({type:"hinote-view",active:!0}),await new Promise(c=>setTimeout(c,200)))}let n=new CustomEvent("open-comment-input",{detail:{highlightId:t.id,text:t.text}});window.dispatchEvent(n)}static setupClickEvent(e,t,A){e.addEventListener("click",async i=>{i.preventDefault(),i.stopPropagation(),t.addClass("hi-note-tooltip-hidden"),await A()})}static createCleanupObserver(e,t){let A=new MutationObserver(i=>{i.forEach(n=>{n.removedNodes.forEach(l=>{l===e&&(t.remove(),A.disconnect())})})});return e.parentElement&&A.observe(e.parentElement,{childList:!0}),A}};Ct.MAX_TOOLTIP_COMMENTS=3;var un=class{constructor(e,t,A){this.plugin=e;this.highlightRepository=t;this.highlightService=A}async processPreview(e,t){let A=this.plugin.app.vault.getAbstractFileByPath(t.sourcePath);if(!(A instanceof Nc.TFile)||!this.highlightService.shouldProcessFile(A))return;let i=e.querySelectorAll("mark, span.highlight");if(i.length===0)return;let n=await this.plugin.app.vault.cachedRead(A),l=this.highlightService.extractHighlights(n,A);if(l.length===0)return;let c=this.enrichHighlightsWithComments(l,A,n);c.length!==0&&i.forEach(g=>{if(g.hasAttribute("data-hi-note-processed"))return;let d=g.textContent;if(!d)return;let m=this.findMatchingHighlight(d,g,e,t,c);m&&(g.setAttribute("data-hi-note-processed","true"),this.renderPreviewWidget(g,m))})}enrichHighlightsWithComments(e,t,A){return e.map(i=>{let n={...i,id:i.id||`highlight-${Date.now()}-${i.position}`,comments:i.comments||[],position:i.position,paragraphOffset:i.paragraphOffset||0,blockId:i.blockId,paragraphId:i.paragraphId||`p-${i.paragraphOffset||0}`,createdAt:i.createdAt||Date.now(),updatedAt:i.updatedAt||Date.now(),text:i.text},l=null,c=[];if(n.blockId){let g=this.highlightRepository.findHighlightsByBlockId(t,n.blockId);if(g&&g.length>0){let d=ti.findMatch(n,g);d&&(l=d,c=d.comments||[])}}else{let d=(this.highlightRepository.getCachedHighlights(t.path)||[]).filter(m=>m.text===n.text?typeof m.position=="number"&&typeof n.position=="number"?Math.abs(m.position-n.position)<1e3:!0:typeof m.position=="number"&&typeof n.position=="number"?Math.abs(m.position-n.position)<30:!1);d&&d.length>0&&(l=d[0],c=(l==null?void 0:l.comments)||[])}return{...n,id:(l==null?void 0:l.id)||n.id,comments:c}}).filter(i=>i.comments&&i.comments.length>0).map(i=>{let n=A.substring(0,i.position).split(`
`).length-1;return{...i,line:n}})}findMatchingHighlight(e,t,A,i,n){let l=t.parentElement;for(;l&&!this.isBlockElement(l)&&l!==A;)l=l.parentElement;let c=null;if(l&&(c=i.getSectionInfo(l)),c){let g=c;return n.find(d=>d.text===e&&d.line>=g.lineStart&&d.line<=g.lineEnd)||null}else return n.find(g=>g.text===e)||null}isBlockElement(e){let t=e.tagName.toLowerCase();return["p","h1","h2","h3","h4","h5","h6","li","div","blockquote","pre","td","th"].includes(t)}renderPreviewWidget(e,t){let A=e.createSpan({cls:"hi-note-widget hi-note-preview-widget"}),i=!!(t.comments&&t.comments.length>0),n=Ct.createButton(A,i),l=n.querySelector(".hi-note-icon-container");if(i&&t.comments){Ct.addCommentCount(l,t.comments.length);let c=Ct.createTooltip(this.plugin.app,t);Ct.setupTooltipEvents(n,A,c),Ct.setupClickEvent(n,c,()=>Ct.openCommentPanel(this.plugin.app,t)),Ct.createCleanupObserver(A,c)}}};var pn=class{constructor(e,t){this.plugin=e,this.highlightRepository=t,this.highlightService=e.highlightService,this.previewRenderer=new un(this.plugin,this.highlightRepository,this.highlightService)}refreshDecorations(){let e=this.getActiveMarkdownView();if(!(e!=null&&e.editor))return;let t=e.editor.cm;t&&t.dispatch({changes:[],effects:[]})}getActiveMarkdownView(){return this.plugin.app.workspace.getActiveViewOfType(ka.MarkdownView)}enable(){let e=this.plugin,t=this.highlightRepository,A=this.highlightService;this.plugin.registerMarkdownPostProcessor((n,l)=>{this.previewRenderer.processPreview(n,l)}),this.plugin.registerEvent(this.plugin.eventManager.on("comment:update",()=>{this.refreshDecorations()})),this.plugin.registerEvent(this.plugin.eventManager.on("comment:delete",()=>{this.refreshDecorations()})),this.plugin.registerEvent(this.plugin.eventManager.on("highlight:update",()=>{this.refreshDecorations()})),this.plugin.registerEvent(this.plugin.eventManager.on("highlight:delete",()=>{this.refreshDecorations()}));let i=IA.ViewPlugin.fromClass(class{constructor(n){this.plugin=e,this.highlightRepository=t,this.highlightService=A,this.decorations=this.buildDecorations(n)}createHiNoteFromHighlight(n){return{...n,id:n.id||`highlight-${Date.now()}-${n.position}`,comments:n.comments||[],position:n.position,paragraphOffset:n.paragraphOffset||0,blockId:n.blockId,paragraphId:n.paragraphId||`p-${n.paragraphOffset||0}`,createdAt:n.createdAt||Date.now(),updatedAt:n.updatedAt||Date.now(),text:n.text}}handleTextChanges(n,l,c){l.text!==c.text&&e.eventManager&&e.eventManager.emitHighlightUpdate(n.path,l.text,c.text)}getCommentsForHighlight(n,l,c=!0){let g=[];if(l.blockId){let d=this.highlightRepository.findHighlightsByBlockId(n,l.blockId);if(d&&d.length>0){let m=ti.findMatch(l,d);m&&(g=m.comments||[],c&&m.text!==l.text&&this.handleTextChanges(n,m,l))}}else{let d=this.highlightRepository.getCachedHighlights(n.path);if(!d||d.length===0)return g;let m=d.filter(C=>!C||!C.text?!1:C.text===l.text?typeof C.position=="number"&&typeof l.position=="number"?Math.abs(C.position-l.position)<1e3:!0:typeof C.position=="number"&&typeof l.position=="number"?Math.abs(C.position-l.position)<30:!1);if(m&&m.length>0){let C=m[0];g=C.comments||[],c&&C.text!==l.text&&this.handleTextChanges(n,C,l)}}return g}update(n){(n.docChanged||n.viewportChanged||n.transactions.length>0)&&(this.decorations=this.buildDecorations(n.view))}buildDecorations(n){var C;let l=[],g=n.state.doc.toString(),d=this.plugin.app.workspace.getActiveViewOfType(ka.MarkdownView);if(!d||!d.file)return IA.Decoration.none;if(!this.highlightService.shouldProcessFile(d.file))return IA.Decoration.none;let m=this.highlightService.extractHighlights(g,d.file);for(let F of m){if(F.position===void 0)continue;let y=this.createHiNoteFromHighlight(F);if(d.file){let U=this.getCommentsForHighlight(d.file,y,!0);y.comments=U}let Q=F.position+((C=F.originalLength)!=null?C:F.text.length+4);if(this.plugin.settings.showCommentWidget!==!1){let U=this.createCommentWidget(y,[y]);l.push(U.range(Q))}}return IA.Decoration.set(l.sort((F,y)=>F.from-y.from))}createCommentWidget(n,l){return IA.Decoration.widget({widget:new gn(this.plugin,n,()=>this.openCommentPanel(n)),side:2,stopEvent:c=>c.type==="mousedown"||c.type==="mouseup"})}async openCommentPanel(n){let l=this.plugin.app.workspace,c=l.getLeavesOfType("hinote-view");if(c.length)l.revealLeaf(c[0]),await new Promise(d=>setTimeout(d,50));else{let d=l.getRightLeaf(!1);d&&(await d.setViewState({type:"hinote-view",active:!0}),await new Promise(m=>setTimeout(m,200)))}let g=new CustomEvent("open-comment-input",{detail:{highlightId:n.id,text:n.text}});window.dispatchEvent(g)}},{decorations:n=>n.decorations});this.highlightPlugin=i,this.plugin.registerEditorExtension([i])}disable(){if(this.highlightPlugin){let e=this.getActiveMarkdownView();e!=null&&e.editor&&e.editor.refresh()}document.querySelectorAll(".hi-note-widget").forEach(e=>e.remove())}};var z=(B=>(B[B.New=0]="New",B[B.Learning=1]="Learning",B[B.Review=2]="Review",B[B.Relearning=3]="Relearning",B))(z||{}),x=(B=>(B[B.Manual=0]="Manual",B[B.Again=1]="Again",B[B.Hard=2]="Hard",B[B.Good=3]="Good",B[B.Easy=4]="Easy",B))(x||{}),$=class B{static card(e){return{...e,state:B.state(e.state),due:B.time(e.due),last_review:e.last_review?B.time(e.last_review):void 0}}static rating(e){if(typeof e=="string"){let t=e.charAt(0).toUpperCase(),A=e.slice(1).toLowerCase(),i=x[`${t}${A}`];if(i===void 0)throw new Error(`Invalid rating:[${e}]`);return i}else if(typeof e=="number")return e;throw new Error(`Invalid rating:[${e}]`)}static state(e){if(typeof e=="string"){let t=e.charAt(0).toUpperCase(),A=e.slice(1).toLowerCase(),i=z[`${t}${A}`];if(i===void 0)throw new Error(`Invalid state:[${e}]`);return i}else if(typeof e=="number")return e;throw new Error(`Invalid state:[${e}]`)}static time(e){if(typeof e=="object"&&e instanceof Date)return e;if(typeof e=="string"){let t=Date.parse(e);if(isNaN(t))throw new Error(`Invalid date:[${e}]`);return new Date(t)}else if(typeof e=="number")return new Date(e);throw new Error(`Invalid date:[${e}]`)}static review_log(e){return{...e,due:B.time(e.due),rating:B.rating(e.rating),state:B.state(e.state),review:B.time(e.review)}}};Date.prototype.scheduler=function(B,e){return wt(this,B,e)},Date.prototype.diff=function(B,e){return Ai(this,B,e)},Date.prototype.format=function(){return df(this)},Date.prototype.dueFormat=function(B,e,t){return uf(this,B,e,t)};function wt(B,e,t){return new Date(t?$.time(B).getTime()+e*24*60*60*1e3:$.time(B).getTime()+e*60*1e3)}function Ai(B,e,t){if(!B||!e)throw new Error("Invalid date");let A=$.time(B).getTime()-$.time(e).getTime(),i=0;switch(t){case"days":i=Math.floor(A/(24*60*60*1e3));break;case"minutes":i=Math.floor(A/(60*1e3));break}return i}function df(B){let e=$.time(B),t=e.getFullYear(),A=e.getMonth()+1,i=e.getDate(),n=e.getHours(),l=e.getMinutes(),c=e.getSeconds();return`${t}-${rr(A)}-${rr(i)} ${rr(n)}:${rr(l)}:${rr(c)}`}function rr(B){return B<10?`0${B}`:`${B}`}var Na=[60,60,24,31,12],Ga=["second","min","hour","day","month","year"];function uf(B,e,t,A=Ga){B=$.time(B),e=$.time(e),A.length!==Ga.length&&(A=Ga);let i=B.getTime()-e.getTime(),n;for(i/=1e3,n=0;n<Na.length&&!(i<Na[n]);n++)i/=Na[n];return`${Math.floor(i)}${t?A[n]:""}`}var pf=Object.freeze([x.Again,x.Hard,x.Good,x.Easy]),ff=[{start:2.5,end:7,factor:.15},{start:7,end:20,factor:.1},{start:20,end:1/0,factor:.05}];function mf(B,e,t){let A=1;for(let l of ff)A+=l.factor*Math.max(Math.min(B,l.end)-l.start,0);B=Math.min(B,t);let i=Math.max(2,Math.round(B-A)),n=Math.min(Math.round(B+A),t);return B>e&&(i=Math.max(i,e+1)),i=Math.min(i,n),{min_ivl:i,max_ivl:n}}function Xe(B,e,t){return Math.min(Math.max(B,e),t)}function Bf(B,e){let t=Date.UTC(B.getUTCFullYear(),B.getUTCMonth(),B.getUTCDate()),A=Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate());return Math.floor((A-t)/864e5)}var Cf="5.2.0",wf=.9,vf=36500,Ff=!1,yf=!0,Ef=Object.freeze(["1m","10m"]),If=Object.freeze(["10m"]),DE=`v${Cf} using FSRS-6.0`,vt=.001;var fn=100,Gc=.5,Hf=.1542,Vc=Object.freeze([.212,1.2931,2.3065,8.2956,6.4133,.8334,3.0194,.001,1.8722,.1666,.796,1.4835,.0614,.2629,1.6483,.6014,1.8729,.5425,.0912,.0658,Hf]),Qf=2,Sf=B=>[[vt,fn],[vt,fn],[vt,fn],[vt,fn],[1,10],[.001,4],[.001,4],[.001,.75],[0,4.5],[0,.8],[.001,3.5],[.001,5],[.001,.25],[.001,.9],[0,4],[0,1],[1,6],[0,B],[0,B],[0,.8],[.1,.8]],Ya=(B,e)=>{let t=Qf;if(Math.max(0,e)>1){let A=-(Math.log(B[11])+Math.log(Math.pow(2,B[13])-1)+B[14]*.3)/e;t=Xe(+A.toFixed(8),.01,2)}return Sf(t).map(([A,i],n)=>Xe(B[n],A,i))};var $a=B=>{if(B===void 0)return[...Vc];switch(B.length){case 21:return[...B];case 19:return console.debug("[FSRS-6]auto fill w from 19 to 21 length"),[...B,0,Gc];case 17:{let e=[...B];return e[4]=+(e[5]*2+e[4]).toFixed(8),e[5]=+(Math.log(e[5]*3+1)/3).toFixed(8),e[6]=+(e[6]+.5).toFixed(8),console.debug("[FSRS-6]auto fill w from 17 to 21 length"),e.concat([0,0,0,Gc])}default:return console.warn("[FSRS]Invalid parameters length, using default parameters"),[...Vc]}},mn=B=>{var i,n;let e=Array.isArray(B==null?void 0:B.learning_steps)?B.learning_steps:Ef,t=Array.isArray(B==null?void 0:B.relearning_steps)?B.relearning_steps:If,A=Ya($a(B==null?void 0:B.w),t.length);return{request_retention:(B==null?void 0:B.request_retention)||wf,maximum_interval:(B==null?void 0:B.maximum_interval)||vf,w:A,enable_fuzz:(i=B==null?void 0:B.enable_fuzz)!=null?i:Ff,enable_short_term:(n=B==null?void 0:B.enable_short_term)!=null?n:yf,learning_steps:e,relearning_steps:t}};function ii(B,e){let t={due:B?$.time(B):new Date,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:0,lapses:0,learning_steps:0,state:z.New,last_review:void 0};return e&&typeof e=="function"?e(t):t}var Va=class{constructor(e){ye(this,"c");ye(this,"s0");ye(this,"s1");ye(this,"s2");let t=Uf();this.c=1,this.s0=t(" "),this.s1=t(" "),this.s2=t(" "),e==null&&(e=+new Date),this.s0-=t(e),this.s0<0&&(this.s0+=1),this.s1-=t(e),this.s1<0&&(this.s1+=1),this.s2-=t(e),this.s2<0&&(this.s2+=1)}next(){let e=2091639*this.s0+this.c*23283064365386963e-26;return this.s0=this.s1,this.s1=this.s2,this.s2=e-(this.c=e|0),this.s2}set state(e){this.c=e.c,this.s0=e.s0,this.s1=e.s1,this.s2=e.s2}get state(){return{c:this.c,s0:this.s0,s1:this.s1,s2:this.s2}}};function Uf(){let B=4022871197;return function(e){e=String(e);for(let t=0;t<e.length;t++){B+=e.charCodeAt(t);let A=.02519603282416938*B;B=A>>>0,A-=B,A*=B,B=A>>>0,A-=B,B+=A*4294967296}return(B>>>0)*23283064365386963e-26}}function bf(B){let e=new Va(B),t=()=>e.next();return t.int32=()=>e.next()*4294967296|0,t.double=()=>t()+(t()*2097152|0)*11102230246251565e-32,t.state=()=>e.state,t.importState=A=>(e.state=A,t),t}var _c=B=>{let e=typeof B=="number"?-B:-B[20],t=Math.exp(Math.pow(e,-1)*Math.log(.9))-1;return{decay:e,factor:+t.toFixed(8)}};function _a(B,e,t){let{decay:A,factor:i}=_c(B);return+Math.pow(1+i*e/t,A).toFixed(8)}var Wa=class{constructor(e){ye(this,"param");ye(this,"intervalModifier");ye(this,"_seed");ye(this,"forgetting_curve");this.param=new Proxy(mn(e),this.params_handler_proxy()),this.intervalModifier=this.calculate_interval_modifier(this.param.request_retention),this.forgetting_curve=_a.bind(this,this.param.w)}get interval_modifier(){return this.intervalModifier}set seed(e){this._seed=e}calculate_interval_modifier(e){if(e<=0||e>1)throw new Error("Requested retention rate should be in the range (0,1]");let{decay:t,factor:A}=_c(this.param.w);return+((Math.pow(e,1/t)-1)/A).toFixed(8)}get parameters(){return this.param}set parameters(e){this.update_parameters(e)}params_handler_proxy(){let e=this;return{set:function(t,A,i){return A==="request_retention"&&Number.isFinite(i)?e.intervalModifier=e.calculate_interval_modifier(Number(i)):A==="w"&&(i=Ya($a(i),t.relearning_steps.length),e.forgetting_curve=_a.bind(this,i),e.intervalModifier=e.calculate_interval_modifier(Number(t.request_retention))),Reflect.set(t,A,i),!0}}}update_parameters(e){let t=mn(e);for(let A in t)if(A in this.param){let i=A;this.param[i]=t[i]}}init_stability(e){return Math.max(this.param.w[e-1],.1)}init_difficulty(e){return+(this.param.w[4]-Math.exp((e-1)*this.param.w[5])+1).toFixed(8)}apply_fuzz(e,t){if(!this.param.enable_fuzz||e<2.5)return Math.round(e);let A=bf(this._seed)(),{min_ivl:i,max_ivl:n}=mf(e,t,this.param.maximum_interval);return Math.floor(A*(n-i+1)+i)}next_interval(e,t){let A=Math.min(Math.max(1,Math.round(e*this.intervalModifier)),this.param.maximum_interval);return this.apply_fuzz(A,t)}linear_damping(e,t){return+(e*(10-t)/9).toFixed(8)}next_difficulty(e,t){let A=-this.param.w[6]*(t-3),i=e+this.linear_damping(A,e);return Xe(this.mean_reversion(this.init_difficulty(x.Easy),i),1,10)}mean_reversion(e,t){return+(this.param.w[7]*e+(1-this.param.w[7])*t).toFixed(8)}next_recall_stability(e,t,A,i){let n=x.Hard===i?this.param.w[15]:1,l=x.Easy===i?this.param.w[16]:1;return+Xe(t*(1+Math.exp(this.param.w[8])*(11-e)*Math.pow(t,-this.param.w[9])*(Math.exp((1-A)*this.param.w[10])-1)*n*l),vt,36500).toFixed(8)}next_forget_stability(e,t,A){return+Xe(this.param.w[11]*Math.pow(e,-this.param.w[12])*(Math.pow(t+1,this.param.w[13])-1)*Math.exp((1-A)*this.param.w[14]),vt,36500).toFixed(8)}next_short_term_stability(e,t){let A=Math.pow(e,-this.param.w[19])*Math.exp(this.param.w[17]*(t-3+this.param.w[18])),i=t>=3?Math.max(A,1):A;return+Xe(e*i,vt,36500).toFixed(8)}next_state(e,t,A){let{difficulty:i,stability:n}=e!=null?e:{difficulty:0,stability:0};if(t<0)throw new Error(`Invalid delta_t "${t}"`);if(A<0||A>4)throw new Error(`Invalid grade "${A}"`);if(i===0&&n===0)return{difficulty:Xe(this.init_difficulty(A),1,10),stability:this.init_stability(A)};if(A===0)return{difficulty:i,stability:n};if(i<1||n<vt)throw new Error(`Invalid memory state { difficulty: ${i}, stability: ${n} }`);let l=this.forgetting_curve(t,n),c=this.next_recall_stability(i,n,l,A),g=this.next_forget_stability(i,n,l),d=this.next_short_term_stability(n,A),m=c;if(A===1){let[C,F]=[0,0];this.param.enable_short_term&&(C=this.param.w[17],F=this.param.w[18]);let y=n/Math.exp(C*F);m=Xe(+y.toFixed(8),vt,g)}return t===0&&this.param.enable_short_term&&(m=d),{difficulty:this.next_difficulty(i,A),stability:m}}};function Mf(){let B=this.review_time.getTime(),e=this.current.reps,t=this.current.difficulty*this.current.stability;return`${B}_${e}_${t}`}var xf=B=>{let e=B.slice(-1),t=parseInt(B.slice(0,-1),10);if(isNaN(t)||!Number.isFinite(t)||t<0)throw new Error(`Invalid step value: ${B}`);switch(e){case"m":return t;case"h":return t*60;case"d":return t*1440;default:throw new Error(`Invalid step unit: ${B}, expected m/h/d`)}},Lf=(B,e,t)=>{let A=e===z.Relearning||e===z.Review?B.relearning_steps:B.learning_steps,i=A.length;if(i===0||t>=i)return{};let n=A[0],l=xf,c=()=>l(n),g=()=>{if(i===1)return Math.round(l(n)*1.5);let y=A[1];return Math.round((l(n)+l(y))/2)},d=y=>y<0||y>=i?null:A[y],m=y=>l(y),C={},F=d(Math.max(0,t));if(e===z.Review)return C[x.Again]={scheduled_minutes:l(F),next_step:0},C;{C[x.Again]={scheduled_minutes:c(),next_step:0},C[x.Hard]={scheduled_minutes:g(),next_step:t};let y=d(t+1);if(y){let Q=m(y);Q&&(C[x.Good]={scheduled_minutes:Math.round(Q),next_step:t+1})}}return C},vn=(B=>(B.SCHEDULER="Scheduler",B.LEARNING_STEPS="LearningSteps",B.SEED="Seed",B))(vn||{}),Bn=class{constructor(e,t,A,i){ye(this,"last");ye(this,"current");ye(this,"review_time");ye(this,"next",new Map);ye(this,"algorithm");ye(this,"strategies");ye(this,"elapsed_days",0);this.algorithm=A,this.last=$.card(e),this.current=$.card(e),this.review_time=$.time(t),this.strategies=i,this.init()}checkGrade(e){if(!Number.isFinite(e)||e<0||e>4)throw new Error(`Invalid grade "${e}",expected 1-4`)}init(){let{state:e,last_review:t}=this.current,A=0;e!==z.New&&t&&(A=Bf(t,this.review_time)),this.current.last_review=this.review_time,this.elapsed_days=A,this.current.elapsed_days=A,this.current.reps+=1;let i=Mf;if(this.strategies){let n=this.strategies.get(vn.SEED);n&&(i=n)}this.algorithm.seed=i.call(this)}preview(){return{[x.Again]:this.review(x.Again),[x.Hard]:this.review(x.Hard),[x.Good]:this.review(x.Good),[x.Easy]:this.review(x.Easy),[Symbol.iterator]:this.previewIterator.bind(this)}}*previewIterator(){for(let e of pf)yield this.review(e)}review(e){let{state:t}=this.last,A;switch(this.checkGrade(e),t){case z.New:A=this.newState(e);break;case z.Learning:case z.Relearning:A=this.learningState(e);break;case z.Review:A=this.reviewState(e);break}return A}buildLog(e){let{last_review:t,due:A,elapsed_days:i}=this.last;return{rating:e,state:this.current.state,due:t||A,stability:this.current.stability,difficulty:this.current.difficulty,elapsed_days:this.elapsed_days,last_elapsed_days:i,scheduled_days:this.current.scheduled_days,learning_steps:this.current.learning_steps,review:this.review_time}}},Cn=class extends Bn{constructor(t,A,i,n){super(t,A,i,n);ye(this,"learningStepsStrategy");let l=Lf;if(this.strategies){let c=this.strategies.get(vn.LEARNING_STEPS);c&&(l=c)}this.learningStepsStrategy=l}getLearningInfo(t,A){var g,d,m,C;let i=this.algorithm.parameters;t.learning_steps=t.learning_steps||0;let n=this.learningStepsStrategy(i,t.state,this.current.state===z.Learning?t.learning_steps+1:t.learning_steps),l=Math.max(0,(d=(g=n[A])==null?void 0:g.scheduled_minutes)!=null?d:0),c=Math.max(0,(C=(m=n[A])==null?void 0:m.next_step)!=null?C:0);return{scheduled_minutes:l,next_steps:c}}applyLearningSteps(t,A,i){let{scheduled_minutes:n,next_steps:l}=this.getLearningInfo(this.current,A);if(n>0&&n<1440)t.learning_steps=l,t.scheduled_days=0,t.state=i,t.due=wt(this.review_time,Math.round(n),!1);else if(t.state=z.Review,n>=1440)t.learning_steps=l,t.due=wt(this.review_time,Math.round(n),!1),t.scheduled_days=Math.floor(n/1440);else{t.learning_steps=0;let c=this.algorithm.next_interval(t.stability,this.elapsed_days);t.scheduled_days=c,t.due=wt(this.review_time,c,!0)}}newState(t){let A=this.next.get(t);if(A)return A;let i=$.card(this.current);i.difficulty=Xe(this.algorithm.init_difficulty(t),1,10),i.stability=this.algorithm.init_stability(t),this.applyLearningSteps(i,t,z.Learning);let n={card:i,log:this.buildLog(t)};return this.next.set(t,n),n}learningState(t){let A=this.next.get(t);if(A)return A;let{state:i,difficulty:n,stability:l}=this.last,c=$.card(this.current);c.difficulty=this.algorithm.next_difficulty(n,t),c.stability=this.algorithm.next_short_term_stability(l,t),this.applyLearningSteps(c,t,i);let g={card:c,log:this.buildLog(t)};return this.next.set(t,g),g}reviewState(t){let A=this.next.get(t);if(A)return A;let i=this.elapsed_days,{difficulty:n,stability:l}=this.last,c=this.algorithm.forgetting_curve(i,l),g=$.card(this.current),d=$.card(this.current),m=$.card(this.current),C=$.card(this.current);this.next_ds(g,d,m,C,n,l,c),this.next_interval(d,m,C,i),this.next_state(d,m,C),this.applyLearningSteps(g,x.Again,z.Relearning),g.lapses+=1;let F={card:g,log:this.buildLog(x.Again)},y={card:d,log:super.buildLog(x.Hard)},Q={card:m,log:super.buildLog(x.Good)},U={card:C,log:super.buildLog(x.Easy)};return this.next.set(x.Again,F),this.next.set(x.Hard,y),this.next.set(x.Good,Q),this.next.set(x.Easy,U),this.next.get(t)}next_ds(t,A,i,n,l,c,g){t.difficulty=this.algorithm.next_difficulty(l,x.Again);let d=c/Math.exp(this.algorithm.parameters.w[17]*this.algorithm.parameters.w[18]),m=this.algorithm.next_forget_stability(l,c,g);t.stability=Xe(+d.toFixed(8),vt,m),A.difficulty=this.algorithm.next_difficulty(l,x.Hard),A.stability=this.algorithm.next_recall_stability(l,c,g,x.Hard),i.difficulty=this.algorithm.next_difficulty(l,x.Good),i.stability=this.algorithm.next_recall_stability(l,c,g,x.Good),n.difficulty=this.algorithm.next_difficulty(l,x.Easy),n.stability=this.algorithm.next_recall_stability(l,c,g,x.Easy)}next_interval(t,A,i,n){let l,c;l=this.algorithm.next_interval(t.stability,n),c=this.algorithm.next_interval(A.stability,n),l=Math.min(l,c),c=Math.max(c,l+1);let g=Math.max(this.algorithm.next_interval(i.stability,n),c+1);t.scheduled_days=l,t.due=wt(this.review_time,l,!0),A.scheduled_days=c,A.due=wt(this.review_time,c,!0),i.scheduled_days=g,i.due=wt(this.review_time,g,!0)}next_state(t,A,i){t.state=z.Review,t.learning_steps=0,A.state=z.Review,A.learning_steps=0,i.state=z.Review,i.learning_steps=0}},wn=class extends Bn{newState(e){let t=this.next.get(e);if(t)return t;this.current.scheduled_days=0,this.current.elapsed_days=0;let A=$.card(this.current),i=$.card(this.current),n=$.card(this.current),l=$.card(this.current);return this.init_ds(A,i,n,l),this.next_interval(A,i,n,l,0),this.next_state(A,i,n,l),this.update_next(A,i,n,l),this.next.get(e)}init_ds(e,t,A,i){e.difficulty=Xe(this.algorithm.init_difficulty(x.Again),1,10),e.stability=this.algorithm.init_stability(x.Again),t.difficulty=Xe(this.algorithm.init_difficulty(x.Hard),1,10),t.stability=this.algorithm.init_stability(x.Hard),A.difficulty=Xe(this.algorithm.init_difficulty(x.Good),1,10),A.stability=this.algorithm.init_stability(x.Good),i.difficulty=Xe(this.algorithm.init_difficulty(x.Easy),1,10),i.stability=this.algorithm.init_stability(x.Easy)}learningState(e){return this.reviewState(e)}reviewState(e){let t=this.next.get(e);if(t)return t;let A=this.elapsed_days,{difficulty:i,stability:n}=this.last,l=this.algorithm.forgetting_curve(A,n),c=$.card(this.current),g=$.card(this.current),d=$.card(this.current),m=$.card(this.current);return this.next_ds(c,g,d,m,i,n,l),this.next_interval(c,g,d,m,A),this.next_state(c,g,d,m),c.lapses+=1,this.update_next(c,g,d,m),this.next.get(e)}next_ds(e,t,A,i,n,l,c){e.difficulty=this.algorithm.next_difficulty(n,x.Again);let g=this.algorithm.next_forget_stability(n,l,c);e.stability=Xe(l,vt,g),t.difficulty=this.algorithm.next_difficulty(n,x.Hard),t.stability=this.algorithm.next_recall_stability(n,l,c,x.Hard),A.difficulty=this.algorithm.next_difficulty(n,x.Good),A.stability=this.algorithm.next_recall_stability(n,l,c,x.Good),i.difficulty=this.algorithm.next_difficulty(n,x.Easy),i.stability=this.algorithm.next_recall_stability(n,l,c,x.Easy)}next_interval(e,t,A,i,n){let l,c,g,d;l=this.algorithm.next_interval(e.stability,n),c=this.algorithm.next_interval(t.stability,n),g=this.algorithm.next_interval(A.stability,n),d=this.algorithm.next_interval(i.stability,n),l=Math.min(l,c),c=Math.max(c,l+1),g=Math.max(g,c+1),d=Math.max(d,g+1),e.scheduled_days=l,e.due=wt(this.review_time,l,!0),t.scheduled_days=c,t.due=wt(this.review_time,c,!0),A.scheduled_days=g,A.due=wt(this.review_time,g,!0),i.scheduled_days=d,i.due=wt(this.review_time,d,!0)}next_state(e,t,A,i){e.state=z.Review,e.learning_steps=0,t.state=z.Review,t.learning_steps=0,A.state=z.Review,A.learning_steps=0,i.state=z.Review,i.learning_steps=0}update_next(e,t,A,i){let n={card:e,log:this.buildLog(x.Again)},l={card:t,log:super.buildLog(x.Hard)},c={card:A,log:super.buildLog(x.Good)},g={card:i,log:super.buildLog(x.Easy)};this.next.set(x.Again,n),this.next.set(x.Hard,l),this.next.set(x.Good,c),this.next.set(x.Easy,g)}},Xa=class{constructor(e){ye(this,"fsrs");this.fsrs=e}replay(e,t,A){return this.fsrs.next(e,t,A)}handleManualRating(e,t,A,i,n,l,c){if(typeof t>"u")throw new Error("reschedule: state is required for manual rating");let g,d;if(t===z.New)g={rating:x.Manual,state:t,due:c!=null?c:A,stability:e.stability,difficulty:e.difficulty,elapsed_days:i,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,learning_steps:e.learning_steps,review:A},d=ii(A),d.last_review=A;else{if(typeof c>"u")throw new Error("reschedule: due is required for manual rating");let m=Ai(c,A,"days");g={rating:x.Manual,state:e.state,due:e.last_review||e.due,stability:e.stability,difficulty:e.difficulty,elapsed_days:i,last_elapsed_days:e.elapsed_days,scheduled_days:e.scheduled_days,learning_steps:e.learning_steps,review:A},d={...e,state:t,due:c,last_review:A,stability:n||e.stability,difficulty:l||e.difficulty,elapsed_days:i,scheduled_days:m,reps:e.reps+1}}return{card:d,log:g}}reschedule(e,t){let A=[],i=ii(e.due);for(let n of t){let l;if(n.review=$.time(n.review),n.rating===x.Manual){let c=0;i.state!==z.New&&i.last_review&&(c=Ai(n.review,i.last_review,"days")),l=this.handleManualRating(i,n.state,n.review,c,n.stability,n.difficulty,n.due?$.time(n.due):void 0)}else l=this.replay(i,n.review,n.rating);A.push(l),i=l.card}return A}calculateManualRecord(e,t,A,i){if(!A)return null;let{card:n,log:l}=A,c=$.card(e);return c.due.getTime()===n.due.getTime()?null:(c.scheduled_days=Ai(n.due,c.due,"days"),this.handleManualRating(c,n.state,$.time(t),l.elapsed_days,i?n.stability:void 0,i?n.difficulty:void 0,n.due))}},Ja=class extends Wa{constructor(t){super(t);ye(this,"strategyHandler",new Map);ye(this,"Scheduler");let{enable_short_term:A}=this.parameters;this.Scheduler=A?Cn:wn}params_handler_proxy(){let t=this;return{set:function(A,i,n){return i==="request_retention"&&Number.isFinite(n)?t.intervalModifier=t.calculate_interval_modifier(Number(n)):i==="enable_short_term"?t.Scheduler=n===!0?Cn:wn:i==="w"&&(n=Ya($a(n),A.relearning_steps.length),t.forgetting_curve=_a.bind(this,n),t.intervalModifier=t.calculate_interval_modifier(Number(A.request_retention))),Reflect.set(A,i,n),!0}}}useStrategy(t,A){return this.strategyHandler.set(t,A),this}clearStrategy(t){return t?this.strategyHandler.delete(t):this.strategyHandler.clear(),this}getScheduler(t,A){let i=this.strategyHandler.get(vn.SCHEDULER)||this.Scheduler;return new i(t,A,this,this.strategyHandler)}repeat(t,A,i){let n=this.getScheduler(t,A).preview();return i&&typeof i=="function"?i(n):n}next(t,A,i,n){let l=this.getScheduler(t,A),c=$.rating(i);if(c===x.Manual)throw new Error("Cannot review a manual rating");let g=l.review(c);return n&&typeof n=="function"?n(g):g}get_retrievability(t,A,i=!0){let n=$.card(t);A=A?$.time(A):new Date;let l=n.state!==z.New?Math.max(Ai(A,n.last_review,"days"),0):0,c=n.state!==z.New?this.forgetting_curve(l,+n.stability.toFixed(8)):0;return i?`${(c*100).toFixed(2)}%`:c}rollback(t,A,i){let n=$.card(t),l=$.review_log(A);if(l.rating===x.Manual)throw new Error("Cannot rollback a manual rating");let c,g,d;switch(l.state){case z.New:c=l.due,g=void 0,d=0;break;case z.Learning:case z.Relearning:case z.Review:c=l.review,g=l.due,d=n.lapses-(l.rating===x.Again&&l.state===z.Review?1:0);break}let m={...n,due:c,stability:l.stability,difficulty:l.difficulty,elapsed_days:l.last_elapsed_days,scheduled_days:l.scheduled_days,reps:Math.max(0,n.reps-1),lapses:Math.max(0,d),learning_steps:l.learning_steps,state:l.state,last_review:g};return i&&typeof i=="function"?i(m):m}forget(t,A,i=!1,n){let l=$.card(t);A=$.time(A);let c=l.state===z.New?0:Ai(A,l.due,"days"),g={rating:x.Manual,state:l.state,due:l.due,stability:l.stability,difficulty:l.difficulty,elapsed_days:0,last_elapsed_days:l.elapsed_days,scheduled_days:c,learning_steps:l.learning_steps,review:A},d={card:{...l,due:A,stability:0,difficulty:0,elapsed_days:0,scheduled_days:0,reps:i?0:l.reps,lapses:i?0:l.lapses,learning_steps:0,state:z.New,last_review:l.last_review},log:g};return n&&typeof n=="function"?n(d):d}reschedule(t,A=[],i={}){let{recordLogHandler:n,reviewsOrderBy:l,skipManual:c=!0,now:g=new Date,update_memory_state:d=!1}=i;l&&typeof l=="function"&&A.sort(l),c&&(A=A.filter(U=>U.rating!==x.Manual));let m=new Xa(this),C=m.reschedule(i.first_card||ii(),A),F=C.length,y=$.card(t),Q=m.calculateManualRecord(y,g,F?C[F-1]:void 0,d);return n&&typeof n=="function"?{collections:C.map(n),reschedule_item:Q?n(Q):null}:{collections:C,reschedule_item:Q}}},za=B=>new Ja(B||{});CA();var Fn=class{constructor(e={}){this.params=this.convertToTsFSRSParams(e),this.fsrsInstance=za(this.params)}convertToTsFSRSParams(e){let{request_retention:t=.9,maximum_interval:A=36500,w:i=[]}=e;return mn({request_retention:t,maximum_interval:A,enable_fuzz:!0,enable_short_term:!0,w:e.w||[]})}toTsFSRSCard(e){if(e.lastReview===0)return ii(new Date(e.createdAt));let t=z.New;return e.reviews>0&&(e.lapses>0?t=z.Relearning:t=z.Review),{due:new Date(e.nextReview),stability:e.stability,difficulty:e.difficulty,elapsed_days:e.lastReview?(Date.now()-e.lastReview)/(24*60*60*1e3):0,scheduled_days:e.lastReview?(e.nextReview-e.lastReview)/(24*60*60*1e3):0,reps:e.reviews,lapses:e.lapses,state:t,last_review:e.lastReview?new Date(e.lastReview):void 0,learning_steps:0}}convertRating(e){switch(e){case oe.AGAIN:return x.Again;case oe.HARD:return x.Hard;case oe.GOOD:return x.Good;case oe.EASY:return x.Easy;default:return x.Good}}fromTsFSRSCard(e,t){let{card:A,log:i}=t;return{...e,difficulty:A.difficulty,stability:A.stability,retrievability:Math.exp(Math.log(.9)*A.elapsed_days/A.stability),lastReview:i.review.getTime(),nextReview:A.due.getTime(),reviews:A.reps,lapses:A.lapses,reviewHistory:[...e.reviewHistory,{timestamp:i.review.getTime(),rating:this.convertTsFSRSRatingToFSRSRating(i.rating),elapsed:i.elapsed_days}]}}convertTsFSRSRatingToFSRSRating(e){switch(e){case x.Again:return oe.AGAIN;case x.Hard:return oe.HARD;case x.Good:return oe.GOOD;case x.Easy:return oe.EASY;default:return oe.GOOD}}initializeCard(e,t,A){let i=Date.now(),n=ii(new Date(i));return{id:tt.generateCardId(),difficulty:n.difficulty,stability:n.stability,retrievability:1,lastReview:0,nextReview:i,reviews:0,lapses:0,reviewHistory:[],text:e,answer:t,filePath:A,createdAt:i}}reviewCard(e,t){let A=this.toTsFSRSCard(e),i=this.convertRating(t),n=new Date;if(i!==x.Manual){let l=this.fsrsInstance.next(A,n,i);return this.fromTsFSRSCard(e,l)}else return e}getSchedulingCards(e){let t=this.toTsFSRSCard(e),A=new Date,i=this.fsrsInstance.repeat(t,A);return{[oe.AGAIN]:this.fromTsFSRSCard(e,i[x.Again]),[oe.HARD]:this.fromTsFSRSCard(e,i[x.Hard]),[oe.GOOD]:this.fromTsFSRSCard(e,i[x.Good]),[oe.EASY]:this.fromTsFSRSCard(e,i[x.Easy])}}isDue(e){return Date.now()>=e.nextReview}getParameters(){return{...this.params}}setParameters(e){this.params=this.convertToTsFSRSParams(e),this.fsrsInstance=za(this.params)}};var yn=class{constructor(e={}){this.params={...Ia,...e},this.adapter=new Fn(this.params)}initializeCard(e,t,A){return this.adapter.initializeCard(e,t,A)}reviewCard(e,t){return this.adapter.reviewCard(e,t)}isDue(e){return this.adapter.isDue(e)}getReviewableCards(e){return e.filter(t=>this.isDue(t)).sort((t,A)=>t.nextReview-A.nextReview)}getParameters(){return{...this.params}}setParameters(e){this.params={...this.params,...e},this.adapter.setParameters(this.params)}resetParameters(){this.params={...Ia},this.adapter.setParameters(this.params)}getSchedulingCards(e){return this.adapter.getSchedulingCards(e)}};var En=class{constructor(e,t){this.plugin=e,this.fsrsService=t}get storage(){return this.plugin.fsrsManager.storage}createCard(e,t,A){try{return this.fsrsService.initializeCard(e,t,A)}catch(i){console.error("\u521B\u5EFA\u5361\u7247\u65F6\u51FA\u9519:",i);try{return this.fsrsService.initializeCard(e,t,A)}catch(n){console.error("\u7B2C\u4E8C\u6B21\u5C1D\u8BD5\u521B\u5EFA\u5361\u7247\u5931\u8D25:",n);let l=new Date;return this.fsrsService.initializeCard(e,t,A)}}}addCard(e,t,A){let i=this.createCard(e,t,A);this.storage.cards||(this.storage.cards={}),this.storage.cards[i.id]=i;try{this.plugin.eventManager.emitFlashcardChanged()}catch(n){console.error("\u4FDD\u5B58\u5361\u7247\u65F6\u51FA\u9519:",n)}return i}getCardsByFile(e){return this.storage.cards?Object.values(this.storage.cards).filter(t=>t.filePath===e):[]}deleteCard(e){try{return!this.storage.cards||!this.storage.cards[e]?!1:(delete this.storage.cards[e],this.plugin.eventManager.emitFlashcardChanged(),!0)}catch(t){return console.error("\u5220\u9664\u5361\u7247\u65F6\u51FA\u9519:",t),!1}}};CA();var sr=class{constructor(e,t){this.plugin=e,this.storage=t}getCardGroups(){return this.storage.cardGroups||[]}getGroupById(e){return this.storage.cardGroups.find(t=>t.id===e)||null}async createCardGroup(e){Array.isArray(this.storage.cardGroups)||(this.storage.cardGroups=[]);let A={id:tt.generateGroupId(),name:e.name,filter:e.filter,createdTime:e.createdTime||Date.now(),sortOrder:e.sortOrder||this.storage.cardGroups.length,isReversed:e.isReversed||!1,settings:e.settings||{useGlobalSettings:!0},cardIds:[]};this.storage.cardGroups.push(A),e.filter&&e.filter.trim().length>0&&this.updateGroupCardIds(A.id);try{await this.plugin.fsrsManager.saveStoragePublic()}catch(i){console.error("\u4FDD\u5B58\u5206\u7EC4\u6570\u636E\u65F6\u51FA\u9519:",i)}return this.plugin.eventManager.emitFlashcardChanged(),A}async updateCardGroup(e,t){let A=this.storage.cardGroups.findIndex(i=>i.id===e);return A===-1?!1:(this.storage.cardGroups[A]={...this.storage.cardGroups[A],...t},t.filter&&this.updateGroupCardIds(e),this.plugin.eventManager.emitFlashcardChanged(),!0)}async deleteCardGroup(e,t=!1){let A=this.storage.cardGroups.findIndex(c=>c.id===e);if(A===-1)return!1;let i=this.storage.cardGroups[A],n=this.storage.uiState;n.currentGroupId===e&&(n.currentGroupId="",n.currentGroupName="",n.currentIndex=0,n.isFlipped=!1,n.completionMessage=null),n.groupCompletionMessages&&e in n.groupCompletionMessages&&delete n.groupCompletionMessages[e],n.groupProgress&&e in n.groupProgress&&delete n.groupProgress[e];let l=[...i.cardIds||[]];for(let c of l)this.removeCardFromGroup(c,e);return this.storage.cardGroups.splice(A,1),this.plugin.eventManager.emitFlashcardChanged(),!0}addCardToGroup(e,t){let A=this.storage.cardGroups.find(n=>n.id===t);if(!A)return!1;let i=this.storage.cards[e];return i?(A.cardIds||(A.cardIds=[]),i.groupIds||(i.groupIds=[]),A.cardIds.includes(e)||(A.cardIds.push(e),i.groupIds.includes(t)||i.groupIds.push(t)),!0):!1}removeCardFromGroup(e,t){let A=this.storage.cardGroups.find(n=>n.id===t);if(!A||!A.cardIds)return!1;let i=this.storage.cards[e];return i?(A.cardIds=A.cardIds.filter(n=>n!==e),i.groupIds&&(i.groupIds=i.groupIds.filter(n=>n!==t)),!0):!1}getCardsByGroupId(e){let t=this.getGroupById(e);if(!t)return console.error(`[getCardsByGroupId] \u9519\u8BEF: \u672A\u627E\u5230\u5206\u7EC4: ${e}`),[];let A=Object.keys(this.storage.cards||{});if(t.cardIds&&t.cardIds.length>0)return t.cardIds.filter(n=>{let l=!!this.storage.cards[n];return l||console.warn(`[getCardsByGroupId] \u5361\u7247\u4E0D\u5B58\u5728: ${n}`),l}).map(n=>this.storage.cards[n]);if(t.filter&&t.filter.trim().length>0){let i=Object.values(this.storage.cards),n=t.filter.split(",").map(g=>g.trim()).filter(g=>g.length>0),l=/\[\[([^\]]+)\]\]/;return i.filter(g=>{if(!g.filePath)return!1;let d=g.filePath.toLowerCase(),m=d.split("/").pop()||"",C=m.replace(/\.md$/i,"");for(let F of n){let y=F.toLowerCase(),Q=y.match(l);if(Q){let U=Q[1].toLowerCase();if(C===U||m===U)return!0}else if(d.includes(y)||g.text&&g.text.toLowerCase().includes(y)||g.answer&&g.answer.toLowerCase().includes(y))return!0}return!1})}return[]}getGroupProgress(e){if(!this.getGroupById(e))return null;let A=this.getCardsByGroupId(e),i=Date.now();return{due:A.filter(n=>n.nextReview<=i).length,newCards:A.filter(n=>n.lastReview===0).length,learned:A.filter(n=>n.lastReview>0).length,retention:this.calculateGroupRetention(A)}}calculateGroupRetention(e){let t=e.filter(i=>i.lastReview>0);return t.length===0?1:t.reduce((i,n)=>i+n.retrievability,0)/t.length}deleteCardReference(e){for(let t of this.storage.cardGroups)t.cardIds&&(t.cardIds=t.cardIds.filter(A=>A!==e))}getGroupsByCardId(e){let t=this.storage.cards[e];return!t||!t.groupIds?[]:t.groupIds.map(A=>this.storage.cardGroups.find(i=>i.id===A)).filter(A=>A!==void 0)}updateGroupCardIds(e){let t=this.getGroupById(e);if(!t||!t.filter||t.filter.trim().length===0)return!1;let A=Object.values(this.storage.cards||{}),i=t.filter.split(",").map(d=>d.trim()).filter(d=>d.length>0),n=/\[\[([^\]]+)\]\]/,c=A.filter(d=>{if(!d.filePath)return!1;let m=d.filePath.toLowerCase(),C=m.split("/").pop()||"",F=C.replace(/\.md$/i,"");for(let y of i){let Q=y.toLowerCase(),U=Q.match(n);if(U){let b=U[1].toLowerCase();if(F===b||C===b)return!0}else if(m.includes(Q)||d.text&&d.text.toLowerCase().includes(Q)||d.answer&&d.answer.toLowerCase().includes(Q))return!0}return!1}).map(d=>d.id);t.cardIds||(t.cardIds=[]);let g=!1;for(let d of c)t.cardIds.includes(d)||(t.cardIds.push(d),g=!0);return g&&this.plugin.fsrsManager.saveStorageDebounced(),g}};var Wc=require("obsidian"),In=class{constructor(e,t){this.useNewStorage=!1;this.plugin=e,this.fsrsService=new yn,this.cardFactory=new En(e,this.fsrsService),t&&(this.dataManager=t,this.useNewStorage=!0),this.storage={version:"1.0",cards:{},globalStats:{totalReviews:0,averageRetention:1,streakDays:0,lastReviewDate:0},cardGroups:[],uiState:{currentGroupName:"",completionMessage:null,groupProgress:{}},dailyStats:[]},this.saveStorageDebounced=(0,Wc.debounce)(this.saveStorage.bind(this),1e3,!0),this.loadStorage().then(A=>{this.storage=A,this.groupRepository=new sr(e,this.storage),this.registerEventListeners()}).catch(A=>{console.error("Loading storage data failed:",A),this.groupRepository=new sr(e,this.storage),this.registerEventListeners()})}async loadStorage(){let e={version:"1.0",cards:{},globalStats:{totalReviews:0,averageRetention:1,streakDays:0,lastReviewDate:0},cardGroups:[],uiState:{currentGroupName:"",completionMessage:null,groupProgress:{}},dailyStats:[]};try{if(this.useNewStorage&&this.dataManager)return await this.dataManager.getFlashcardData()||e;{let t=await this.plugin.loadData();if(!(t!=null&&t.fsrs))return e;let A=Array.isArray(t.fsrs.cardGroups)?t.fsrs.cardGroups:[];return{version:t.fsrs.version||e.version,cards:t.fsrs.cards||{},globalStats:t.fsrs.globalStats||e.globalStats,cardGroups:A,uiState:t.fsrs.uiState||e.uiState,dailyStats:t.fsrs.dailyStats||[]}}}catch(t){return console.error("Loading storage data failed:",t),e}}async saveStorage(){try{if(Array.isArray(this.storage.cardGroups)||(this.storage.cardGroups=[]),this.storage.cards||(this.storage.cards={}),this.useNewStorage&&this.dataManager)await this.dataManager.saveFlashcardData(this.storage);else{let t={...await this.plugin.loadData()||{},fsrs:this.storage};await this.plugin.saveData(t)}}catch(e){throw console.error("Saving data failed:",e),e}}updateGlobalStats(e,t){let A=this.storage.globalStats,i=Date.now(),n=new Date(i).setHours(0,0,0,0);if(A.totalReviews++,A.averageRetention=(A.averageRetention*(A.totalReviews-1)+t)/A.totalReviews,A.lastReviewDate===0)A.streakDays=1;else{let l=new Date(A.lastReviewDate).setHours(0,0,0,0),c=(n-l)/(24*60*60*1e3);c===1?A.streakDays++:c>1&&(A.streakDays=1)}A.lastReviewDate=i}addCard(e,t,A,i,n){let l=this.cardFactory.createCard(e,t,A);return i&&n&&(l.sourceId=i,l.sourceType=n),this.storage.cards[l.id]=l,this.checkAndAddCardToGroups(l),this.saveStorageDebounced(),l}getCardsForStudy(e){if(!e)return console.warn("No group ID specified, returning empty card list"),[];let t=this.groupRepository.getCardsByGroupId(e);if(t.length===0)return[];let A=Date.now(),i=t.filter(y=>y.reviews===0&&y.lastReview===0),n=t.filter(y=>!(y.reviews===0&&y.lastReview===0)&&y.nextReview<=A),l=this.getRemainingNewCardsToday(e),c=this.getRemainingReviewsToday(e),g=this.storage.cardGroups.find(y=>y.id===e),d=20,m=100;if(g&&g.settings)if(!g.settings.useGlobalSettings)d=g.settings.newCardsPerDay!==void 0?g.settings.newCardsPerDay:d,m=g.settings.reviewsPerDay!==void 0?g.settings.reviewsPerDay:m;else{let y=this.fsrsService.getParameters();d=y.newCardsPerDay,m=y.reviewsPerDay}let C=i.slice(0,l),F=n.slice(0,c);return[...C,...F]}trackStudyProgress(e,t){let A=this.storage.cards[e];if(!A)return console.error(`Tracking study progress failed: Card ${e} does not exist`),null;let i=A.lastReview===0,n=this.fsrsService.reviewCard(A,t);return this.storage.cards[e]=n,this.updateGlobalStats(t,n.retrievability),this.updateDailyStats(i,t),A.groupIds&&A.groupIds.length>0&&A.groupIds.forEach(l=>{let c=this.groupRepository.getGroupById(l)}),this.saveStorage(),this.plugin.eventManager.emitFlashcardChanged(),this.storage.cards[e]}getCardPredictions(e){let t=this.storage.cards[e];return t?this.fsrsService.getSchedulingCards(t):null}async generateCardsForGroup(e){return 0}checkAndAddCardToGroups(e){if(!e||!e.id)return 0;let t=this.groupRepository.getCardGroups();if(!t||t.length===0)return 0;let A=0;for(let i of t){if(!i.filter||i.filter.trim().length===0)continue;let n=[e];this.checkCardMatchesGroupFilter(e,i.filter)&&this.addCardToGroup(e.id,i.id)&&A++}return A>0,A}checkCardMatchesGroupFilter(e,t){if(!e||!e.filePath||!t||t.trim().length===0)return!1;let A=t.split(",").map(g=>g.trim()).filter(g=>g.length>0);if(A.length===0)return!1;let i=/\[\[([^\]]+)\]\]/,n=e.filePath.toLowerCase(),l=n.split("/").pop()||"",c=l.replace(/\.md$/i,"");for(let g of A){let d=g.toLowerCase(),m=d.match(i);if(m){let C=m[1].toLowerCase();if(c===C||l===C)return!0}else if(n.includes(d)||e.text&&e.text.toLowerCase().includes(d)||e.answer&&e.answer.toLowerCase().includes(d))return!0}return!1}findCardsBySourceId(e,t){return!this.storage.cards||!e?[]:Object.values(this.storage.cards).filter(A=>A.sourceId===e&&(!t||A.sourceType===t))}deleteCardsBySourceId(e,t){let A=this.findCardsBySourceId(e,t),i=0;for(let n of A){if(n.groupIds)for(let l of n.groupIds)this.removeCardFromGroup(n.id,l);delete this.storage.cards[n.id],i++}return i>0&&this.saveStorageDebounced(),i}updateCardsBySourceId(e,t,A,i){let n=this.findCardsBySourceId(e,t),l=0;for(let c of n)A!==void 0&&(c.text=A),i!==void 0&&(c.answer=i),c.updatedAt=Date.now(),l++;return l>0&&this.saveStorageDebounced(),l}getTotalCardsCount(){let e=this.getCardGroups()||[];if(e.length===0)return 0;if(e.length===1&&e[0].cardIds)return e[0].cardIds.length;let t=new Set;return e.forEach(A=>{A.cardIds&&A.cardIds.forEach(i=>{this.storage.cards[i]&&t.add(i)})}),t.size}getProgress(){let e=this.getAllGroupCards(),t=Date.now();return e.length===0?{due:0,newCards:0,learned:0,retention:this.storage.globalStats.averageRetention}:{due:e.filter(A=>A.nextReview<=t).length,newCards:e.filter(A=>A.lastReview===0).length,learned:e.filter(A=>A.lastReview>0).length,retention:this.storage.globalStats.averageRetention}}getAllGroupCards(){let e=this.groupRepository.getCardGroups();if(!e||e.length===0)return[];let t=new Set,A=[];for(let i of e){let n=this.groupRepository.getCardsByGroupId(i.id);for(let l of n)t.has(l.id)||(t.add(l.id),A.push(l))}return A}getStats(){return{...this.storage.globalStats}}getUIState(){return{...this.storage.uiState}}updateUIState(e){this.storage.uiState={...this.storage.uiState,...e},this.saveStorageDebounced()}deleteCard(e){let t=this.storage.cards[e];if(!t)return!1;if(t.groupIds)for(let A of t.groupIds)this.removeCardFromGroup(e,A);return delete this.storage.cards[e],this.saveStorageDebounced(),this.plugin.eventManager.emitFlashcardChanged(),!0}getCardsByFile(e){return this.cardFactory.getCardsByFile(e)}getPlugin(){return this.plugin}async saveStoragePublic(){return this.saveStorage()}getTodayTimestamp(){let e=new Date;return e.setHours(0,0,0,0),e.getTime()}getTodayStats(){let e=new Date;e.setHours(0,0,0,0);let t=e.getTime(),A=e.toDateString(),i=this.storage.dailyStats.find(n=>new Date(n.date).toDateString()===A);return i||(i={date:t,newCardsLearned:0,cardsReviewed:0,reviewCount:0,newCount:0,againCount:0,hardCount:0,goodCount:0,easyCount:0},this.storage.dailyStats.push(i),this.saveStorageDebounced()),i}updateTodayStats(e){let t=this.getTodayStats();e?t.newCardsLearned++:t.cardsReviewed++,this.saveStorageDebounced()}canLearnNewCardsToday(e){let t=this.getTodayStats(),A=this.fsrsService.getParameters();if(e){let i=this.storage.cardGroups.find(n=>n.id===e);if(i&&i.settings&&!i.settings.useGlobalSettings&&i.settings.newCardsPerDay!==void 0)return t.newCardsLearned<i.settings.newCardsPerDay}return t.newCardsLearned<A.newCardsPerDay}canReviewCardsToday(e){let t=this.getTodayStats(),A=this.fsrsService.getParameters();if(e){let i=this.storage.cardGroups.find(n=>n.id===e);if(i&&i.settings&&!i.settings.useGlobalSettings&&i.settings.reviewsPerDay!==void 0)return t.cardsReviewed<i.settings.reviewsPerDay}return t.cardsReviewed<A.reviewsPerDay}getRemainingNewCardsToday(e){let t=this.getTodayStats(),A=this.fsrsService.getParameters();if(e){let i=this.storage.cardGroups.find(n=>n.id===e);if(i&&i.settings&&!i.settings.useGlobalSettings&&i.settings.newCardsPerDay!==void 0)return Math.max(0,i.settings.newCardsPerDay-t.newCardsLearned)}return Math.max(0,A.newCardsPerDay-t.newCardsLearned)}getRemainingReviewsToday(e){let t=this.getTodayStats(),A=this.fsrsService.getParameters();if(e){let i=this.storage.cardGroups.find(n=>n.id===e);if(i&&i.settings&&!i.settings.useGlobalSettings&&i.settings.reviewsPerDay!==void 0)return Math.max(0,i.settings.reviewsPerDay-t.cardsReviewed)}return Math.max(0,A.reviewsPerDay-t.cardsReviewed)}async createCardGroup(e){Array.isArray(this.storage.cardGroups)||(this.storage.cardGroups=[]);let t=await this.groupRepository.createCardGroup(e),A=await this.generateCardsForGroup(t.id);return this.storage.cardGroups.some(i=>i.id===t.id)||this.storage.cardGroups.push(t),await this.saveStorage(),t}async updateCardGroup(e,t){let A=this.groupRepository.getGroupById(e),i=A==null?void 0:A.filter;if(!await this.groupRepository.updateCardGroup(e,t))return!1;if(t.filter!==void 0&&t.filter!==i){let l=this.groupRepository.getGroupById(e);if(l&&l.cardIds)for(let g of[...l.cardIds])this.removeCardFromGroup(g,e);let c=await this.generateCardsForGroup(e)}return await this.saveStorage(),!0}async deleteCardGroup(e,t=!1){if(!await this.groupRepository.deleteCardGroup(e,!1))return!1;try{return await this.saveStorage(),!0}catch(i){return!1}}getCardsInGroup(e){return e.cardIds&&e.cardIds.length>0?this.getCardsByGroupId(e.id):Object.values(this.storage.cards).filter(A=>{let i=e.filter.split(",").map(d=>d.trim().toLowerCase()),n=A.text.toLowerCase(),l=A.answer.toLowerCase(),c=(A.filePath||"").toLowerCase();return i.some(d=>{if(d.startsWith("#"))return n.includes(d)||l.includes(d);if(d.startsWith("path:")){let m=d.substring(5);return c.includes(m)}return n.includes(d)||l.includes(d)})})}addCardToGroup(e,t){let A=this.groupRepository.addCardToGroup(e,t);return A&&this.saveStorageDebounced(),A}removeCardFromGroup(e,t){let A=this.groupRepository.removeCardFromGroup(e,t);return A&&this.saveStorageDebounced(),A}getGroupProgress(e){return this.groupRepository.getGroupProgress(e)}getCardsByGroupId(e){return this.groupRepository.getCardsByGroupId(e)}getAllCards(){return Object.values(this.storage.cards)}getCardGroups(){return this.groupRepository.getCardGroups()}registerEventListeners(){if(!this.plugin.eventManager){console.error("\u4E8B\u4EF6\u7BA1\u7406\u5668\u4E0D\u5B58\u5728\uFF0C\u65E0\u6CD5\u6CE8\u518C\u4E8B\u4EF6\u76D1\u542C\u5668");return}this.plugin.eventManager.on("highlight:update",(e,t,A,i)=>{this.handleHighlightUpdate(e,t,A,i)}),this.plugin.eventManager.on("highlight:delete",(e,t,A)=>{this.handleHighlightDelete(e,t,A)}),this.plugin.eventManager.on("comment:update",(e,t,A,i)=>{this.handleCommentUpdate(e,t,A,i)}),this.plugin.eventManager.on("comment:delete",(e,t,A)=>{this.handleCommentDelete(e,t,A)})}handleHighlightUpdate(e,t,A,i){let n=this.updateCardsBySourceId(i,"highlight",A)}handleHighlightDelete(e,t,A){let i=this.deleteCardsBySourceId(A,"highlight")}handleCommentUpdate(e,t,A,i){var d;let n=this.findCardsBySourceId(i,"highlight");if(!n||n.length===0)return;let l=(d=this.plugin.highlightRepository)==null?void 0:d.findHighlightById(i),c=(l==null?void 0:l.comments)||[],g=0;for(let m of n){let C=/\{\{([^{}]+)\}\}/g,F=[],y;for(;(y=C.exec(m.text))!==null;)F.push(y[1]);let Q=[];if(F.length>0&&Q.push(F.join(`
`)),c.length>0){let b=c.map(P=>P.content).filter(P=>P&&P.trim()!=="");b.length>0&&Q.push(b.join(`

`))}let U=Q.length>0?Q.join(`

`):"";U!==m.answer&&(m.answer=U,m.updatedAt=Date.now(),g++)}g>0&&(this.saveStorageDebounced(),this.plugin.eventManager&&this.plugin.eventManager.emitFlashcardChanged())}handleCommentDelete(e,t,A){let i=this.deleteCardsBySourceId(A,"highlight")}checkAndMaintainDailyStats(){this.storage.dailyStats||(this.storage.dailyStats=[]),this.storage.dailyStats.sort((t,A)=>A.date-t.date);let e=new Map;return this.storage.dailyStats.forEach(t=>{let A=new Date(t.date),i=`${A.getFullYear()}-${A.getMonth()+1}-${A.getDate()}`;e.has(i)||e.set(i,t)}),this.storage.dailyStats=Array.from(e.values()),this.storage.dailyStats.sort((t,A)=>A.date-t.date),this.storage.dailyStats.length>84&&(this.storage.dailyStats=this.storage.dailyStats.slice(0,84)),this.storage.dailyStats.length}updateDailyStats(e,t){let A=new Date;A.setHours(0,0,0,0);let i=A.getTime();this.storage.globalStats.lastReviewDate?this.storage.globalStats.lastReviewDate===i||(this.storage.globalStats.lastReviewDate===i-864e5?(this.storage.globalStats.lastReviewDate=i,this.storage.globalStats.streakDays++):this.storage.globalStats.lastReviewDate<i&&(this.storage.globalStats.lastReviewDate=i,this.storage.globalStats.streakDays=1)):(this.storage.globalStats.lastReviewDate=i,this.storage.globalStats.streakDays=1);let n=A.toDateString(),l=this.storage.dailyStats.find(c=>new Date(c.date).toDateString()===n);switch(l||(l={date:i,newCardsLearned:0,cardsReviewed:0,reviewCount:0,newCount:0,againCount:0,hardCount:0,goodCount:0,easyCount:0},this.storage.dailyStats.push(l),this.checkAndMaintainDailyStats()),l.reviewCount++,e?(l.newCount++,l.newCardsLearned++):l.cardsReviewed++,t){case oe.AGAIN:l.againCount++;break;case oe.HARD:l.hardCount++;break;case oe.GOOD:l.goodCount++;break;case oe.EASY:l.easyCount++;break}this.saveStorageDebounced()}cleanupInvalidCardReferences(){let e=0;if(!this.storage.cardGroups)return e;for(let t of this.storage.cardGroups)if(t.cardIds&&t.cardIds.length>0){let A=t.cardIds.length;t.cardIds=t.cardIds.filter(n=>this.storage.cards&&this.storage.cards[n]);let i=A-t.cardIds.length;i>0&&(e+=i,t.lastUpdated=Date.now())}return e>0&&this.saveStorageDebounced(),e}resetGroupCompletionMessage(e){if(!e)return;let t=this.groupRepository.getGroupById(e);t&&(this.storage.uiState||(this.storage.uiState={currentGroupName:"",completionMessage:null,groupProgress:{}}),this.storage.uiState.groupProgress||(this.storage.uiState.groupProgress={}),this.storage.uiState.groupProgress[t.name]&&(this.storage.uiState.groupProgress[t.name].completionMessage=null,this.saveStorageDebounced()))}};var Xc=require("crypto"),Je=class{static toSafeFileName(e){return e.replace(/[\/\\:*?"<>|]/g,"_").replace(/\s+/g,"_").toLowerCase()+".json"}static fromSafeFileName(e){return e.replace(/\.json$/,"").replace(/_/g," ")}static generateHash(e){return(0,Xc.createHash)("md5").update(e).digest("hex")}static isSafePath(e){return!/[\/\\:*?"<>|]/.test(e)}static getHiNoteDir(e){return`${e}/.hinote`}static getHighlightsDir(e){return`${this.getHiNoteDir(e)}/highlights`}static getFlashcardsDir(e){return`${this.getHiNoteDir(e)}/flashcards`}static getMetadataDir(e){return`${this.getHiNoteDir(e)}/metadata`}};var ri=class{static validateHighlightData(e){let t=[];if(!e||typeof e!="object")return t.push("\u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61"),{valid:!1,errors:t};if((!e.version||typeof e.version!="string")&&t.push("\u7F3A\u5C11\u6709\u6548\u7684\u7248\u672C\u4FE1\u606F"),e.lastModified&&typeof e.lastModified!="number"&&t.push("lastModified\u5FC5\u987B\u662F\u6570\u5B57"),!e.highlights||typeof e.highlights!="object")return t.push("\u7F3A\u5C11highlights\u5BF9\u8C61"),{valid:!1,errors:t};for(let[A,i]of Object.entries(e.highlights)){let n=this.validateHighlight(A,i);t.push(...n)}return{valid:t.length===0,errors:t}}static validateHighlight(e,t){let A=[];return!t||typeof t!="object"?(A.push(`\u9AD8\u4EAE ${e}: \u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61`),A):((!t.text||typeof t.text!="string")&&A.push(`\u9AD8\u4EAE ${e}: \u7F3A\u5C11\u6709\u6548\u7684text\u5B57\u6BB5`),typeof t.position!="number"&&A.push(`\u9AD8\u4EAE ${e}: position\u5FC5\u987B\u662F\u6570\u5B57`),typeof t.created!="number"&&A.push(`\u9AD8\u4EAE ${e}: created\u5FC5\u987B\u662F\u6570\u5B57`),typeof t.updated!="number"&&A.push(`\u9AD8\u4EAE ${e}: updated\u5FC5\u987B\u662F\u6570\u5B57`),t.backgroundColor&&typeof t.backgroundColor!="string"&&A.push(`\u9AD8\u4EAE ${e}: backgroundColor\u5FC5\u987B\u662F\u5B57\u7B26\u4E32`),t.blockId&&typeof t.blockId!="string"&&A.push(`\u9AD8\u4EAE ${e}: blockId\u5FC5\u987B\u662F\u5B57\u7B26\u4E32`),t.isCloze&&typeof t.isCloze!="boolean"&&A.push(`\u9AD8\u4EAE ${e}: isCloze\u5FC5\u987B\u662F\u5E03\u5C14\u503C`),t.comments&&(Array.isArray(t.comments)?t.comments.forEach((i,n)=>{let l=this.validateComment(i,`${e}.comments[${n}]`);A.push(...l)}):A.push(`\u9AD8\u4EAE ${e}: comments\u5FC5\u987B\u662F\u6570\u7EC4`)),A)}static validateComment(e,t){let A=[];return!e||typeof e!="object"?(A.push(`${t}: \u8BC4\u8BBA\u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61`),A):((!e.id||typeof e.id!="string")&&A.push(`${t}: \u7F3A\u5C11\u6709\u6548\u7684id\u5B57\u6BB5`),(!e.content||typeof e.content!="string")&&A.push(`${t}: \u7F3A\u5C11\u6709\u6548\u7684content\u5B57\u6BB5`),typeof e.created!="number"&&A.push(`${t}: created\u5FC5\u987B\u662F\u6570\u5B57`),typeof e.updated!="number"&&A.push(`${t}: updated\u5FC5\u987B\u662F\u6570\u5B57`),A)}static validateFlashcardData(e){let t=[];return!e||typeof e!="object"?(t.push("\u95EA\u5361\u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61"),{valid:!1,errors:t}):((!e.version||typeof e.version!="string")&&t.push("\u7F3A\u5C11\u6709\u6548\u7684\u7248\u672C\u4FE1\u606F"),e.cards&&typeof e.cards!="object"&&t.push("cards\u5FC5\u987B\u662F\u5BF9\u8C61"),e.globalStats&&typeof e.globalStats!="object"&&t.push("globalStats\u5FC5\u987B\u662F\u5BF9\u8C61"),e.cardGroups&&!Array.isArray(e.cardGroups)&&t.push("cardGroups\u5FC5\u987B\u662F\u6570\u7EC4"),{valid:t.length===0,errors:t})}static validateFileMappingData(e){let t=[];return!e||typeof e!="object"?(t.push("\u6620\u5C04\u6570\u636E\u5FC5\u987B\u662F\u5BF9\u8C61"),{valid:!1,errors:t}):((!e.version||typeof e.version!="string")&&t.push("\u7F3A\u5C11\u6709\u6548\u7684\u7248\u672C\u4FE1\u606F"),(!e.mapping||typeof e.mapping!="object")&&t.push("\u7F3A\u5C11mapping\u5BF9\u8C61"),typeof e.lastUpdated!="number"&&t.push("lastUpdated\u5FC5\u987B\u662F\u6570\u5B57"),{valid:t.length===0,errors:t})}static sanitizeHighlight(e){let t={};return e.text&&typeof e.text=="string"&&(t.text=e.text),typeof e.position=="number"&&(t.position=e.position),typeof e.created=="number"?t.created=e.created:typeof e.createdAt=="number"&&(t.created=e.createdAt),typeof e.updated=="number"?t.updated=e.updated:typeof e.updatedAt=="number"&&(t.updated=e.updatedAt),e.backgroundColor&&typeof e.backgroundColor=="string"&&(t.backgroundColor=e.backgroundColor),e.blockId&&typeof e.blockId=="string"&&(t.blockId=e.blockId),typeof e.isCloze=="boolean"&&(t.isCloze=e.isCloze),typeof e.paragraphOffset=="number"&&(t.paragraphOffset=e.paragraphOffset),Array.isArray(e.comments)&&(t.comments=e.comments.filter(A=>A&&typeof A=="object").map(A=>this.sanitizeComment(A)).filter(A=>A.id&&A.content)),t}static sanitizeComment(e){let t={};return e.id&&typeof e.id=="string"&&(t.id=e.id),e.content&&typeof e.content=="string"&&(t.content=e.content),typeof e.created=="number"?t.created=e.created:typeof e.createdAt=="number"&&(t.created=e.createdAt),typeof e.updated=="number"?t.updated=e.updated:typeof e.updatedAt=="number"&&(t.updated=e.updatedAt),t}};var Hn=class{constructor(e){this.fileMapping=new Map;this.CURRENT_VERSION="2.0";this.app=e,this.vaultPath=""}async initialize(){await this.ensureDirectoryStructure(),await this.loadFileMapping()}async ensureDirectoryStructure(){let e=[Je.getHiNoteDir(this.vaultPath),Je.getHighlightsDir(this.vaultPath),Je.getFlashcardsDir(this.vaultPath),Je.getMetadataDir(this.vaultPath)];for(let t of e)try{await this.app.vault.adapter.mkdir(t)}catch(A){}}async loadFileMapping(){let e=`${Je.getMetadataDir(this.vaultPath)}/file-mapping.json`;try{let t=await this.app.vault.adapter.read(e),A=JSON.parse(t),i=ri.validateFileMappingData(A);if(!i.valid){console.warn("\u6587\u4EF6\u6620\u5C04\u6570\u636E\u9A8C\u8BC1\u5931\u8D25:",i.errors);return}this.fileMapping=new Map(Object.entries(A.mapping))}catch(t){this.fileMapping=new Map}}async saveFileMapping(){let e=`${Je.getMetadataDir(this.vaultPath)}/file-mapping.json`,t={version:this.CURRENT_VERSION,mapping:Object.fromEntries(this.fileMapping),lastUpdated:Date.now()};await this.app.vault.adapter.write(e,JSON.stringify(t,null,2))}getStoragePathForFile(e){let t=this.fileMapping.get(e);return t||(t=Je.toSafeFileName(e),this.fileMapping.set(e,t),this.saveFileMapping().catch(console.error)),`${Je.getHighlightsDir(this.vaultPath)}/${t}`}async getFileHighlights(e){let t=this.getStoragePathForFile(e);try{let A=await this.app.vault.adapter.read(t),i=JSON.parse(A),n=ri.validateHighlightData(i);return n.valid?Object.entries(i.highlights).map(([l,c])=>this.convertToLegacyFormat(l,c,e)):(console.warn(`\u6587\u4EF6 ${e} \u7684\u9AD8\u4EAE\u6570\u636E\u9A8C\u8BC1\u5931\u8D25:`,n.errors),[])}catch(A){return[]}}async saveFileHighlights(e,t){let A=this.getStoragePathForFile(e),i={};for(let l of t){if(!l.id)continue;let c=this.convertToOptimizedFormat(l);i[l.id]=c}let n={version:this.CURRENT_VERSION,lastModified:Date.now(),highlights:i};await this.app.vault.adapter.write(A,JSON.stringify(n,null,2))}async deleteFileHighlights(e){let t=this.getStoragePathForFile(e);try{await this.app.vault.adapter.remove(t),this.fileMapping.delete(e),await this.saveFileMapping()}catch(A){}}async handleFileRename(e,t){let A=this.getStoragePathForFile(e),i=this.getStoragePathForFile(t);try{let n=await this.app.vault.adapter.read(A);await this.app.vault.adapter.write(i,n),await this.app.vault.adapter.remove(A),this.fileMapping.delete(e),await this.saveFileMapping()}catch(n){}}async getAllHighlightFiles(){let e=Array.from(this.fileMapping.keys());if(e.length===0)try{let t=Je.getHighlightsDir(this.vaultPath),A=await this.app.vault.adapter.list(t),i=[];for(let n of A.files)if(n.endsWith(".json")){let l=n.replace(/\.json$/,"").replace(t+"/",""),c=Je.fromSafeFileName(l);i.push(c),this.fileMapping.set(c,l)}return i.length>0&&this.saveFileMapping().catch(n=>console.warn("\u4FDD\u5B58\u6587\u4EF6\u6620\u5C04\u5931\u8D25:",n)),i}catch(t){return console.warn("\u626B\u63CF\u9AD8\u4EAE\u76EE\u5F55\u5931\u8D25:",t),[]}return e}convertToLegacyFormat(e,t,A){var i;return{id:e,text:t.text,position:t.position,createdAt:t.created,updatedAt:t.updated,filePath:A,backgroundColor:t.backgroundColor,blockId:t.blockId,isCloze:t.isCloze||!1,isVirtual:t.isVirtual||!1,paragraphOffset:t.paragraphOffset,comments:((i=t.comments)==null?void 0:i.map(n=>({id:n.id,content:n.content,createdAt:n.created,updatedAt:n.updated})))||[]}}convertToOptimizedFormat(e){var i,n;let t=Date.now(),A={text:e.text,position:e.position,created:(i=e.createdAt)!=null?i:t,updated:(n=e.updatedAt)!=null?n:t};return e.backgroundColor&&(A.backgroundColor=e.backgroundColor),e.blockId&&(A.blockId=e.blockId),e.isCloze&&(A.isCloze=e.isCloze),e.isVirtual&&(A.isVirtual=e.isVirtual),e.paragraphOffset!==void 0&&(A.paragraphOffset=e.paragraphOffset),e.comments&&e.comments.length>0&&(A.comments=e.comments.map(l=>({id:l.id,content:l.content,created:l.createdAt,updated:l.updatedAt}))),A}async getFlashcardData(){let e=`${Je.getFlashcardsDir(this.vaultPath)}/cards.json`;try{let t=await this.app.vault.adapter.read(e),A=JSON.parse(t),i=ri.validateFlashcardData(A);return i.valid?A:(console.warn("\u95EA\u5361\u6570\u636E\u9A8C\u8BC1\u5931\u8D25:",i.errors),null)}catch(t){return null}}async saveFlashcardData(e){let t=`${Je.getFlashcardsDir(this.vaultPath)}/cards.json`;await this.app.vault.adapter.write(t,JSON.stringify(e,null,2))}};var Qn=class{constructor(e){this.vault=e}async parseCanvasFile(e){try{let t=await this.vault.read(e),A=JSON.parse(t),i=[];if(A&&A.nodes)for(let n of A.nodes)n.type==="file"&&n.file&&i.push(n.file);return i}catch(t){return console.error("\u89E3\u6790 Canvas \u6587\u4EF6\u5931\u8D25:",t),[]}}};var Jc=require("obsidian"),Sn=class{constructor(e){this.app=e;this.events=new Jc.Events}emitHighlightUpdate(e,t,A,i){this.events.trigger("highlight:update",e,t,A,i)}emitHighlightDelete(e,t,A){this.events.trigger("highlight:delete",e,t,A)}emitCommentUpdate(e,t,A,i){this.events.trigger("comment:update",e,t,A,i)}emitCommentDelete(e,t,A){this.events.trigger("comment:delete",e,t,A)}emitFlashcardChanged(){this.events.trigger("flashcard:changed")}on(e,t){return this.events.on(e,t)}off(e,t){this.events.off(e,t)}};var qa=require("obsidian");CA();var Un=class{constructor(e,t,A,i){this.app=e;this.repository=t;this.eventManager=A;this.highlightService=i}async addHighlight(e,t){t.id||(t.id=tt.generateHighlightId(e.path,t.position||0,t.text));let A=Date.now();t.createdAt||(t.createdAt=A),t.updatedAt=A;let i=e.path,n=await this.repository.getFileHighlights(i),l=n.findIndex(c=>c.id===t.id);if(l>=0?n[l]=t:n.push(t),await this.repository.saveFileHighlights(i,n),this.eventManager)if(t.comments&&t.comments.length>0){let c=t.comments[t.comments.length-1];this.eventManager.emitCommentUpdate(i,t.text,c.content,t.id)}else this.eventManager.emitHighlightUpdate(i,t.text,t.text,t.id);return t}async removeHighlight(e,t){let A=e.path,i=await this.repository.getFileHighlights(A);if(!i.some(c=>c.id===t.id))return!1;let l=i.filter(c=>c.id!==t.id);if(l.length>0?await this.repository.saveFileHighlights(A,l):await this.repository.deleteFileHighlights(A),this.eventManager&&t.id)if(t.comments&&t.comments.length>0){let c=t.comments[t.comments.length-1];this.eventManager.emitCommentDelete(A,c.content,t.id)}else this.eventManager.emitHighlightDelete(A,t.text,t.id);return!0}async getFileHighlights(e){return e?await this.repository.getFileHighlights(e.path):[]}async findHighlights(e,t){return e?(await this.repository.getFileHighlights(e.path)).filter(i=>i.text===t.text?typeof i.position=="number"&&typeof t.position=="number"?Math.abs(i.position-t.position)<1e3:!0:typeof i.position=="number"&&typeof t.position=="number"?Math.abs(i.position-t.position)<30:!1):[]}async findHighlightsByBlockId(e,t){return this.repository.findHighlightsByBlockId(e,t)}findHighlightById(e){return this.repository.findHighlightById(e)}async checkOrphanedDataCount(){let e=0,t=new Set,A=this.repository.getAllCachedHighlights();for(let[i,n]of A.entries()){let l=this.app.vault.getAbstractFileByPath(i);if(!l||!(l instanceof qa.TFile)){t.add(i),e+=n.length;continue}try{let c=await this.app.vault.read(l),g=this.highlightService.extractHighlights(c,l),d=new Set(g.map(C=>C.text)),m=!1;for(let C of n)C.isVirtual||d.has(C.text)||(e++,m=!0);m&&t.add(i)}catch(c){}}return{orphanedHighlights:e,affectedFiles:t.size}}async cleanOrphanedData(){let e=0,t=new Set,A=this.repository.getAllCachedHighlights();for(let[i,n]of A.entries()){let l=this.app.vault.getAbstractFileByPath(i);if(!l||!(l instanceof qa.TFile)){await this.repository.deleteFileHighlights(i),t.add(i),e+=n.length;continue}try{let c=await this.app.vault.read(l),g=this.highlightService.extractHighlights(c,l),d=new Set(g.map(C=>C.text)),m=n.filter(C=>C.isVirtual?!0:d.has(C.text));m.length<n.length&&(e+=n.length-m.length,t.add(i),m.length===0?await this.repository.deleteFileHighlights(i):await this.repository.saveFileHighlights(i,m))}catch(c){}}return{removedHighlights:e,affectedFiles:t.size}}async handleFileRename(e,t){await this.repository.handleFileRename(e,t)}};var bn=class{constructor(e){this.cache=new Map;this.dataManager=e}async initialize(){await this.dataManager.initialize(),await this.loadAllHighlightsToCache()}async loadAllHighlightsToCache(){try{let e=await this.dataManager.getAllHighlightFiles();for(let t of e)this.cache.has(t)||this.cache.set(t,[]);for(let t of e)this.loadFileHighlightsAsync(t)}catch(e){console.error("[HighlightRepository] \u52A0\u8F7D\u9AD8\u4EAE\u6587\u4EF6\u5217\u8868\u5931\u8D25:",e)}}async loadFileHighlightsAsync(e){try{let t=await this.dataManager.getFileHighlights(e);t.length>0?this.cache.set(e,t):this.cache.delete(e)}catch(t){console.warn(`[HighlightRepository] \u52A0\u8F7D\u6587\u4EF6 ${e} \u7684\u9AD8\u4EAE\u6570\u636E\u5931\u8D25:`,t)}}async getFileHighlights(e){if(this.cache.has(e))return this.cache.get(e)||[];let t=await this.dataManager.getFileHighlights(e);return this.cache.set(e,t),t}async saveFileHighlights(e,t){this.cache.set(e,t),await this.dataManager.saveFileHighlights(e,t)}async deleteFileHighlights(e){this.cache.delete(e),await this.dataManager.deleteFileHighlights(e)}async handleFileRename(e,t){await this.dataManager.handleFileRename(e,t);let A=this.cache.get(e)||[];A.forEach(i=>{i.filePath=t}),this.cache.set(t,A),this.cache.delete(e)}async getAllHighlightFiles(){return await this.dataManager.getAllHighlightFiles()}getCachedHighlights(e){return this.cache.get(e)||null}invalidateCache(e){this.cache.delete(e)}getAllCachedHighlights(){return new Map(this.cache)}findHighlightById(e){if(!e)return null;for(let t of this.cache.values()){let A=t.find(i=>i.id===e);if(A)return A}return null}findHighlightsByBlockId(e,t){if(!e||!t)return[];let A=e.path;return(this.cache.get(A)||[]).filter(n=>n.blockId===t)}};var Mn=class{constructor(e){this.plugin=e;this.isInitialized=!1;this.initializationPromise=null}async ensureInitialized(){if(!this.isInitialized){if(this.initializationPromise)return this.initializationPromise;this.initializationPromise=this.initialize(),await this.initializationPromise,this.isInitialized=!0}}async initialize(){this.eventManager=new Sn(this.plugin.app),this.dataManager=new Hn(this.plugin.app),this.highlightService=new YA(this.plugin.app),this.highlightService.initialize(),this.canvasService=new Qn(this.plugin.app.vault),this.highlightRepository=new bn(this.dataManager),this.highlightManager=new Un(this.plugin.app,this.highlightRepository,this.eventManager,this.highlightService),this.highlightRepository.initialize().catch(e=>{console.error("[HiNote] \u52A0\u8F7D\u9AD8\u4EAE\u6570\u636E\u5931\u8D25:",e)}),this.fsrsManager=new In(this.plugin,this.dataManager),this.highlightDecorator=new pn(this.plugin,this.highlightRepository),this.highlightDecorator.enable()}async cleanup(){this.highlightDecorator&&this.highlightDecorator.disable(),this.highlightService&&this.highlightService.destroy()}get initialized(){return this.isInitialized}};var xn=class extends Yc.Plugin{get highlightDecorator(){return this.initManager.highlightDecorator}get fsrsManager(){return this.initManager.fsrsManager}get eventManager(){return this.initManager.eventManager}get highlightService(){return this.initManager.highlightService}get dataManager(){return this.initManager.dataManager}get canvasService(){return this.initManager.canvasService}get highlightRepository(){return this.initManager.highlightRepository}get highlightManager(){return this.initManager.highlightManager}async onload(){let e=await this.loadData();this.settings=Object.assign({},Gt,e),window.html2canvas=$c.default,this.initManager=new Mn(this),this.windowManager=Kc(this),this.registerView(pt,t=>(this.initManager.ensureInitialized(),new at(t,this.initManager.highlightManager,this.initManager.highlightRepository))),this.addRibbonIcon("highlighter","HiNote",async()=>{await this.initManager.ensureInitialized(),await this.windowManager.openCommentPanelInSidebar()}),Rc(this,this.windowManager,()=>this.initManager.ensureInitialized()),this.addSettingTab(new An(this.app,this)),this.registerEvent(this.app.vault.on("rename",async(t,A)=>{this.initManager.initialized&&this.highlightManager&&await this.highlightManager.handleFileRename(A,t.path)}))}async onunload(){this.initManager&&await this.initManager.cleanup(),EA.instance&&EA.instance.close()}async saveSettings(){var t,A;this.settings||(this.settings={...Gt});let e=await this.loadData();e!=null&&e["flashcard-license"]&&(this.settings["flashcard-license"]=e["flashcard-license"]),this.settings.excludePatterns=(t=this.settings.excludePatterns)!=null?t:Gt.excludePatterns,this.settings.useCustomPattern=(A=this.settings.useCustomPattern)!=null?A:Gt.useCustomPattern,(!this.settings.regexRules||!Array.isArray(this.settings.regexRules))&&(this.settings.regexRules=[...Gt.regexRules]),this.settings.ai=this.settings.ai||{...Gt.ai},this.settings.export=this.settings.export||{...Gt.export},this.settings.ai.prompts||(this.settings.ai.prompts={...Gt.ai.prompts}),await this.saveData(this.settings)}};
/*! Bundled license information:

html2canvas/dist/html2canvas.js:
  (*!
   * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
   * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
   * Released under MIT License
   *)
  (*! *****************************************************************************
      Copyright (c) Microsoft Corporation.
  
      Permission to use, copy, modify, and/or distribute this software for any
      purpose with or without fee is hereby granted.
  
      THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
      REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
      AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
      INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
      LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
      OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
      PERFORMANCE OF THIS SOFTWARE.
      ***************************************************************************** *)
*/

/* nosourcemap */